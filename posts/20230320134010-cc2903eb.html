<!DOCTYPE html>
<html lang=zh-CN>
  <head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Mall商城 从头到尾，一步一步复现Mall商城项目  Mall项目主要结构mall-mbgmall-mbg模块主要用于通过MyBatis生成器生成的数据交互代码，mall-mbg模块目录结构如下  generatorConfig.xml文件对MBG进行了一些配置，如生成的实体类存储在com.macro.mall.model包下，生成的mapper接口存储在com.macro.mall.mappe">
<meta property="og:type" content="article">
<meta property="og:title" content="Mall商城">
<meta property="og:url" content="https://www.t1kcode.top/posts/20230320134010-cc2903eb.html">
<meta property="og:site_name" content="t1kcode">
<meta property="og:description" content="Mall商城 从头到尾，一步一步复现Mall商城项目  Mall项目主要结构mall-mbgmall-mbg模块主要用于通过MyBatis生成器生成的数据交互代码，mall-mbg模块目录结构如下  generatorConfig.xml文件对MBG进行了一些配置，如生成的实体类存储在com.macro.mall.model包下，生成的mapper接口存储在com.macro.mall.mappe">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="c:/Users/TAK/AppData/Roaming/Typora/typora-user-images/image-20230219155432704.png">
<meta property="og:image" content="https://www.t1kcode.top/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E8%AE%BE%E8%AE%A1/image/ums/my_ums_admin.png">
<meta property="og:image" content="https://www.t1kcode.top/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E8%AE%BE%E8%AE%A1/image/ums/my_ums_member.png">
<meta property="og:image" content="https://www.t1kcode.top/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E8%AE%BE%E8%AE%A1/image/pms/my_ums_pms.png">
<meta property="og:image" content="https://www.t1kcode.top/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E8%AE%BE%E8%AE%A1/image/cms/my_ums.png">
<meta property="og:image" content="https://www.t1kcode.top/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E8%AE%BE%E8%AE%A1/image/oms/my_oms1.png">
<meta property="og:image" content="https://www.t1kcode.top/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E8%AE%BE%E8%AE%A1/image/sms/my_sms.png">
<meta property="article:published_time" content="2023-03-20T05:40:10.000Z">
<meta property="article:modified_time" content="2023-03-25T15:56:09.913Z">
<meta property="article:author" content="t1k">
<meta property="article:tag" content="JAVA">
<meta property="article:tag" content="项目">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:/Users/TAK/AppData/Roaming/Typora/typora-user-images/image-20230219155432704.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/Rolan.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    
      <title>t1kcode·Mall商城</title>
    
    
    <!-- styles -->

    <!-- 默认CSS引入方法 -->
    
<link rel="stylesheet" href="/css/layout.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	


  
  <!-- L2Dwidget -->
  
<script src="/lib/live2d/L2Dwidget.min.js"></script>


  <script>
  // 猫
  L2Dwidget.init({
    model: {
      jsonPath: "/lib/live2d/tororo/assets/tororo.model.json",
    },
    display: {
      superSample: 2,
      width: 60,
      height: 80,
      position: 'right',
      hOffset: 0,
      vOffset: 20,
    },
    mobile: {
      show: true,
      scale: 1,
      motion: true,
    },
    react: {
      opacityDefault: 1,
      opacityOnHover: 1,
    }
  })
  //百度搜索爬虫



var _hmt = _hmt || [];
(function () {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7e9a19e5e700f1a2607b47c7bd6b35e8";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();

  </script>
  <meta name="baidu-site-verification" content="code-dIan6MAmy5" />
  

  <!-- styles -->


 
  <link
    rel="preload"
    href="/lib/font-awesome/css/all.min.css"
    as="style"
    onload="this.onload=null;this.rel='stylesheet'"
  />
  <noscript
    ><link
      rel="stylesheet"
      href="/lib/font-awesome/css/all.min.css"
  /></noscript>



<meta name="generator" content="Hexo 6.3.0"></head>


    <body class="max-width mx-auto">
     <div class="home">
        <!-- //actions_desktop 右上角导航栏 -->
      <aside id="#aside" class="hubzy_left">
        
          <div class="hubzy_logo">
	<a href="/">
		
		  
					<div id="logo" style="background-image: url(/images/logo.jpg);"></div>
					
					  
	  </a>
	  <div id="title">
		<a href="/">
		  <h1>
			t1k
		  </h1>
		</a>
		
			<!-- icon列表 -->
			  <p class="iconlist">
				<!-- # > index.find_me_on -->
				
				
				
				
				  
					<a class="icon" target="_blank" rel="noopener" href="https://github.com/t1kcode" aria-label="github">
					  <i class="fab fa-github"></i></a>
					  
			     
				  
				
				  
					<a class="icon" target="_blank" rel="noopener" href="https://gitee.com/t1kcode">
					  <i><svg class='diyIcon'  viewBox="0 0 1024 1024" ><path d="M512 1024C229.248 1024 0 794.752 0 512S229.248 0 512 0s512 229.248 512 512-229.248 512-512 512z m259.168-568.896h-290.752a25.28 25.28 0 0 0-25.28 25.28l-0.032 63.232c0 13.952 11.296 25.28 25.28 25.28h177.024a25.28 25.28 0 0 1 25.28 25.28v12.64a75.84 75.84 0 0 1-75.84 75.84h-240.224a25.28 25.28 0 0 1-25.28-25.28v-240.192a75.84 75.84 0 0 1 75.84-75.84h353.92a25.28 25.28 0 0 0 25.28-25.28l0.064-63.2a25.312 25.312 0 0 0-25.28-25.312H417.184a189.632 189.632 0 0 0-189.632 189.6v353.952c0 13.952 11.328 25.28 25.28 25.28h372.928a170.656 170.656 0 0 0 170.656-170.656v-145.376a25.28 25.28 0 0 0-25.28-25.28z"></path></svg></i>
					</a>
				  
			  
				  
				
			  </p>
			
	  </div>
</div>
<!-- 搜索栏 -->
<div id="search">
	<input class="search-input" type="text" placeholder="search">
	<span id="search-icon" class="fa fa-bars" title="展开目录"></span>
</div>

<!-- 侧边目录栏 -->
<div id="tree">
	

	
					<ul>
						<li class="file">
							<a href="/posts/20191207173653-34322.html">
								<i class="fa fa-file"></i>
								2019-12-07-个人博客搭建流程及一些问题
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20210308180810-45748.html">
								<i class="fa fa-file"></i>
								2021-03-12-单链表
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20210305160710-52078.html">
								<i class="fa fa-file"></i>
								2021-03-13-顺序表
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20210314161900-40356.html">
								<i class="fa fa-file"></i>
								2021-03-14-C++那些事
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20210323180810-48829.html">
								<i class="fa fa-file"></i>
								2021-03-23-循环链表
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20210328161810-12508.html">
								<i class="fa fa-file"></i>
								2021-03-28-双向循环链表
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20210401203910-37273.html">
								<i class="fa fa-file"></i>
								2021-04-01-栈
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20210410143910-48527.html">
								<i class="fa fa-file"></i>
								2021-04-010-基数排序
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20210402190010-36496.html">
								<i class="fa fa-file"></i>
								2021-04-02-栈的应用
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20210403143910-26671.html">
								<i class="fa fa-file"></i>
								2021-04-03-队列
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20210501195710-23384.html">
								<i class="fa fa-file"></i>
								2021-05-01-树
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20210422183910-27506.html">
								<i class="fa fa-file"></i>
								2021-4-22-查找
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20221001175710-33701.html">
								<i class="fa fa-file"></i>
								2022-10-01-JAVA基础
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20221203185710-45889.html">
								<i class="fa fa-file"></i>
								2022-12-03-电脑商城项目
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20230216100710-1bff3c65.html">
								<i class="fa fa-file"></i>
								2023-2-16-MyBatis
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20230218080710-bed8b4fb.html">
								<i class="fa fa-file"></i>
								2023-2-18-MyBatis Generator
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20230227202410-ed4aca2b.html">
								<i class="fa fa-file"></i>
								2023-2-27-SpringSecurityJWT
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20230311163310-3b72b36d.html">
								<i class="fa fa-file"></i>
								2023-3-11-Mall整合SpringTask
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20230311153410-8ead567e.html">
								<i class="fa fa-file"></i>
								2023-3-11-MongoDB
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20230314103110-e0a3f475.html">
								<i class="fa fa-file"></i>
								2023-3-14-RabbitMQ_JAVA
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20230315220410-e0a3f475.html">
								<i class="fa fa-file"></i>
								2023-3-15-Mall整合RabbitMQ
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20230317105310-7d1f0793.html">
								<i class="fa fa-file"></i>
								2023-3-17-SpringBoot中使用AOP记录接口访问日志
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20230302211010-feec57d.html">
								<i class="fa fa-file"></i>
								2023-3-2-Spring Data Redis
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file active">
							<a href="/posts/20230320134010-cc2903eb.html">
								<i class="fa fa-file"></i>
								2023-3-20-Mall商城
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20230323121710-57e98fa8.html">
								<i class="fa fa-file"></i>
								2023-3-23-Mall整合Elasticsearch
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20230302105710-8aebab8e.html">
								<i class="fa fa-file"></i>
								2023-3-3-Mall-SpringSecurity-JWT
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20230303201610-6b63fba0.html">
								<i class="fa fa-file"></i>
								2023-3-3-Swagger-UI
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/posts/20230305194310-d48132d3.html">
								<i class="fa fa-file"></i>
								2023-3-5-ElasticSearch
							</a>
						</li>
					</ul>
	
</div>

        
      </aside>
      <div id="header-post" class="hubzy_right">
        
          
  <!-- <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a> -->
  <!-- <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a> -->
  <!-- <a id="top-icon-tablet" href="#" "Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"
    style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a> -->
  <span id="menu">
    <span id="nav">
      <ul>
        
          <li><a href="/blog/">
              首页
            </a></li>
          
          <li><a href="/archives/">
              归档
            </a></li>
          
          <li><a href="/">
              关于
            </a></li>
          
      </ul>
    </span>
    <br />
    <div id="toc">
      
    </div>
    <br />
    <span id="actions">
      <ul>
        <!--// 
          <li><a class="icon" aria-label="上一篇 " href="/posts/20230323121710-57e98fa8.html"><i
                class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();"
                onmouseout="$('#i-prev').toggle();"></i></a></li>
          
            
              <li><a class="icon" aria-label="下一篇 " href="/posts/20230317105310-7d1f0793.html"><i
                    class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();"
                    onmouseout="$('#i-next').toggle();"></i></a></li>
              // -->
                <li><a class="icon" aria-label="返回顶部 " href="#"
                    onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up"
                      aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a>
                </li>
                <li><a class="icon" aria-label="分享文章 " href="#"><i class="fas fa-share-alt"
                      aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();"
                      onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">
        上一篇
      </span>
      <span id="i-next" class="info" style="display:none;">
        下一篇
      </span>
      <span id="i-top" class="info" style="display:none;">
        返回顶部
      </span>
      <span id="i-share" class="info" style="display:none;">
        分享文章
      </span>
    </span>
    <br />
    <div id="share" style="display: none">
      <ul>
  <li> 开发中. </li>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&text=Mall商城"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&title=Mall商城"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&is_video=false&description=Mall商城"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Mall商城&body=Check out this article: https://www.t1kcode.top/posts/20230320134010-cc2903eb.html"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&title=Mall商城"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&title=Mall商城"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&title=Mall商城"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&title=Mall商城"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&name=Mall商城&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&t=Mall商城"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li> -->

</ul>

    </div>

  </span>

        
      </div>
       
      <div class="content  hubzy_center">
        
          <!-- //body 引入首页和md编译后的页面 -->
          <!-- md 编译成 html 后的文件模板 -->

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="hubzy_center_title">
    
    <h1 class="posttitle" itemprop="name headline">
        Mall商城
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">t1k</span>
      </span>
      <!-- 文章时间和首页时间 -->

    <div class="postdate">
      
        <time datetime="2023-03-20T05:40:10.000Z" itemprop="datePublished">2023-03-20</time>
        
        <!-- (Updated: <time datetime="2023-03-25T15:56:09.913Z" itemprop="dateModified">2023-03-25</time>) -->
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a> › <a class="category-link" href="/categories/%E9%A1%B9%E7%9B%AE/JAVA/">JAVA</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/JAVA/" rel="tag">JAVA</a>, <a class="tag-link-link" href="/tags/%E9%A1%B9%E7%9B%AE/" rel="tag">项目</a>
    </div>


    </div>
  </header>
  

  <div class="content conterDiy"  id="article" itemprop="articleBody">
    <em class="nubScript">
        ·本篇:28.4k字 大约需要: 152分钟
    </em>
    <h1 id="Mall商城"><a href="#Mall商城" class="headerlink" title="Mall商城"></a>Mall商城</h1><blockquote>
<p><strong>从头到尾，一步一步复现Mall商城项目</strong></p>
</blockquote>
<h2 id="Mall项目主要结构"><a href="#Mall项目主要结构" class="headerlink" title="Mall项目主要结构"></a>Mall项目主要结构</h2><h3 id="mall-mbg"><a href="#mall-mbg" class="headerlink" title="mall-mbg"></a>mall-mbg</h3><p><strong><code>mall-mbg</code>模块主要用于通过MyBatis生成器生成的数据交互代码，<code>mall-mbg</code>模块目录结构如下</strong></p>
<p><img src="C:/Users/TAK/AppData/Roaming/Typora/typora-user-images/image-20230219155432704.png" alt="mall-mbg模块目录结构"></p>
<p><strong><code>generatorConfig.xml</code>文件对MBG进行了一些配置，如生成的实体类存储在<code>com.macro.mall.model</code>包下，生成的<code>mapper</code>接口存储在<code>com.macro.mall.mapper</code>包下，生成的<code>mapper.xml</code>文件放在<code>resources</code>中的<code>com.macro.mall.mapper</code>目录下</strong></p>
<p><strong><code>CommentGenerator.java</code>继承了<code>DefaultCommentGenerator</code>，可以自定义实体类代码的生成，这里添加了<code>Swagger</code>注解的支持</strong></p>
<h3 id="mall-common"><a href="#mall-common" class="headerlink" title="mall-common"></a>mall-common</h3><p>分页插件<artifactId>pagehelper-spring-boot-starter</artifactId>和<artifactId>pagehelper</artifactId>的区别</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_33770878/article/details/88657125">SpringBoot之分页PageHelper 求求别误导了_weixin_33770878的博客-CSDN博客</a></p>
<p>先对pom.xml文件进行分析，再对包结构进行分析。</p>
<p>validation进行数据的合理性校验</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/444925714">SpringBoot 使用validation数据校验-超级详细超级多干货 - 第406篇 - 知乎 (zhihu.com)</a></p>
<p>还是先从mbg模块开始</p>
<p>&#x2F;&#x2F; TODO</p>
<p>应该分析下各模块的实现思路</p>
<h2 id="Mall项目主要结构-1"><a href="#Mall项目主要结构-1" class="headerlink" title="Mall项目主要结构"></a>Mall项目主要结构</h2><h3 id="mall-admin"><a href="#mall-admin" class="headerlink" title="mall-admin"></a>mall-admin</h3><p><strong>后台商城管理系统接口</strong></p>
<h3 id="mall-portal"><a href="#mall-portal" class="headerlink" title="mall-portal"></a>mall-portal</h3><p><strong>前台商城系统接口</strong></p>
<h3 id="mall-common-1"><a href="#mall-common-1" class="headerlink" title="mall-common"></a>mall-common</h3><p><strong>工具类及通用代码</strong></p>
<h3 id="mall-mbg-1"><a href="#mall-mbg-1" class="headerlink" title="mall-mbg"></a>mall-mbg</h3><p><strong>MyBatis Generator生成的数据库操作代码</strong></p>
<h3 id="mall-search"><a href="#mall-search" class="headerlink" title="mall-search"></a>mall-search</h3><p><strong>基于Elasticsearch的商品搜索系统</strong></p>
<h3 id="mall-security"><a href="#mall-security" class="headerlink" title="mall-security"></a>mall-security</h3><p><strong>SpringSecurity封装公用模块</strong></p>
<h2 id="mall-common模块"><a href="#mall-common模块" class="headerlink" title="mall-common模块"></a>mall-common模块</h2><h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringWeb启动项--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring-boot-starter-validation可以用来校验SpringMVC的入参，</span></span><br><span class="line"><span class="comment">        也就是可以用来校验参数的合理性--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Mybatis分页插件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringData Redis--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringData工具包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--集成logstash--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.logstash.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logstash-logback-encoder<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Swagger-UI API文档生产工具--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="包结构"><a href="#包结构" class="headerlink" title="包结构"></a>包结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mall-common</span><br><span class="line">└─com</span><br><span class="line">    └─macro</span><br><span class="line">        └─mall</span><br><span class="line">            └─common</span><br><span class="line">                ├─api</span><br><span class="line">                ├─config</span><br><span class="line">                ├─domain</span><br><span class="line">                ├─exception</span><br><span class="line">                ├─log</span><br><span class="line">                ├─service</span><br><span class="line">                │  └─impl</span><br><span class="line">                └─util</span><br></pre></td></tr></table></figure>

<p><strong>mall-common模块的包都统一放在了com.macro.mall.common包下</strong></p>
<ul>
<li><p><strong>api包中存放了一些封装了通用返回结果的类，用于前后端交互</strong></p>
</li>
<li><p><strong>config包中存放了Redis基础配置和Swagger基础配置类，如果其他模块也需要配置Redis和Swagger，可以直接继承该类</strong></p>
</li>
<li><p><strong>domain包中存放了Swagger的自定义配置和Controller层的日志封装类</strong></p>
</li>
<li><p><strong>exception包中存放了一些异常处理类</strong></p>
</li>
<li><p><strong>log包中存放了统一日志处理切面类</strong></p>
</li>
<li><p><strong>service包中存放了Redis相关操作业务类</strong></p>
</li>
<li><p><strong>util包中存放了请求工具类</strong></p>
</li>
</ul>
<h3 id="主要代码分析"><a href="#主要代码分析" class="headerlink" title="主要代码分析"></a>主要代码分析</h3><h4 id="全局异常处理类"><a href="#全局异常处理类" class="headerlink" title="全局异常处理类"></a>全局异常处理类</h4><ul>
<li><strong>@ControllerAdvice：用于捕获全局异常，能作用于所有controller中</strong></li>
<li><strong>@ExceptionHandler：修饰方法，表示该方法为处理全局异常的方法</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.macro.mall.common.exception;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局异常处理类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 常与 @ExceptionHandler 注解一起使用，用于捕获全局异常，能作用于所有controller中</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="comment">// 修饰方法，表示该方法为处理全局异常的方法，value表示能处理的异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = ApiException.class)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">handle</span><span class="params">(ApiException e)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (e.getErrorCode() != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed(e.getErrorCode());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">handleValidException</span><span class="params">(MethodArgumentNotValidException e)</span> &#123;</span><br><span class="line">        <span class="type">BindingResult</span> <span class="variable">bindingResult</span> <span class="operator">=</span> e.getBindingResult();</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (bindingResult.hasErrors()) &#123;</span><br><span class="line">            <span class="type">FieldError</span> <span class="variable">fieldError</span> <span class="operator">=</span> bindingResult.getFieldError();</span><br><span class="line">            <span class="keyword">if</span> (fieldError != <span class="literal">null</span>) &#123;</span><br><span class="line">                message = fieldError.getField() + fieldError.getDefaultMessage();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.validateFailed(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = BindException.class)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">handleValidException</span><span class="params">(BindException e)</span> &#123;</span><br><span class="line">        <span class="type">BindingResult</span> <span class="variable">bindingResult</span> <span class="operator">=</span> e.getBindingResult();</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (bindingResult.hasErrors()) &#123;</span><br><span class="line">            <span class="type">FieldError</span> <span class="variable">fieldError</span> <span class="operator">=</span> bindingResult.getFieldError();</span><br><span class="line">            <span class="keyword">if</span> (fieldError != <span class="literal">null</span>) &#123;</span><br><span class="line">                message = fieldError.getField() + fieldError.getDefaultMessage();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.validateFailed(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="统一日志处理切面"><a href="#统一日志处理切面" class="headerlink" title="统一日志处理切面"></a>统一日志处理切面</h4><ul>
<li><strong>@Aspect：表示该类为切面类</strong></li>
<li><strong>@Around()：通知方法会将目标方法封装起来</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统一日志处理切面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 表示该类为切面类</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebLogAspect</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(WebLogAspect.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 切点表达式</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(public * com.macro.mall.controller.*.*(..))||execution(public * com.macro.mall.*.controller.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">webLog</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 表示被增强方法执行之前调用</span></span><br><span class="line">    <span class="meta">@Before(&quot;webLog()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doBefore</span><span class="params">(JoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable</span><br><span class="line">    &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;webLog()&quot;, returning = &quot;ret&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterReturning</span><span class="params">(Object ret)</span> <span class="keyword">throws</span> Throwable</span><br><span class="line">    &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通知方法会将目标方法封装起来</span></span><br><span class="line">    <span class="meta">@Around(&quot;webLog()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doAround</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 返回当前时间</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//获取当前请求对象</span></span><br><span class="line">        <span class="type">ServletRequestAttributes</span> <span class="variable">attributes</span> <span class="operator">=</span></span><br><span class="line">                (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> Objects.requireNonNull(attributes).getRequest();</span><br><span class="line">        <span class="comment">//记录请求信息(通过Logstash传入Elasticsearch)</span></span><br><span class="line">        <span class="type">WebLog</span> <span class="variable">webLog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebLog</span>();</span><br><span class="line">        <span class="comment">// 目标方法执行</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line">        <span class="comment">// 获取签名</span></span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">methodSignature</span> <span class="operator">=</span> (MethodSignature) signature;</span><br><span class="line">        <span class="comment">// 获取到目标方法</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> methodSignature.getMethod();</span><br><span class="line">        <span class="comment">// 判断该方法是否有ApiOperation注解</span></span><br><span class="line">        <span class="keyword">if</span>(method.isAnnotationPresent(ApiOperation.class))&#123;</span><br><span class="line">            <span class="comment">// 获取ApiOperation注解的value，加入到log</span></span><br><span class="line">            <span class="type">ApiOperation</span> <span class="variable">log</span> <span class="operator">=</span> method.getAnnotation(ApiOperation.class);</span><br><span class="line">            webLog.setDescription(log.value());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取目标方法执行结束时间</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 构造日志对象</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">urlStr</span> <span class="operator">=</span> request.getRequestURL().toString();</span><br><span class="line">        LOGGER.info(<span class="string">&quot;urlStr = &#123;&#125;&quot;</span>, urlStr);</span><br><span class="line">        webLog.setBasePath(StrUtil.removeSuffix(urlStr, URLUtil.url(urlStr).getPath()));</span><br><span class="line">        webLog.setUsername(request.getRemoteUser());</span><br><span class="line">        webLog.setIp(RequestUtil.getRequestIp(request));</span><br><span class="line">        webLog.setMethod(request.getMethod());</span><br><span class="line">        <span class="comment">// 处理目标方法请求参数</span></span><br><span class="line">        webLog.setParameter(getParameter(method, joinPoint.getArgs()));</span><br><span class="line">        webLog.setResult(result);</span><br><span class="line">        webLog.setSpendTime((<span class="type">int</span>) (endTime - startTime));</span><br><span class="line">        webLog.setStartTime(startTime);</span><br><span class="line">        webLog.setUri(request.getRequestURI());</span><br><span class="line">        webLog.setUrl(request.getRequestURL().toString());</span><br><span class="line">        Map&lt;String, Object&gt; logMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        logMap.put(<span class="string">&quot;url&quot;</span>, webLog.getUrl());</span><br><span class="line">        logMap.put(<span class="string">&quot;method&quot;</span>, webLog.getMethod());</span><br><span class="line">        logMap.put(<span class="string">&quot;parameter&quot;</span>, webLog.getParameter());</span><br><span class="line">        logMap.put(<span class="string">&quot;spendTime&quot;</span>, webLog.getSpendTime());</span><br><span class="line">        logMap.put(<span class="string">&quot;description&quot;</span>, webLog.getDescription());</span><br><span class="line">        <span class="comment">//        LOGGER.info(&quot;&#123;&#125;&quot;, JSONUtil.parse(webLog));</span></span><br><span class="line">        LOGGER.info(Markers.appendEntries(logMap), JSONUtil.parse(webLog).toString());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据方法和传入的参数获取请求参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">getParameter</span><span class="params">(Method method, Object[] args)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;Object&gt; argList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Parameter[] parameters = method.getParameters();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; parameters.length; i++)&#123;</span><br><span class="line">            <span class="comment">//将RequestBody注解修饰的参数作为请求参数</span></span><br><span class="line">            <span class="type">RequestBody</span> <span class="variable">requestBody</span> <span class="operator">=</span> parameters[i].getAnnotation(RequestBody.class);</span><br><span class="line">            <span class="keyword">if</span>(requestBody != <span class="literal">null</span>)&#123;</span><br><span class="line">                argList.add(args[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//将RequestParam注解修饰的参数作为请求参数</span></span><br><span class="line">            <span class="type">RequestParam</span> <span class="variable">requestParam</span> <span class="operator">=</span> parameters[i].getAnnotation(RequestParam.class);</span><br><span class="line">            <span class="keyword">if</span>(requestParam != <span class="literal">null</span>)&#123;</span><br><span class="line">                Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> parameters[i].getName();</span><br><span class="line">                <span class="keyword">if</span>(!StrUtil.isEmpty(requestParam.value()))&#123;</span><br><span class="line">                    key = requestParam.value();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(args[i] != <span class="literal">null</span>)&#123;</span><br><span class="line">                    map.put(key, args[i]);</span><br><span class="line">                    argList.add(map);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(argList.size() == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(argList.size() == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> argList.get(<span class="number">0</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> argList;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="mall-mbg模块"><a href="#mall-mbg模块" class="headerlink" title="mall-mbg模块"></a>mall-mbg模块</h2><h3 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--工具类及通用代码模块--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.macro.mall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mall-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--MyBatis分页插件starter--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--集成druid连接池--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- MyBatis 生成器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Mysql数据库驱动--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="包结构-1"><a href="#包结构-1" class="headerlink" title="包结构"></a>包结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mall-mbg</span><br><span class="line">├─java</span><br><span class="line">│  └─com</span><br><span class="line">│      └─macro</span><br><span class="line">│          └─mall</span><br><span class="line">│              ├─mapper</span><br><span class="line">│              └─model</span><br><span class="line">└─resources</span><br><span class="line">    └─com</span><br><span class="line">        └─macro</span><br><span class="line">            └─mall</span><br><span class="line">                └─mapper</span><br></pre></td></tr></table></figure>

<p><strong>mall-mbg模块的包都统一放在com.macro.mall包下</strong></p>
<ul>
<li><strong>mapper包中存放了MyBatis Generator生成的数据库中相关表的mapper</strong></li>
<li><strong>model包中存放了MyBatis Generator生成的数据库中相关表的实体类</strong></li>
<li><strong>resources中com.macro.mall.mapper文件夹下存放了mapper包中对应的mapper.xml文件</strong></li>
</ul>
<h2 id="mall-search模块"><a href="#mall-search模块" class="headerlink" title="mall-search模块"></a>mall-search模块</h2><h3 id="pom-xml-2"><a href="#pom-xml-2" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mall中MBG生成模块--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.macro.mall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mall-mbg<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--SpringBoot-Data-elasticsearch--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="包结构-2"><a href="#包结构-2" class="headerlink" title="包结构"></a>包结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mall-search</span><br><span class="line">├─java</span><br><span class="line">│  └─com</span><br><span class="line">│      └─macro</span><br><span class="line">│          └─mall</span><br><span class="line">│              └─search</span><br><span class="line">│                  ├─config</span><br><span class="line">│                  ├─controller</span><br><span class="line">│                  ├─dao</span><br><span class="line">│                  ├─domain</span><br><span class="line">│                  ├─repository</span><br><span class="line">│                  └─service</span><br><span class="line">│                      └─impl</span><br><span class="line">└─resources</span><br><span class="line">    └─dao</span><br></pre></td></tr></table></figure>

<p><strong>mall-search模块的包都统一放在com.macro.mall.search包下</strong></p>
<ul>
<li><strong>config包中存放了一些配置类</strong></li>
<li><strong>controller包中存放了商品搜索管理的接口</strong></li>
<li><strong>dao包中存放了商品搜索的自定义Dao，主要用来将数据库中的商品导入ES</strong></li>
<li><strong>domain包中存放了商品的相关信息类</strong></li>
<li><strong>repository包中存放了ES操作类</strong></li>
<li><strong>service包中存放了商品搜索管理的业务类</strong></li>
</ul>
<h3 id="主要代码分析-1"><a href="#主要代码分析-1" class="headerlink" title="主要代码分析"></a>主要代码分析</h3><h4 id="搜索商品的信息类"><a href="#搜索商品的信息类" class="headerlink" title="搜索商品的信息类"></a>搜索商品的信息类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索商品的信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="comment">// indexName索引名称，表示该类为文档</span></span><br><span class="line"><span class="meta">@Document(indexName = &quot;pms&quot;)</span></span><br><span class="line"><span class="comment">// shards：分片，replicas：副本</span></span><br><span class="line"><span class="meta">@Setting(shards = 1, replicas = 0)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EsProduct</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@Field(type = FieldType.Keyword)</span></span><br><span class="line">    <span class="keyword">private</span> String productSn;</span><br><span class="line">    <span class="keyword">private</span> Long brandId;</span><br><span class="line">    <span class="meta">@Field(type = FieldType.Keyword)</span></span><br><span class="line">    <span class="keyword">private</span> String brandName;</span><br><span class="line">    <span class="keyword">private</span> Long productCategoryId;</span><br><span class="line">    <span class="meta">@Field(type = FieldType.Keyword)</span></span><br><span class="line">    <span class="keyword">private</span> String productCategoryName;</span><br><span class="line">    <span class="keyword">private</span> String pic;</span><br><span class="line">    <span class="meta">@Field(analyzer = &quot;ik_max_word&quot;, type = FieldType.Text)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Field(analyzer = &quot;ik_max_word&quot;, type = FieldType.Text)</span></span><br><span class="line">    <span class="keyword">private</span> String subTitle;</span><br><span class="line">    <span class="meta">@Field(analyzer = &quot;ik_max_word&quot;, type = FieldType.Text)</span></span><br><span class="line">    <span class="keyword">private</span> String keywords;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> Integer sale;</span><br><span class="line">    <span class="keyword">private</span> Integer newStatus;</span><br><span class="line">    <span class="keyword">private</span> Integer recommandStatus;</span><br><span class="line">    <span class="keyword">private</span> Integer stock;</span><br><span class="line">    <span class="keyword">private</span> Integer promotionType;</span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line">    <span class="meta">@Field(type = FieldType.Nested, fielddata = true)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;EsProductAttributeValue&gt; attrValueList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="搜索商品管理业务类"><a href="#搜索商品管理业务类" class="headerlink" title="搜索商品管理业务类"></a>搜索商品管理业务类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索商品管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EsProductService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从数据库中导入所有商品到ES</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">importAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id删除商品</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id创建商品</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    EsProduct <span class="title function_">create</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除商品</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据关键字搜索名称或者副标题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Page&lt;EsProduct&gt; <span class="title function_">search</span><span class="params">(String keyword, Integer pageNum, Integer pageSize)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据关键字搜索名称或者副标题复合查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Page&lt;EsProduct&gt; <span class="title function_">search</span><span class="params">(String keyword, Long brandId, Long productCategoryId, Integer pageNum, Integer pageSize,</span></span><br><span class="line"><span class="params">                           Integer sort)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据商品id推荐相关商品</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Page&lt;EsProduct&gt; <span class="title function_">recommend</span><span class="params">(Long id, Integer pageNum, Integer pageSize)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取搜索词相关品牌、分类、属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    EsProductRelatedInfo <span class="title function_">searchRelatedInfo</span><span class="params">(String keyword)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索商品管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EsProductServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">EsProductService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(EsProductServiceImpl.class);</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> EsProductDao productDao;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> EsProductRepository productRepository;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ElasticsearchRestTemplate elasticsearchRestTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">importAll</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 从数据库中获取所有商品数据信息</span></span><br><span class="line">        List&lt;EsProduct&gt; esProductList = productDao.getAllEsProductList(<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// 将数据库中的商品信息导入ES</span></span><br><span class="line">        Iterable&lt;EsProduct&gt; esProductIterable = productRepository.saveAll(esProductList);</span><br><span class="line">        <span class="comment">// 获取相应对象的迭代器</span></span><br><span class="line">        Iterator&lt;EsProduct&gt; iterator = esProductIterable.iterator();</span><br><span class="line">        <span class="comment">// 统计导入的数据条数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">            result++;</span><br><span class="line">            iterator.next();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        productRepository.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> EsProduct <span class="title function_">create</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">EsProduct</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// 从数据库中获取该id的商品信息</span></span><br><span class="line">        List&lt;EsProduct&gt; esProductList = productDao.getAllEsProductList(id);</span><br><span class="line">        <span class="comment">// 将该商品信息导入ES</span></span><br><span class="line">        <span class="keyword">if</span>(esProductList.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">EsProduct</span> <span class="variable">esProduct</span> <span class="operator">=</span> esProductList.get(<span class="number">0</span>);</span><br><span class="line">            result = productRepository.save(esProduct);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!CollectionUtils.isEmpty(ids))&#123;</span><br><span class="line">            List&lt;EsProduct&gt; esProductList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span>(Long id : ids)&#123;</span><br><span class="line">                <span class="type">EsProduct</span> <span class="variable">esProduct</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EsProduct</span>();</span><br><span class="line">                esProduct.setId(id);</span><br><span class="line">                esProductList.add(esProduct);</span><br><span class="line">            &#125;</span><br><span class="line">            productRepository.deleteAll(esProductList);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Page&lt;EsProduct&gt; <span class="title function_">search</span><span class="params">(String keyword, Integer pageNum, Integer pageSize)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(pageNum, pageSize);</span><br><span class="line">        <span class="keyword">return</span> productRepository.findByNameOrSubTitleOrKeywords(keyword, keyword, keyword, pageable);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Page&lt;EsProduct&gt; <span class="title function_">search</span><span class="params">(String keyword, Long brandId, Long productCategoryId, Integer pageNum,</span></span><br><span class="line"><span class="params">                                  Integer pageSize, Integer sort)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取分页信息包装类</span></span><br><span class="line">        <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(pageNum, pageSize);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// NativeSearchQuery查询对象构造器</span></span><br><span class="line">        <span class="type">NativeSearchQueryBuilder</span> <span class="variable">nativeSearchQueryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NativeSearchQueryBuilder</span>();</span><br><span class="line">        <span class="comment">//分页</span></span><br><span class="line">        nativeSearchQueryBuilder.withPageable(pageable);</span><br><span class="line">        <span class="comment">//过滤</span></span><br><span class="line">        <span class="keyword">if</span>(brandId != <span class="literal">null</span> || productCategoryId != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 获取bool查询对象构造器</span></span><br><span class="line">            <span class="type">BoolQueryBuilder</span> <span class="variable">boolQueryBuilder</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line">            <span class="keyword">if</span>(brandId != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">// terms查询，基于关键字查询</span></span><br><span class="line">                boolQueryBuilder.must(QueryBuilders.termQuery(<span class="string">&quot;brandId&quot;</span>, brandId));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(productCategoryId != <span class="literal">null</span>)&#123;</span><br><span class="line">                boolQueryBuilder.must(QueryBuilders.termQuery(<span class="string">&quot;productCategoryId&quot;</span>, productCategoryId));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 加入过滤条件</span></span><br><span class="line">            nativeSearchQueryBuilder.withFilter(boolQueryBuilder);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//搜索</span></span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isEmpty(keyword))&#123;</span><br><span class="line">            <span class="comment">// 如果关键词为空，则查询所有文档</span></span><br><span class="line">            nativeSearchQueryBuilder.withQuery(QueryBuilders.matchAllQuery());</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 过滤器列表</span></span><br><span class="line">            List&lt;FunctionScoreQueryBuilder.FilterFunctionBuilder&gt; filterFunctionBuilders = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="comment">// 过滤函数构造器</span></span><br><span class="line">            filterFunctionBuilders.add(<span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span></span><br><span class="line">                    .FilterFunctionBuilder(QueryBuilders.matchQuery(<span class="string">&quot;name&quot;</span>, keyword),</span><br><span class="line">                                           ScoreFunctionBuilders.weightFactorFunction(<span class="number">10</span>))); <span class="comment">// 设置多字段查询权重</span></span><br><span class="line">            filterFunctionBuilders.add(<span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span></span><br><span class="line">                    .FilterFunctionBuilder(QueryBuilders.matchQuery(<span class="string">&quot;subTitle&quot;</span>, keyword),</span><br><span class="line">                                           ScoreFunctionBuilders.weightFactorFunction(<span class="number">5</span>)));</span><br><span class="line">            filterFunctionBuilders.add(<span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span></span><br><span class="line">                    .FilterFunctionBuilder(QueryBuilders.matchQuery(<span class="string">&quot;keywords&quot;</span>, keyword),</span><br><span class="line">                                           ScoreFunctionBuilders.weightFactorFunction(<span class="number">2</span>)));</span><br><span class="line">            FunctionScoreQueryBuilder.FilterFunctionBuilder[] builders = <span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span></span><br><span class="line">                    .FilterFunctionBuilder[filterFunctionBuilders.size()];</span><br><span class="line">            filterFunctionBuilders.toArray(builders); <span class="comment">// 转换为数组形式</span></span><br><span class="line">            <span class="type">FunctionScoreQueryBuilder</span> <span class="variable">functionScoreQueryBuilder</span> <span class="operator">=</span> QueryBuilders.functionScoreQuery(builders)</span><br><span class="line">                                                                               .scoreMode(FunctionScoreQuery.ScoreMode.SUM) <span class="comment">// 对结果分数求和</span></span><br><span class="line">                                                                               .setMinScore(<span class="number">2</span>);</span><br><span class="line">            <span class="comment">// 添加过滤条件</span></span><br><span class="line">            nativeSearchQueryBuilder.withQuery(functionScoreQueryBuilder);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//排序</span></span><br><span class="line">        <span class="keyword">if</span>(sort == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">//按新品从新到旧</span></span><br><span class="line">            nativeSearchQueryBuilder.withSorts(SortBuilders.fieldSort(<span class="string">&quot;id&quot;</span>).order(SortOrder.DESC));</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(sort == <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="comment">//按销量从高到低</span></span><br><span class="line">            nativeSearchQueryBuilder.withSorts(SortBuilders.fieldSort(<span class="string">&quot;sale&quot;</span>).order(SortOrder.DESC));</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(sort == <span class="number">3</span>)&#123;</span><br><span class="line">            <span class="comment">//按价格从低到高</span></span><br><span class="line">            nativeSearchQueryBuilder.withSorts(SortBuilders.fieldSort(<span class="string">&quot;price&quot;</span>).order(SortOrder.ASC));</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(sort == <span class="number">4</span>)&#123;</span><br><span class="line">            <span class="comment">//按价格从高到低</span></span><br><span class="line">            nativeSearchQueryBuilder.withSorts(SortBuilders.fieldSort(<span class="string">&quot;price&quot;</span>).order(SortOrder.DESC));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//按相关度，即文档得分</span></span><br><span class="line">            nativeSearchQueryBuilder.withSorts(SortBuilders.scoreSort().order(SortOrder.DESC));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 按相关度</span></span><br><span class="line">        nativeSearchQueryBuilder.withSorts(SortBuilders.scoreSort().order(SortOrder.DESC));</span><br><span class="line">        <span class="comment">// NativeSearchQuery 查询对象</span></span><br><span class="line">        <span class="type">NativeSearchQuery</span> <span class="variable">searchQuery</span> <span class="operator">=</span> nativeSearchQueryBuilder.build();</span><br><span class="line">        LOGGER.info(<span class="string">&quot;DSL:&#123;&#125;&quot;</span>, Objects.requireNonNull(searchQuery.getQuery()));</span><br><span class="line">        <span class="comment">// 查询结果Hit数组</span></span><br><span class="line">        SearchHits&lt;EsProduct&gt; searchHits = elasticsearchRestTemplate.search(searchQuery, EsProduct.class);</span><br><span class="line">        <span class="comment">// 查询到的总条数</span></span><br><span class="line">        <span class="keyword">if</span>(searchHits.getTotalHits() &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">// 没有查询到，返回空</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageImpl</span>&lt;&gt;(ListUtil.empty(), pageable, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取查询到的对象</span></span><br><span class="line">        List&lt;EsProduct&gt; searchProductList = searchHits.stream()</span><br><span class="line">                                                      .map(SearchHit::getContent)</span><br><span class="line">                                                      .collect(Collectors.toList());</span><br><span class="line">        <span class="comment">// 封装为分页对象返回</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageImpl</span>&lt;&gt;(searchProductList, pageable, searchHits.getTotalHits());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Page&lt;EsProduct&gt; <span class="title function_">recommend</span><span class="params">(Long id, Integer pageNum, Integer pageSize)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 封装分页信息对象</span></span><br><span class="line">        <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(pageNum, pageSize);</span><br><span class="line">        <span class="comment">// 从数据库中获取对应id商品</span></span><br><span class="line">        List&lt;EsProduct&gt; esProductList = productDao.getAllEsProductList(id);</span><br><span class="line">        <span class="comment">// 如果获取到该商品</span></span><br><span class="line">        <span class="keyword">if</span>(esProductList.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">// 获取该商品对象</span></span><br><span class="line">            <span class="type">EsProduct</span> <span class="variable">esProduct</span> <span class="operator">=</span> esProductList.get(<span class="number">0</span>);</span><br><span class="line">            <span class="comment">// 获取商品名</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">keyword</span> <span class="operator">=</span> esProduct.getName();</span><br><span class="line">            <span class="comment">// 获取品牌id</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">brandId</span> <span class="operator">=</span> esProduct.getBrandId();</span><br><span class="line">            <span class="comment">// 获取商品属性类别id</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">productCategoryId</span> <span class="operator">=</span> esProduct.getProductCategoryId();</span><br><span class="line">            <span class="comment">// 根据商品标题、品牌、分类进行搜索</span></span><br><span class="line">            <span class="comment">// 多字段权重排序</span></span><br><span class="line">            List&lt;FunctionScoreQueryBuilder.FilterFunctionBuilder&gt; filterFunctionBuilders = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">            filterFunctionBuilders.add(<span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span></span><br><span class="line">                    .FilterFunctionBuilder(QueryBuilders.matchQuery(<span class="string">&quot;name&quot;</span>, keyword),</span><br><span class="line">                                           ScoreFunctionBuilders.weightFactorFunction(<span class="number">8</span>)));</span><br><span class="line">            filterFunctionBuilders.add(<span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span></span><br><span class="line">                    .FilterFunctionBuilder(QueryBuilders.matchQuery(<span class="string">&quot;subTitle&quot;</span>, keyword),</span><br><span class="line">                                           ScoreFunctionBuilders.weightFactorFunction(<span class="number">2</span>)));</span><br><span class="line">            filterFunctionBuilders.add(<span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span></span><br><span class="line">                    .FilterFunctionBuilder(QueryBuilders.matchQuery(<span class="string">&quot;keywords&quot;</span>, keyword),</span><br><span class="line">                                           ScoreFunctionBuilders.weightFactorFunction(<span class="number">2</span>)));</span><br><span class="line">            filterFunctionBuilders.add(<span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span></span><br><span class="line">                    .FilterFunctionBuilder(QueryBuilders.matchQuery(<span class="string">&quot;brandId&quot;</span>, brandId),</span><br><span class="line">                                           ScoreFunctionBuilders.weightFactorFunction(<span class="number">5</span>)));</span><br><span class="line">            filterFunctionBuilders.add(<span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span></span><br><span class="line">                    .FilterFunctionBuilder(QueryBuilders.matchQuery(<span class="string">&quot;productCategoryId&quot;</span>, productCategoryId),</span><br><span class="line">                                           ScoreFunctionBuilders.weightFactorFunction(<span class="number">3</span>)));</span><br><span class="line">            FunctionScoreQueryBuilder.FilterFunctionBuilder[] builders =</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder[filterFunctionBuilders.size()];</span><br><span class="line">            filterFunctionBuilders.toArray(builders);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 允许自定评分的函数查询</span></span><br><span class="line">            <span class="type">FunctionScoreQueryBuilder</span> <span class="variable">functionScoreQueryBuilder</span> <span class="operator">=</span></span><br><span class="line">                    QueryBuilders.functionScoreQuery(builders)</span><br><span class="line">                                 .scoreMode(FunctionScoreQuery.ScoreMode.SUM)</span><br><span class="line">                                 .setMinScore(<span class="number">2</span>);</span><br><span class="line">            <span class="comment">// 用于过滤掉相同的商品</span></span><br><span class="line">            <span class="type">BoolQueryBuilder</span> <span class="variable">boolQueryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BoolQueryBuilder</span>()</span><br><span class="line">                    .mustNot(QueryBuilders.termQuery(<span class="string">&quot;id&quot;</span>, id));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//构建查询条件</span></span><br><span class="line">            <span class="type">NativeSearchQueryBuilder</span> <span class="variable">builder</span> <span class="operator">=</span></span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">NativeSearchQueryBuilder</span>().withQuery(functionScoreQueryBuilder)</span><br><span class="line">                                                  .withFilter(boolQueryBuilder)</span><br><span class="line">                                                  .withPageable(pageable);</span><br><span class="line">            <span class="type">NativeSearchQuery</span> <span class="variable">searchQuery</span> <span class="operator">=</span> builder.build();</span><br><span class="line">            LOGGER.info(<span class="string">&quot;DSL: &#123;&#125;&quot;</span>, Objects.requireNonNull(searchQuery.getQuery()));</span><br><span class="line">            <span class="comment">// 获取结果hit数组</span></span><br><span class="line">            SearchHits&lt;EsProduct&gt; searchHits = elasticsearchRestTemplate.search(searchQuery, EsProduct.class);</span><br><span class="line">            <span class="comment">// 如果查询到的总条数小于0，即没有查到，则返回空列表</span></span><br><span class="line">            <span class="keyword">if</span>(searchHits.getTotalHits() &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageImpl</span>&lt;&gt;(ListUtil.empty(), pageable, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 将查询到的商品信息对象封装为列表返回</span></span><br><span class="line">            List&lt;EsProduct&gt; searchProductList =</span><br><span class="line">                    searchHits.stream()</span><br><span class="line">                              .map(SearchHit::getContent)</span><br><span class="line">                              .collect(Collectors.toList());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageImpl</span>&lt;&gt;(searchProductList, pageable, searchHits.getTotalHits());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageImpl</span>&lt;&gt;(ListUtil.empty());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> EsProductRelatedInfo <span class="title function_">searchRelatedInfo</span><span class="params">(String keyword)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取NativeSearchQueryBuilder</span></span><br><span class="line">        <span class="type">NativeSearchQueryBuilder</span> <span class="variable">nativeSearchQueryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NativeSearchQueryBuilder</span>();</span><br><span class="line">        <span class="comment">//搜索条件</span></span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isEmpty(keyword))&#123;</span><br><span class="line">            <span class="comment">// 如果关键词为空，就查询所有</span></span><br><span class="line">            nativeSearchQueryBuilder.withQuery(QueryBuilders.matchAllQuery());</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 进行多字段查询</span></span><br><span class="line">            nativeSearchQueryBuilder.withQuery(QueryBuilders.multiMatchQuery(keyword,<span class="string">&quot;name&quot;</span>, <span class="string">&quot;subTitle&quot;</span>, <span class="string">&quot;keywords&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//聚合搜索品牌名称</span></span><br><span class="line">        nativeSearchQueryBuilder.withAggregations(AggregationBuilders.terms(<span class="string">&quot;brandNames&quot;</span>)</span><br><span class="line">                                                                     .field(<span class="string">&quot;brandName&quot;</span>))</span><br><span class="line">                                <span class="comment">//聚合搜索分类名称</span></span><br><span class="line">                                .withAggregations(AggregationBuilders.terms(<span class="string">&quot;productCategoryNames&quot;</span>)</span><br><span class="line">                                                                     .field(<span class="string">&quot;productCategoryName&quot;</span>));</span><br><span class="line">        <span class="comment">//聚合搜索商品属性，去除type=1的属性</span></span><br><span class="line">        <span class="type">NestedAggregationBuilder</span> <span class="variable">nestedAggregationBuilder</span> <span class="operator">=</span></span><br><span class="line">                AggregationBuilders</span><br><span class="line">                        .nested(<span class="string">&quot;allAttrValues&quot;</span>, <span class="string">&quot;attrValueList&quot;</span>) <span class="comment">// 对attrValueList进行聚合查询</span></span><br><span class="line">                        <span class="comment">// 子聚合</span></span><br><span class="line">                        .subAggregation(AggregationBuilders</span><br><span class="line">                                                .filter(<span class="string">&quot;productAttrs&quot;</span>, QueryBuilders.termQuery(<span class="string">&quot;attrValueList.type&quot;</span>,<span class="number">1</span>)) <span class="comment">// 添加过滤器，取出type=1的attrValue</span></span><br><span class="line">                                                .subAggregation(AggregationBuilders.terms(<span class="string">&quot;attrIds&quot;</span>).field(<span class="string">&quot;attrValueList.productAttributeId&quot;</span>)</span><br><span class="line">                                                                                   .subAggregation(AggregationBuilders.terms(<span class="string">&quot;attrValues&quot;</span>).field(<span class="string">&quot;attrValueList.value&quot;</span>))</span><br><span class="line">                                                                                   .subAggregation(AggregationBuilders.terms(<span class="string">&quot;attrNames&quot;</span>).field(<span class="string">&quot;attrValueList.name&quot;</span>))));</span><br><span class="line">        <span class="comment">// 针对前面子聚合，实际上是按这样一种方式聚合</span></span><br><span class="line">        <span class="comment">// &quot;aggregations&quot;: &#123; &quot;attrIds&quot;: &#123; &quot;aggregations&quot;: &#123; &quot;attrValues&quot;: &#123;&#125;, &quot;attrNames&quot;: &#123;&#125; &#125; &#125; &#125;</span></span><br><span class="line">        nativeSearchQueryBuilder.withAggregations(nestedAggregationBuilder);</span><br><span class="line">        <span class="comment">// 构建NativeSearchQuery对象</span></span><br><span class="line">        <span class="type">NativeSearchQuery</span> <span class="variable">nativeSearchQuery</span> <span class="operator">=</span> nativeSearchQueryBuilder.build();</span><br><span class="line">        LOGGER.info(<span class="string">&quot;searchRelatedInfoSub：DSL = &#123;&#125;&quot;</span>, Objects.requireNonNull(nativeSearchQuery.getQuery()));</span><br><span class="line">        SearchHits&lt;EsProduct&gt; searchHits = elasticsearchRestTemplate.search(nativeSearchQuery, EsProduct.class);</span><br><span class="line">        <span class="keyword">return</span> convertProductRelatedInfo(searchHits);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将返回结果转换为对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> EsProductRelatedInfo <span class="title function_">convertProductRelatedInfo</span><span class="params">(SearchHits&lt;EsProduct&gt; response)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 创建EsProductRelatedInfo对象</span></span><br><span class="line">        <span class="type">EsProductRelatedInfo</span> <span class="variable">productRelatedInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EsProductRelatedInfo</span>();</span><br><span class="line">        <span class="comment">// 将hits中的aggregations转换为map对象</span></span><br><span class="line">        Map&lt;String, Aggregation&gt; aggregationMap = ((Aggregations) Objects</span><br><span class="line">                .requireNonNull(response.getAggregations())</span><br><span class="line">                .aggregations())</span><br><span class="line">                .asMap();</span><br><span class="line">        <span class="comment">//设置品牌</span></span><br><span class="line">        <span class="type">Terms</span> <span class="variable">brandNames</span> <span class="operator">=</span> (Terms) aggregationMap.get(<span class="string">&quot;brandNames&quot;</span>);</span><br><span class="line">        List&lt;String&gt; brandNameList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        brandNames.getBuckets()</span><br><span class="line">                  .forEach(brandName -&gt; brandNameList.add(brandName.getKeyAsString()));</span><br><span class="line">        productRelatedInfo.setBrandNames(brandNameList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置分类</span></span><br><span class="line">        <span class="type">Terms</span> <span class="variable">productCategoryNames</span> <span class="operator">=</span> (Terms) aggregationMap.get(<span class="string">&quot;productCategoryNames&quot;</span>);</span><br><span class="line">        List&lt;String&gt; productCategoryNameList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        productCategoryNames.getBuckets()</span><br><span class="line">                            .forEach(productCategoryName -&gt;</span><br><span class="line">                                             productCategoryNameList</span><br><span class="line">                                                     .add(productCategoryName.getKeyAsString()));</span><br><span class="line">        productRelatedInfo.setProductCategoryNames(productCategoryNameList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取nested</span></span><br><span class="line">        <span class="type">ParsedNested</span> <span class="variable">allAttrValues</span> <span class="operator">=</span> (ParsedNested) aggregationMap.get(<span class="string">&quot;allAttrValues&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取filter</span></span><br><span class="line">        <span class="type">ParsedFilter</span> <span class="variable">productAttrs</span> <span class="operator">=</span> allAttrValues.getAggregations().get(<span class="string">&quot;productAttrs&quot;</span>);</span><br><span class="line">        <span class="comment">// 按照字段类型获取获取terms，attrId为Long类型</span></span><br><span class="line">        <span class="type">ParsedLongTerms</span> <span class="variable">attrIds</span> <span class="operator">=</span> productAttrs.getAggregations().get(<span class="string">&quot;attrIds&quot;</span>);</span><br><span class="line">        LOGGER.info(<span class="string">&quot;attrIds = &#123;&#125;&quot;</span>, attrIds);</span><br><span class="line">        <span class="comment">// 处理子聚合返回结果，构建为内部类对象</span></span><br><span class="line">        <span class="comment">// 针对前面子聚合，实际上是按这样一种方式聚合</span></span><br><span class="line">        <span class="comment">// &quot;aggregations&quot;: &#123; &quot;attrIds&quot;: &#123; &quot;aggregations&quot;: &#123; &quot;attrValues&quot;: &#123;&#125;, &quot;attrNames&quot;: &#123;&#125; &#125; &#125; &#125;</span></span><br><span class="line">        List&lt;EsProductRelatedInfo.ProductAttr&gt; productAttrList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        attrIds.getBuckets().forEach(attrId -&gt; &#123;</span><br><span class="line">            EsProductRelatedInfo.<span class="type">ProductAttr</span> <span class="variable">productAttr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EsProductRelatedInfo</span>.ProductAttr();</span><br><span class="line">            productAttr.setAttrId(Long.valueOf(attrId.getKey().toString()));</span><br><span class="line">            <span class="type">ParsedStringTerms</span> <span class="variable">attrNames</span> <span class="operator">=</span> attrId.getAggregations().get(<span class="string">&quot;attrNames&quot;</span>);</span><br><span class="line">            productAttr.setAttrName(Objects.requireNonNull(attrNames.getBuckets())</span><br><span class="line">                                           .get(<span class="number">0</span>)</span><br><span class="line">                                           .getKeyAsString());</span><br><span class="line">            <span class="type">ParsedStringTerms</span> <span class="variable">attrValues</span> <span class="operator">=</span> attrId.getAggregations().get(<span class="string">&quot;attrValues&quot;</span>);</span><br><span class="line">            List&lt;String&gt; attrValueList =</span><br><span class="line">                    attrValues.getBuckets()</span><br><span class="line">                              .stream()</span><br><span class="line">                              .map((MultiBucketsAggregation.Bucket::getKeyAsString))</span><br><span class="line">                              .collect(Collectors.toList());</span><br><span class="line">            productAttr.setAttrValues(attrValueList);</span><br><span class="line">            productAttrList.add(productAttr);</span><br><span class="line">        &#125;);</span><br><span class="line">        productRelatedInfo.setProductAttrs(productAttrList);</span><br><span class="line">        <span class="keyword">return</span> productRelatedInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="mall-security模块"><a href="#mall-security模块" class="headerlink" title="mall-security模块"></a>mall-security模块</h2><h3 id="pom-xml-3"><a href="#pom-xml-3" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mall工具类及通用模块--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.macro.mall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mall-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringBoot启动相关依赖--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringSecurity依赖--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--redis依赖--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--jwt依赖--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="包结构-3"><a href="#包结构-3" class="headerlink" title="包结构"></a>包结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mall-security</span><br><span class="line">└─com</span><br><span class="line">    └─macro</span><br><span class="line">        └─mall</span><br><span class="line">            └─security</span><br><span class="line">                ├─annotation</span><br><span class="line">                ├─aspect</span><br><span class="line">                ├─component</span><br><span class="line">                ├─config</span><br><span class="line">                └─util</span><br></pre></td></tr></table></figure>

<p><strong>mall-security模块的包都统一放在com.macro.mall.security包下</strong></p>
<ul>
<li><p><strong>annotation包中存放了自定义缓存异常注解</strong></p>
</li>
<li><p><strong>aspect包中存放了Redis缓存切面</strong></p>
</li>
<li><p><strong>component包中存放了权限相关处理器和JWT过滤器</strong></p>
</li>
<li><p><strong>config包中存放了一些配置类</strong></p>
</li>
<li><p><strong>util包中存放了一些工具类</strong></p>
</li>
</ul>
<h3 id="主要代码分析-2"><a href="#主要代码分析-2" class="headerlink" title="主要代码分析"></a>主要代码分析</h3><h4 id="自定义缓存异常注解"><a href="#自定义缓存异常注解" class="headerlink" title="自定义缓存异常注解"></a>自定义缓存异常注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义缓存异常注解，有该注解的缓存方法会抛出异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> CacheException &#123;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Redis缓存切面"><a href="#Redis缓存切面" class="headerlink" title="Redis缓存切面"></a>Redis缓存切面</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Redis缓存切面，防止Redis宕机影响正常业务逻辑</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(2)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisCacheAspect</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(RedisCacheAspect.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(public * com.macro.mall.portal.service.*CacheService.*(..)) || execution(public * com.macro.mall.service.*CacheService.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cacheAspect</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;cacheAspect()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doAround</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取签名</span></span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">methodSignature</span> <span class="operator">=</span> (MethodSignature) signature;</span><br><span class="line">        <span class="comment">// 获取目标方法</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> methodSignature.getMethod();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// 目标方法执行</span></span><br><span class="line">            result = joinPoint.proceed();</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Throwable throwable)&#123;</span><br><span class="line">            <span class="comment">//有CacheException注解的方法需要抛出异常</span></span><br><span class="line">            <span class="keyword">if</span>(method.isAnnotationPresent(CacheException.class))&#123;</span><br><span class="line">                <span class="keyword">throw</span> throwable;</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                LOGGER.error(throwable.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="mall-admin模块"><a href="#mall-admin模块" class="headerlink" title="mall-admin模块"></a>mall-admin模块</h2><h3 id="数据库表前缀说明"><a href="#数据库表前缀说明" class="headerlink" title="数据库表前缀说明"></a>数据库表前缀说明</h3><ul>
<li>*<em>cms_<em>：内容管理模块相关表</em></em></li>
<li>*<em>oms_<em>：订单管理模块相关表</em></em></li>
<li>*<em>pms_<em>：商品模块相关表</em></em></li>
<li>*<em>sms_<em>：营销模块相关表</em></em></li>
<li>*<em>ums_<em>：会员模块相关表</em></em></li>
</ul>
<h3 id="pom-xml-4"><a href="#pom-xml-4" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mall中MBG生成模块--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.macro.mall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mall-mbg<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mall安全模块--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.macro.mall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mall-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 阿里云OSS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--MinIO JAVA SDK--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.minio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>minio<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="包结构-4"><a href="#包结构-4" class="headerlink" title="包结构"></a>包结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mall-admin</span><br><span class="line">├─java</span><br><span class="line">│  └─com</span><br><span class="line">│      └─macro</span><br><span class="line">│          └─mall</span><br><span class="line">│              ├─bo</span><br><span class="line">│              ├─config</span><br><span class="line">│              ├─controller</span><br><span class="line">│              ├─dao</span><br><span class="line">│              ├─dto</span><br><span class="line">│              ├─service</span><br><span class="line">│              │  └─impl</span><br><span class="line">│              └─validator</span><br><span class="line">└─resources</span><br><span class="line">    ├─dao</span><br><span class="line">    └─META-INF</span><br></pre></td></tr></table></figure>

<p><strong>mall-admin模块的包都统一放在com.macro.mall包下</strong></p>
<ul>
<li><strong>bo包中存放了SpringSecurity需要的用户信息封装类</strong></li>
<li><strong>config包中存放了一些配置类</strong></li>
<li><strong>controller包中存放了后台管理相关接口类</strong></li>
<li><strong>service包中存放了后台管理相关业务类</strong></li>
<li><strong>dao包中存放了一些自定义DAO</strong></li>
<li><strong>dto包中存放了一些后台管理相关DTO</strong></li>
<li><strong>validator包中存放了状态校验器类</strong></li>
<li><strong>resources目录中dao文件夹下存放了dao包中对应的xml文件</strong></li>
</ul>
<h3 id="主要代码分析-3"><a href="#主要代码分析-3" class="headerlink" title="主要代码分析"></a>主要代码分析</h3><h4 id="后台用户模块相关表分析，ums-admin"><a href="#后台用户模块相关表分析，ums-admin" class="headerlink" title="后台用户模块相关表分析，ums_admin*"></a>后台用户模块相关表分析，ums_admin*</h4><img src="../数据库表设计/image/ums/my_ums_admin.png" alt="my_ums_admin" style="zoom:80%;" />

<h5 id="ums-admin相关表分析"><a href="#ums-admin相关表分析" class="headerlink" title="ums_admin相关表分析"></a>ums_admin相关表分析</h5><p><strong>其中ums_permission（后台用户权限表）、ums_admin_permission_relation（后台用户和权限关系表(除角色中定义的权限以外的加减权限)）和ums_role_permission_relation（后台用户角色和权限关系表）三张表已弃用</strong></p>
<ul>
<li><strong>ums_admin表为后台用户信息表</strong></li>
<li><strong>ums_admin_login_log表为后台用户登录日志表，其中admin_id字段ums_admin表的外键</strong></li>
<li><strong>ums_role表为后台用户角色表</strong></li>
<li><strong>ums_admin_role_relation表为后台用户和角色关系表，其中admin_id字段为ums_admin表的外键，role_id字段为ums_role表的外键</strong></li>
<li><strong>ums_menu表为后台菜单表，其中parent_id为自身的外键，表示父级id</strong></li>
<li><strong>ums_role_menu_relation表为后台角色菜单关系表，其中role_id字段为ums_role表的外键，menu_id字段为ums_menu表的外键</strong></li>
<li><strong>ums_resource_category表为资源分类表</strong></li>
<li><strong>ums_resource表为后台资源表，其中category_id字段为ums_resource_category表的外键</strong></li>
<li><strong>ums_role_resource_relation表为后台角色资源关系表，其中role_id字段为ums_role表的外键，resource_id字段为表ums_resource表的外键</strong></li>
</ul>
<h4 id="后台用户相关接口设计"><a href="#后台用户相关接口设计" class="headerlink" title="后台用户相关接口设计"></a>后台用户相关接口设计</h4><h5 id="UmsAdminController相关"><a href="#UmsAdminController相关" class="headerlink" title="UmsAdminController相关"></a>UmsAdminController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台用户管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;UmsAdminController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;UmsAdminController&quot;, description = &quot;后台用户管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UmsAdminController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Authorization #JWT存储的请求头</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jwt.tokenHeader&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String tokenHeader;</span><br><span class="line">    <span class="comment">// &#x27;Bearer &#x27;  #JWT负载中拿到开头</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jwt.tokenHead&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String tokenHead;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsAdminService adminService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsRoleService roleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;用户注册&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/register&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="comment">// @Validated 注解式参数校验</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;UmsAdmin&gt; <span class="title function_">register</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> UmsAdminParam umsAdminParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">UmsAdmin</span> <span class="variable">umsAdmin</span> <span class="operator">=</span> adminService.register(umsAdminParam);</span><br><span class="line">        <span class="keyword">if</span>(umsAdmin == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(umsAdmin);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;登录以后返回token&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/login&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">login</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> UmsAdminLoginParam umsAdminLoginParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> adminService.login(umsAdminLoginParam.getUsername(), umsAdminLoginParam.getPassword());</span><br><span class="line">        <span class="keyword">if</span>(token == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.validateFailed(<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Map&lt;String, String&gt; tokenMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        tokenMap.put(<span class="string">&quot;token&quot;</span>, token);</span><br><span class="line">        tokenMap.put(<span class="string">&quot;tokenHead&quot;</span>, tokenHead);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(tokenMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;刷新token&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/refreshToken&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">refreshToken</span><span class="params">(HttpServletRequest request)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取连接中的token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(tokenHeader);</span><br><span class="line">        <span class="comment">// 刷新之后的token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">refreshToken</span> <span class="operator">=</span> adminService.refreshToken(token);</span><br><span class="line">        <span class="keyword">if</span>(refreshToken == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed(<span class="string">&quot;token已经过期！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Map&lt;String, String&gt; tokenMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        tokenMap.put(<span class="string">&quot;token&quot;</span>, refreshToken);</span><br><span class="line">        tokenMap.put(<span class="string">&quot;tokenHead&quot;</span>, tokenHead);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(tokenMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取当前登录用户信息&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/info&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="comment">// Principal此接口表示主体的抽象概念，它可以用来表示任何实体，例如，个人、公司或登录id</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">getAdminInfo</span><span class="params">(Principal principal)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 表示未登录</span></span><br><span class="line">        <span class="keyword">if</span>(principal == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.unauthorized(<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 返回此主题的名称</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> principal.getName();</span><br><span class="line">        <span class="type">UmsAdmin</span> <span class="variable">umsAdmin</span> <span class="operator">=</span> adminService.getAdminByUsername(username);</span><br><span class="line">        <span class="comment">// 将相关用户信息存入map</span></span><br><span class="line">        Map&lt;String, Object&gt; data = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        data.put(<span class="string">&quot;username&quot;</span>, umsAdmin.getUsername());</span><br><span class="line">        data.put(<span class="string">&quot;menus&quot;</span>, roleService.getMenuList(umsAdmin.getId()));</span><br><span class="line">        data.put(<span class="string">&quot;icon&quot;</span>, umsAdmin.getIcon());</span><br><span class="line">        <span class="comment">// 获取用户权限列表</span></span><br><span class="line">        List&lt;UmsRole&gt; roleList = adminService.getRoleList(umsAdmin.getId());</span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isNotEmpty(roleList))&#123;</span><br><span class="line">            List&lt;String&gt; roles = roleList.stream()</span><br><span class="line">                                         .map(UmsRole::getName)</span><br><span class="line">                                         .collect(Collectors.toList());</span><br><span class="line">            data.put(<span class="string">&quot;roles&quot;</span>, roles);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;登出功能&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/logout&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">logout</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据用户名或姓名分页获取用户列表&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="comment">// required 是否为必要参数 false</span></span><br><span class="line">    <span class="comment">// defaultValue 默认参数</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;UmsAdmin&gt;&gt; <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam(value = &quot;keyword&quot;, required = false)</span> String keyword,</span></span><br><span class="line"><span class="params">                                                   <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                                                   <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// TODO 这里是用从数据库中使用模糊查询获得的，或许可以改用Elasticsearch</span></span><br><span class="line">        List&lt;UmsAdmin&gt; adminList = adminService.list(keyword, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(adminList));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取指定用户信息&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="comment">// @PathVariable 映射URL绑定的占位符，当方法参数名称与url中的变量名称一致时，可以简写</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;UmsAdmin&gt; <span class="title function_">getItem</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">UmsAdmin</span> <span class="variable">admin</span> <span class="operator">=</span> adminService.getItem(id);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(admin);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改指定用户信息&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> UmsAdmin admin)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> adminService.update(id, admin);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改指定用户密码&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/updatePassword&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updatePassword</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> UpdateAdminPasswordParam updatePasswordParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">status</span> <span class="operator">=</span> adminService.updatePassword(updatePasswordParam);</span><br><span class="line">        <span class="keyword">if</span>(status == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(status);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(status == -<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed(<span class="string">&quot;提交参数不合法&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(status == -<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed(<span class="string">&quot;找不到该用户&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(status == -<span class="number">3</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed(<span class="string">&quot;旧密码错误&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed(<span class="string">&quot;其他错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;删除指定用户信息&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> adminService.delete(id);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改帐号状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/updateStatus/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateStatus</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestParam(value = &quot;status&quot;)</span> Integer status)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">UmsAdmin</span> <span class="variable">umsAdmin</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsAdmin</span>();</span><br><span class="line">        umsAdmin.setStatus(status);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> adminService.update(id, umsAdmin);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;给用户分配角色&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/role/update&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateRole</span><span class="params">(<span class="meta">@RequestParam(&quot;adminId&quot;)</span> Long adminId, <span class="meta">@RequestParam(&quot;roleIds&quot;)</span> List&lt;Long&gt; roleIds)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> adminService.updateRole(adminId, roleIds);</span><br><span class="line">        <span class="keyword">if</span>(count &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取指定用户的角色&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/role/&#123;adminId&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;UmsRole&gt;&gt; <span class="title function_">getRoleList</span><span class="params">(<span class="meta">@PathVariable</span> Long adminId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;UmsRole&gt; roleList = adminService.getRoleList(adminId);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(roleList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="UmsAdminService"><a href="#UmsAdminService" class="headerlink" title="UmsAdminService"></a>UmsAdminService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台用户管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UmsAdminService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名获取后台管理员</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UmsAdmin <span class="title function_">getAdminByUsername</span><span class="params">(String username)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册功能</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UmsAdmin <span class="title function_">register</span><span class="params">(UmsAdminParam umsAdminParam)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录功能</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 生成的JWT的token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">login</span><span class="params">(String username, String password)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 刷新token的功能</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> oldToken 旧的token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">refreshToken</span><span class="params">(String oldToken)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户id获取用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UmsAdmin <span class="title function_">getItem</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名或昵称分页查询用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;UmsAdmin&gt; <span class="title function_">list</span><span class="params">(String keyword, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改指定用户信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, UmsAdmin admin)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除指定用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户角色关系</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateRole</span><span class="params">(Long adminId, List&lt;Long&gt; roleIds)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户对应角色</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;UmsRole&gt; <span class="title function_">getRoleList</span><span class="params">(Long adminId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取指定用户的可访问资源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;UmsResource&gt; <span class="title function_">getResourceList</span><span class="params">(Long adminId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updatePassword</span><span class="params">(UpdateAdminPasswordParam updatePasswordParam)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取缓存服务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UmsAdminCacheService <span class="title function_">getCacheService</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="UmsAdminServiceImpl"><a href="#UmsAdminServiceImpl" class="headerlink" title="UmsAdminServiceImpl"></a>UmsAdminServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台用户管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UmsAdminServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UmsAdminService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(UmsAdminServiceImpl.class);</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> JwtTokenUtil jwtTokenUtil;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PasswordEncoder passwordEncoder;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsAdminMapper adminMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsAdminRoleRelationMapper adminRoleRelationMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsAdminRoleRelationDao adminRoleRelationDao;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsAdminLoginLogMapper loginLogMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UmsAdmin <span class="title function_">getAdminByUsername</span><span class="params">(String username)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取缓存中的后台用户信息</span></span><br><span class="line">        <span class="type">UmsAdmin</span> <span class="variable">admin</span> <span class="operator">=</span> getCacheService().getAdmin(username);</span><br><span class="line">        <span class="keyword">if</span>(admin != <span class="literal">null</span>) <span class="keyword">return</span> admin;</span><br><span class="line">        <span class="comment">// 从数据库中获取用户信息</span></span><br><span class="line">        <span class="type">UmsAdminExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsAdminExample</span>();</span><br><span class="line">        example.createCriteria().andUsernameEqualTo(username);</span><br><span class="line">        List&lt;UmsAdmin&gt; adminList = adminMapper.selectByExample(example);</span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isNotEmpty(adminList))&#123;</span><br><span class="line">            <span class="comment">// 获取用户信息并存入缓存</span></span><br><span class="line">            admin = adminList.get(<span class="number">0</span>);</span><br><span class="line">            getCacheService().setAdmin(admin);</span><br><span class="line">            <span class="keyword">return</span> admin;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UmsAdmin <span class="title function_">register</span><span class="params">(UmsAdminParam umsAdminParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">UmsAdmin</span> <span class="variable">umsAdmin</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsAdmin</span>();</span><br><span class="line">        <span class="comment">// 将给定源umsAdminParam的属性值复制到目标Bean umsAdmin中</span></span><br><span class="line">        BeanUtils.copyProperties(umsAdminParam, umsAdmin);</span><br><span class="line">        <span class="comment">// 启用账户</span></span><br><span class="line">        umsAdmin.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        umsAdmin.setStatus(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//查询是否有相同用户名的用户</span></span><br><span class="line">        <span class="type">UmsAdminExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsAdminExample</span>();</span><br><span class="line">        example.createCriteria().andUsernameEqualTo(umsAdmin.getUsername());</span><br><span class="line">        List&lt;UmsAdmin&gt; umsAdminList = adminMapper.selectByExample(example);</span><br><span class="line">        <span class="comment">// 数据库中有相同用户名的用户</span></span><br><span class="line">        <span class="keyword">if</span>(umsAdminList.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将密码进行加密操作</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">encodePassword</span> <span class="operator">=</span> passwordEncoder.encode(umsAdmin.getPassword());</span><br><span class="line">        umsAdmin.setPassword(encodePassword);</span><br><span class="line">        adminMapper.insert(umsAdmin);</span><br><span class="line">        <span class="keyword">return</span> umsAdmin;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(String username, String password)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//密码需要客户端加密后传递</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">UserDetails</span> <span class="variable">userDetails</span> <span class="operator">=</span> loadUserByUsername(username);</span><br><span class="line">            <span class="comment">// 抛出异常后，全局异常处理类GlobalExceptionHandler中处理</span></span><br><span class="line">            <span class="keyword">if</span>(!passwordEncoder.matches(password, userDetails.getPassword()))&#123;</span><br><span class="line">                Asserts.fail(<span class="string">&quot;密码不正确&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!userDetails.isEnabled())&#123;</span><br><span class="line">                Asserts.fail(<span class="string">&quot;帐号已被禁用&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 构造authentication，并且该构造函数自动将该用户设为已验证</span></span><br><span class="line">            <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authentication</span> <span class="operator">=</span></span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(userDetails, <span class="literal">null</span>, userDetails.getAuthorities());</span><br><span class="line">            <span class="comment">// 将authentication存入SecurityContextHolder，方便后续调用</span></span><br><span class="line">            SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class="line">            <span class="comment">// 生成token</span></span><br><span class="line">            token = jwtTokenUtil.generateToken(userDetails);</span><br><span class="line">            <span class="comment">// updateLoginTimeByUsername(username);</span></span><br><span class="line">            <span class="comment">// 添加登录记录</span></span><br><span class="line">            insertLoginLog(username);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(AuthenticationException e)&#123;</span><br><span class="line">            LOGGER.warn(<span class="string">&quot;登录异常:&#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加登录记录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">insertLoginLog</span><span class="params">(String username)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">UmsAdmin</span> <span class="variable">admin</span> <span class="operator">=</span> getAdminByUsername(username);</span><br><span class="line">        <span class="keyword">if</span>(admin == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">UmsAdminLoginLog</span> <span class="variable">loginLog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsAdminLoginLog</span>();</span><br><span class="line">        loginLog.setAdminId(admin.getId());</span><br><span class="line">        loginLog.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="comment">// 获取登录ip</span></span><br><span class="line">        <span class="type">ServletRequestAttributes</span> <span class="variable">attributes</span> <span class="operator">=</span> (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> Objects.requireNonNull(attributes).getRequest();</span><br><span class="line">        loginLog.setIp(RequestUtil.getRequestIp(request));</span><br><span class="line">        loginLogMapper.insert(loginLog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名修改登录时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateLoginTimeByUsername</span><span class="params">(String username)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">UmsAdmin</span> <span class="variable">record</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsAdmin</span>();</span><br><span class="line">        record.setLoginTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">UmsAdminExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsAdminExample</span>();</span><br><span class="line">        example.createCriteria().andUsernameEqualTo(username);</span><br><span class="line">        adminMapper.updateByExampleSelective(record, example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">refreshToken</span><span class="params">(String oldToken)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> jwtTokenUtil.refreshHeadToken(oldToken);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UmsAdmin <span class="title function_">getItem</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> adminMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UmsAdmin&gt; <span class="title function_">list</span><span class="params">(String keyword, Integer pageSize, Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="type">UmsAdminExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsAdminExample</span>();</span><br><span class="line">        UmsAdminExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> example.createCriteria();</span><br><span class="line">        <span class="keyword">if</span>(!StrUtil.isEmpty(keyword))&#123;</span><br><span class="line">            <span class="comment">// 如果关键字不为空，则模糊查询用户名或昵称</span></span><br><span class="line">            criteria.andUsernameLike(<span class="string">&quot;%&quot;</span> + keyword + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">            example.or(example.createCriteria().andNickNameLike(<span class="string">&quot;%&quot;</span> + keyword + <span class="string">&quot;%&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果关键字为空，则查询所有</span></span><br><span class="line">        <span class="keyword">return</span> adminMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, UmsAdmin admin)</span></span><br><span class="line">    &#123;</span><br><span class="line">        admin.setId(id);</span><br><span class="line">        <span class="comment">// 根据id获取数据库中的用户信息</span></span><br><span class="line">        <span class="type">UmsAdmin</span> <span class="variable">rawAdmin</span> <span class="operator">=</span> adminMapper.selectByPrimaryKey(id);</span><br><span class="line">        <span class="keyword">if</span>(rawAdmin.getPassword().equals(admin.getPassword()) || StrUtil.isEmpty(admin.getPassword()))&#123;</span><br><span class="line">            <span class="comment">//与原加密密码相同的不需要修改</span></span><br><span class="line">            admin.setPassword(<span class="literal">null</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//与原加密密码不同的需要加密修改</span></span><br><span class="line">            admin.setPassword(passwordEncoder.encode(admin.getPassword()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> adminMapper.updateByPrimaryKeySelective(admin);</span><br><span class="line">        <span class="comment">// 用户信息已修改，删除缓存中的该id用户信息</span></span><br><span class="line">        getCacheService().delAdmin(id);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 删除缓存中的用户信息</span></span><br><span class="line">        getCacheService().delAdmin(id);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> adminMapper.deleteByPrimaryKey(id);</span><br><span class="line">        <span class="comment">// 删除用户资源列表缓存</span></span><br><span class="line">        getCacheService().delResourceList(id);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateRole</span><span class="params">(Long adminId, List&lt;Long&gt; roleIds)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> roleIds == <span class="literal">null</span> ? <span class="number">0</span> : roleIds.size();</span><br><span class="line">        <span class="comment">// 当count等于0有两种情况，一是什么都不添加，而是取消原来所有权限</span></span><br><span class="line">        <span class="comment">// 先删除原来的关系</span></span><br><span class="line">        <span class="type">UmsAdminRoleRelationExample</span> <span class="variable">adminRoleRelationExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsAdminRoleRelationExample</span>();</span><br><span class="line">        adminRoleRelationExample.createCriteria().andAdminIdEqualTo(adminId);</span><br><span class="line">        adminRoleRelationMapper.deleteByExample(adminRoleRelationExample);</span><br><span class="line">        <span class="comment">//建立新关系</span></span><br><span class="line">        <span class="keyword">if</span>(!CollectionUtils.isEmpty(roleIds))&#123;</span><br><span class="line">            List&lt;UmsAdminRoleRelation&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            roleIds.forEach(roleId -&gt; &#123;</span><br><span class="line">                <span class="type">UmsAdminRoleRelation</span> <span class="variable">roleRelation</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsAdminRoleRelation</span>();</span><br><span class="line">                roleRelation.setAdminId(adminId);</span><br><span class="line">                roleRelation.setRoleId(roleId);</span><br><span class="line">                list.add(roleRelation);</span><br><span class="line">            &#125;);</span><br><span class="line">            adminRoleRelationDao.insertList(list);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 删除旧用户资源列表缓存</span></span><br><span class="line">        getCacheService().delResourceList(adminId);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UmsRole&gt; <span class="title function_">getRoleList</span><span class="params">(Long adminId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> adminRoleRelationDao.getRoleList(adminId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UmsResource&gt; <span class="title function_">getResourceList</span><span class="params">(Long adminId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;UmsResource&gt; resourceList = getCacheService().getResourceList(adminId);</span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isNotEmpty(resourceList))&#123;</span><br><span class="line">            <span class="keyword">return</span> resourceList;</span><br><span class="line">        &#125;</span><br><span class="line">        resourceList = adminRoleRelationDao.getResourceList(adminId);</span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isNotEmpty(resourceList))&#123;</span><br><span class="line">            getCacheService().setResourceList(adminId, resourceList);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> resourceList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updatePassword</span><span class="params">(UpdateAdminPasswordParam param)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 虽然接口参数加上了@Validated，但是这@NotNull只能检验参数不为null</span></span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isEmpty(param.getUsername()) || StrUtil.isEmpty(param.getOldPassword()) || StrUtil</span><br><span class="line">                .isEmpty(param.getNewPassword()))&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 根据用户名获取用户信息</span></span><br><span class="line">        <span class="type">UmsAdminExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsAdminExample</span>();</span><br><span class="line">        example.createCriteria().andUsernameEqualTo(param.getUsername());</span><br><span class="line">        List&lt;UmsAdmin&gt; adminList = adminMapper.selectByExample(example);</span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isEmpty(adminList))&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">UmsAdmin</span> <span class="variable">umsAdmin</span> <span class="operator">=</span> adminList.get(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 如果旧密码不匹配</span></span><br><span class="line">        <span class="keyword">if</span>(!passwordEncoder.matches(param.getOldPassword(), umsAdmin.getPassword()))&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 设置新密码</span></span><br><span class="line">        umsAdmin.setPassword(passwordEncoder.encode(param.getNewPassword()));</span><br><span class="line">        adminMapper.updateByPrimaryKey(umsAdmin);</span><br><span class="line">        <span class="comment">// 删除缓存中的旧用户信息</span></span><br><span class="line">        getCacheService().delAdmin(umsAdmin.getId());</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//获取用户信息</span></span><br><span class="line">        <span class="type">UmsAdmin</span> <span class="variable">admin</span> <span class="operator">=</span> getAdminByUsername(username);</span><br><span class="line">        <span class="keyword">if</span>(admin != <span class="literal">null</span>)&#123;</span><br><span class="line">            List&lt;UmsResource&gt; resourceList = getResourceList(admin.getId());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AdminUserDetails</span>(admin, resourceList);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UmsAdminCacheService <span class="title function_">getCacheService</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> SpringUtil.getBean(UmsAdminCacheService.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="UmsRoleController相关"><a href="#UmsRoleController相关" class="headerlink" title="UmsRoleController相关"></a>UmsRoleController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台用户角色管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;UmsRoleController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;UmsRoleController&quot;, description = &quot;后台用户角色管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/role&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UmsRoleController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsRoleService roleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加角色&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> UmsRole role)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> roleService.create(role);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改角色&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> UmsRole role)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> roleService.update(id, role);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量删除角色&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> roleService.delete(ids);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取所有角色&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/listAll&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;UmsRole&gt;&gt; <span class="title function_">listAll</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;UmsRole&gt; roleList = roleService.list();</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(roleList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据角色名称分页获取角色列表&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;UmsRole&gt;&gt; <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam(value = &quot;keyword&quot;, required = false)</span> String keyword,</span></span><br><span class="line"><span class="params">                                                  <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                                                  <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;UmsRole&gt; roleList = roleService.list(keyword, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(roleList));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改角色状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/updateStatus/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateStatus</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestParam(value = &quot;status&quot;)</span> Integer status)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">UmsRole</span> <span class="variable">umsRole</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsRole</span>();</span><br><span class="line">        umsRole.setStatus(status);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> roleService.update(id, umsRole);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取角色相关菜单&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/listMenu/&#123;roleId&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;UmsMenu&gt;&gt; <span class="title function_">listMenu</span><span class="params">(<span class="meta">@PathVariable</span> Long roleId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;UmsMenu&gt; roleList = roleService.listMenu(roleId);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(roleList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取角色相关资源&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/listResource/&#123;roleId&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;UmsResource&gt;&gt; <span class="title function_">listResource</span><span class="params">(<span class="meta">@PathVariable</span> Long roleId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;UmsResource&gt; roleList = roleService.listResource(roleId);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(roleList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;给角色分配菜单&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/allocMenu&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">allocMenu</span><span class="params">(<span class="meta">@RequestParam</span> Long roleId, <span class="meta">@RequestParam</span> List&lt;Long&gt; menuIds)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> roleService.allocMenu(roleId, menuIds);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;给角色分配资源&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/allocResource&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">allocResource</span><span class="params">(<span class="meta">@RequestParam</span> Long roleId, <span class="meta">@RequestParam</span> List&lt;Long&gt; resourceIds)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> roleService.allocResource(roleId, resourceIds);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="UmsRoleService"><a href="#UmsRoleService" class="headerlink" title="UmsRoleService"></a>UmsRoleService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台角色管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UmsRoleService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加角色</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(UmsRole role)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改角色信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, UmsRole role)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除角色</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有角色列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;UmsRole&gt; <span class="title function_">list</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页获取角色列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;UmsRole&gt; <span class="title function_">list</span><span class="params">(String keyword, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据管理员ID获取对应菜单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;UmsMenu&gt; <span class="title function_">getMenuList</span><span class="params">(Long adminId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取角色相关菜单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;UmsMenu&gt; <span class="title function_">listMenu</span><span class="params">(Long roleId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取角色相关资源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;UmsResource&gt; <span class="title function_">listResource</span><span class="params">(Long roleId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 给角色分配菜单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">allocMenu</span><span class="params">(Long roleId, List&lt;Long&gt; menuIds)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 给角色分配资源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">allocResource</span><span class="params">(Long roleId, List&lt;Long&gt; resourceIds)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="UmsRoleServiceImpl"><a href="#UmsRoleServiceImpl" class="headerlink" title="UmsRoleServiceImpl"></a>UmsRoleServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台角色管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UmsRoleServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UmsRoleService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsRoleMapper roleMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsRoleMenuRelationMapper roleMenuRelationMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsRoleResourceRelationMapper roleResourceRelationMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsRoleDao roleDao;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsAdminCacheService adminCacheService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(UmsRole role)</span></span><br><span class="line">    &#123;</span><br><span class="line">        role.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        role.setAdminCount(<span class="number">0</span>);</span><br><span class="line">        role.setSort(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> roleMapper.insert(role);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, UmsRole role)</span></span><br><span class="line">    &#123;</span><br><span class="line">        role.setId(id);</span><br><span class="line">        <span class="keyword">return</span> roleMapper.updateByPrimaryKeySelective(role);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 没有校验参数ids，但是andIdIn(ids)内部会判断value为空会抛出异常</span></span><br><span class="line">        <span class="type">UmsRoleExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsRoleExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> roleMapper.deleteByExample(example);</span><br><span class="line">        adminCacheService.delResourceListByRoleIds(ids);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UmsRole&gt; <span class="title function_">list</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> roleMapper.selectByExample(<span class="keyword">new</span> <span class="title class_">UmsRoleExample</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UmsRole&gt; <span class="title function_">list</span><span class="params">(String keyword, Integer pageSize, Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="type">UmsRoleExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsRoleExample</span>();</span><br><span class="line">        <span class="keyword">if</span>(!StrUtil.isEmpty(keyword))&#123;</span><br><span class="line">            example.createCriteria().andNameLike(<span class="string">&quot;%&quot;</span> + keyword + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> roleMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UmsMenu&gt; <span class="title function_">getMenuList</span><span class="params">(Long adminId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> roleDao.getMenuList(adminId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UmsMenu&gt; <span class="title function_">listMenu</span><span class="params">(Long roleId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> roleDao.getMenuListByRoleId(roleId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UmsResource&gt; <span class="title function_">listResource</span><span class="params">(Long roleId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> roleDao.getResourceListByRoleId(roleId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">allocMenu</span><span class="params">(Long roleId, List&lt;Long&gt; menuIds)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//先删除原有关系</span></span><br><span class="line">        <span class="type">UmsRoleMenuRelationExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsRoleMenuRelationExample</span>();</span><br><span class="line">        example.createCriteria().andRoleIdEqualTo(roleId);</span><br><span class="line">        roleMenuRelationMapper.deleteByExample(example);</span><br><span class="line">        <span class="comment">//批量插入新关系</span></span><br><span class="line">        menuIds.forEach(menuId -&gt; &#123;</span><br><span class="line">            <span class="type">UmsRoleMenuRelation</span> <span class="variable">relation</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsRoleMenuRelation</span>();</span><br><span class="line">            relation.setRoleId(roleId);</span><br><span class="line">            relation.setMenuId(menuId);</span><br><span class="line">            roleMenuRelationMapper.insert(relation);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> menuIds.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">allocResource</span><span class="params">(Long roleId, List&lt;Long&gt; resourceIds)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//先删除原有关系</span></span><br><span class="line">        <span class="type">UmsRoleResourceRelationExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsRoleResourceRelationExample</span>();</span><br><span class="line">        example.createCriteria().andRoleIdEqualTo(roleId);</span><br><span class="line">        roleResourceRelationMapper.deleteByExample(example);</span><br><span class="line">        <span class="comment">//批量插入新关系</span></span><br><span class="line">        resourceIds.forEach(resourceId -&gt; &#123;</span><br><span class="line">            <span class="type">UmsRoleResourceRelation</span> <span class="variable">relation</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsRoleResourceRelation</span>();</span><br><span class="line">            relation.setRoleId(roleId);</span><br><span class="line">            relation.setResourceId(resourceId);</span><br><span class="line">            roleResourceRelationMapper.insert(relation);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 当角色相关资源信息改变时删除相关后台用户缓存</span></span><br><span class="line">        adminCacheService.delResourceListByRole(roleId);</span><br><span class="line">        <span class="keyword">return</span> resourceIds.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="UmsResourceController相关"><a href="#UmsResourceController相关" class="headerlink" title="UmsResourceController相关"></a>UmsResourceController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台资源管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;UmsResourceController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;UmsResourceController&quot;, description = &quot;后台资源管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/resource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UmsResourceController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsResourceService resourceService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> DynamicSecurityMetadataSource dynamicSecurityMetadataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加后台资源&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> UmsResource umsResource)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> resourceService.create(umsResource);</span><br><span class="line">        <span class="comment">// 清空资源Map</span></span><br><span class="line">        dynamicSecurityMetadataSource.clearDataSource();</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改后台资源&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> UmsResource umsResource)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> resourceService.update(id, umsResource);</span><br><span class="line">        dynamicSecurityMetadataSource.clearDataSource();</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据ID获取资源详情&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;UmsResource&gt; <span class="title function_">getItem</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">UmsResource</span> <span class="variable">umsResource</span> <span class="operator">=</span> resourceService.getItem(id);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(umsResource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据ID删除后台资源&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> resourceService.delete(id);</span><br><span class="line">        dynamicSecurityMetadataSource.clearDataSource();</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;分页模糊查询后台资源&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;UmsResource&gt;&gt; <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam(required = false)</span> Long categoryId,</span></span><br><span class="line"><span class="params">                                                      <span class="meta">@RequestParam(required = false)</span> String nameKeyword,</span></span><br><span class="line"><span class="params">                                                      <span class="meta">@RequestParam(required = false)</span> String urlKeyword,</span></span><br><span class="line"><span class="params">                                                      <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                                                      <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;UmsResource&gt; resourceList = resourceService.list(categoryId, nameKeyword, urlKeyword, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(resourceList));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;查询所有后台资源&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/listAll&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;UmsResource&gt;&gt; <span class="title function_">listAll</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;UmsResource&gt; resourceList = resourceService.listAll();</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(resourceList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="UmsResourceService"><a href="#UmsResourceService" class="headerlink" title="UmsResourceService"></a>UmsResourceService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台资源管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UmsResourceService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加资源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(UmsResource umsResource)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改资源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, UmsResource umsResource)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取资源详情</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UmsResource <span class="title function_">getItem</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除资源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询资源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;UmsResource&gt; <span class="title function_">list</span><span class="params">(Long categoryId, String nameKeyword, String urlKeyword, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询全部资源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;UmsResource&gt; <span class="title function_">listAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="UmsResourceServiceImpl"><a href="#UmsResourceServiceImpl" class="headerlink" title="UmsResourceServiceImpl"></a>UmsResourceServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台资源管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UmsResourceServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UmsResourceService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsResourceMapper resourceMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsAdminCacheService adminCacheService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(UmsResource umsResource)</span></span><br><span class="line">    &#123;</span><br><span class="line">        umsResource.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="keyword">return</span> resourceMapper.insert(umsResource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, UmsResource umsResource)</span></span><br><span class="line">    &#123;</span><br><span class="line">        umsResource.setId(id);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> resourceMapper.updateByPrimaryKeySelective(umsResource);</span><br><span class="line">        adminCacheService.delResourceListByResource(id);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UmsResource <span class="title function_">getItem</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> resourceMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> resourceMapper.deleteByPrimaryKey(id);</span><br><span class="line">        adminCacheService.delResourceListByResource(id);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UmsResource&gt; <span class="title function_">list</span><span class="params">(Long categoryId, String nameKeyword, String urlKeyword, Integer pageSize,</span></span><br><span class="line"><span class="params">                                  Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="type">UmsResourceExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsResourceExample</span>();</span><br><span class="line">        UmsResourceExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> example.createCriteria();</span><br><span class="line">        <span class="keyword">if</span>(categoryId != <span class="literal">null</span>)&#123;</span><br><span class="line">            criteria.andCategoryIdEqualTo(categoryId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isNotEmpty(nameKeyword))&#123;</span><br><span class="line">            criteria.andNameLike(<span class="string">&#x27;%&#x27;</span> + nameKeyword + <span class="string">&#x27;%&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isNotEmpty(urlKeyword))&#123;</span><br><span class="line">            criteria.andUrlLike(<span class="string">&#x27;%&#x27;</span> + urlKeyword + <span class="string">&#x27;%&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> resourceMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UmsResource&gt; <span class="title function_">listAll</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> resourceMapper.selectByExample(<span class="keyword">new</span> <span class="title class_">UmsResourceExample</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="DynamicSecurityMetadataSource"><a href="#DynamicSecurityMetadataSource" class="headerlink" title="DynamicSecurityMetadataSource"></a>DynamicSecurityMetadataSource</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 动态权限数据源，用于获取动态权限规则</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicSecurityMetadataSource</span> <span class="keyword">implements</span> <span class="title class_">FilterInvocationSecurityMetadataSource</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(DynamicSecurityMetadataSource.class);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, ConfigAttribute&gt; configAttributeMap = <span class="literal">null</span>;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DynamicSecurityService dynamicSecurityService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 被@PostConstruct修饰的方法会在服务器加载Servlet的时候运行，并且只会被服务器执行一次</span></span><br><span class="line">    <span class="comment">// 加载用户权限</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loadDataSource</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        configAttributeMap = dynamicSecurityService.loadDataSource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clearDataSource</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        configAttributeMap.clear();</span><br><span class="line">        configAttributeMap = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="title function_">getAttributes</span><span class="params">(Object o)</span> <span class="keyword">throws</span> IllegalArgumentException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 加载资源ANT通配符和资源对应MAP</span></span><br><span class="line">        <span class="keyword">if</span>(configAttributeMap == <span class="literal">null</span>) <span class="built_in">this</span>.loadDataSource();</span><br><span class="line">        <span class="comment">//获取当前访问的路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> ((FilterInvocation) o).getRequestUrl();</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> URLUtil.getPath(url);</span><br><span class="line">        <span class="type">PathMatcher</span> <span class="variable">pathMatcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AntPathMatcher</span>();</span><br><span class="line">        <span class="comment">//获取访问该路径所需资源</span></span><br><span class="line">        List&lt;ConfigAttribute&gt; configAttributes = configAttributeMap</span><br><span class="line">                .keySet()</span><br><span class="line">                .stream()</span><br><span class="line">                .filter(pattern -&gt; pathMatcher.match(pattern, path))</span><br><span class="line">                .map(pattern -&gt; configAttributeMap.get(pattern))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO 打印configAttributes日志</span></span><br><span class="line">        LOGGER.info(<span class="string">&quot;DynamicSecurityMetadataSource configAttributes = &#123;&#125;, url = &#123;&#125;&quot;</span>, configAttributes, url);</span><br><span class="line">        <span class="comment">// 未设置操作请求权限，返回空集合</span></span><br><span class="line">        <span class="keyword">return</span> configAttributes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="title function_">getAllConfigAttributes</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Class&lt;?&gt; aClass)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="UmsResourceCategoryController相关"><a href="#UmsResourceCategoryController相关" class="headerlink" title="UmsResourceCategoryController相关"></a>UmsResourceCategoryController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台资源分类管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;UmsResourceCategoryController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;UmsResourceCategoryController&quot;, description = &quot;后台资源分类管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/resourceCategory&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UmsResourceCategoryController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsResourceCategoryService resourceCategoryService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;查询所有后台资源分类&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/listAll&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;UmsResourceCategory&gt;&gt; <span class="title function_">listAll</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;UmsResourceCategory&gt; resourceList = resourceCategoryService.listAll();</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(resourceList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加后台资源分类&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> UmsResourceCategory umsResourceCategory)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> resourceCategoryService.create(umsResourceCategory);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改后台资源分类&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> UmsResourceCategory umsResourceCategory)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> resourceCategoryService.update(id, umsResourceCategory);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据ID删除后台资源&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> resourceCategoryService.delete(id);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="UmsResourceCategoryService"><a href="#UmsResourceCategoryService" class="headerlink" title="UmsResourceCategoryService"></a>UmsResourceCategoryService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台资源分类管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UmsResourceCategoryService</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有资源分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;UmsResourceCategory&gt; <span class="title function_">listAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建资源分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(UmsResourceCategory umsResourceCategory)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改资源分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, UmsResourceCategory umsResourceCategory)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除资源分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="UmsResourceCategoryServiceImpl"><a href="#UmsResourceCategoryServiceImpl" class="headerlink" title="UmsResourceCategoryServiceImpl"></a>UmsResourceCategoryServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台资源分类管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UmsResourceCategoryServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UmsResourceCategoryService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsResourceCategoryMapper resourceCategoryMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UmsResourceCategory&gt; <span class="title function_">listAll</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">UmsResourceCategoryExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsResourceCategoryExample</span>();</span><br><span class="line">        example.setOrderByClause(<span class="string">&quot;sort desc&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> resourceCategoryMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(UmsResourceCategory umsResourceCategory)</span></span><br><span class="line">    &#123;</span><br><span class="line">        umsResourceCategory.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="keyword">return</span> resourceCategoryMapper.insert(umsResourceCategory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, UmsResourceCategory umsResourceCategory)</span></span><br><span class="line">    &#123;</span><br><span class="line">        umsResourceCategory.setId(id);</span><br><span class="line">        <span class="keyword">return</span> resourceCategoryMapper.updateByPrimaryKeySelective(umsResourceCategory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> resourceCategoryMapper.deleteByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="UmsMenuController相关"><a href="#UmsMenuController相关" class="headerlink" title="UmsMenuController相关"></a>UmsMenuController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台菜单管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;UmsMenuController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;UmsMenuController&quot;, description = &quot;后台菜单管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/menu&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UmsMenuController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsMenuService menuService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加后台菜单&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> UmsMenu umsMenu)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> menuService.create(umsMenu);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改后台菜单&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> UmsMenu umsMenu)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> menuService.update(id, umsMenu);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据ID获取菜单详情&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;UmsMenu&gt; <span class="title function_">getItem</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">UmsMenu</span> <span class="variable">umsMenu</span> <span class="operator">=</span> menuService.getItem(id);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(umsMenu);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据ID删除后台菜单&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> menuService.delete(id);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;分页查询后台菜单&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list/&#123;parentId&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;UmsMenu&gt;&gt; <span class="title function_">list</span><span class="params">(<span class="meta">@PathVariable</span> Long parentId,</span></span><br><span class="line"><span class="params">                                                  <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                                                  <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;UmsMenu&gt; menuList = menuService.list(parentId, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(menuList));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;树形结构返回所有菜单列表&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/treeList&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;UmsMenuNode&gt;&gt; <span class="title function_">treeList</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;UmsMenuNode&gt; list = menuService.treeList();</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改菜单显示状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/updateHidden/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateHidden</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestParam(&quot;hidden&quot;)</span> Integer hidden)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> menuService.updateHidden(id, hidden);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="UmsMenuService"><a href="#UmsMenuService" class="headerlink" title="UmsMenuService"></a>UmsMenuService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台菜单管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UmsMenuService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建后台菜单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(UmsMenu umsMenu)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改后台菜单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, UmsMenu umsMenu)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据ID获取菜单详情</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UmsMenu <span class="title function_">getItem</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据ID删除菜单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询后台菜单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;UmsMenu&gt; <span class="title function_">list</span><span class="params">(Long parentId, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 树形结构返回所有菜单列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;UmsMenuNode&gt; <span class="title function_">treeList</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改菜单显示状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateHidden</span><span class="params">(Long id, Integer hidden)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="UmsMenuServiceImpl"><a href="#UmsMenuServiceImpl" class="headerlink" title="UmsMenuServiceImpl"></a>UmsMenuServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台菜单管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UmsMenuServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UmsMenuService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsMenuMapper menuMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(UmsMenu umsMenu)</span></span><br><span class="line">    &#123;</span><br><span class="line">        umsMenu.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        updateLevel(umsMenu);</span><br><span class="line">        <span class="keyword">return</span> menuMapper.insert(umsMenu);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改菜单层级</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateLevel</span><span class="params">(UmsMenu umsMenu)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(umsMenu.getParentId() == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//没有父菜单时为一级菜单</span></span><br><span class="line">            umsMenu.setLevel(<span class="number">0</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//有父菜单时选择根据父菜单level设置</span></span><br><span class="line">            <span class="type">UmsMenu</span> <span class="variable">parentMenu</span> <span class="operator">=</span> menuMapper.selectByPrimaryKey(umsMenu.getParentId());</span><br><span class="line">            <span class="keyword">if</span>(parentMenu != <span class="literal">null</span>)&#123;</span><br><span class="line">                umsMenu.setLevel(parentMenu.getLevel() + <span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                umsMenu.setLevel(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, UmsMenu umsMenu)</span></span><br><span class="line">    &#123;</span><br><span class="line">        umsMenu.setId(id);</span><br><span class="line">        updateLevel(umsMenu);</span><br><span class="line">        <span class="keyword">return</span> menuMapper.updateByPrimaryKeySelective(umsMenu);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UmsMenu <span class="title function_">getItem</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> menuMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> menuMapper.deleteByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UmsMenu&gt; <span class="title function_">list</span><span class="params">(Long parentId, Integer pageSize, Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="type">UmsMenuExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsMenuExample</span>();</span><br><span class="line">        example.setOrderByClause(<span class="string">&quot;sort desc&quot;</span>);</span><br><span class="line">        example.createCriteria().andParentIdEqualTo(parentId);</span><br><span class="line">        <span class="keyword">return</span> menuMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UmsMenuNode&gt; <span class="title function_">treeList</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 先查询所有菜单</span></span><br><span class="line">        List&lt;UmsMenu&gt; menuList = menuMapper.selectByExample(<span class="keyword">new</span> <span class="title class_">UmsMenuExample</span>());</span><br><span class="line">        List&lt;UmsMenuNode&gt; result = menuList.stream()</span><br><span class="line">                                           <span class="comment">// 过滤出父级菜单为0的，即为一级菜单</span></span><br><span class="line">                                           .filter(menu -&gt; menu.getParentId().equals(<span class="number">0L</span>))</span><br><span class="line">                                           .map(menu -&gt; UmsMenuServiceImpl.<span class="built_in">this</span>.covertMenuNode(menu, menuList))</span><br><span class="line">                                           .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateHidden</span><span class="params">(Long id, Integer hidden)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">UmsMenu</span> <span class="variable">umsMenu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsMenu</span>();</span><br><span class="line">        umsMenu.setId(id);</span><br><span class="line">        umsMenu.setHidden(hidden);</span><br><span class="line">        <span class="keyword">return</span> menuMapper.updateByPrimaryKeySelective(umsMenu);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将UmsMenu转化为UmsMenuNode并设置children属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> UmsMenuNode <span class="title function_">covertMenuNode</span><span class="params">(UmsMenu menu, List&lt;UmsMenu&gt; menuList)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">UmsMenuNode</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsMenuNode</span>();</span><br><span class="line">        BeanUtils.copyProperties(menu, node);</span><br><span class="line">        List&lt;UmsMenuNode&gt; children = menuList.stream()</span><br><span class="line">                                             <span class="comment">// TODO 过滤出该一级菜单的子级菜单，数据库中最多只有二级菜单</span></span><br><span class="line">                                             <span class="comment">// 如果有多级菜单，下面再次递归调用，就能解决</span></span><br><span class="line">                                             <span class="comment">// 如果过滤条件不满足就结束了</span></span><br><span class="line">                                             .filter(subMenu -&gt; subMenu.getParentId().equals(menu.getId()))</span><br><span class="line">                                             <span class="comment">// 将过滤出来的子级菜单转换为UmsMenuNode</span></span><br><span class="line">                                             .map(subMenu -&gt; UmsMenuServiceImpl.<span class="built_in">this</span>.covertMenuNode(subMenu, menuList))</span><br><span class="line">                                             .collect(Collectors.toList());</span><br><span class="line">        node.setChildren(children);</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="会员模块相关表分析，ums-member"><a href="#会员模块相关表分析，ums-member" class="headerlink" title="会员模块相关表分析，ums_member*"></a>会员模块相关表分析，ums_member*</h4><img src="../数据库表设计/image/ums/my_ums_member.png" alt="my_ums_member" style="zoom:80%;" />

<h5 id="ums-member相关表分析"><a href="#ums-member相关表分析" class="headerlink" title="ums_member相关表分析"></a>ums_member相关表分析</h5><ul>
<li><strong>ums_member表为会员表，其中member_level_id字段为表ums_member_level的外键</strong></li>
<li><strong>ums_member_level表为会员等级表</strong></li>
<li><strong>ums_member_login_log表为会员登录记录表，其中member_id字段为表ums_member的外键</strong></li>
<li><strong>ums_member_product_category_relation表为会员与产品分类关系表（用户喜欢的分类），其中member_id字段为表ums_member的外键</strong></li>
<li><strong>ums_member_tag表为用户标签表</strong></li>
<li><strong>ums_member_member_tag_relation表为用户和标签关系表，其中tag_id字段为ums_member_tag的外键，member_id字段为表ums_member的外键</strong></li>
<li><strong>ums_member_statistics_info表为会员统计信息表，其中member_id字段为表ums_member的外键</strong></li>
<li><strong>ums_growth_change_history表为成长值变化历史记录表，其中member_id字段为表ums_member的外键</strong></li>
<li><strong>ums_integration_change_history表为积分变化历史记录表，其中member_id字段为表ums_member的外键</strong></li>
<li><strong>ums_member_task表为会员任务表</strong></li>
<li><strong>ums_member_rule_setting表为会员积分成长规则表</strong></li>
<li><strong>ums_integration_consume_setting表为积分消费设置表</strong></li>
</ul>
<h4 id="会员相关接口设计（设计不完整）"><a href="#会员相关接口设计（设计不完整）" class="headerlink" title="会员相关接口设计（设计不完整）"></a>会员相关接口设计（设计不完整）</h4><h5 id="UmsMemberLevelController相关"><a href="#UmsMemberLevelController相关" class="headerlink" title="UmsMemberLevelController相关"></a>UmsMemberLevelController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 会员等级管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;UmsMemberLevelController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;UmsMemberLevelController&quot;, description = &quot;会员等级管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/memberLevel&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UmsMemberLevelController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsMemberLevelService memberLevelService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;查询所有会员等级&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;UmsMemberLevel&gt;&gt; <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam(&quot;defaultStatus&quot;)</span> Integer defaultStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;UmsMemberLevel&gt; memberLevelList = memberLevelService.list(defaultStatus);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(memberLevelList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="UmsMemberLevelService"><a href="#UmsMemberLevelService" class="headerlink" title="UmsMemberLevelService"></a>UmsMemberLevelService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 会员等级管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UmsMemberLevelService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有会员等级</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> defaultStatus 是否为默认会员</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;UmsMemberLevel&gt; <span class="title function_">list</span><span class="params">(Integer defaultStatus)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="UmsMemberLevelServiceImpl"><a href="#UmsMemberLevelServiceImpl" class="headerlink" title="UmsMemberLevelServiceImpl"></a>UmsMemberLevelServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 会员等级管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UmsMemberLevelServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UmsMemberLevelService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UmsMemberLevelMapper memberLevelMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UmsMemberLevel&gt; <span class="title function_">list</span><span class="params">(Integer defaultStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">UmsMemberLevelExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UmsMemberLevelExample</span>();</span><br><span class="line">        example.createCriteria().andDefaultStatusEqualTo(defaultStatus);</span><br><span class="line">        <span class="keyword">return</span> memberLevelMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="商品模块相关表分析，pms"><a href="#商品模块相关表分析，pms" class="headerlink" title="商品模块相关表分析，pms_*"></a>商品模块相关表分析，pms_*</h4><img src="../数据库表设计/image/pms/my_ums_pms.png" alt="my_ums_pms" style="zoom:80%;" />

<h5 id="pms-相关表分析"><a href="#pms-相关表分析" class="headerlink" title="pms_*相关表分析"></a>pms_*相关表分析</h5><ul>
<li><strong>pms_product表为商品信息表，其中brand_id字段为表pms_brand的外键、product_category_id字段为表pms_product_category的外键、feight_template_id字段为表pms_feight_template的外键、product_attribute_category_id为表pms_product_attribute_category的外键</strong></li>
<li><strong>pms_brand表为品牌表</strong></li>
<li><strong>pms_product_category表为产品分类表，其中parent_id字段为自身的外键，表示父级id</strong></li>
<li><strong>pms_product_attribute_category表为产品属性分类表</strong></li>
<li><strong>pms_feight_template表为运费模版表</strong></li>
<li><strong>pms_product_attribute表为商品属性参数表，其中product_attribute_category_id字段为表pms_product_attribute_category的外键</strong></li>
<li><strong>pms_product_attribute_value表为存储产品参数信息的表，其中product_id字段为表pms_product的外键、product_attribute_id字段为表pms_product_attribute的外键</strong></li>
<li><strong>pms_product_category_attribute_relation表为产品的分类和属性的关系表，用于设置分类筛选条件（只支持一级分类），其中product_category_id为表pms_product_category的外键、product_attribute_id字段为表pms_product_attribute的外键</strong></li>
<li><strong>pms_sku_stock表为sku的库存表，其中product_id字段为表pms_product的外键</strong></li>
<li><strong>pms_comment表为商品评价表，其中product_id字段为表pms_product的外键</strong></li>
<li><strong>pms_comment_replay表为产品评价回复表，其中comment_id字段为表pms_comment的外键</strong></li>
<li><strong>pms_product_operate_log表为商品操作日志表，其中product_id字段为表pms_product的外键</strong></li>
<li><strong>pms_product_vertify_record表为商品审核记录表，其中product_id字段为表pms_product的外键</strong></li>
<li><strong>pms_product_full_reduction表为产品满减表(只针对同商品)，其中product_id字段为表pms_product的外键</strong></li>
<li><strong>pms_product_ladder表为产品阶梯价格表(只针对同商品)，其中product_id字段为表pms_product的外键</strong></li>
<li><strong>pms_member_price表为商品会员价格表，其中product_id字段为表pms_product的外键</strong></li>
<li><strong>pms_album表为相册表</strong></li>
<li><strong>pms_album_pic表为画册图片表，其中album_id字段为表pms_album的外键</strong></li>
</ul>
<h4 id="商品相关接口设计"><a href="#商品相关接口设计" class="headerlink" title="商品相关接口设计"></a>商品相关接口设计</h4><h5 id="PmsProductController相关"><a href="#PmsProductController相关" class="headerlink" title="PmsProductController相关"></a>PmsProductController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;PmsProductController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;PmsProductController&quot;, description = &quot;商品管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/product&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PmsProductController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductService productService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;创建商品&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> PmsProductParam productParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productService.create(productParam);</span><br><span class="line">        <span class="keyword">if</span>(count == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据商品id获取商品编辑信息&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/updateInfo/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;PmsProductResult&gt; <span class="title function_">getUpdateInfo</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProductResult</span> <span class="variable">productResult</span> <span class="operator">=</span> productService.getUpdateInfo(id);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(productResult);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;更新商品&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> PmsProductParam productParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productService.update(id, productParam);</span><br><span class="line">        <span class="keyword">if</span>(count == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;查询商品&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;PmsProduct&gt;&gt; <span class="title function_">getList</span><span class="params">(PmsProductQueryParam productQueryParam,</span></span><br><span class="line"><span class="params">                                                        <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                                                        <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;PmsProduct&gt; productList = productService.list(productQueryParam, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(productList));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据商品名称或货号模糊查询&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/simpleList&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;PmsProduct&gt;&gt; <span class="title function_">getList</span><span class="params">(String keyword)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;PmsProduct&gt; productList = productService.list(keyword);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(productList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO 未开发完全</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量修改审核状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/verifyStatus&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateVerifyStatus</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids,</span></span><br><span class="line"><span class="params">                                           <span class="meta">@RequestParam(&quot;verifyStatus&quot;)</span> Integer verifyStatus,</span></span><br><span class="line"><span class="params">                                           <span class="meta">@RequestParam(&quot;detail&quot;)</span> String detail)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productService.updateVerifyStatus(ids, verifyStatus, detail);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量上下架商品&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/publishStatus&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updatePublishStatus</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids,</span></span><br><span class="line"><span class="params">                                            <span class="meta">@RequestParam(&quot;publishStatus&quot;)</span> Integer publishStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productService.updatePublishStatus(ids, publishStatus);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量推荐商品&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/recommendStatus&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateRecommendStatus</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids,</span></span><br><span class="line"><span class="params">                                              <span class="meta">@RequestParam(&quot;recommendStatus&quot;)</span> Integer recommendStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productService.updateRecommendStatus(ids, recommendStatus);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量设为新品&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/newStatus&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateNewStatus</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@RequestParam(&quot;newStatus&quot;)</span> Integer newStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productService.updateNewStatus(ids, newStatus);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量修改删除状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/deleteStatus&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateDeleteStatus</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids,</span></span><br><span class="line"><span class="params">                                           <span class="meta">@RequestParam(&quot;deleteStatus&quot;)</span> Integer deleteStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productService.updateDeleteStatus(ids, deleteStatus);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="PmsProductService"><a href="#PmsProductService" class="headerlink" title="PmsProductService"></a>PmsProductService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PmsProductService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建商品</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional(isolation = Isolation.DEFAULT, propagation = Propagation.REQUIRED)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(PmsProductParam productParam)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据商品编号获取更新信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    PmsProductResult <span class="title function_">getUpdateInfo</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新商品</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, PmsProductParam productParam)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询商品</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;PmsProduct&gt; <span class="title function_">list</span><span class="params">(PmsProductQueryParam productQueryParam, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量修改审核状态</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids          产品id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> verifyStatus 审核状态</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> detail       审核详情</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateVerifyStatus</span><span class="params">(List&lt;Long&gt; ids, Integer verifyStatus, String detail)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量修改商品上架状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updatePublishStatus</span><span class="params">(List&lt;Long&gt; ids, Integer publishStatus)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量修改商品推荐状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateRecommendStatus</span><span class="params">(List&lt;Long&gt; ids, Integer recommendStatus)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量修改新品状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateNewStatus</span><span class="params">(List&lt;Long&gt; ids, Integer newStatus)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除商品</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateDeleteStatus</span><span class="params">(List&lt;Long&gt; ids, Integer deleteStatus)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据商品名称或者货号模糊查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;PmsProduct&gt; <span class="title function_">list</span><span class="params">(String keyword)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="PmsProductServiceImpl"><a href="#PmsProductServiceImpl" class="headerlink" title="PmsProductServiceImpl"></a>PmsProductServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PmsProductServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PmsProductService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(PmsProductServiceImpl.class);</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductMapper productMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsMemberPriceDao memberPriceDao;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsMemberPriceMapper memberPriceMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductLadderDao productLadderDao;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductLadderMapper productLadderMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductFullReductionDao productFullReductionDao;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductFullReductionMapper productFullReductionMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsSkuStockDao skuStockDao;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsSkuStockMapper skuStockMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductAttributeValueDao productAttributeValueDao;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductAttributeValueMapper productAttributeValueMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CmsSubjectProductRelationDao subjectProductRelationDao;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CmsSubjectProductRelationMapper subjectProductRelationMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CmsPrefrenceAreaProductRelationDao prefrenceAreaProductRelationDao;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CmsPrefrenceAreaProductRelationMapper prefrenceAreaProductRelationMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductDao productDao;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductVertifyRecordDao productVertifyRecordDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(PmsProductParam productParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> count;</span><br><span class="line">        <span class="comment">//创建商品</span></span><br><span class="line">        <span class="type">PmsProduct</span> <span class="variable">product</span> <span class="operator">=</span> productParam;</span><br><span class="line">        product.setId(<span class="literal">null</span>);</span><br><span class="line">        productMapper.insertSelective(product);</span><br><span class="line">        <span class="comment">//根据促销类型设置价格：会员价格、阶梯价格、满减价格</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">productId</span> <span class="operator">=</span> product.getId();</span><br><span class="line">        <span class="comment">//会员价格</span></span><br><span class="line">        relateAndInsertList(memberPriceDao, productParam.getMemberPriceList(), productId);</span><br><span class="line">        <span class="comment">//阶梯价格</span></span><br><span class="line">        relateAndInsertList(productLadderDao, productParam.getProductLadderList(), productId);</span><br><span class="line">        <span class="comment">//满减价格</span></span><br><span class="line">        relateAndInsertList(productFullReductionDao, productParam.getProductFullReductionList(), productId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//处理sku的编码</span></span><br><span class="line">        handleSkuStockCode(productParam.getSkuStockList(), productId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加sku库存信息</span></span><br><span class="line">        relateAndInsertList(skuStockDao, productParam.getSkuStockList(), productId);</span><br><span class="line">        <span class="comment">//添加商品参数,添加自定义商品规格</span></span><br><span class="line">        relateAndInsertList(productAttributeValueDao, productParam.getProductAttributeValueList(), productId);</span><br><span class="line">        <span class="comment">//关联专题</span></span><br><span class="line">        relateAndInsertList(subjectProductRelationDao, productParam.getSubjectProductRelationList(), productId);</span><br><span class="line">        <span class="comment">//关联优选</span></span><br><span class="line">        relateAndInsertList(prefrenceAreaProductRelationDao, productParam.getPrefrenceAreaProductRelationList(), productId);</span><br><span class="line">        <span class="comment">// 中间如果出错会抛出异常</span></span><br><span class="line">        count = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleSkuStockCode</span><span class="params">(List&lt;PmsSkuStock&gt; skuStockList, Long productId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(CollectionUtils.isEmpty(skuStockList)) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; skuStockList.size(); i++)&#123;</span><br><span class="line">            <span class="type">PmsSkuStock</span> <span class="variable">skuStock</span> <span class="operator">=</span> skuStockList.get(i);</span><br><span class="line">            <span class="keyword">if</span>(StrUtil.isEmpty(skuStock.getSkuCode()))&#123;</span><br><span class="line">                <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyyMMdd&quot;</span>);</span><br><span class="line">                <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                <span class="comment">//日期</span></span><br><span class="line">                sb.append(sdf.format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">                <span class="comment">//四位商品id</span></span><br><span class="line">                sb.append(String.format(<span class="string">&quot;%04d&quot;</span>, productId));</span><br><span class="line">                <span class="comment">// TODO 三位索引id，索引id有什么用？</span></span><br><span class="line">                sb.append(String.format(<span class="string">&quot;%03d&quot;</span>, i + <span class="number">1</span>));</span><br><span class="line">                skuStock.setSkuCode(sb.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PmsProductResult <span class="title function_">getUpdateInfo</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> productDao.getUpdateInfo(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, PmsProductParam productParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> count;</span><br><span class="line">        <span class="comment">//更新商品信息</span></span><br><span class="line">        <span class="type">PmsProduct</span> <span class="variable">product</span> <span class="operator">=</span> productParam;</span><br><span class="line">        product.setId(id);</span><br><span class="line">        productMapper.updateByPrimaryKeySelective(product);</span><br><span class="line">        <span class="comment">//会员价格</span></span><br><span class="line">        <span class="type">PmsMemberPriceExample</span> <span class="variable">pmsMemberPriceExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsMemberPriceExample</span>();</span><br><span class="line">        pmsMemberPriceExample.createCriteria().andProductIdEqualTo(id);</span><br><span class="line">        memberPriceMapper.deleteByExample(pmsMemberPriceExample);</span><br><span class="line">        relateAndInsertList(memberPriceDao, productParam.getMemberPriceList(), id);</span><br><span class="line">        <span class="comment">//阶梯价格</span></span><br><span class="line">        <span class="type">PmsProductLadderExample</span> <span class="variable">ladderExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductLadderExample</span>();</span><br><span class="line">        ladderExample.createCriteria().andProductIdEqualTo(id);</span><br><span class="line">        productLadderMapper.deleteByExample(ladderExample);</span><br><span class="line">        relateAndInsertList(productLadderDao, productParam.getProductLadderList(), id);</span><br><span class="line">        <span class="comment">//满减价格</span></span><br><span class="line">        <span class="type">PmsProductFullReductionExample</span> <span class="variable">fullReductionExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductFullReductionExample</span>();</span><br><span class="line">        fullReductionExample.createCriteria().andProductIdEqualTo(id);</span><br><span class="line">        productFullReductionMapper.deleteByExample(fullReductionExample);</span><br><span class="line">        relateAndInsertList(productFullReductionDao, productParam.getProductFullReductionList(), id);</span><br><span class="line">        <span class="comment">//修改sku库存信息</span></span><br><span class="line">        handleUpdateSkuStockList(id, productParam);</span><br><span class="line">        <span class="comment">//修改商品参数,添加自定义商品规格</span></span><br><span class="line">        <span class="type">PmsProductAttributeValueExample</span> <span class="variable">productAttributeValueExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductAttributeValueExample</span>();</span><br><span class="line">        productAttributeValueExample.createCriteria().andProductIdEqualTo(id);</span><br><span class="line">        productAttributeValueMapper.deleteByExample(productAttributeValueExample);</span><br><span class="line">        relateAndInsertList(productAttributeValueDao, productParam.getProductAttributeValueList(), id);</span><br><span class="line">        <span class="comment">//关联专题</span></span><br><span class="line">        <span class="type">CmsSubjectProductRelationExample</span> <span class="variable">subjectProductRelationExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CmsSubjectProductRelationExample</span>();</span><br><span class="line">        subjectProductRelationExample.createCriteria().andProductIdEqualTo(id);</span><br><span class="line">        subjectProductRelationMapper.deleteByExample(subjectProductRelationExample);</span><br><span class="line">        relateAndInsertList(subjectProductRelationDao, productParam.getSubjectProductRelationList(), id);</span><br><span class="line">        <span class="comment">//关联优选</span></span><br><span class="line">        <span class="type">CmsPrefrenceAreaProductRelationExample</span> <span class="variable">prefrenceAreaExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CmsPrefrenceAreaProductRelationExample</span>();</span><br><span class="line">        prefrenceAreaExample.createCriteria().andProductIdEqualTo(id);</span><br><span class="line">        prefrenceAreaProductRelationMapper.deleteByExample(prefrenceAreaExample);</span><br><span class="line">        relateAndInsertList(prefrenceAreaProductRelationDao, productParam.getPrefrenceAreaProductRelationList(), id);</span><br><span class="line">        count = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleUpdateSkuStockList</span><span class="params">(Long id, PmsProductParam productParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//当前的sku信息</span></span><br><span class="line">        List&lt;PmsSkuStock&gt; currSkuList = productParam.getSkuStockList();</span><br><span class="line">        <span class="comment">//当前没有sku直接删除</span></span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isEmpty(currSkuList))&#123;</span><br><span class="line">            <span class="type">PmsSkuStockExample</span> <span class="variable">skuStockExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsSkuStockExample</span>();</span><br><span class="line">            skuStockExample.createCriteria().andProductIdEqualTo(id);</span><br><span class="line">            skuStockMapper.deleteByExample(skuStockExample);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取初始sku信息</span></span><br><span class="line">        <span class="type">PmsSkuStockExample</span> <span class="variable">skuStockExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsSkuStockExample</span>();</span><br><span class="line">        skuStockExample.createCriteria().andProductIdEqualTo(id);</span><br><span class="line">        List&lt;PmsSkuStock&gt; oriStuList = skuStockMapper.selectByExample(skuStockExample);</span><br><span class="line">        <span class="comment">//获取新增sku信息，如果id为null则为新增的sku</span></span><br><span class="line">        List&lt;PmsSkuStock&gt; insertSkuList =</span><br><span class="line">                currSkuList.stream()</span><br><span class="line">                           .filter(item -&gt; item.getId() == <span class="literal">null</span>)</span><br><span class="line">                           .collect(Collectors.toList());</span><br><span class="line">        <span class="comment">//获取需要更新的sku信息，如果id不为null则为要更新的sku</span></span><br><span class="line">        List&lt;PmsSkuStock&gt; updateSkuList =</span><br><span class="line">                currSkuList.stream()</span><br><span class="line">                           .filter(item -&gt; item.getId() != <span class="literal">null</span>)</span><br><span class="line">                           .collect(Collectors.toList());</span><br><span class="line">        List&lt;Long&gt; updateSkuIds = updateSkuList.stream()</span><br><span class="line">                                               .map(PmsSkuStock::getId)</span><br><span class="line">                                               .collect(Collectors.toList());</span><br><span class="line">        <span class="comment">//获取需要删除的sku信息，如果id不在要更新的sku的id列表中，则为要删除的sku</span></span><br><span class="line">        <span class="comment">// 这是初始的sku信息</span></span><br><span class="line">        List&lt;PmsSkuStock&gt; removeSkuList =</span><br><span class="line">                oriStuList.stream()</span><br><span class="line">                          .filter(item -&gt; !updateSkuIds.contains(item.getId()))</span><br><span class="line">                          .collect(Collectors.toList());</span><br><span class="line">        <span class="comment">// 处理sku编码</span></span><br><span class="line">        handleSkuStockCode(insertSkuList, id);</span><br><span class="line">        handleSkuStockCode(updateSkuList, id);</span><br><span class="line">        <span class="comment">//新增sku</span></span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isNotEmpty(insertSkuList))&#123;</span><br><span class="line">            relateAndInsertList(skuStockDao, insertSkuList, id);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//删除sku</span></span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isNotEmpty(removeSkuList))&#123;</span><br><span class="line">            List&lt;Long&gt; removeSkuIds = removeSkuList.stream().map(PmsSkuStock::getId).collect(Collectors.toList());</span><br><span class="line">            <span class="type">PmsSkuStockExample</span> <span class="variable">removeExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsSkuStockExample</span>();</span><br><span class="line">            removeExample.createCriteria().andIdIn(removeSkuIds);</span><br><span class="line">            skuStockMapper.deleteByExample(removeExample);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//修改sku</span></span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isNotEmpty(updateSkuList))&#123;</span><br><span class="line">            <span class="keyword">for</span>(PmsSkuStock pmsSkuStock : updateSkuList)&#123;</span><br><span class="line">                skuStockMapper.updateByPrimaryKeySelective(pmsSkuStock);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;PmsProduct&gt; <span class="title function_">list</span><span class="params">(PmsProductQueryParam productQueryParam, Integer pageSize, Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="type">PmsProductExample</span> <span class="variable">productExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductExample</span>();</span><br><span class="line">        PmsProductExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> productExample.createCriteria();</span><br><span class="line">        <span class="comment">// 没有删除的商品</span></span><br><span class="line">        criteria.andDeleteStatusEqualTo(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 拼接查询条件</span></span><br><span class="line">        <span class="keyword">if</span>(productQueryParam.getPublishStatus() != <span class="literal">null</span>)&#123;</span><br><span class="line">            criteria.andPublishStatusEqualTo(productQueryParam.getPublishStatus());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(productQueryParam.getVerifyStatus() != <span class="literal">null</span>)&#123;</span><br><span class="line">            criteria.andVerifyStatusEqualTo(productQueryParam.getVerifyStatus());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!StrUtil.isEmpty(productQueryParam.getKeyword()))&#123;</span><br><span class="line">            criteria.andNameLike(<span class="string">&quot;%&quot;</span> + productQueryParam.getKeyword() + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!StrUtil.isEmpty(productQueryParam.getProductSn()))&#123;</span><br><span class="line">            criteria.andProductSnEqualTo(productQueryParam.getProductSn());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(productQueryParam.getBrandId() != <span class="literal">null</span>)&#123;</span><br><span class="line">            criteria.andBrandIdEqualTo(productQueryParam.getBrandId());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(productQueryParam.getProductCategoryId() != <span class="literal">null</span>)&#123;</span><br><span class="line">            criteria.andProductCategoryIdEqualTo(productQueryParam.getProductCategoryId());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> productMapper.selectByExample(productExample);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateVerifyStatus</span><span class="params">(List&lt;Long&gt; ids, Integer verifyStatus, String detail)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProduct</span> <span class="variable">product</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProduct</span>();</span><br><span class="line">        product.setVerifyStatus(verifyStatus);</span><br><span class="line">        <span class="type">PmsProductExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        List&lt;PmsProductVertifyRecord&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productMapper.updateByExampleSelective(product, example);</span><br><span class="line">        <span class="comment">//修改完审核状态后插入审核记录</span></span><br><span class="line">        <span class="comment">// TODO 获取登录之后存储的 authentication，打印日志</span></span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> authentication.getName();</span><br><span class="line">        <span class="type">UmsAdmin</span> <span class="variable">details</span> <span class="operator">=</span> (UmsAdmin) authentication.getDetails();</span><br><span class="line">        LOGGER.info(<span class="string">&quot;PmsProductServiceImpl username = &#123;&#125;, details = &#123;&#125;&quot;</span>, username, details);</span><br><span class="line">        <span class="keyword">for</span>(Long id : ids)&#123;</span><br><span class="line">            <span class="type">PmsProductVertifyRecord</span> <span class="variable">record</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductVertifyRecord</span>();</span><br><span class="line">            record.setProductId(id);</span><br><span class="line">            record.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">            record.setDetail(detail);</span><br><span class="line">            record.setStatus(verifyStatus);</span><br><span class="line">            <span class="comment">// TODO 审核人固定为test?</span></span><br><span class="line">            <span class="comment">// 需要将token传回来？</span></span><br><span class="line">            record.setVertifyMan(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">            list.add(record);</span><br><span class="line">        &#125;</span><br><span class="line">        productVertifyRecordDao.insertList(list);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updatePublishStatus</span><span class="params">(List&lt;Long&gt; ids, Integer publishStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProduct</span> <span class="variable">record</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProduct</span>();</span><br><span class="line">        record.setPublishStatus(publishStatus);</span><br><span class="line">        <span class="type">PmsProductExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="keyword">return</span> productMapper.updateByExampleSelective(record, example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateRecommendStatus</span><span class="params">(List&lt;Long&gt; ids, Integer recommendStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProduct</span> <span class="variable">record</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProduct</span>();</span><br><span class="line">        record.setRecommandStatus(recommendStatus);</span><br><span class="line">        <span class="type">PmsProductExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="keyword">return</span> productMapper.updateByExampleSelective(record, example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateNewStatus</span><span class="params">(List&lt;Long&gt; ids, Integer newStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProduct</span> <span class="variable">record</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProduct</span>();</span><br><span class="line">        record.setNewStatus(newStatus);</span><br><span class="line">        <span class="type">PmsProductExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="keyword">return</span> productMapper.updateByExampleSelective(record, example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateDeleteStatus</span><span class="params">(List&lt;Long&gt; ids, Integer deleteStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProduct</span> <span class="variable">record</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProduct</span>();</span><br><span class="line">        record.setDeleteStatus(deleteStatus);</span><br><span class="line">        <span class="type">PmsProductExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="keyword">return</span> productMapper.updateByExampleSelective(record, example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;PmsProduct&gt; <span class="title function_">list</span><span class="params">(String keyword)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProductExample</span> <span class="variable">productExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductExample</span>();</span><br><span class="line">        PmsProductExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> productExample.createCriteria();</span><br><span class="line">        criteria.andDeleteStatusEqualTo(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span>(!StrUtil.isEmpty(keyword))&#123;</span><br><span class="line">            criteria.andNameLike(<span class="string">&quot;%&quot;</span> + keyword + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">            productExample.or().andDeleteStatusEqualTo(<span class="number">0</span>).andProductSnLike(<span class="string">&quot;%&quot;</span> + keyword + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> productMapper.selectByExample(productExample);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 建立和插入关系表操作</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dao       可以操作的dao</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataList  要插入的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> productId 建立关系的id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">relateAndInsertList</span><span class="params">(Object dao, List dataList, Long productId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(CollectionUtils.isEmpty(dataList)) <span class="keyword">return</span>;</span><br><span class="line">            <span class="comment">// 将给定的 dataList 中的每个对象都执行 setId 和 setProductId 这两个方法</span></span><br><span class="line">            <span class="keyword">for</span>(Object item : dataList)&#123;</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setId</span> <span class="operator">=</span> item.getClass().getMethod(<span class="string">&quot;setId&quot;</span>, Long.class);</span><br><span class="line">                setId.invoke(item, (Long) <span class="literal">null</span>);</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setProductId</span> <span class="operator">=</span> item.getClass().getMethod(<span class="string">&quot;setProductId&quot;</span>, Long.class);</span><br><span class="line">                setProductId.invoke(item, productId);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 将 dataList 插入对应的表</span></span><br><span class="line">            <span class="type">Method</span> <span class="variable">insertList</span> <span class="operator">=</span> dao.getClass().getMethod(<span class="string">&quot;insertList&quot;</span>, List.class);</span><br><span class="line">            insertList.invoke(dao, dataList);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            LOGGER.warn(<span class="string">&quot;创建产品出错:&#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="PmsBrandController相关"><a href="#PmsBrandController相关" class="headerlink" title="PmsBrandController相关"></a>PmsBrandController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品品牌管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;PmsBrandController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;PmsBrandController&quot;, description = &quot;商品品牌管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/brand&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PmsBrandController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsBrandService brandService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取全部品牌列表&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/listAll&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;PmsBrand&gt;&gt; <span class="title function_">getList</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(brandService.listAllBrand());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;添加品牌&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> PmsBrandParam pmsBrand)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> brandService.createBrand(pmsBrand);</span><br><span class="line">        <span class="keyword">if</span>(count == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;更新品牌&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id, <span class="meta">@Validated</span> <span class="meta">@RequestBody</span> PmsBrandParam pmsBrandParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> brandService.updateBrand(id, pmsBrandParam);</span><br><span class="line">        <span class="keyword">if</span>(count == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除品牌&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> brandService.deleteBrand(id);</span><br><span class="line">        <span class="keyword">if</span>(count == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(<span class="literal">null</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据品牌名称分页获取品牌列表&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;PmsBrand&gt;&gt; <span class="title function_">getList</span><span class="params">(<span class="meta">@RequestParam(value = &quot;keyword&quot;, required = false)</span> String keyword,</span></span><br><span class="line"><span class="params">                                                      <span class="meta">@RequestParam(value = &quot;showStatus&quot;, required = false)</span> Integer showStatus,</span></span><br><span class="line"><span class="params">                                                      <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum,</span></span><br><span class="line"><span class="params">                                                      <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;PmsBrand&gt; brandList = brandService.listBrand(keyword, showStatus, pageNum, pageSize);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(brandList));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据编号查询品牌信息&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;PmsBrand&gt; <span class="title function_">getItem</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(brandService.getBrand(id));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;批量删除品牌&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete/batch&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">deleteBatch</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> brandService.deleteBrand(ids);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;批量更新显示状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/showStatus&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateShowStatus</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids,</span></span><br><span class="line"><span class="params">                                         <span class="meta">@RequestParam(&quot;showStatus&quot;)</span> Integer showStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> brandService.updateShowStatus(ids, showStatus);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;批量更新厂家制造商状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/factoryStatus&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateFactoryStatus</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids,</span></span><br><span class="line"><span class="params">                                            <span class="meta">@RequestParam(&quot;factoryStatus&quot;)</span> Integer factoryStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> brandService.updateFactoryStatus(ids, factoryStatus);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="PmsBrandService"><a href="#PmsBrandService" class="headerlink" title="PmsBrandService"></a>PmsBrandService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品品牌管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PmsBrandService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有品牌</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;PmsBrand&gt; <span class="title function_">listAllBrand</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建品牌</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">createBrand</span><span class="params">(PmsBrandParam pmsBrandParam)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改品牌</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateBrand</span><span class="params">(Long id, PmsBrandParam pmsBrandParam)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除品牌</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteBrand</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除品牌</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteBrand</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询品牌</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;PmsBrand&gt; <span class="title function_">listBrand</span><span class="params">(String keyword, Integer showStatus, <span class="type">int</span> pageNum, <span class="type">int</span> pageSize)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取品牌详情</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    PmsBrand <span class="title function_">getBrand</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改显示状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateShowStatus</span><span class="params">(List&lt;Long&gt; ids, Integer showStatus)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改厂家制造商状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateFactoryStatus</span><span class="params">(List&lt;Long&gt; ids, Integer factoryStatus)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="PmsBrandServiceImpl"><a href="#PmsBrandServiceImpl" class="headerlink" title="PmsBrandServiceImpl"></a>PmsBrandServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品品牌管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PmsBrandServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PmsBrandService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsBrandMapper brandMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductMapper productMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;PmsBrand&gt; <span class="title function_">listAllBrand</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> brandMapper.selectByExample(<span class="keyword">new</span> <span class="title class_">PmsBrandExample</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">createBrand</span><span class="params">(PmsBrandParam pmsBrandParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsBrand</span> <span class="variable">pmsBrand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsBrand</span>();</span><br><span class="line">        BeanUtils.copyProperties(pmsBrandParam, pmsBrand);</span><br><span class="line">        <span class="comment">//如果创建时首字母为空，取名称的第一个为首字母</span></span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isEmpty(pmsBrand.getFirstLetter()))&#123;</span><br><span class="line">            pmsBrand.setFirstLetter(pmsBrand.getName().substring(<span class="number">0</span>, <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> brandMapper.insertSelective(pmsBrand);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateBrand</span><span class="params">(Long id, PmsBrandParam pmsBrandParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsBrand</span> <span class="variable">pmsBrand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsBrand</span>();</span><br><span class="line">        BeanUtils.copyProperties(pmsBrandParam, pmsBrand);</span><br><span class="line">        pmsBrand.setId(id);</span><br><span class="line">        <span class="comment">//如果创建时首字母为空，取名称的第一个为首字母</span></span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isEmpty(pmsBrand.getFirstLetter()))&#123;</span><br><span class="line">            pmsBrand.setFirstLetter(pmsBrand.getName().substring(<span class="number">0</span>, <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//更新品牌时要更新商品中的品牌名称</span></span><br><span class="line">        <span class="type">PmsProduct</span> <span class="variable">product</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProduct</span>();</span><br><span class="line">        product.setBrandName(pmsBrand.getName());</span><br><span class="line">        <span class="type">PmsProductExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductExample</span>();</span><br><span class="line">        example.createCriteria().andBrandIdEqualTo(id);</span><br><span class="line">        productMapper.updateByExampleSelective(product, example);</span><br><span class="line">        <span class="keyword">return</span> brandMapper.updateByPrimaryKeySelective(pmsBrand);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteBrand</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> brandMapper.deleteByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteBrand</span><span class="params">(List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsBrandExample</span> <span class="variable">pmsBrandExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsBrandExample</span>();</span><br><span class="line">        pmsBrandExample.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="keyword">return</span> brandMapper.deleteByExample(pmsBrandExample);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;PmsBrand&gt; <span class="title function_">listBrand</span><span class="params">(String keyword, Integer showStatus, <span class="type">int</span> pageNum, <span class="type">int</span> pageSize)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="type">PmsBrandExample</span> <span class="variable">pmsBrandExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsBrandExample</span>();</span><br><span class="line">        pmsBrandExample.setOrderByClause(<span class="string">&quot;sort desc&quot;</span>);</span><br><span class="line">        PmsBrandExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> pmsBrandExample.createCriteria();</span><br><span class="line">        <span class="keyword">if</span>(!StrUtil.isEmpty(keyword))&#123;</span><br><span class="line">            criteria.andNameLike(<span class="string">&quot;%&quot;</span> + keyword + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(showStatus != <span class="literal">null</span>)&#123;</span><br><span class="line">            criteria.andShowStatusEqualTo(showStatus);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> brandMapper.selectByExample(pmsBrandExample);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PmsBrand <span class="title function_">getBrand</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> brandMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateShowStatus</span><span class="params">(List&lt;Long&gt; ids, Integer showStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsBrand</span> <span class="variable">pmsBrand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsBrand</span>();</span><br><span class="line">        pmsBrand.setShowStatus(showStatus);</span><br><span class="line">        <span class="type">PmsBrandExample</span> <span class="variable">pmsBrandExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsBrandExample</span>();</span><br><span class="line">        pmsBrandExample.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="keyword">return</span> brandMapper.updateByExampleSelective(pmsBrand, pmsBrandExample);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateFactoryStatus</span><span class="params">(List&lt;Long&gt; ids, Integer factoryStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsBrand</span> <span class="variable">pmsBrand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsBrand</span>();</span><br><span class="line">        pmsBrand.setFactoryStatus(factoryStatus);</span><br><span class="line">        <span class="type">PmsBrandExample</span> <span class="variable">pmsBrandExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsBrandExample</span>();</span><br><span class="line">        pmsBrandExample.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="keyword">return</span> brandMapper.updateByExampleSelective(pmsBrand, pmsBrandExample);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="PmsSkuStockController相关"><a href="#PmsSkuStockController相关" class="headerlink" title="PmsSkuStockController相关"></a>PmsSkuStockController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品SKU库存管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;PmsSkuStockController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;PmsSkuStockController&quot;, description = &quot;sku商品库存管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/sku&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PmsSkuStockController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsSkuStockService skuStockService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据商品ID及sku编码模糊搜索sku库存&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;pid&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;PmsSkuStock&gt;&gt; <span class="title function_">getList</span><span class="params">(<span class="meta">@PathVariable</span> Long pid,</span></span><br><span class="line"><span class="params">                                                   <span class="meta">@RequestParam(value = &quot;keyword&quot;, required = false)</span> String keyword)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;PmsSkuStock&gt; skuStockList = skuStockService.getList(pid, keyword);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(skuStockList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量更新sku库存信息&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;pid&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long pid, <span class="meta">@RequestBody</span> List&lt;PmsSkuStock&gt; skuStockList)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> skuStockService.update(pid, skuStockList);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="PmsSkuStockService"><a href="#PmsSkuStockService" class="headerlink" title="PmsSkuStockService"></a>PmsSkuStockService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品SKU库存管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PmsSkuStockService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据产品id和skuCode关键字模糊搜索</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;PmsSkuStock&gt; <span class="title function_">getList</span><span class="params">(Long pid, String keyword)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量更新商品库存信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long pid, List&lt;PmsSkuStock&gt; skuStockList)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="PmsSkuStockServiceImpl"><a href="#PmsSkuStockServiceImpl" class="headerlink" title="PmsSkuStockServiceImpl"></a>PmsSkuStockServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品SKU库存管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PmsSkuStockServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PmsSkuStockService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsSkuStockMapper skuStockMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsSkuStockDao skuStockDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;PmsSkuStock&gt; <span class="title function_">getList</span><span class="params">(Long pid, String keyword)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsSkuStockExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsSkuStockExample</span>();</span><br><span class="line">        PmsSkuStockExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> example.createCriteria().andProductIdEqualTo(pid);</span><br><span class="line">        <span class="keyword">if</span>(!StrUtil.isEmpty(keyword))&#123;</span><br><span class="line">            criteria.andSkuCodeLike(<span class="string">&quot;%&quot;</span> + keyword + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> skuStockMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long pid, List&lt;PmsSkuStock&gt; skuStockList)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> skuStockDao.replaceList(skuStockList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="PmsProductCategoryController相关"><a href="#PmsProductCategoryController相关" class="headerlink" title="PmsProductCategoryController相关"></a>PmsProductCategoryController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品分类管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;PmsProductCategoryController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;PmsProductCategoryController&quot;, description = &quot;商品分类管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/productCategory&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PmsProductCategoryController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductCategoryService productCategoryService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加商品分类&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> PmsProductCategoryParam productCategoryParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productCategoryService.create(productCategoryParam);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改商品分类&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id,</span></span><br><span class="line"><span class="params">                               <span class="meta">@Validated</span> <span class="meta">@RequestBody</span> PmsProductCategoryParam productCategoryParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productCategoryService.update(id, productCategoryParam);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;分页查询商品分类&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list/&#123;parentId&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;PmsProductCategory&gt;&gt; <span class="title function_">getList</span><span class="params">(<span class="meta">@PathVariable</span> Long parentId,</span></span><br><span class="line"><span class="params">                                                                <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                                                                <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;PmsProductCategory&gt; productCategoryList = productCategoryService.getList(parentId, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(productCategoryList));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据id获取商品分类&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;PmsProductCategory&gt; <span class="title function_">getItem</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProductCategory</span> <span class="variable">productCategory</span> <span class="operator">=</span> productCategoryService.getItem(id);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(productCategory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;删除商品分类&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productCategoryService.delete(id);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改导航栏显示状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/navStatus&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateNavStatus</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@RequestParam(&quot;navStatus&quot;)</span> Integer navStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productCategoryService.updateNavStatus(ids, navStatus);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改显示状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/showStatus&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateShowStatus</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids,</span></span><br><span class="line"><span class="params">                                         <span class="meta">@RequestParam(&quot;showStatus&quot;)</span> Integer showStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productCategoryService.updateShowStatus(ids, showStatus);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;查询所有一级分类及子分类&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list/withChildren&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;PmsProductCategoryWithChildrenItem&gt;&gt; <span class="title function_">listWithChildren</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;PmsProductCategoryWithChildrenItem&gt; list = productCategoryService.listWithChildren();</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="PmsProductCategoryService"><a href="#PmsProductCategoryService" class="headerlink" title="PmsProductCategoryService"></a>PmsProductCategoryService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品分类管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PmsProductCategoryService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建商品分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(PmsProductCategoryParam pmsProductCategoryParam)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改商品分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, PmsProductCategoryParam pmsProductCategoryParam)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页获取商品分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;PmsProductCategory&gt; <span class="title function_">getList</span><span class="params">(Long parentId, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除商品分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据ID获取商品分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    PmsProductCategory <span class="title function_">getItem</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量修改导航状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateNavStatus</span><span class="params">(List&lt;Long&gt; ids, Integer navStatus)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量修改显示状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateShowStatus</span><span class="params">(List&lt;Long&gt; ids, Integer showStatus)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 以层级形式获取商品分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;PmsProductCategoryWithChildrenItem&gt; <span class="title function_">listWithChildren</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="PmsProductCategoryServiceImpl"><a href="#PmsProductCategoryServiceImpl" class="headerlink" title="PmsProductCategoryServiceImpl"></a>PmsProductCategoryServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品分类管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PmsProductCategoryServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PmsProductCategoryService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductCategoryMapper productCategoryMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductMapper productMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductCategoryAttributeRelationDao productCategoryAttributeRelationDao;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductCategoryAttributeRelationMapper productCategoryAttributeRelationMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductCategoryDao productCategoryDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(PmsProductCategoryParam pmsProductCategoryParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProductCategory</span> <span class="variable">productCategory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductCategory</span>();</span><br><span class="line">        productCategory.setProductCount(<span class="number">0</span>);</span><br><span class="line">        BeanUtils.copyProperties(pmsProductCategoryParam, productCategory);</span><br><span class="line">        <span class="comment">//没有父分类时为一级分类</span></span><br><span class="line">        setCategoryLevel(productCategory);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productCategoryMapper.insertSelective(productCategory);</span><br><span class="line">        <span class="comment">//创建筛选属性关联</span></span><br><span class="line">        List&lt;Long&gt; productAttributeIdList = pmsProductCategoryParam.getProductAttributeIdList();</span><br><span class="line">        <span class="keyword">if</span>(!CollectionUtils.isEmpty(productAttributeIdList))&#123;</span><br><span class="line">            insertRelationList(productCategory.getId(), productAttributeIdList);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量插入商品分类与筛选属性关系表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> productCategoryId      商品分类id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> productAttributeIdList 相关商品筛选属性id集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">insertRelationList</span><span class="params">(Long productCategoryId, List&lt;Long&gt; productAttributeIdList)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;PmsProductCategoryAttributeRelation&gt; relationList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        productAttributeIdList.forEach(productAttrId -&gt; &#123;</span><br><span class="line">            <span class="type">PmsProductCategoryAttributeRelation</span> <span class="variable">relation</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductCategoryAttributeRelation</span>();</span><br><span class="line">            relation.setProductAttributeId(productAttrId);</span><br><span class="line">            relation.setProductCategoryId(productCategoryId);</span><br><span class="line">            relationList.add(relation);</span><br><span class="line">        &#125;);</span><br><span class="line">        productCategoryAttributeRelationDao.insertList(relationList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, PmsProductCategoryParam pmsProductCategoryParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProductCategory</span> <span class="variable">productCategory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductCategory</span>();</span><br><span class="line">        productCategory.setId(id);</span><br><span class="line">        BeanUtils.copyProperties(pmsProductCategoryParam, productCategory);</span><br><span class="line">        setCategoryLevel(productCategory);</span><br><span class="line">        <span class="comment">//更新商品分类时要更新商品中的名称</span></span><br><span class="line">        <span class="type">PmsProduct</span> <span class="variable">product</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProduct</span>();</span><br><span class="line">        product.setProductCategoryName(productCategory.getName());</span><br><span class="line">        <span class="type">PmsProductExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductExample</span>();</span><br><span class="line">        example.createCriteria().andProductCategoryIdEqualTo(id);</span><br><span class="line">        productMapper.updateByExampleSelective(product, example);</span><br><span class="line">        <span class="comment">//同时更新筛选属性的信息</span></span><br><span class="line">        <span class="keyword">if</span>(!CollectionUtils.isEmpty(pmsProductCategoryParam.getProductAttributeIdList()))&#123;</span><br><span class="line">            <span class="type">PmsProductCategoryAttributeRelationExample</span> <span class="variable">relationExample</span> <span class="operator">=</span></span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">PmsProductCategoryAttributeRelationExample</span>();</span><br><span class="line">            relationExample.createCriteria().andProductCategoryIdEqualTo(id);</span><br><span class="line">            productCategoryAttributeRelationMapper.deleteByExample(relationExample);</span><br><span class="line">            insertRelationList(id, pmsProductCategoryParam.getProductAttributeIdList());</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">PmsProductCategoryAttributeRelationExample</span> <span class="variable">relationExample</span> <span class="operator">=</span></span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">PmsProductCategoryAttributeRelationExample</span>();</span><br><span class="line">            relationExample.createCriteria().andProductCategoryIdEqualTo(id);</span><br><span class="line">            productCategoryAttributeRelationMapper.deleteByExample(relationExample);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> productCategoryMapper.updateByPrimaryKeySelective(productCategory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;PmsProductCategory&gt; <span class="title function_">getList</span><span class="params">(Long parentId, Integer pageSize, Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="type">PmsProductCategoryExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductCategoryExample</span>();</span><br><span class="line">        example.setOrderByClause(<span class="string">&quot;sort desc&quot;</span>);</span><br><span class="line">        example.createCriteria().andParentIdEqualTo(parentId);</span><br><span class="line">        <span class="keyword">return</span> productCategoryMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> productCategoryMapper.deleteByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PmsProductCategory <span class="title function_">getItem</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> productCategoryMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateNavStatus</span><span class="params">(List&lt;Long&gt; ids, Integer navStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProductCategory</span> <span class="variable">productCategory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductCategory</span>();</span><br><span class="line">        productCategory.setNavStatus(navStatus);</span><br><span class="line">        <span class="type">PmsProductCategoryExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductCategoryExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="keyword">return</span> productCategoryMapper.updateByExampleSelective(productCategory, example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateShowStatus</span><span class="params">(List&lt;Long&gt; ids, Integer showStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProductCategory</span> <span class="variable">productCategory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductCategory</span>();</span><br><span class="line">        productCategory.setShowStatus(showStatus);</span><br><span class="line">        <span class="type">PmsProductCategoryExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductCategoryExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="keyword">return</span> productCategoryMapper.updateByExampleSelective(productCategory, example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;PmsProductCategoryWithChildrenItem&gt; <span class="title function_">listWithChildren</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> productCategoryDao.listWithChildren();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据分类的parentId设置分类的level</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setCategoryLevel</span><span class="params">(PmsProductCategory productCategory)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//没有父分类时为一级分类</span></span><br><span class="line">        <span class="keyword">if</span>(productCategory.getParentId() == <span class="number">0</span>)&#123;</span><br><span class="line">            productCategory.setLevel(<span class="number">0</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//有父分类时选择根据父分类level设置</span></span><br><span class="line">            <span class="type">PmsProductCategory</span> <span class="variable">parentCategory</span> <span class="operator">=</span> productCategoryMapper.selectByPrimaryKey(productCategory.getParentId());</span><br><span class="line">            <span class="keyword">if</span>(parentCategory != <span class="literal">null</span>)&#123;</span><br><span class="line">                productCategory.setLevel(parentCategory.getLevel() + <span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                productCategory.setLevel(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="PmsProductAttributeController相关"><a href="#PmsProductAttributeController相关" class="headerlink" title="PmsProductAttributeController相关"></a>PmsProductAttributeController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;PmsProductAttributeController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;PmsProductAttributeController&quot;, description = &quot;商品属性管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/productAttribute&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PmsProductAttributeController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductAttributeService productAttributeService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据分类查询属性列表或参数列表&quot;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams(</span></span><br><span class="line"><span class="meta">            &#123;@ApiImplicitParam(name = &quot;type&quot;, value = &quot;0表示属性，1表示参数&quot;, required = true, paramType = &quot;query&quot;,</span></span><br><span class="line"><span class="meta">                    dataType = &quot;integer&quot;)&#125;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list/&#123;cid&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;PmsProductAttribute&gt;&gt; <span class="title function_">getList</span><span class="params">(<span class="meta">@PathVariable</span> Long cid,</span></span><br><span class="line"><span class="params">                                                                 <span class="meta">@RequestParam(value = &quot;type&quot;)</span> Integer type,</span></span><br><span class="line"><span class="params">                                                                 <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                                                                 <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;PmsProductAttribute&gt; productAttributeList = productAttributeService.getList(cid, type, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(productAttributeList));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加商品属性信息&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> PmsProductAttributeParam productAttributeParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productAttributeService.create(productAttributeParam);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改商品属性信息&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> PmsProductAttributeParam productAttributeParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productAttributeService.update(id, productAttributeParam);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;查询单个商品属性&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;PmsProductAttribute&gt; <span class="title function_">getItem</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProductAttribute</span> <span class="variable">productAttribute</span> <span class="operator">=</span> productAttributeService.getItem(id);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(productAttribute);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量删除商品属性&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productAttributeService.delete(ids);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据商品分类的id获取商品属性及属性分类&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/attrInfo/&#123;productCategoryId&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;ProductAttrInfo&gt;&gt; <span class="title function_">getAttrInfo</span><span class="params">(<span class="meta">@PathVariable</span> Long productCategoryId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;ProductAttrInfo&gt; productAttrInfoList = productAttributeService.getProductAttrInfo(productCategoryId);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(productAttrInfoList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="PmsProductAttributeService"><a href="#PmsProductAttributeService" class="headerlink" title="PmsProductAttributeService"></a>PmsProductAttributeService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品属性管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PmsProductAttributeService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据分类分页获取商品属性</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cid  分类id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type 0-&gt;规格；1-&gt;参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;PmsProductAttribute&gt; <span class="title function_">getList</span><span class="params">(Long cid, Integer type, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加商品属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(PmsProductAttributeParam pmsProductAttributeParam)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改商品属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, PmsProductAttributeParam productAttributeParam)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取单个商品属性信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    PmsProductAttribute <span class="title function_">getItem</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除商品属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取商品分类对应属性列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;ProductAttrInfo&gt; <span class="title function_">getProductAttrInfo</span><span class="params">(Long productCategoryId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="PmsProductAttributeServiceImpl"><a href="#PmsProductAttributeServiceImpl" class="headerlink" title="PmsProductAttributeServiceImpl"></a>PmsProductAttributeServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品属性管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PmsProductAttributeServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PmsProductAttributeService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductAttributeMapper productAttributeMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductAttributeCategoryMapper productAttributeCategoryMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductAttributeDao productAttributeDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;PmsProductAttribute&gt; <span class="title function_">getList</span><span class="params">(Long cid, Integer type, Integer pageSize, Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="type">PmsProductAttributeExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductAttributeExample</span>();</span><br><span class="line">        example.setOrderByClause(<span class="string">&quot;sort desc&quot;</span>);</span><br><span class="line">        example.createCriteria().andProductAttributeCategoryIdEqualTo(cid).andTypeEqualTo(type);</span><br><span class="line">        <span class="keyword">return</span> productAttributeMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(PmsProductAttributeParam pmsProductAttributeParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProductAttribute</span> <span class="variable">pmsProductAttribute</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductAttribute</span>();</span><br><span class="line">        BeanUtils.copyProperties(pmsProductAttributeParam, pmsProductAttribute);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productAttributeMapper.insertSelective(pmsProductAttribute);</span><br><span class="line">        <span class="comment">//新增商品属性以后需要更新商品属性分类数量</span></span><br><span class="line">        <span class="type">PmsProductAttributeCategory</span> <span class="variable">pmsProductAttributeCategory</span> <span class="operator">=</span></span><br><span class="line">                productAttributeCategoryMapper.selectByPrimaryKey(pmsProductAttribute.getProductAttributeCategoryId());</span><br><span class="line">        <span class="keyword">if</span>(pmsProductAttribute.getType() == <span class="number">0</span>)&#123;</span><br><span class="line">            pmsProductAttributeCategory.setAttributeCount(pmsProductAttributeCategory.getAttributeCount() + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(pmsProductAttribute.getType() == <span class="number">1</span>)&#123;</span><br><span class="line">            pmsProductAttributeCategory.setParamCount(pmsProductAttributeCategory.getParamCount() + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        productAttributeCategoryMapper.updateByPrimaryKey(pmsProductAttributeCategory);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, PmsProductAttributeParam productAttributeParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProductAttribute</span> <span class="variable">pmsProductAttribute</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductAttribute</span>();</span><br><span class="line">        pmsProductAttribute.setId(id);</span><br><span class="line">        BeanUtils.copyProperties(productAttributeParam, pmsProductAttribute);</span><br><span class="line">        <span class="keyword">return</span> productAttributeMapper.updateByPrimaryKeySelective(pmsProductAttribute);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PmsProductAttribute <span class="title function_">getItem</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> productAttributeMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//获取分类</span></span><br><span class="line">        <span class="type">PmsProductAttribute</span> <span class="variable">pmsProductAttribute</span> <span class="operator">=</span> productAttributeMapper.selectByPrimaryKey(ids.get(<span class="number">0</span>));</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">type</span> <span class="operator">=</span> pmsProductAttribute.getType();</span><br><span class="line">        <span class="type">PmsProductAttributeCategory</span> <span class="variable">pmsProductAttributeCategory</span> <span class="operator">=</span></span><br><span class="line">                productAttributeCategoryMapper.selectByPrimaryKey(pmsProductAttribute.getProductAttributeCategoryId());</span><br><span class="line">        <span class="type">PmsProductAttributeExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductAttributeExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productAttributeMapper.deleteByExample(example);</span><br><span class="line">        <span class="comment">//删除完成后修改数量</span></span><br><span class="line">        <span class="keyword">if</span>(type == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(pmsProductAttributeCategory.getAttributeCount() &gt;= count)&#123;</span><br><span class="line">                pmsProductAttributeCategory.setAttributeCount(pmsProductAttributeCategory.getAttributeCount() - count);</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                pmsProductAttributeCategory.setAttributeCount(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(type == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(pmsProductAttributeCategory.getParamCount() &gt;= count)&#123;</span><br><span class="line">                pmsProductAttributeCategory.setParamCount(pmsProductAttributeCategory.getParamCount() - count);</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                pmsProductAttributeCategory.setParamCount(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        productAttributeCategoryMapper.updateByPrimaryKey(pmsProductAttributeCategory);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;ProductAttrInfo&gt; <span class="title function_">getProductAttrInfo</span><span class="params">(Long productCategoryId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> productAttributeDao.getProductAttrInfo(productCategoryId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="PmsProductAttributeCategoryController相关"><a href="#PmsProductAttributeCategoryController相关" class="headerlink" title="PmsProductAttributeCategoryController相关"></a>PmsProductAttributeCategoryController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品属性分类管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;PmsProductAttributeCategoryController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;PmsProductAttributeCategoryController&quot;, description = &quot;商品属性分类管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/productAttribute/category&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PmsProductAttributeCategoryController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductAttributeCategoryService productAttributeCategoryService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加商品属性分类&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestParam</span> String name)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productAttributeCategoryService.create(name);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改商品属性分类&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestParam</span> String name)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productAttributeCategoryService.update(id, name);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;删除单个商品属性分类&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> productAttributeCategoryService.delete(id);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取单个商品属性分类信息&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;PmsProductAttributeCategory&gt; <span class="title function_">getItem</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProductAttributeCategory</span> <span class="variable">productAttributeCategory</span> <span class="operator">=</span> productAttributeCategoryService.getItem(id);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(productAttributeCategory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;分页获取所有商品属性分类&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;PmsProductAttributeCategory&gt;&gt; <span class="title function_">getList</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;5&quot;)</span> Integer pageSize, <span class="meta">@RequestParam(defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;PmsProductAttributeCategory&gt; productAttributeCategoryList =</span><br><span class="line">                productAttributeCategoryService.getList(pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(productAttributeCategoryList));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取所有商品属性分类及其下属性&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list/withAttr&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;PmsProductAttributeCategoryItem&gt;&gt; <span class="title function_">getListWithAttr</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;PmsProductAttributeCategoryItem&gt; productAttributeCategoryResultList =</span><br><span class="line">                productAttributeCategoryService.getListWithAttr();</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(productAttributeCategoryResultList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="PmsProductAttributeCategoryService"><a href="#PmsProductAttributeCategoryService" class="headerlink" title="PmsProductAttributeCategoryService"></a>PmsProductAttributeCategoryService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品属性分类管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PmsProductAttributeCategoryService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建属性分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(String name)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改属性分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, String name)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除属性分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取属性分类详情</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    PmsProductAttributeCategory <span class="title function_">getItem</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询属性分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;PmsProductAttributeCategory&gt; <span class="title function_">getList</span><span class="params">(Integer pageSize, Integer pageNum)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取包含属性的属性分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;PmsProductAttributeCategoryItem&gt; <span class="title function_">getListWithAttr</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="PmsProductAttributeCategoryServiceImpl"><a href="#PmsProductAttributeCategoryServiceImpl" class="headerlink" title="PmsProductAttributeCategoryServiceImpl"></a>PmsProductAttributeCategoryServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品属性分类管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PmsProductAttributeCategoryServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PmsProductAttributeCategoryService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductAttributeCategoryMapper productAttributeCategoryMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PmsProductAttributeCategoryDao productAttributeCategoryDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(String name)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProductAttributeCategory</span> <span class="variable">productAttributeCategory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductAttributeCategory</span>();</span><br><span class="line">        productAttributeCategory.setName(name);</span><br><span class="line">        <span class="keyword">return</span> productAttributeCategoryMapper.insertSelective(productAttributeCategory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, String name)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">PmsProductAttributeCategory</span> <span class="variable">productAttributeCategory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PmsProductAttributeCategory</span>();</span><br><span class="line">        productAttributeCategory.setName(name);</span><br><span class="line">        productAttributeCategory.setId(id);</span><br><span class="line">        <span class="keyword">return</span> productAttributeCategoryMapper.updateByPrimaryKeySelective(productAttributeCategory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> productAttributeCategoryMapper.deleteByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PmsProductAttributeCategory <span class="title function_">getItem</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> productAttributeCategoryMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;PmsProductAttributeCategory&gt; <span class="title function_">getList</span><span class="params">(Integer pageSize, Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="keyword">return</span> productAttributeCategoryMapper.selectByExample(<span class="keyword">new</span> <span class="title class_">PmsProductAttributeCategoryExample</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;PmsProductAttributeCategoryItem&gt; <span class="title function_">getListWithAttr</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> productAttributeCategoryDao.getListWithAttr();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="内容管理模块相关表分析，cms"><a href="#内容管理模块相关表分析，cms" class="headerlink" title="内容管理模块相关表分析，cms_*"></a>内容管理模块相关表分析，cms_*</h4><img src="../数据库表设计/image/cms/my_ums.png" alt="my_ums" style="zoom:80%;" />

<h5 id="cms-相关表分析"><a href="#cms-相关表分析" class="headerlink" title="cms_*相关表分析"></a>cms_*相关表分析</h5><ul>
<li><strong>cms_subject表为专题表，其中category_id字段为表cms_subject_category的外键</strong></li>
<li><strong>cms_subject_category表为专题分类表</strong></li>
<li><strong>cms_subject_comment表为专题评论表，其中subject_id字段为表cms_subject的外键</strong></li>
<li><strong>cms_subject_product_relation表为专题商品关系表，其中subject_id字段为表cms_subject的外键</strong></li>
<li><strong>cms_prefrence_area表为优选专区表</strong></li>
<li><strong>cms_prefrence_area_product_relation表为优选专区和产品关系表，其中prefrence_area_id字段为表cms_prefrence_area的外键</strong></li>
<li><strong>cms_topic表为话题表，其中category_id字段为表cms_topic_category的外键</strong></li>
<li><strong>cms_topic_category表为话题分类表</strong></li>
<li><strong>cms_topic_comment表为专题评论表，其中topic_id字段为表cms_topic的外键</strong></li>
<li><strong>cms_member_report表为用户举报表</strong></li>
<li><strong>cms_help表为帮助表，其中category_id字段为表cms_help_category的外键</strong></li>
<li><strong>cms_help_category表为帮助分类表</strong></li>
</ul>
<h4 id="内容管理相关接口设计（设计不完整）"><a href="#内容管理相关接口设计（设计不完整）" class="headerlink" title="内容管理相关接口设计（设计不完整）"></a>内容管理相关接口设计（设计不完整）</h4><h5 id="CmsSubjectController相关"><a href="#CmsSubjectController相关" class="headerlink" title="CmsSubjectController相关"></a>CmsSubjectController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品专题管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;CmsSubjectController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;CmsSubjectController&quot;, description = &quot;商品专题管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/subject&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CmsSubjectController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CmsSubjectService subjectService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取全部商品专题&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/listAll&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;CmsSubject&gt;&gt; <span class="title function_">listAll</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;CmsSubject&gt; subjectList = subjectService.listAll();</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(subjectList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据专题名称分页获取商品专题&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;CmsSubject&gt;&gt; <span class="title function_">getList</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;keyword&quot;, required = false)</span> String keyword,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;CmsSubject&gt; subjectList = subjectService.list(keyword, pageNum, pageSize);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(subjectList));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="CmsSubjectService"><a href="#CmsSubjectService" class="headerlink" title="CmsSubjectService"></a>CmsSubjectService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品专题管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CmsSubjectService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有专题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;CmsSubject&gt; <span class="title function_">listAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询专题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;CmsSubject&gt; <span class="title function_">list</span><span class="params">(String keyword, Integer pageNum, Integer pageSize)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="CmsSubjectServiceImpl"><a href="#CmsSubjectServiceImpl" class="headerlink" title="CmsSubjectServiceImpl"></a>CmsSubjectServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品专题管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CmsSubjectServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CmsSubjectService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CmsSubjectMapper subjectMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CmsSubject&gt; <span class="title function_">listAll</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> subjectMapper.selectByExample(<span class="keyword">new</span> <span class="title class_">CmsSubjectExample</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CmsSubject&gt; <span class="title function_">list</span><span class="params">(String keyword, Integer pageNum, Integer pageSize)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="type">CmsSubjectExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CmsSubjectExample</span>();</span><br><span class="line">        CmsSubjectExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> example.createCriteria();</span><br><span class="line">        <span class="keyword">if</span>(!StrUtil.isEmpty(keyword))&#123;</span><br><span class="line">            criteria.andTitleLike(<span class="string">&quot;%&quot;</span> + keyword + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> subjectMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="CmsPrefrenceAreaController相关"><a href="#CmsPrefrenceAreaController相关" class="headerlink" title="CmsPrefrenceAreaController相关"></a>CmsPrefrenceAreaController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品优选管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;CmsPrefrenceAreaController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;CmsPrefrenceAreaController&quot;, description = &quot;商品优选管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/prefrenceArea&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CmsPrefrenceAreaController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CmsPrefrenceAreaService prefrenceAreaService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取所有商品优选&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/listAll&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;CmsPrefrenceArea&gt;&gt; <span class="title function_">listAll</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;CmsPrefrenceArea&gt; prefrenceAreaList = prefrenceAreaService.listAll();</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(prefrenceAreaList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="CmsPrefrenceAreaService"><a href="#CmsPrefrenceAreaService" class="headerlink" title="CmsPrefrenceAreaService"></a>CmsPrefrenceAreaService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品优选管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CmsPrefrenceAreaService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有优选专区</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;CmsPrefrenceArea&gt; <span class="title function_">listAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="CmsPrefrenceAreaServiceImpl"><a href="#CmsPrefrenceAreaServiceImpl" class="headerlink" title="CmsPrefrenceAreaServiceImpl"></a>CmsPrefrenceAreaServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品优选管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CmsPrefrenceAreaServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CmsPrefrenceAreaService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CmsPrefrenceAreaMapper prefrenceAreaMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CmsPrefrenceArea&gt; <span class="title function_">listAll</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> prefrenceAreaMapper.selectByExample(<span class="keyword">new</span> <span class="title class_">CmsPrefrenceAreaExample</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="订单管理模块相关表分析，oms"><a href="#订单管理模块相关表分析，oms" class="headerlink" title="订单管理模块相关表分析，oms_*"></a>订单管理模块相关表分析，oms_*</h4><img src="../数据库表设计/image/oms/my_oms1.png" alt="my_oms1" style="zoom:80%;" />

<h5 id="oms-相关表分析"><a href="#oms-相关表分析" class="headerlink" title="oms_*相关表分析"></a>oms_*相关表分析</h5><ul>
<li><strong>oms_order表为订单表</strong></li>
<li><strong>oms_order_item表为订单中所包含的商品，其中order_id字段为表oms_order的外键</strong></li>
<li><strong>oms_order_operate_history表为订单操作历史记录，其中order_id字段为表oms_order的外键</strong></li>
<li><strong>oms_order_return_apply表为订单退货申请表，其中order_id字段为表oms_order的外键、company_address_id为表oms_company_address的外键</strong></li>
<li><strong>oms_company_address表为公司收发货地址表</strong></li>
<li><strong>oms_cart_item表为购物车表</strong></li>
<li><strong>oms_order_return_reason表为退货原因表</strong></li>
<li><strong>oms_order_setting表为订单设置表</strong></li>
</ul>
<h4 id="订单管理相关接口设计"><a href="#订单管理相关接口设计" class="headerlink" title="订单管理相关接口设计"></a>订单管理相关接口设计</h4><h5 id="OmsOrderController相关"><a href="#OmsOrderController相关" class="headerlink" title="OmsOrderController相关"></a>OmsOrderController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;OmsOrderController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;OmsOrderController&quot;, description = &quot;订单管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OmsOrderController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OmsOrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;查询订单&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;OmsOrder&gt;&gt; <span class="title function_">list</span><span class="params">(OmsOrderQueryParam queryParam,</span></span><br><span class="line"><span class="params">                                                   <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                                                   <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;OmsOrder&gt; orderList = orderService.list(queryParam, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(orderList));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量发货&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/delivery&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delivery</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;OmsOrderDeliveryParam&gt; deliveryParamList)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderService.delivery(deliveryParamList);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量关闭订单&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/close&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">close</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids, <span class="meta">@RequestParam</span> String note)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderService.close(ids, note);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量删除订单&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderService.delete(ids);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取订单详情：订单信息、商品信息、操作记录&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;OmsOrderDetail&gt; <span class="title function_">detail</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">OmsOrderDetail</span> <span class="variable">orderDetailResult</span> <span class="operator">=</span> orderService.detail(id);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(orderDetailResult);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改收货人信息&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/receiverInfo&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateReceiverInfo</span><span class="params">(<span class="meta">@RequestBody</span> OmsReceiverInfoParam receiverInfoParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderService.updateReceiverInfo(receiverInfoParam);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改订单费用信息&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/moneyInfo&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateReceiverInfo</span><span class="params">(<span class="meta">@RequestBody</span> OmsMoneyInfoParam moneyInfoParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderService.updateMoneyInfo(moneyInfoParam);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;备注订单&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/note&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateNote</span><span class="params">(<span class="meta">@RequestParam(&quot;id&quot;)</span> Long id, <span class="meta">@RequestParam(&quot;note&quot;)</span> String note,</span></span><br><span class="line"><span class="params">                                   <span class="meta">@RequestParam(&quot;status&quot;)</span> Integer status)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderService.updateNote(id, note, status);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="OmsOrderService"><a href="#OmsOrderService" class="headerlink" title="OmsOrderService"></a>OmsOrderService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OmsOrderService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订单查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;OmsOrder&gt; <span class="title function_">list</span><span class="params">(OmsOrderQueryParam queryParam, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量发货</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delivery</span><span class="params">(List&lt;OmsOrderDeliveryParam&gt; deliveryParamList)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量关闭订单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">close</span><span class="params">(List&lt;Long&gt; ids, String note)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除订单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取指定订单详情</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    OmsOrderDetail <span class="title function_">detail</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改订单收货人信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateReceiverInfo</span><span class="params">(OmsReceiverInfoParam receiverInfoParam)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改订单费用信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateMoneyInfo</span><span class="params">(OmsMoneyInfoParam moneyInfoParam)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改订单备注</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateNote</span><span class="params">(Long id, String note, Integer status)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="OmsOrderServiceImpl"><a href="#OmsOrderServiceImpl" class="headerlink" title="OmsOrderServiceImpl"></a>OmsOrderServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OmsOrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OmsOrderService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OmsOrderMapper orderMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OmsOrderDao orderDao;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OmsOrderOperateHistoryDao orderOperateHistoryDao;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OmsOrderOperateHistoryMapper orderOperateHistoryMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;OmsOrder&gt; <span class="title function_">list</span><span class="params">(OmsOrderQueryParam queryParam, Integer pageSize, Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="keyword">return</span> orderDao.getList(queryParam);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delivery</span><span class="params">(List&lt;OmsOrderDeliveryParam&gt; deliveryParamList)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//批量发货</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderDao.delivery(deliveryParamList);</span><br><span class="line">        <span class="comment">//添加操作记录</span></span><br><span class="line">        List&lt;OmsOrderOperateHistory&gt; operateHistoryList = deliveryParamList</span><br><span class="line">                .stream()</span><br><span class="line">                .map(omsOrderDeliveryParam -&gt; &#123;</span><br><span class="line">                    <span class="type">OmsOrderOperateHistory</span> <span class="variable">history</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrderOperateHistory</span>();</span><br><span class="line">                    history.setOrderId(omsOrderDeliveryParam.getOrderId());</span><br><span class="line">                    history.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">                    history.setOperateMan(<span class="string">&quot;后台管理员&quot;</span>);</span><br><span class="line">                    history.setOrderStatus(<span class="number">2</span>);</span><br><span class="line">                    history.setNote(<span class="string">&quot;完成发货&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> history;</span><br><span class="line">                &#125;)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        orderOperateHistoryDao.insertList(operateHistoryList);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">close</span><span class="params">(List&lt;Long&gt; ids, String note)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">OmsOrder</span> <span class="variable">record</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrder</span>();</span><br><span class="line">        record.setStatus(<span class="number">4</span>);</span><br><span class="line">        <span class="type">OmsOrderExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrderExample</span>();</span><br><span class="line">        example.createCriteria().andDeleteStatusEqualTo(<span class="number">0</span>).andIdIn(ids);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderMapper.updateByExampleSelective(record, example);</span><br><span class="line">        List&lt;OmsOrderOperateHistory&gt; historyList = ids</span><br><span class="line">                .stream()</span><br><span class="line">                .map(orderId -&gt; &#123;</span><br><span class="line">                    <span class="type">OmsOrderOperateHistory</span> <span class="variable">history</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrderOperateHistory</span>();</span><br><span class="line">                    history.setOrderId(orderId);</span><br><span class="line">                    history.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">                    history.setOperateMan(<span class="string">&quot;后台管理员&quot;</span>);</span><br><span class="line">                    history.setOrderStatus(<span class="number">4</span>);</span><br><span class="line">                    history.setNote(<span class="string">&quot;订单关闭:&quot;</span> + note);</span><br><span class="line">                    <span class="keyword">return</span> history;&#125;)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        orderOperateHistoryDao.insertList(historyList);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">OmsOrder</span> <span class="variable">record</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrder</span>();</span><br><span class="line">        record.setDeleteStatus(<span class="number">1</span>);</span><br><span class="line">        <span class="type">OmsOrderExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrderExample</span>();</span><br><span class="line">        example.createCriteria().andDeleteStatusEqualTo(<span class="number">0</span>).andIdIn(ids);</span><br><span class="line">        <span class="keyword">return</span> orderMapper.updateByExampleSelective(record, example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> OmsOrderDetail <span class="title function_">detail</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> orderDao.getDetail(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateReceiverInfo</span><span class="params">(OmsReceiverInfoParam receiverInfoParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">OmsOrder</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrder</span>();</span><br><span class="line">        order.setId(receiverInfoParam.getOrderId());</span><br><span class="line">        order.setReceiverName(receiverInfoParam.getReceiverName());</span><br><span class="line">        order.setReceiverPhone(receiverInfoParam.getReceiverPhone());</span><br><span class="line">        order.setReceiverPostCode(receiverInfoParam.getReceiverPostCode());</span><br><span class="line">        order.setReceiverDetailAddress(receiverInfoParam.getReceiverDetailAddress());</span><br><span class="line">        order.setReceiverProvince(receiverInfoParam.getReceiverProvince());</span><br><span class="line">        order.setReceiverCity(receiverInfoParam.getReceiverCity());</span><br><span class="line">        order.setReceiverRegion(receiverInfoParam.getReceiverRegion());</span><br><span class="line">        order.setModifyTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderMapper.updateByPrimaryKeySelective(order);</span><br><span class="line">        <span class="comment">//插入操作记录</span></span><br><span class="line">        <span class="type">OmsOrderOperateHistory</span> <span class="variable">history</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrderOperateHistory</span>();</span><br><span class="line">        history.setOrderId(receiverInfoParam.getOrderId());</span><br><span class="line">        history.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        history.setOperateMan(<span class="string">&quot;后台管理员&quot;</span>);</span><br><span class="line">        history.setOrderStatus(receiverInfoParam.getStatus());</span><br><span class="line">        history.setNote(<span class="string">&quot;修改收货人信息&quot;</span>);</span><br><span class="line">        orderOperateHistoryMapper.insert(history);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateMoneyInfo</span><span class="params">(OmsMoneyInfoParam moneyInfoParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">OmsOrder</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrder</span>();</span><br><span class="line">        order.setId(moneyInfoParam.getOrderId());</span><br><span class="line">        order.setFreightAmount(moneyInfoParam.getFreightAmount());</span><br><span class="line">        order.setDiscountAmount(moneyInfoParam.getDiscountAmount());</span><br><span class="line">        order.setModifyTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderMapper.updateByPrimaryKeySelective(order);</span><br><span class="line">        <span class="comment">//插入操作记录</span></span><br><span class="line">        <span class="type">OmsOrderOperateHistory</span> <span class="variable">history</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrderOperateHistory</span>();</span><br><span class="line">        history.setOrderId(moneyInfoParam.getOrderId());</span><br><span class="line">        history.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        history.setOperateMan(<span class="string">&quot;后台管理员&quot;</span>);</span><br><span class="line">        history.setOrderStatus(moneyInfoParam.getStatus());</span><br><span class="line">        history.setNote(<span class="string">&quot;修改费用信息&quot;</span>);</span><br><span class="line">        orderOperateHistoryMapper.insert(history);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateNote</span><span class="params">(Long id, String note, Integer status)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">OmsOrder</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrder</span>();</span><br><span class="line">        order.setId(id);</span><br><span class="line">        order.setNote(note);</span><br><span class="line">        order.setModifyTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderMapper.updateByPrimaryKeySelective(order);</span><br><span class="line">        <span class="type">OmsOrderOperateHistory</span> <span class="variable">history</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrderOperateHistory</span>();</span><br><span class="line">        history.setOrderId(id);</span><br><span class="line">        history.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        history.setOperateMan(<span class="string">&quot;后台管理员&quot;</span>);</span><br><span class="line">        history.setOrderStatus(status);</span><br><span class="line">        history.setNote(<span class="string">&quot;修改备注信息：&quot;</span> + note);</span><br><span class="line">        orderOperateHistoryMapper.insert(history);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="OmsCompanyAddressController相关"><a href="#OmsCompanyAddressController相关" class="headerlink" title="OmsCompanyAddressController相关"></a>OmsCompanyAddressController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 收货地址管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;OmsCompanyAddressController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;OmsCompanyAddressController&quot;, description = &quot;收货地址管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/companyAddress&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OmsCompanyAddressController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OmsCompanyAddressService companyAddressService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取所有收货地址&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;OmsCompanyAddress&gt;&gt; <span class="title function_">list</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;OmsCompanyAddress&gt; companyAddressList = companyAddressService.list();</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(companyAddressList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="OmsCompanyAddressService"><a href="#OmsCompanyAddressService" class="headerlink" title="OmsCompanyAddressService"></a>OmsCompanyAddressService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 收货地址管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OmsCompanyAddressService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取全部收货地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;OmsCompanyAddress&gt; <span class="title function_">list</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="OmsCompanyAddressServiceImpl"><a href="#OmsCompanyAddressServiceImpl" class="headerlink" title="OmsCompanyAddressServiceImpl"></a>OmsCompanyAddressServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 收货地址管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OmsCompanyAddressServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OmsCompanyAddressService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OmsCompanyAddressMapper companyAddressMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;OmsCompanyAddress&gt; <span class="title function_">list</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> companyAddressMapper.selectByExample(<span class="keyword">new</span> <span class="title class_">OmsCompanyAddressExample</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="OmsOrderSettingController相关"><a href="#OmsOrderSettingController相关" class="headerlink" title="OmsOrderSettingController相关"></a>OmsOrderSettingController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单设置管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;OmsOrderSettingController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;OmsOrderSettingController&quot;, description = &quot;订单设置管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/orderSetting&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OmsOrderSettingController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OmsOrderSettingService orderSettingService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取指定订单设置&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;OmsOrderSetting&gt; <span class="title function_">getItem</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">OmsOrderSetting</span> <span class="variable">orderSetting</span> <span class="operator">=</span> orderSettingService.getItem(id);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(orderSetting);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改指定订单设置&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> OmsOrderSetting orderSetting)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderSettingService.update(id, orderSetting);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="OmsOrderSettingService"><a href="#OmsOrderSettingService" class="headerlink" title="OmsOrderSettingService"></a>OmsOrderSettingService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单设置管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OmsOrderSettingService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取指定订单设置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    OmsOrderSetting <span class="title function_">getItem</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改指定订单设置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, OmsOrderSetting orderSetting)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="OmsOrderSettingServiceImpl"><a href="#OmsOrderSettingServiceImpl" class="headerlink" title="OmsOrderSettingServiceImpl"></a>OmsOrderSettingServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单设置管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OmsOrderSettingServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OmsOrderSettingService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OmsOrderSettingMapper orderSettingMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> OmsOrderSetting <span class="title function_">getItem</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> orderSettingMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, OmsOrderSetting orderSetting)</span></span><br><span class="line">    &#123;</span><br><span class="line">        orderSetting.setId(id);</span><br><span class="line">        <span class="keyword">return</span> orderSettingMapper.updateByPrimaryKey(orderSetting);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="OmsOrderReturnApplyController相关"><a href="#OmsOrderReturnApplyController相关" class="headerlink" title="OmsOrderReturnApplyController相关"></a>OmsOrderReturnApplyController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单退货申请管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;OmsOrderReturnApplyController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;OmsOrderReturnApplyController&quot;, description = &quot;订单退货申请管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/returnApply&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OmsOrderReturnApplyController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OmsOrderReturnApplyService returnApplyService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;分页查询退货申请&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;OmsOrderReturnApply&gt;&gt; <span class="title function_">list</span><span class="params">(OmsReturnApplyQueryParam queryParam,</span></span><br><span class="line"><span class="params">                                                              <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                                                              <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;OmsOrderReturnApply&gt; returnApplyList = returnApplyService.list(queryParam, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(returnApplyList));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量删除退货申请&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> returnApplyService.delete(ids);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取退货申请详情&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">getItem</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">OmsOrderReturnApplyResult</span> <span class="variable">result</span> <span class="operator">=</span> returnApplyService.getItem(id);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改退货申请状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/status/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateStatus</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> OmsUpdateStatusParam statusParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> returnApplyService.updateStatus(id, statusParam);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="OmsOrderReturnApplyService"><a href="#OmsOrderReturnApplyService" class="headerlink" title="OmsOrderReturnApplyService"></a>OmsOrderReturnApplyService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 退货申请管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OmsOrderReturnApplyService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询申请</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;OmsOrderReturnApply&gt; <span class="title function_">list</span><span class="params">(OmsReturnApplyQueryParam queryParam, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除申请</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改指定申请状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateStatus</span><span class="params">(Long id, OmsUpdateStatusParam statusParam)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取指定申请详情</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    OmsOrderReturnApplyResult <span class="title function_">getItem</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="OmsOrderReturnApplyServiceImpl"><a href="#OmsOrderReturnApplyServiceImpl" class="headerlink" title="OmsOrderReturnApplyServiceImpl"></a>OmsOrderReturnApplyServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单退货管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OmsOrderReturnApplyServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OmsOrderReturnApplyService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(OmsOrderReturnApplyServiceImpl.class);</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OmsOrderReturnApplyDao returnApplyDao;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OmsOrderReturnApplyMapper returnApplyMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;OmsOrderReturnApply&gt; <span class="title function_">list</span><span class="params">(OmsReturnApplyQueryParam queryParam, Integer pageSize, Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="keyword">return</span> returnApplyDao.getList(queryParam);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">OmsOrderReturnApplyExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrderReturnApplyExample</span>();</span><br><span class="line">        <span class="comment">// 3 表示订单已拒绝</span></span><br><span class="line">        example.createCriteria().andIdIn(ids).andStatusEqualTo(<span class="number">3</span>);</span><br><span class="line">        <span class="keyword">return</span> returnApplyMapper.deleteByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateStatus</span><span class="params">(Long id, OmsUpdateStatusParam statusParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">status</span> <span class="operator">=</span> statusParam.getStatus();</span><br><span class="line">        <span class="type">OmsOrderReturnApply</span> <span class="variable">returnApply</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrderReturnApply</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO 这里不能改为 BeanUtils.copyProperties(statusParam, returnApply);？</span></span><br><span class="line">        <span class="keyword">if</span>(status.equals(<span class="number">1</span>))&#123;</span><br><span class="line">            <span class="comment">//确认退货</span></span><br><span class="line">            returnApply.setId(id);</span><br><span class="line">            returnApply.setStatus(<span class="number">1</span>);</span><br><span class="line">            returnApply.setReturnAmount(statusParam.getReturnAmount());</span><br><span class="line">            returnApply.setCompanyAddressId(statusParam.getCompanyAddressId());</span><br><span class="line">            returnApply.setHandleTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">            returnApply.setHandleMan(statusParam.getHandleMan());</span><br><span class="line">            returnApply.setHandleNote(statusParam.getHandleNote());</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(status.equals(<span class="number">2</span>))&#123;</span><br><span class="line">            <span class="comment">//完成退货</span></span><br><span class="line">            returnApply.setId(id);</span><br><span class="line">            returnApply.setStatus(<span class="number">2</span>);</span><br><span class="line">            returnApply.setReceiveTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">            returnApply.setReceiveMan(statusParam.getReceiveMan());</span><br><span class="line">            returnApply.setReceiveNote(statusParam.getReceiveNote());</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(status.equals(<span class="number">3</span>))&#123;</span><br><span class="line">            <span class="comment">//拒绝退货</span></span><br><span class="line">            returnApply.setId(id);</span><br><span class="line">            returnApply.setStatus(<span class="number">3</span>);</span><br><span class="line">            returnApply.setHandleTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">            returnApply.setHandleMan(statusParam.getHandleMan());</span><br><span class="line">            returnApply.setHandleNote(statusParam.getHandleNote());</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// TODO 打印日志，看两个对象内容是否一致</span></span><br><span class="line">        <span class="comment">// 这里应该可以直接换成下面的写法，因为只要status不一样就行，虽然多了一些无关信息</span></span><br><span class="line">        <span class="comment">// 需要处理一下处理时间和收货时间</span></span><br><span class="line">        <span class="type">OmsOrderReturnApply</span> <span class="variable">returnApply1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrderReturnApply</span>();</span><br><span class="line">        BeanUtils.copyProperties(statusParam, returnApply1);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        returnApply1.setId(id);</span><br><span class="line">        <span class="keyword">if</span>(status.equals(<span class="number">1</span>) || status.equals(<span class="number">3</span>))&#123;</span><br><span class="line">            returnApply1.setHandleTime(date);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(status.equals(<span class="number">2</span>))&#123;</span><br><span class="line">            returnApply1.setReceiveTime(date);</span><br><span class="line">        &#125;</span><br><span class="line">        LOGGER.info(<span class="string">&quot;OmsOrderReturnApplyServiceImpl returnApply = &#123;&#125;&quot;</span>, returnApply);</span><br><span class="line">        LOGGER.info(<span class="string">&quot;OmsOrderReturnApplyServiceImpl returnApply1 = &#123;&#125;&quot;</span>, returnApply1);</span><br><span class="line">        <span class="keyword">return</span> returnApplyMapper.updateByPrimaryKeySelective(returnApply);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> OmsOrderReturnApplyResult <span class="title function_">getItem</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> returnApplyDao.getDetail(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="OmsOrderReturnReasonController相关"><a href="#OmsOrderReturnReasonController相关" class="headerlink" title="OmsOrderReturnReasonController相关"></a>OmsOrderReturnReasonController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 退货原因管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;OmsOrderReturnReasonController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;OmsOrderReturnReasonController&quot;, description = &quot;退货原因管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/returnReason&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OmsOrderReturnReasonController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OmsOrderReturnReasonService orderReturnReasonService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加退货原因&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> OmsOrderReturnReason returnReason)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderReturnReasonService.create(returnReason);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改退货原因&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> OmsOrderReturnReason returnReason)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderReturnReasonService.update(id, returnReason);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量删除退货原因&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderReturnReasonService.delete(ids);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;分页查询退货原因&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;OmsOrderReturnReason&gt;&gt; <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                                                               <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;OmsOrderReturnReason&gt; reasonList = orderReturnReasonService.list(pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(reasonList));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取单个退货原因详情信息&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;OmsOrderReturnReason&gt; <span class="title function_">getItem</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">OmsOrderReturnReason</span> <span class="variable">reason</span> <span class="operator">=</span> orderReturnReasonService.getItem(id);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(reason);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改退货原因启用状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/status&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateStatus</span><span class="params">(<span class="meta">@RequestParam(value = &quot;status&quot;)</span> Integer status,</span></span><br><span class="line"><span class="params">                                     <span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderReturnReasonService.updateStatus(ids, status);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="OmsOrderReturnReasonService"><a href="#OmsOrderReturnReasonService" class="headerlink" title="OmsOrderReturnReasonService"></a>OmsOrderReturnReasonService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 退货原因管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OmsOrderReturnReasonService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加退货原因</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(OmsOrderReturnReason returnReason)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改退货原因</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, OmsOrderReturnReason returnReason)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除退货原因</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页获取退货原因</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;OmsOrderReturnReason&gt; <span class="title function_">list</span><span class="params">(Integer pageSize, Integer pageNum)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量修改退货原因状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateStatus</span><span class="params">(List&lt;Long&gt; ids, Integer status)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取单个退货原因详情信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    OmsOrderReturnReason <span class="title function_">getItem</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="OmsOrderReturnReasonServiceImpl"><a href="#OmsOrderReturnReasonServiceImpl" class="headerlink" title="OmsOrderReturnReasonServiceImpl"></a>OmsOrderReturnReasonServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单原因管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OmsOrderReturnReasonServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OmsOrderReturnReasonService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OmsOrderReturnReasonMapper returnReasonMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(OmsOrderReturnReason returnReason)</span></span><br><span class="line">    &#123;</span><br><span class="line">        returnReason.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="keyword">return</span> returnReasonMapper.insert(returnReason);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, OmsOrderReturnReason returnReason)</span></span><br><span class="line">    &#123;</span><br><span class="line">        returnReason.setId(id);</span><br><span class="line">        <span class="keyword">return</span> returnReasonMapper.updateByPrimaryKey(returnReason);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">OmsOrderReturnReasonExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrderReturnReasonExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="keyword">return</span> returnReasonMapper.deleteByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;OmsOrderReturnReason&gt; <span class="title function_">list</span><span class="params">(Integer pageSize, Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="type">OmsOrderReturnReasonExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrderReturnReasonExample</span>();</span><br><span class="line">        example.setOrderByClause(<span class="string">&quot;sort desc&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> returnReasonMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateStatus</span><span class="params">(List&lt;Long&gt; ids, Integer status)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!status.equals(<span class="number">0</span>) &amp;&amp; !status.equals(<span class="number">1</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">OmsOrderReturnReason</span> <span class="variable">record</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrderReturnReason</span>();</span><br><span class="line">        record.setStatus(status);</span><br><span class="line">        <span class="type">OmsOrderReturnReasonExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsOrderReturnReasonExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="keyword">return</span> returnReasonMapper.updateByExampleSelective(record, example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> OmsOrderReturnReason <span class="title function_">getItem</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> returnReasonMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="营销模块相关表分析，sms"><a href="#营销模块相关表分析，sms" class="headerlink" title="营销模块相关表分析，sms_*"></a>营销模块相关表分析，sms_*</h4><img src="../数据库表设计/image/sms/my_sms.png" alt="my_sms" style="zoom:80%;" />



<h5 id="sms-相关表分析"><a href="#sms-相关表分析" class="headerlink" title="sms_*相关表分析"></a>sms_*相关表分析</h5><ul>
<li><strong>sms_coupon表为优惠券表</strong></li>
<li><strong>sms_coupon_history表为优惠券使用、领取历史表，其中coupon_id字段为表sms_coupon的字段</strong></li>
<li><strong>sms_coupon_product_relation表为优惠券和产品的关系表，其中coupon_id字段为表sms_coupon的字段</strong></li>
<li><strong>sms_coupon_product_category_relation表为优惠券和产品分类关系表，其中coupon_id字段为表sms_coupon的字段</strong></li>
<li><strong>sms_flash_promotion_product_relation表为商品限时购与商品关系表，其中flash_promotion_id字段为表sms_flash_promotion的外键、flash_promotion_session_id字段为表sms_flash_promotion_session的外键</strong></li>
<li><strong>sms_flash_promotion表为限时购表</strong></li>
<li><strong>sms_flash_promotion_session表为限时购场次表</strong></li>
<li><strong>sms_flash_promotion_log表为限时购通知记录</strong></li>
<li><strong>sms_home_recommend_product表为人气推荐商品表</strong></li>
<li><strong>sms_home_brand表为首页推荐品牌表</strong></li>
<li><strong>sms_home_recommend_subject表为首页推荐专题表</strong></li>
<li><strong>sms_home_new_product表为新鲜好物表</strong></li>
<li><strong>sms_home_advertise表为首页轮播广告表</strong></li>
</ul>
<h4 id="营销相关接口设计"><a href="#营销相关接口设计" class="headerlink" title="营销相关接口设计"></a>营销相关接口设计</h4><h5 id="SmsCouponController相关"><a href="#SmsCouponController相关" class="headerlink" title="SmsCouponController相关"></a>SmsCouponController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 优惠券管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;SmsCouponController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;SmsCouponController&quot;, description = &quot;优惠券管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/coupon&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsCouponController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsCouponService couponService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加优惠券&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> SmsCouponParam couponParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> couponService.create(couponParam);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;删除优惠券&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> couponService.delete(id);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改优惠券&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> SmsCouponParam couponParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> couponService.update(id, couponParam);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据优惠券名称和类型分页获取优惠券列表&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;SmsCoupon&gt;&gt; <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam(value = &quot;name&quot;, required = false)</span> String name,</span></span><br><span class="line"><span class="params">                                                    <span class="meta">@RequestParam(value = &quot;type&quot;, required = false)</span> Integer type,</span></span><br><span class="line"><span class="params">                                                    <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                                                    <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;SmsCoupon&gt; couponList = couponService.list(name, type, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(couponList));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取单个优惠券的详细信息&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;SmsCouponParam&gt; <span class="title function_">getItem</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsCouponParam</span> <span class="variable">couponParam</span> <span class="operator">=</span> couponService.getItem(id);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(couponParam);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsCouponService"><a href="#SmsCouponService" class="headerlink" title="SmsCouponService"></a>SmsCouponService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 优惠券管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmsCouponService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加优惠券</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(SmsCouponParam couponParam)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据优惠券id删除优惠券</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据优惠券id更新优惠券信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, SmsCouponParam couponParam)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页获取优惠券列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;SmsCoupon&gt; <span class="title function_">list</span><span class="params">(String name, Integer type, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取优惠券详情</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 优惠券表id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SmsCouponParam <span class="title function_">getItem</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsCouponServiceImpl"><a href="#SmsCouponServiceImpl" class="headerlink" title="SmsCouponServiceImpl"></a>SmsCouponServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 优惠券管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsCouponServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SmsCouponService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsCouponMapper couponMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsCouponProductRelationMapper productRelationMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsCouponProductCategoryRelationMapper productCategoryRelationMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsCouponProductRelationDao productRelationDao;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsCouponProductCategoryRelationDao productCategoryRelationDao;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsCouponDao couponDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(SmsCouponParam couponParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 创建优惠券时的发行数量和实际数量相等</span></span><br><span class="line">        couponParam.setCount(couponParam.getPublishCount());</span><br><span class="line">        couponParam.setUseCount(<span class="number">0</span>);</span><br><span class="line">        couponParam.setReceiveCount(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//插入优惠券表</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> couponMapper.insert(couponParam);</span><br><span class="line">        <span class="comment">//插入优惠券和商品关系表</span></span><br><span class="line">        <span class="comment">// 如果优惠券是指定商品的需要建立关系</span></span><br><span class="line">        <span class="keyword">if</span>(couponParam.getUseType().equals(<span class="number">2</span>))&#123;</span><br><span class="line">            <span class="keyword">for</span>(SmsCouponProductRelation productRelation : couponParam.getProductRelationList())&#123;</span><br><span class="line">                productRelation.setCouponId(couponParam.getId());</span><br><span class="line">            &#125;</span><br><span class="line">            productRelationDao.insertList(couponParam.getProductRelationList());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//插入优惠券和商品分类关系表</span></span><br><span class="line">        <span class="comment">// 如果优惠券是指定分类商品</span></span><br><span class="line">        <span class="keyword">if</span>(couponParam.getUseType().equals(<span class="number">1</span>))&#123;</span><br><span class="line">            <span class="keyword">for</span>(SmsCouponProductCategoryRelation couponProductCategoryRelation : couponParam.getProductCategoryRelationList())&#123;</span><br><span class="line">                couponProductCategoryRelation.setCouponId(couponParam.getId());</span><br><span class="line">            &#125;</span><br><span class="line">            productCategoryRelationDao.insertList(couponParam.getProductCategoryRelationList());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//删除优惠券</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> couponMapper.deleteByPrimaryKey(id);</span><br><span class="line">        <span class="comment">//删除商品关联</span></span><br><span class="line">        deleteProductRelation(id);</span><br><span class="line">        <span class="comment">//删除商品分类关联</span></span><br><span class="line">        deleteProductCategoryRelation(id);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">deleteProductCategoryRelation</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsCouponProductCategoryRelationExample</span> <span class="variable">productCategoryRelationExample</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">SmsCouponProductCategoryRelationExample</span>();</span><br><span class="line">        productCategoryRelationExample.createCriteria().andCouponIdEqualTo(id);</span><br><span class="line">        productCategoryRelationMapper.deleteByExample(productCategoryRelationExample);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">deleteProductRelation</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsCouponProductRelationExample</span> <span class="variable">productRelationExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsCouponProductRelationExample</span>();</span><br><span class="line">        productRelationExample.createCriteria().andCouponIdEqualTo(id);</span><br><span class="line">        productRelationMapper.deleteByExample(productRelationExample);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, SmsCouponParam couponParam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        couponParam.setId(id);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> couponMapper.updateByPrimaryKey(couponParam);</span><br><span class="line">        <span class="comment">//删除后原先的关系，插入新的优惠券和商品关系表</span></span><br><span class="line">        <span class="keyword">if</span>(couponParam.getUseType().equals(<span class="number">2</span>))&#123;</span><br><span class="line">            <span class="keyword">for</span>(SmsCouponProductRelation productRelation : couponParam.getProductRelationList())&#123;</span><br><span class="line">                productRelation.setCouponId(couponParam.getId());</span><br><span class="line">            &#125;</span><br><span class="line">            deleteProductRelation(id);</span><br><span class="line">            productRelationDao.insertList(couponParam.getProductRelationList());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//删除后插入优惠券和商品分类关系表</span></span><br><span class="line">        <span class="keyword">if</span>(couponParam.getUseType().equals(<span class="number">1</span>))&#123;</span><br><span class="line">            <span class="keyword">for</span>(SmsCouponProductCategoryRelation couponProductCategoryRelation : couponParam.getProductCategoryRelationList())&#123;</span><br><span class="line">                couponProductCategoryRelation.setCouponId(couponParam.getId());</span><br><span class="line">            &#125;</span><br><span class="line">            deleteProductCategoryRelation(id);</span><br><span class="line">            productCategoryRelationDao.insertList(couponParam.getProductCategoryRelationList());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SmsCoupon&gt; <span class="title function_">list</span><span class="params">(String name, Integer type, Integer pageSize, Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsCouponExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsCouponExample</span>();</span><br><span class="line">        SmsCouponExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> example.createCriteria();</span><br><span class="line">        <span class="keyword">if</span>(!StrUtil.isEmpty(name))&#123;</span><br><span class="line">            criteria.andNameLike(<span class="string">&quot;%&quot;</span> + name + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(type != <span class="literal">null</span>)&#123;</span><br><span class="line">            criteria.andTypeEqualTo(type);</span><br><span class="line">        &#125;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="keyword">return</span> couponMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SmsCouponParam <span class="title function_">getItem</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> couponDao.getItem(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="SmsCouponHistoryController相关"><a href="#SmsCouponHistoryController相关" class="headerlink" title="SmsCouponHistoryController相关"></a>SmsCouponHistoryController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 优惠券领取记录管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;SmsCouponHistoryController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;SmsCouponHistoryController&quot;, description = &quot;优惠券领取记录管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/couponHistory&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsCouponHistoryController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsCouponHistoryService historyService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据优惠券id，使用状态，订单编号分页获取领取记录&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;SmsCouponHistory&gt;&gt; <span class="title function_">list</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;couponId&quot;, required = false)</span> Long couponId,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;useStatus&quot;, required = false)</span> Integer useStatus,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;orderSn&quot;, required = false)</span> String orderSn,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;SmsCouponHistory&gt; historyList = historyService.list(couponId, useStatus, orderSn, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(historyList));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsCouponHistoryService"><a href="#SmsCouponHistoryService" class="headerlink" title="SmsCouponHistoryService"></a>SmsCouponHistoryService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 优惠券领取记录管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmsCouponHistoryService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询优惠券领取记录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> couponId  优惠券id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> useStatus 使用状态</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orderSn   使用订单号码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;SmsCouponHistory&gt; <span class="title function_">list</span><span class="params">(Long couponId, Integer useStatus, String orderSn, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsCouponHistoryServiceImpl"><a href="#SmsCouponHistoryServiceImpl" class="headerlink" title="SmsCouponHistoryServiceImpl"></a>SmsCouponHistoryServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 优惠券领取记录管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsCouponHistoryServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SmsCouponHistoryService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsCouponHistoryMapper historyMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SmsCouponHistory&gt; <span class="title function_">list</span><span class="params">(Long couponId, Integer useStatus, String orderSn, Integer pageSize, Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="type">SmsCouponHistoryExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsCouponHistoryExample</span>();</span><br><span class="line">        SmsCouponHistoryExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> example.createCriteria();</span><br><span class="line">        <span class="keyword">if</span>(couponId != <span class="literal">null</span>)&#123;</span><br><span class="line">            criteria.andCouponIdEqualTo(couponId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(useStatus != <span class="literal">null</span>)&#123;</span><br><span class="line">            criteria.andUseStatusEqualTo(useStatus);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!StrUtil.isEmpty(orderSn))&#123;</span><br><span class="line">            criteria.andOrderSnEqualTo(orderSn);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> historyMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="SmsFlashPromotionController相关"><a href="#SmsFlashPromotionController相关" class="headerlink" title="SmsFlashPromotionController相关"></a>SmsFlashPromotionController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 限时购活动管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;SmsFlashPromotionController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;SmsFlashPromotionController&quot;, description = &quot;限时购活动管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/flash&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsFlashPromotionController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsFlashPromotionService flashPromotionService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加活动&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> SmsFlashPromotion flashPromotion)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> flashPromotionService.create(flashPromotion);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;编辑活动&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> SmsFlashPromotion flashPromotion)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> flashPromotionService.update(id, flashPromotion);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;删除活动&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> flashPromotionService.delete(id);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改上下线状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/status/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id, Integer status)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> flashPromotionService.updateStatus(id, status);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取活动详情&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getItem</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsFlashPromotion</span> <span class="variable">flashPromotion</span> <span class="operator">=</span> flashPromotionService.getItem(id);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(flashPromotion);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据活动名称分页查询&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getItem</span><span class="params">(<span class="meta">@RequestParam(value = &quot;keyword&quot;, required = false)</span> String keyword,</span></span><br><span class="line"><span class="params">                          <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                          <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;SmsFlashPromotion&gt; flashPromotionList = flashPromotionService.list(keyword, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(flashPromotionList));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsFlashPromotionService"><a href="#SmsFlashPromotionService" class="headerlink" title="SmsFlashPromotionService"></a>SmsFlashPromotionService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 限时购活动管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmsFlashPromotionService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加活动</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(SmsFlashPromotion flashPromotion)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改指定活动</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, SmsFlashPromotion flashPromotion)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除单个活动</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改上下线状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateStatus</span><span class="params">(Long id, Integer status)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取活动详情</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SmsFlashPromotion <span class="title function_">getItem</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询活动</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;SmsFlashPromotion&gt; <span class="title function_">list</span><span class="params">(String keyword, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsFlashPromotionServiceImpl"><a href="#SmsFlashPromotionServiceImpl" class="headerlink" title="SmsFlashPromotionServiceImpl"></a>SmsFlashPromotionServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 限时购活动管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsFlashPromotionServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SmsFlashPromotionService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsFlashPromotionMapper flashPromotionMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(SmsFlashPromotion flashPromotion)</span></span><br><span class="line">    &#123;</span><br><span class="line">        flashPromotion.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="keyword">return</span> flashPromotionMapper.insert(flashPromotion);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, SmsFlashPromotion flashPromotion)</span></span><br><span class="line">    &#123;</span><br><span class="line">        flashPromotion.setId(id);</span><br><span class="line">        <span class="keyword">return</span> flashPromotionMapper.updateByPrimaryKey(flashPromotion);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> flashPromotionMapper.deleteByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateStatus</span><span class="params">(Long id, Integer status)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsFlashPromotion</span> <span class="variable">flashPromotion</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsFlashPromotion</span>();</span><br><span class="line">        flashPromotion.setId(id);</span><br><span class="line">        flashPromotion.setStatus(status);</span><br><span class="line">        <span class="keyword">return</span> flashPromotionMapper.updateByPrimaryKeySelective(flashPromotion);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SmsFlashPromotion <span class="title function_">getItem</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> flashPromotionMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SmsFlashPromotion&gt; <span class="title function_">list</span><span class="params">(String keyword, Integer pageSize, Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="type">SmsFlashPromotionExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsFlashPromotionExample</span>();</span><br><span class="line">        <span class="keyword">if</span>(!StrUtil.isEmpty(keyword))&#123;</span><br><span class="line">            example.createCriteria().andTitleLike(<span class="string">&quot;%&quot;</span> + keyword + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flashPromotionMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="SmsFlashPromotionProductRelationController相关"><a href="#SmsFlashPromotionProductRelationController相关" class="headerlink" title="SmsFlashPromotionProductRelationController相关"></a>SmsFlashPromotionProductRelationController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 限时购和商品关系管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;SmsFlashPromotionProductRelationController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;SmsFlashPromotionProductRelationController&quot;, description = &quot;限时购和商品关系管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/flashProductRelation&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsFlashPromotionProductRelationController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsFlashPromotionProductRelationService relationService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量选择商品添加关联&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;SmsFlashPromotionProductRelation&gt; relationList)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> relationService.create(relationList);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改关联信息&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> SmsFlashPromotionProductRelation relation)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> relationService.update(id, relation);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;删除关联&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> relationService.delete(id);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取管理商品促销信息&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;SmsFlashPromotionProductRelation&gt; <span class="title function_">getItem</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsFlashPromotionProductRelation</span> <span class="variable">relation</span> <span class="operator">=</span> relationService.getItem(id);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(relation);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;分页查询不同场次关联及商品信息&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;SmsFlashPromotionProduct&gt;&gt; <span class="title function_">list</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;flashPromotionId&quot;)</span> Long flashPromotionId,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;flashPromotionSessionId&quot;)</span> Long flashPromotionSessionId,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;SmsFlashPromotionProduct&gt; flashPromotionProductList =</span><br><span class="line">                relationService.list(flashPromotionId, flashPromotionSessionId, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(flashPromotionProductList));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsFlashPromotionProductRelationService"><a href="#SmsFlashPromotionProductRelationService" class="headerlink" title="SmsFlashPromotionProductRelationService"></a>SmsFlashPromotionProductRelationService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 限时购商品关联管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmsFlashPromotionProductRelationService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量添加关联</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(List&lt;SmsFlashPromotionProductRelation&gt; relationList)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改关联信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, SmsFlashPromotionProductRelation relation)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除关联</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取关联详情</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SmsFlashPromotionProductRelation <span class="title function_">getItem</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询相关商品及限时购促销信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> flashPromotionId        限时购id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> flashPromotionSessionId 限时购场次id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;SmsFlashPromotionProduct&gt; <span class="title function_">list</span><span class="params">(Long flashPromotionId, Long flashPromotionSessionId, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据活动和场次id获取商品关系数量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> flashPromotionId        限时购id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> flashPromotionSessionId 限时购场次id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">long</span> <span class="title function_">getCount</span><span class="params">(Long flashPromotionId, Long flashPromotionSessionId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsFlashPromotionProductRelationServiceImpl"><a href="#SmsFlashPromotionProductRelationServiceImpl" class="headerlink" title="SmsFlashPromotionProductRelationServiceImpl"></a>SmsFlashPromotionProductRelationServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 限时购商品关联管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsFlashPromotionProductRelationServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SmsFlashPromotionProductRelationService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsFlashPromotionProductRelationMapper relationMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsFlashPromotionProductRelationDao relationDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(List&lt;SmsFlashPromotionProductRelation&gt; relationList)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(SmsFlashPromotionProductRelation relation : relationList)&#123;</span><br><span class="line">            relationMapper.insert(relation);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> relationList.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, SmsFlashPromotionProductRelation relation)</span></span><br><span class="line">    &#123;</span><br><span class="line">        relation.setId(id);</span><br><span class="line">        <span class="keyword">return</span> relationMapper.updateByPrimaryKey(relation);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> relationMapper.deleteByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SmsFlashPromotionProductRelation <span class="title function_">getItem</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> relationMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SmsFlashPromotionProduct&gt; <span class="title function_">list</span><span class="params">(Long flashPromotionId, Long flashPromotionSessionId, Integer pageSize, Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="keyword">return</span> relationDao.getList(flashPromotionId, flashPromotionSessionId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getCount</span><span class="params">(Long flashPromotionId, Long flashPromotionSessionId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsFlashPromotionProductRelationExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsFlashPromotionProductRelationExample</span>();</span><br><span class="line">        example.createCriteria().andFlashPromotionIdEqualTo(flashPromotionId)</span><br><span class="line">               .andFlashPromotionSessionIdEqualTo(flashPromotionSessionId);</span><br><span class="line">        <span class="keyword">return</span> relationMapper.countByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="SmsFlashPromotionSessionController相关"><a href="#SmsFlashPromotionSessionController相关" class="headerlink" title="SmsFlashPromotionSessionController相关"></a>SmsFlashPromotionSessionController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 限时购场次管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;SmsFlashPromotionSessionController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;SmsFlashPromotionSessionController&quot;, description = &quot;限时购场次管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/flashSession&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsFlashPromotionSessionController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsFlashPromotionSessionService flashPromotionSessionService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加场次&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> SmsFlashPromotionSession promotionSession)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> flashPromotionSessionService.create(promotionSession);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改场次&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> SmsFlashPromotionSession promotionSession)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> flashPromotionSessionService.update(id, promotionSession);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改启用状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/status/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateStatus</span><span class="params">(<span class="meta">@PathVariable</span> Long id, Integer status)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> flashPromotionSessionService.updateStatus(id, status);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;删除场次&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> flashPromotionSessionService.delete(id);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取场次详情&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;SmsFlashPromotionSession&gt; <span class="title function_">getItem</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsFlashPromotionSession</span> <span class="variable">promotionSession</span> <span class="operator">=</span> flashPromotionSessionService.getItem(id);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(promotionSession);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取全部场次&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;SmsFlashPromotionSession&gt;&gt; <span class="title function_">list</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;SmsFlashPromotionSession&gt; promotionSessionList = flashPromotionSessionService.list();</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(promotionSessionList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取全部可选场次及其数量&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/selectList&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;SmsFlashPromotionSessionDetail&gt;&gt; <span class="title function_">selectList</span><span class="params">(Long flashPromotionId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;SmsFlashPromotionSessionDetail&gt; promotionSessionList =</span><br><span class="line">                flashPromotionSessionService.selectList(flashPromotionId);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(promotionSessionList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsFlashPromotionSessionService"><a href="#SmsFlashPromotionSessionService" class="headerlink" title="SmsFlashPromotionSessionService"></a>SmsFlashPromotionSessionService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 限时购场次管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmsFlashPromotionSessionService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加场次</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(SmsFlashPromotionSession promotionSession)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改场次</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, SmsFlashPromotionSession promotionSession)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改场次启用状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateStatus</span><span class="params">(Long id, Integer status)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除场次</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取详情</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SmsFlashPromotionSession <span class="title function_">getItem</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据启用状态获取场次列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;SmsFlashPromotionSession&gt; <span class="title function_">list</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取全部可选场次及其数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;SmsFlashPromotionSessionDetail&gt; <span class="title function_">selectList</span><span class="params">(Long flashPromotionId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsFlashPromotionSessionServiceImpl"><a href="#SmsFlashPromotionSessionServiceImpl" class="headerlink" title="SmsFlashPromotionSessionServiceImpl"></a>SmsFlashPromotionSessionServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 限时购场次管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsFlashPromotionSessionServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SmsFlashPromotionSessionService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsFlashPromotionSessionMapper promotionSessionMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsFlashPromotionProductRelationService relationService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(SmsFlashPromotionSession promotionSession)</span></span><br><span class="line">    &#123;</span><br><span class="line">        promotionSession.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="keyword">return</span> promotionSessionMapper.insert(promotionSession);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, SmsFlashPromotionSession promotionSession)</span></span><br><span class="line">    &#123;</span><br><span class="line">        promotionSession.setId(id);</span><br><span class="line">        <span class="keyword">return</span> promotionSessionMapper.updateByPrimaryKey(promotionSession);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateStatus</span><span class="params">(Long id, Integer status)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsFlashPromotionSession</span> <span class="variable">promotionSession</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsFlashPromotionSession</span>();</span><br><span class="line">        promotionSession.setId(id);</span><br><span class="line">        promotionSession.setStatus(status);</span><br><span class="line">        <span class="keyword">return</span> promotionSessionMapper.updateByPrimaryKeySelective(promotionSession);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> promotionSessionMapper.deleteByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SmsFlashPromotionSession <span class="title function_">getItem</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> promotionSessionMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SmsFlashPromotionSession&gt; <span class="title function_">list</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsFlashPromotionSessionExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsFlashPromotionSessionExample</span>();</span><br><span class="line">        <span class="keyword">return</span> promotionSessionMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(SmsFlashPromotionSessionServiceImpl.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SmsFlashPromotionSessionDetail&gt; <span class="title function_">selectList</span><span class="params">(Long flashPromotionId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsFlashPromotionSessionExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsFlashPromotionSessionExample</span>();</span><br><span class="line">        <span class="comment">// 查询出启用的场次</span></span><br><span class="line">        example.createCriteria().andStatusEqualTo(<span class="number">1</span>);</span><br><span class="line">        List&lt;SmsFlashPromotionSession&gt; list = promotionSessionMapper.selectByExample(example);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 原始写法</span></span><br><span class="line"><span class="comment">//        List&lt;SmsFlashPromotionSessionDetail&gt; result = new ArrayList&lt;&gt;();</span></span><br><span class="line"><span class="comment">//        list.forEach(promotionSession -&gt; &#123;</span></span><br><span class="line"><span class="comment">//            SmsFlashPromotionSessionDetail detail = new SmsFlashPromotionSessionDetail();</span></span><br><span class="line"><span class="comment">//            BeanUtils.copyProperties(promotionSession, detail);</span></span><br><span class="line"><span class="comment">//            // 查询商品数量</span></span><br><span class="line"><span class="comment">//            long count = relationService.getCount(flashPromotionId, promotionSession.getId());</span></span><br><span class="line"><span class="comment">//            detail.setProductCount(count);</span></span><br><span class="line"><span class="comment">//            result.add(detail);</span></span><br><span class="line"><span class="comment">//        &#125;);</span></span><br><span class="line"></span><br><span class="line">        List&lt;SmsFlashPromotionSessionDetail&gt; result =</span><br><span class="line">                list.stream()</span><br><span class="line">                    .map(smsFlashPromotionSession -&gt; &#123;</span><br><span class="line">                        <span class="type">SmsFlashPromotionSessionDetail</span> <span class="variable">detail</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsFlashPromotionSessionDetail</span>();</span><br><span class="line">                        BeanUtils.copyProperties(smsFlashPromotionSession, detail);</span><br><span class="line">                        <span class="comment">// 查询商品数量</span></span><br><span class="line">                        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> relationService.getCount(flashPromotionId, smsFlashPromotionSession.getId());</span><br><span class="line">                        detail.setProductCount(count);</span><br><span class="line">                        <span class="keyword">return</span> detail;</span><br><span class="line">                    &#125;)</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line">            <span class="comment">// TODO 打印日志，看list和list1是否一致</span></span><br><span class="line"><span class="comment">//        LOGGER.info(&quot;SmsFlashPromotionSessionServiceImpl list = &#123;&#125;&quot;, result);</span></span><br><span class="line"><span class="comment">//        LOGGER.info(&quot;SmsFlashPromotionSessionServiceImpl list1 = &#123;&#125;&quot;, result1);</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="SmsHomeAdvertiseController相关"><a href="#SmsHomeAdvertiseController相关" class="headerlink" title="SmsHomeAdvertiseController相关"></a>SmsHomeAdvertiseController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页轮播广告管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;SmsHomeAdvertiseController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;SmsHomeAdvertiseController&quot;, description = &quot;首页轮播广告管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/home/advertise&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsHomeAdvertiseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsHomeAdvertiseService advertiseService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加广告&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> SmsHomeAdvertise advertise)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> advertiseService.create(advertise);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>) <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;删除广告&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> advertiseService.delete(ids);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>) <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改上下线状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/status/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateStatus</span><span class="params">(<span class="meta">@PathVariable</span> Long id, Integer status)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> advertiseService.updateStatus(id, status);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>) <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取广告详情&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;SmsHomeAdvertise&gt; <span class="title function_">getItem</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsHomeAdvertise</span> <span class="variable">advertise</span> <span class="operator">=</span> advertiseService.getItem(id);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(advertise);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改广告&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> SmsHomeAdvertise advertise)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> advertiseService.update(id, advertise);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>) <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;分页查询广告&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;SmsHomeAdvertise&gt;&gt; <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam(value = &quot;name&quot;, required = false)</span> String name,</span></span><br><span class="line"><span class="params">                                                           <span class="meta">@RequestParam(value = &quot;type&quot;, required = false)</span> Integer type,</span></span><br><span class="line"><span class="params">                                                           <span class="meta">@RequestParam(value = &quot;endTime&quot;, required = false)</span> String endTime,</span></span><br><span class="line"><span class="params">                                                           <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                                                           <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;SmsHomeAdvertise&gt; advertiseList = advertiseService.list(name, type, endTime, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(advertiseList));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsHomeAdvertiseService"><a href="#SmsHomeAdvertiseService" class="headerlink" title="SmsHomeAdvertiseService"></a>SmsHomeAdvertiseService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页广告管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmsHomeAdvertiseService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加广告</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(SmsHomeAdvertise advertise)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除广告</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改上、下线状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateStatus</span><span class="params">(Long id, Integer status)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取广告详情</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SmsHomeAdvertise <span class="title function_">getItem</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新广告</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, SmsHomeAdvertise advertise)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询广告</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;SmsHomeAdvertise&gt; <span class="title function_">list</span><span class="params">(String name, Integer type, String endTime, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsHomeAdvertiseServiceImpl"><a href="#SmsHomeAdvertiseServiceImpl" class="headerlink" title="SmsHomeAdvertiseServiceImpl"></a>SmsHomeAdvertiseServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页广告管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsHomeAdvertiseServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SmsHomeAdvertiseService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsHomeAdvertiseMapper advertiseMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(SmsHomeAdvertise advertise)</span></span><br><span class="line">    &#123;</span><br><span class="line">        advertise.setClickCount(<span class="number">0</span>);</span><br><span class="line">        advertise.setOrderCount(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> advertiseMapper.insert(advertise);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsHomeAdvertiseExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeAdvertiseExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="keyword">return</span> advertiseMapper.deleteByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateStatus</span><span class="params">(Long id, Integer status)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsHomeAdvertise</span> <span class="variable">record</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeAdvertise</span>();</span><br><span class="line">        record.setId(id);</span><br><span class="line">        record.setStatus(status);</span><br><span class="line">        <span class="keyword">return</span> advertiseMapper.updateByPrimaryKeySelective(record);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SmsHomeAdvertise <span class="title function_">getItem</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> advertiseMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Long id, SmsHomeAdvertise advertise)</span></span><br><span class="line">    &#123;</span><br><span class="line">        advertise.setId(id);</span><br><span class="line">        <span class="keyword">return</span> advertiseMapper.updateByPrimaryKeySelective(advertise);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SmsHomeAdvertise&gt; <span class="title function_">list</span><span class="params">(String name, Integer type, String endTime, Integer pageSize, Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="type">SmsHomeAdvertiseExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeAdvertiseExample</span>();</span><br><span class="line">        SmsHomeAdvertiseExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> example.createCriteria();</span><br><span class="line">        <span class="keyword">if</span>(!StrUtil.isEmpty(name))&#123;</span><br><span class="line">            criteria.andNameLike(<span class="string">&quot;%&quot;</span> + name + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(type != <span class="literal">null</span>)&#123;</span><br><span class="line">            criteria.andTypeEqualTo(type);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!StrUtil.isEmpty(endTime))&#123;</span><br><span class="line">            <span class="comment">// TODO 这里可以优化吗？</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">startStr</span> <span class="operator">=</span> endTime + <span class="string">&quot; 00:00:00&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">endStr</span> <span class="operator">=</span> endTime + <span class="string">&quot; 23:59:59&quot;</span>;</span><br><span class="line">            <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">            <span class="type">Date</span> <span class="variable">start</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                start = sdf.parse(startStr);</span><br><span class="line">            &#125; <span class="keyword">catch</span>(ParseException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Date</span> <span class="variable">end</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                end = sdf.parse(endStr);</span><br><span class="line">            &#125; <span class="keyword">catch</span>(ParseException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(start != <span class="literal">null</span> &amp;&amp; end != <span class="literal">null</span>)&#123;</span><br><span class="line">                criteria.andEndTimeBetween(start, end);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        example.setOrderByClause(<span class="string">&quot;sort desc&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> advertiseMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="SmsHomeBrandController相关"><a href="#SmsHomeBrandController相关" class="headerlink" title="SmsHomeBrandController相关"></a>SmsHomeBrandController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页品牌管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;SmsHomeBrandController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;SmsHomeBrandController&quot;, description = &quot;首页品牌管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/home/brand&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsHomeBrandController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsHomeBrandService homeBrandService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加首页推荐品牌&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;SmsHomeBrand&gt; homeBrandList)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> homeBrandService.create(homeBrandList);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改推荐品牌排序&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/sort/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateSort</span><span class="params">(<span class="meta">@PathVariable</span> Long id, Integer sort)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> homeBrandService.updateSort(id, sort);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量删除推荐品牌&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> homeBrandService.delete(ids);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量修改推荐品牌状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/recommendStatus&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateRecommendStatus</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids,</span></span><br><span class="line"><span class="params">                                              <span class="meta">@RequestParam</span> Integer recommendStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> homeBrandService.updateRecommendStatus(ids, recommendStatus);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;分页查询推荐品牌&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;SmsHomeBrand&gt;&gt; <span class="title function_">list</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;brandName&quot;, required = false)</span> String brandName,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;recommendStatus&quot;, required = false)</span> Integer recommendStatus,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;SmsHomeBrand&gt; homeBrandList = homeBrandService.list(brandName, recommendStatus, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(homeBrandList));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsHomeBrandService"><a href="#SmsHomeBrandService" class="headerlink" title="SmsHomeBrandService"></a>SmsHomeBrandService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页品牌管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmsHomeBrandService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加首页品牌推荐</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(List&lt;SmsHomeBrand&gt; homeBrandList)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改品牌推荐排序</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateSort</span><span class="params">(Long id, Integer sort)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除品牌推荐</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量更新推荐状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateRecommendStatus</span><span class="params">(List&lt;Long&gt; ids, Integer recommendStatus)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询品牌推荐</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;SmsHomeBrand&gt; <span class="title function_">list</span><span class="params">(String brandName, Integer recommendStatus, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsHomeBrandServiceImpl"><a href="#SmsHomeBrandServiceImpl" class="headerlink" title="SmsHomeBrandServiceImpl"></a>SmsHomeBrandServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页品牌管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsHomeBrandServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SmsHomeBrandService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsHomeBrandMapper homeBrandMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(List&lt;SmsHomeBrand&gt; homeBrandList)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(SmsHomeBrand smsHomeBrand : homeBrandList)&#123;</span><br><span class="line">            smsHomeBrand.setRecommendStatus(<span class="number">1</span>);</span><br><span class="line">            smsHomeBrand.setSort(<span class="number">0</span>);</span><br><span class="line">            homeBrandMapper.insert(smsHomeBrand);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> homeBrandList.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateSort</span><span class="params">(Long id, Integer sort)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsHomeBrand</span> <span class="variable">homeBrand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeBrand</span>();</span><br><span class="line">        homeBrand.setId(id);</span><br><span class="line">        homeBrand.setSort(sort);</span><br><span class="line">        <span class="keyword">return</span> homeBrandMapper.updateByPrimaryKeySelective(homeBrand);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsHomeBrandExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeBrandExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="keyword">return</span> homeBrandMapper.deleteByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateRecommendStatus</span><span class="params">(List&lt;Long&gt; ids, Integer recommendStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsHomeBrandExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeBrandExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="type">SmsHomeBrand</span> <span class="variable">record</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeBrand</span>();</span><br><span class="line">        record.setRecommendStatus(recommendStatus);</span><br><span class="line">        <span class="keyword">return</span> homeBrandMapper.updateByExampleSelective(record, example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SmsHomeBrand&gt; <span class="title function_">list</span><span class="params">(String brandName, Integer recommendStatus, Integer pageSize, Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="type">SmsHomeBrandExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeBrandExample</span>();</span><br><span class="line">        SmsHomeBrandExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> example.createCriteria();</span><br><span class="line">        <span class="keyword">if</span>(!StrUtil.isEmpty(brandName))&#123;</span><br><span class="line">            criteria.andBrandNameLike(<span class="string">&quot;%&quot;</span> + brandName + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(recommendStatus != <span class="literal">null</span>)&#123;</span><br><span class="line">            criteria.andRecommendStatusEqualTo(recommendStatus);</span><br><span class="line">        &#125;</span><br><span class="line">        example.setOrderByClause(<span class="string">&quot;sort desc&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> homeBrandMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="SmsHomeNewProductController相关"><a href="#SmsHomeNewProductController相关" class="headerlink" title="SmsHomeNewProductController相关"></a>SmsHomeNewProductController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页新品管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;SmsHomeNewProductController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;SmsHomeNewProductController&quot;, description = &quot;首页新品管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/home/newProduct&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsHomeNewProductController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsHomeNewProductService homeNewProductService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加首页新品&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;SmsHomeNewProduct&gt; homeNewProductList)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> homeNewProductService.create(homeNewProductList);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改首页新品排序&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/sort/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateSort</span><span class="params">(<span class="meta">@PathVariable</span> Long id, Integer sort)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> homeNewProductService.updateSort(id, sort);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量删除首页新品&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> homeNewProductService.delete(ids);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量修改首页新品状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/recommendStatus&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateRecommendStatus</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids,</span></span><br><span class="line"><span class="params">                                              <span class="meta">@RequestParam</span> Integer recommendStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> homeNewProductService.updateRecommendStatus(ids, recommendStatus);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;分页查询首页新品&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;SmsHomeNewProduct&gt;&gt; <span class="title function_">list</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;productName&quot;, required = false)</span> String productName,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;recommendStatus&quot;, required = false)</span> Integer recommendStatus,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;SmsHomeNewProduct&gt; homeNewProductList =</span><br><span class="line">                homeNewProductService.list(productName, recommendStatus, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(homeNewProductList));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsHomeNewProductService"><a href="#SmsHomeNewProductService" class="headerlink" title="SmsHomeNewProductService"></a>SmsHomeNewProductService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页新品推荐管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmsHomeNewProductService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加首页推荐</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(List&lt;SmsHomeNewProduct&gt; homeNewProductList)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改推荐排序</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateSort</span><span class="params">(Long id, Integer sort)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除推荐</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量更新推荐状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateRecommendStatus</span><span class="params">(List&lt;Long&gt; ids, Integer recommendStatus)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询推荐</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;SmsHomeNewProduct&gt; <span class="title function_">list</span><span class="params">(String productName, Integer recommendStatus, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsHomeNewProductServiceImpl"><a href="#SmsHomeNewProductServiceImpl" class="headerlink" title="SmsHomeNewProductServiceImpl"></a>SmsHomeNewProductServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页新品推荐管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsHomeNewProductServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SmsHomeNewProductService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsHomeNewProductMapper homeNewProductMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(List&lt;SmsHomeNewProduct&gt; homeNewProductList)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(SmsHomeNewProduct SmsHomeNewProduct : homeNewProductList)&#123;</span><br><span class="line">            SmsHomeNewProduct.setRecommendStatus(<span class="number">1</span>);</span><br><span class="line">            SmsHomeNewProduct.setSort(<span class="number">0</span>);</span><br><span class="line">            homeNewProductMapper.insert(SmsHomeNewProduct);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> homeNewProductList.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateSort</span><span class="params">(Long id, Integer sort)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsHomeNewProduct</span> <span class="variable">homeNewProduct</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeNewProduct</span>();</span><br><span class="line">        homeNewProduct.setId(id);</span><br><span class="line">        homeNewProduct.setSort(sort);</span><br><span class="line">        <span class="keyword">return</span> homeNewProductMapper.updateByPrimaryKeySelective(homeNewProduct);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsHomeNewProductExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeNewProductExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="keyword">return</span> homeNewProductMapper.deleteByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateRecommendStatus</span><span class="params">(List&lt;Long&gt; ids, Integer recommendStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsHomeNewProductExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeNewProductExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="type">SmsHomeNewProduct</span> <span class="variable">record</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeNewProduct</span>();</span><br><span class="line">        record.setRecommendStatus(recommendStatus);</span><br><span class="line">        <span class="keyword">return</span> homeNewProductMapper.updateByExampleSelective(record, example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SmsHomeNewProduct&gt; <span class="title function_">list</span><span class="params">(String productName, Integer recommendStatus, Integer pageSize, Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="type">SmsHomeNewProductExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeNewProductExample</span>();</span><br><span class="line">        SmsHomeNewProductExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> example.createCriteria();</span><br><span class="line">        <span class="keyword">if</span>(!StrUtil.isEmpty(productName))&#123;</span><br><span class="line">            criteria.andProductNameLike(<span class="string">&quot;%&quot;</span> + productName + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(recommendStatus != <span class="literal">null</span>)&#123;</span><br><span class="line">            criteria.andRecommendStatusEqualTo(recommendStatus);</span><br><span class="line">        &#125;</span><br><span class="line">        example.setOrderByClause(<span class="string">&quot;sort desc&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> homeNewProductMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="SmsHomeRecommendProductController相关"><a href="#SmsHomeRecommendProductController相关" class="headerlink" title="SmsHomeRecommendProductController相关"></a>SmsHomeRecommendProductController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页人气推荐管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;SmsHomeRecommendProductController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;SmsHomeRecommendProductController&quot;, description = &quot;首页人气推荐管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/home/recommendProduct&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsHomeRecommendProductController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsHomeRecommendProductService recommendProductService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加首页推荐&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;SmsHomeRecommendProduct&gt; homeRecommendProductList)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> recommendProductService.create(homeRecommendProductList);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改推荐排序&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/sort/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateSort</span><span class="params">(<span class="meta">@PathVariable</span> Long id, Integer sort)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> recommendProductService.updateSort(id, sort);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量删除推荐&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> recommendProductService.delete(ids);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量修改推荐状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/recommendStatus&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateRecommendStatus</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids,</span></span><br><span class="line"><span class="params">                                              <span class="meta">@RequestParam</span> Integer recommendStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> recommendProductService.updateRecommendStatus(ids, recommendStatus);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;分页查询推荐&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;SmsHomeRecommendProduct&gt;&gt; <span class="title function_">list</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;productName&quot;, required = false)</span> String productName,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;recommendStatus&quot;, required = false)</span> Integer recommendStatus,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;SmsHomeRecommendProduct&gt; homeRecommendProductList =</span><br><span class="line">                recommendProductService.list(productName, recommendStatus, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(homeRecommendProductList));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsHomeRecommendProductService"><a href="#SmsHomeRecommendProductService" class="headerlink" title="SmsHomeRecommendProductService"></a>SmsHomeRecommendProductService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页人气推荐管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmsHomeRecommendProductService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加首页推荐</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(List&lt;SmsHomeRecommendProduct&gt; homeRecommendProductList)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改推荐排序</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateSort</span><span class="params">(Long id, Integer sort)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除推荐</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量更新推荐状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateRecommendStatus</span><span class="params">(List&lt;Long&gt; ids, Integer recommendStatus)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询推荐</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;SmsHomeRecommendProduct&gt; <span class="title function_">list</span><span class="params">(String productName, Integer recommendStatus, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsHomeRecommendProductServiceImpl"><a href="#SmsHomeRecommendProductServiceImpl" class="headerlink" title="SmsHomeRecommendProductServiceImpl"></a>SmsHomeRecommendProductServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页人气推荐管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsHomeRecommendProductServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SmsHomeRecommendProductService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsHomeRecommendProductMapper recommendProductMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(List&lt;SmsHomeRecommendProduct&gt; homeRecommendProductList)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(SmsHomeRecommendProduct recommendProduct : homeRecommendProductList)&#123;</span><br><span class="line">            recommendProduct.setRecommendStatus(<span class="number">1</span>);</span><br><span class="line">            recommendProduct.setSort(<span class="number">0</span>);</span><br><span class="line">            recommendProductMapper.insert(recommendProduct);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> homeRecommendProductList.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateSort</span><span class="params">(Long id, Integer sort)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsHomeRecommendProduct</span> <span class="variable">recommendProduct</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeRecommendProduct</span>();</span><br><span class="line">        recommendProduct.setId(id);</span><br><span class="line">        recommendProduct.setSort(sort);</span><br><span class="line">        <span class="keyword">return</span> recommendProductMapper.updateByPrimaryKeySelective(recommendProduct);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsHomeRecommendProductExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeRecommendProductExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="keyword">return</span> recommendProductMapper.deleteByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateRecommendStatus</span><span class="params">(List&lt;Long&gt; ids, Integer recommendStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsHomeRecommendProductExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeRecommendProductExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="type">SmsHomeRecommendProduct</span> <span class="variable">record</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeRecommendProduct</span>();</span><br><span class="line">        record.setRecommendStatus(recommendStatus);</span><br><span class="line">        <span class="keyword">return</span> recommendProductMapper.updateByExampleSelective(record, example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SmsHomeRecommendProduct&gt; <span class="title function_">list</span><span class="params">(String productName, Integer recommendStatus, Integer pageSize,</span></span><br><span class="line"><span class="params">                                              Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="type">SmsHomeRecommendProductExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeRecommendProductExample</span>();</span><br><span class="line">        SmsHomeRecommendProductExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> example.createCriteria();</span><br><span class="line">        <span class="keyword">if</span>(!StrUtil.isEmpty(productName))&#123;</span><br><span class="line">            criteria.andProductNameLike(<span class="string">&quot;%&quot;</span> + productName + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(recommendStatus != <span class="literal">null</span>)&#123;</span><br><span class="line">            criteria.andRecommendStatusEqualTo(recommendStatus);</span><br><span class="line">        &#125;</span><br><span class="line">        example.setOrderByClause(<span class="string">&quot;sort desc&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> recommendProductMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="SmsHomeRecommendSubjectController相关"><a href="#SmsHomeRecommendSubjectController相关" class="headerlink" title="SmsHomeRecommendSubjectController相关"></a>SmsHomeRecommendSubjectController相关</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页专题推荐管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;SmsHomeRecommendSubjectController&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;SmsHomeRecommendSubjectController&quot;, description = &quot;首页专题推荐管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/home/recommendSubject&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsHomeRecommendSubjectController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsHomeRecommendSubjectService recommendSubjectService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加首页推荐专题&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/create&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;SmsHomeRecommendSubject&gt; homeRecommendSubjectList)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> recommendSubjectService.create(homeRecommendSubjectList);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改推荐排序&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/sort/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateSort</span><span class="params">(<span class="meta">@PathVariable</span> Long id, Integer sort)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> recommendSubjectService.updateSort(id, sort);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量删除推荐&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/delete&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> recommendSubjectService.delete(ids);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;批量修改推荐状态&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update/recommendStatus&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">updateRecommendStatus</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids,</span></span><br><span class="line"><span class="params">                                              <span class="meta">@RequestParam</span> Integer recommendStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> recommendSubjectService.updateRecommendStatus(ids, recommendStatus);</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> CommonResult.success(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.failed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;分页查询推荐&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/list&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;CommonPage&lt;SmsHomeRecommendSubject&gt;&gt; <span class="title function_">list</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;subjectName&quot;, required = false)</span> String subjectName,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;recommendStatus&quot;, required = false)</span> Integer recommendStatus,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;5&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;SmsHomeRecommendSubject&gt; homeRecommendSubjectList =</span><br><span class="line">                recommendSubjectService.list(subjectName, recommendStatus, pageSize, pageNum);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(CommonPage.restPage(homeRecommendSubjectList));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsHomeRecommendSubjectService"><a href="#SmsHomeRecommendSubjectService" class="headerlink" title="SmsHomeRecommendSubjectService"></a>SmsHomeRecommendSubjectService</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页专题推荐管理Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmsHomeRecommendSubjectService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加首页推荐</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">create</span><span class="params">(List&lt;SmsHomeRecommendSubject&gt; recommendSubjectList)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改推荐排序</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateSort</span><span class="params">(Long id, Integer sort)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除推荐</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量更新推荐状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateRecommendStatus</span><span class="params">(List&lt;Long&gt; ids, Integer recommendStatus)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询推荐</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;SmsHomeRecommendSubject&gt; <span class="title function_">list</span><span class="params">(String subjectName, Integer recommendStatus, Integer pageSize, Integer pageNum)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SmsHomeRecommendSubjectServiceImpl"><a href="#SmsHomeRecommendSubjectServiceImpl" class="headerlink" title="SmsHomeRecommendSubjectServiceImpl"></a>SmsHomeRecommendSubjectServiceImpl</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页专题推荐管理Service实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsHomeRecommendSubjectServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SmsHomeRecommendSubjectService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsHomeRecommendSubjectMapper recommendProductMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(List&lt;SmsHomeRecommendSubject&gt; recommendSubjectList)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(SmsHomeRecommendSubject recommendProduct : recommendSubjectList)&#123;</span><br><span class="line">            recommendProduct.setRecommendStatus(<span class="number">1</span>);</span><br><span class="line">            recommendProduct.setSort(<span class="number">0</span>);</span><br><span class="line">            recommendProductMapper.insert(recommendProduct);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> recommendSubjectList.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateSort</span><span class="params">(Long id, Integer sort)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsHomeRecommendSubject</span> <span class="variable">recommendProduct</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeRecommendSubject</span>();</span><br><span class="line">        recommendProduct.setId(id);</span><br><span class="line">        recommendProduct.setSort(sort);</span><br><span class="line">        <span class="keyword">return</span> recommendProductMapper.updateByPrimaryKeySelective(recommendProduct);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(List&lt;Long&gt; ids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsHomeRecommendSubjectExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeRecommendSubjectExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="keyword">return</span> recommendProductMapper.deleteByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateRecommendStatus</span><span class="params">(List&lt;Long&gt; ids, Integer recommendStatus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SmsHomeRecommendSubjectExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeRecommendSubjectExample</span>();</span><br><span class="line">        example.createCriteria().andIdIn(ids);</span><br><span class="line">        <span class="type">SmsHomeRecommendSubject</span> <span class="variable">record</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeRecommendSubject</span>();</span><br><span class="line">        record.setRecommendStatus(recommendStatus);</span><br><span class="line">        <span class="keyword">return</span> recommendProductMapper.updateByExampleSelective(record, example);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SmsHomeRecommendSubject&gt; <span class="title function_">list</span><span class="params">(String subjectName, Integer recommendStatus, Integer pageSize,</span></span><br><span class="line"><span class="params">                                              Integer pageNum)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">        <span class="type">SmsHomeRecommendSubjectExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsHomeRecommendSubjectExample</span>();</span><br><span class="line">        SmsHomeRecommendSubjectExample.<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> example.createCriteria();</span><br><span class="line">        <span class="keyword">if</span>(!StrUtil.isEmpty(subjectName))&#123;</span><br><span class="line">            criteria.andSubjectNameLike(<span class="string">&quot;%&quot;</span> + subjectName + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(recommendStatus != <span class="literal">null</span>)&#123;</span><br><span class="line">            criteria.andRecommendStatusEqualTo(recommendStatus);</span><br><span class="line">        &#125;</span><br><span class="line">        example.setOrderByClause(<span class="string">&quot;sort desc&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> recommendProductMapper.selectByExample(example);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









<h2 id="mall-portal模块"><a href="#mall-portal模块" class="headerlink" title="mall-portal模块"></a>mall-portal模块</h2><h3 id="pom-xml-5"><a href="#pom-xml-5" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mall中MBG生成模块--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.macro.mall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mall-mbg<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mall安全模块--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.macro.mall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mall-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mongodb依赖配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--redis依赖配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--集成消息队列--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="包结构-5"><a href="#包结构-5" class="headerlink" title="包结构"></a>包结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mall-portal</span><br><span class="line">├─java</span><br><span class="line">│  └─com</span><br><span class="line">│      └─macro</span><br><span class="line">│          └─mall</span><br><span class="line">│              └─portal</span><br><span class="line">│                  ├─component</span><br><span class="line">│                  ├─config</span><br><span class="line">│                  ├─controller</span><br><span class="line">│                  ├─dao</span><br><span class="line">│                  ├─domain</span><br><span class="line">│                  ├─repository</span><br><span class="line">│                  ├─service</span><br><span class="line">│                  │  └─impl</span><br><span class="line">│                  └─util</span><br><span class="line">└─resources</span><br><span class="line">    └─dao</span><br></pre></td></tr></table></figure>

<p><strong>mall-portal模块的包都统一放在com.macro.mall.portal包下</strong></p>
<ul>
<li><strong>component包中存放的是订单消息相关的RabbitMQ操作类</strong></li>
<li><strong>config包中存放的是一些配置类</strong></li>
<li><strong>controller包中存放的是前台商城相关接口类</strong></li>
<li><strong>dao包中存放的是前台商城相关DAO</strong></li>
<li><strong>domain包中存放的是前台商城相关信息实体类</strong></li>
<li><strong>repository包中存放的是MongoDB相关操作接口</strong></li>
<li><strong>service包中存放的是前台商城相关业务类</strong></li>
<li><strong>util包中存放的是一些工具类</strong></li>
</ul>

  </div>
</article>




          
          <!-- //actions_mobile 移动端导航栏 -->
            <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" class="Popup" style="display: none">
      <ul>
         
          <li><a href="/blog/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/">关于</a></li>
        
      </ul>
    </div>

    <div id="toc-footer"  class="Popup" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Mall%E5%95%86%E5%9F%8E"><span class="toc-number">1.</span> <span class="toc-text">Mall商城</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Mall%E9%A1%B9%E7%9B%AE%E4%B8%BB%E8%A6%81%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.</span> <span class="toc-text">Mall项目主要结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mall-mbg"><span class="toc-number">1.1.1.</span> <span class="toc-text">mall-mbg</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mall-common"><span class="toc-number">1.1.2.</span> <span class="toc-text">mall-common</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mall%E9%A1%B9%E7%9B%AE%E4%B8%BB%E8%A6%81%E7%BB%93%E6%9E%84-1"><span class="toc-number">1.2.</span> <span class="toc-text">Mall项目主要结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mall-admin"><span class="toc-number">1.2.1.</span> <span class="toc-text">mall-admin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mall-portal"><span class="toc-number">1.2.2.</span> <span class="toc-text">mall-portal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mall-common-1"><span class="toc-number">1.2.3.</span> <span class="toc-text">mall-common</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mall-mbg-1"><span class="toc-number">1.2.4.</span> <span class="toc-text">mall-mbg</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mall-search"><span class="toc-number">1.2.5.</span> <span class="toc-text">mall-search</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mall-security"><span class="toc-number">1.2.6.</span> <span class="toc-text">mall-security</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mall-common%E6%A8%A1%E5%9D%97"><span class="toc-number">1.3.</span> <span class="toc-text">mall-common模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pom-xml"><span class="toc-number">1.3.1.</span> <span class="toc-text">pom.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%85%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.2.</span> <span class="toc-text">包结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">1.3.3.</span> <span class="toc-text">主要代码分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E7%B1%BB"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">全局异常处理类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86%E5%88%87%E9%9D%A2"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">统一日志处理切面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mall-mbg%E6%A8%A1%E5%9D%97"><span class="toc-number">1.4.</span> <span class="toc-text">mall-mbg模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pom-xml-1"><span class="toc-number">1.4.1.</span> <span class="toc-text">pom.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%85%E7%BB%93%E6%9E%84-1"><span class="toc-number">1.4.2.</span> <span class="toc-text">包结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mall-search%E6%A8%A1%E5%9D%97"><span class="toc-number">1.5.</span> <span class="toc-text">mall-search模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pom-xml-2"><span class="toc-number">1.5.1.</span> <span class="toc-text">pom.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%85%E7%BB%93%E6%9E%84-2"><span class="toc-number">1.5.2.</span> <span class="toc-text">包结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-1"><span class="toc-number">1.5.3.</span> <span class="toc-text">主要代码分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%95%86%E5%93%81%E7%9A%84%E4%BF%A1%E6%81%AF%E7%B1%BB"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">搜索商品的信息类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86%E4%B8%9A%E5%8A%A1%E7%B1%BB"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">搜索商品管理业务类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mall-security%E6%A8%A1%E5%9D%97"><span class="toc-number">1.6.</span> <span class="toc-text">mall-security模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pom-xml-3"><span class="toc-number">1.6.1.</span> <span class="toc-text">pom.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%85%E7%BB%93%E6%9E%84-3"><span class="toc-number">1.6.2.</span> <span class="toc-text">包结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-2"><span class="toc-number">1.6.3.</span> <span class="toc-text">主要代码分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BC%93%E5%AD%98%E5%BC%82%E5%B8%B8%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">自定义缓存异常注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E7%BC%93%E5%AD%98%E5%88%87%E9%9D%A2"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">Redis缓存切面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mall-admin%E6%A8%A1%E5%9D%97"><span class="toc-number">1.7.</span> <span class="toc-text">mall-admin模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E5%89%8D%E7%BC%80%E8%AF%B4%E6%98%8E"><span class="toc-number">1.7.1.</span> <span class="toc-text">数据库表前缀说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pom-xml-4"><span class="toc-number">1.7.2.</span> <span class="toc-text">pom.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%85%E7%BB%93%E6%9E%84-4"><span class="toc-number">1.7.3.</span> <span class="toc-text">包结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-3"><span class="toc-number">1.7.4.</span> <span class="toc-text">主要代码分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97%E7%9B%B8%E5%85%B3%E8%A1%A8%E5%88%86%E6%9E%90%EF%BC%8Cums-admin"><span class="toc-number">1.7.4.1.</span> <span class="toc-text">后台用户模块相关表分析，ums_admin*</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ums-admin%E7%9B%B8%E5%85%B3%E8%A1%A8%E5%88%86%E6%9E%90"><span class="toc-number">1.7.4.1.1.</span> <span class="toc-text">ums_admin相关表分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E7%94%A8%E6%88%B7%E7%9B%B8%E5%85%B3%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.7.4.2.</span> <span class="toc-text">后台用户相关接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#UmsAdminController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.2.1.</span> <span class="toc-text">UmsAdminController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#UmsAdminService"><span class="toc-number">1.7.4.2.1.1.</span> <span class="toc-text">UmsAdminService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#UmsAdminServiceImpl"><span class="toc-number">1.7.4.2.1.2.</span> <span class="toc-text">UmsAdminServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UmsRoleController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.2.2.</span> <span class="toc-text">UmsRoleController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#UmsRoleService"><span class="toc-number">1.7.4.2.2.1.</span> <span class="toc-text">UmsRoleService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#UmsRoleServiceImpl"><span class="toc-number">1.7.4.2.2.2.</span> <span class="toc-text">UmsRoleServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UmsResourceController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.2.3.</span> <span class="toc-text">UmsResourceController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#UmsResourceService"><span class="toc-number">1.7.4.2.3.1.</span> <span class="toc-text">UmsResourceService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#UmsResourceServiceImpl"><span class="toc-number">1.7.4.2.3.2.</span> <span class="toc-text">UmsResourceServiceImpl</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#DynamicSecurityMetadataSource"><span class="toc-number">1.7.4.2.3.3.</span> <span class="toc-text">DynamicSecurityMetadataSource</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UmsResourceCategoryController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.2.4.</span> <span class="toc-text">UmsResourceCategoryController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#UmsResourceCategoryService"><span class="toc-number">1.7.4.2.4.1.</span> <span class="toc-text">UmsResourceCategoryService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#UmsResourceCategoryServiceImpl"><span class="toc-number">1.7.4.2.4.2.</span> <span class="toc-text">UmsResourceCategoryServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UmsMenuController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.2.5.</span> <span class="toc-text">UmsMenuController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#UmsMenuService"><span class="toc-number">1.7.4.2.5.1.</span> <span class="toc-text">UmsMenuService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#UmsMenuServiceImpl"><span class="toc-number">1.7.4.2.5.2.</span> <span class="toc-text">UmsMenuServiceImpl</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%9A%E5%91%98%E6%A8%A1%E5%9D%97%E7%9B%B8%E5%85%B3%E8%A1%A8%E5%88%86%E6%9E%90%EF%BC%8Cums-member"><span class="toc-number">1.7.4.3.</span> <span class="toc-text">会员模块相关表分析，ums_member*</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ums-member%E7%9B%B8%E5%85%B3%E8%A1%A8%E5%88%86%E6%9E%90"><span class="toc-number">1.7.4.3.1.</span> <span class="toc-text">ums_member相关表分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%9A%E5%91%98%E7%9B%B8%E5%85%B3%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1%EF%BC%88%E8%AE%BE%E8%AE%A1%E4%B8%8D%E5%AE%8C%E6%95%B4%EF%BC%89"><span class="toc-number">1.7.4.4.</span> <span class="toc-text">会员相关接口设计（设计不完整）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#UmsMemberLevelController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.4.1.</span> <span class="toc-text">UmsMemberLevelController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#UmsMemberLevelService"><span class="toc-number">1.7.4.4.1.1.</span> <span class="toc-text">UmsMemberLevelService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#UmsMemberLevelServiceImpl"><span class="toc-number">1.7.4.4.1.2.</span> <span class="toc-text">UmsMemberLevelServiceImpl</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%95%86%E5%93%81%E6%A8%A1%E5%9D%97%E7%9B%B8%E5%85%B3%E8%A1%A8%E5%88%86%E6%9E%90%EF%BC%8Cpms"><span class="toc-number">1.7.4.5.</span> <span class="toc-text">商品模块相关表分析，pms_*</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#pms-%E7%9B%B8%E5%85%B3%E8%A1%A8%E5%88%86%E6%9E%90"><span class="toc-number">1.7.4.5.1.</span> <span class="toc-text">pms_*相关表分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%95%86%E5%93%81%E7%9B%B8%E5%85%B3%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.7.4.6.</span> <span class="toc-text">商品相关接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#PmsProductController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.6.1.</span> <span class="toc-text">PmsProductController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#PmsProductService"><span class="toc-number">1.7.4.6.1.1.</span> <span class="toc-text">PmsProductService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#PmsProductServiceImpl"><span class="toc-number">1.7.4.6.1.2.</span> <span class="toc-text">PmsProductServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PmsBrandController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.6.2.</span> <span class="toc-text">PmsBrandController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#PmsBrandService"><span class="toc-number">1.7.4.6.2.1.</span> <span class="toc-text">PmsBrandService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#PmsBrandServiceImpl"><span class="toc-number">1.7.4.6.2.2.</span> <span class="toc-text">PmsBrandServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PmsSkuStockController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.6.3.</span> <span class="toc-text">PmsSkuStockController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#PmsSkuStockService"><span class="toc-number">1.7.4.6.3.1.</span> <span class="toc-text">PmsSkuStockService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#PmsSkuStockServiceImpl"><span class="toc-number">1.7.4.6.3.2.</span> <span class="toc-text">PmsSkuStockServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PmsProductCategoryController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.6.4.</span> <span class="toc-text">PmsProductCategoryController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#PmsProductCategoryService"><span class="toc-number">1.7.4.6.4.1.</span> <span class="toc-text">PmsProductCategoryService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#PmsProductCategoryServiceImpl"><span class="toc-number">1.7.4.6.4.2.</span> <span class="toc-text">PmsProductCategoryServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PmsProductAttributeController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.6.5.</span> <span class="toc-text">PmsProductAttributeController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#PmsProductAttributeService"><span class="toc-number">1.7.4.6.5.1.</span> <span class="toc-text">PmsProductAttributeService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#PmsProductAttributeServiceImpl"><span class="toc-number">1.7.4.6.5.2.</span> <span class="toc-text">PmsProductAttributeServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PmsProductAttributeCategoryController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.6.6.</span> <span class="toc-text">PmsProductAttributeCategoryController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#PmsProductAttributeCategoryService"><span class="toc-number">1.7.4.6.6.1.</span> <span class="toc-text">PmsProductAttributeCategoryService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#PmsProductAttributeCategoryServiceImpl"><span class="toc-number">1.7.4.6.6.2.</span> <span class="toc-text">PmsProductAttributeCategoryServiceImpl</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97%E7%9B%B8%E5%85%B3%E8%A1%A8%E5%88%86%E6%9E%90%EF%BC%8Ccms"><span class="toc-number">1.7.4.7.</span> <span class="toc-text">内容管理模块相关表分析，cms_*</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#cms-%E7%9B%B8%E5%85%B3%E8%A1%A8%E5%88%86%E6%9E%90"><span class="toc-number">1.7.4.7.1.</span> <span class="toc-text">cms_*相关表分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E7%AE%A1%E7%90%86%E7%9B%B8%E5%85%B3%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1%EF%BC%88%E8%AE%BE%E8%AE%A1%E4%B8%8D%E5%AE%8C%E6%95%B4%EF%BC%89"><span class="toc-number">1.7.4.8.</span> <span class="toc-text">内容管理相关接口设计（设计不完整）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#CmsSubjectController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.8.1.</span> <span class="toc-text">CmsSubjectController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#CmsSubjectService"><span class="toc-number">1.7.4.8.1.1.</span> <span class="toc-text">CmsSubjectService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#CmsSubjectServiceImpl"><span class="toc-number">1.7.4.8.1.2.</span> <span class="toc-text">CmsSubjectServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CmsPrefrenceAreaController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.8.2.</span> <span class="toc-text">CmsPrefrenceAreaController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#CmsPrefrenceAreaService"><span class="toc-number">1.7.4.8.2.1.</span> <span class="toc-text">CmsPrefrenceAreaService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#CmsPrefrenceAreaServiceImpl"><span class="toc-number">1.7.4.8.2.2.</span> <span class="toc-text">CmsPrefrenceAreaServiceImpl</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97%E7%9B%B8%E5%85%B3%E8%A1%A8%E5%88%86%E6%9E%90%EF%BC%8Coms"><span class="toc-number">1.7.4.9.</span> <span class="toc-text">订单管理模块相关表分析，oms_*</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#oms-%E7%9B%B8%E5%85%B3%E8%A1%A8%E5%88%86%E6%9E%90"><span class="toc-number">1.7.4.9.1.</span> <span class="toc-text">oms_*相关表分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E7%AE%A1%E7%90%86%E7%9B%B8%E5%85%B3%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.7.4.10.</span> <span class="toc-text">订单管理相关接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#OmsOrderController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.10.1.</span> <span class="toc-text">OmsOrderController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#OmsOrderService"><span class="toc-number">1.7.4.10.1.1.</span> <span class="toc-text">OmsOrderService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#OmsOrderServiceImpl"><span class="toc-number">1.7.4.10.1.2.</span> <span class="toc-text">OmsOrderServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OmsCompanyAddressController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.10.2.</span> <span class="toc-text">OmsCompanyAddressController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#OmsCompanyAddressService"><span class="toc-number">1.7.4.10.2.1.</span> <span class="toc-text">OmsCompanyAddressService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#OmsCompanyAddressServiceImpl"><span class="toc-number">1.7.4.10.2.2.</span> <span class="toc-text">OmsCompanyAddressServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OmsOrderSettingController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.10.3.</span> <span class="toc-text">OmsOrderSettingController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#OmsOrderSettingService"><span class="toc-number">1.7.4.10.3.1.</span> <span class="toc-text">OmsOrderSettingService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#OmsOrderSettingServiceImpl"><span class="toc-number">1.7.4.10.3.2.</span> <span class="toc-text">OmsOrderSettingServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OmsOrderReturnApplyController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.10.4.</span> <span class="toc-text">OmsOrderReturnApplyController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#OmsOrderReturnApplyService"><span class="toc-number">1.7.4.10.4.1.</span> <span class="toc-text">OmsOrderReturnApplyService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#OmsOrderReturnApplyServiceImpl"><span class="toc-number">1.7.4.10.4.2.</span> <span class="toc-text">OmsOrderReturnApplyServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OmsOrderReturnReasonController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.10.5.</span> <span class="toc-text">OmsOrderReturnReasonController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#OmsOrderReturnReasonService"><span class="toc-number">1.7.4.10.5.1.</span> <span class="toc-text">OmsOrderReturnReasonService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#OmsOrderReturnReasonServiceImpl"><span class="toc-number">1.7.4.10.5.2.</span> <span class="toc-text">OmsOrderReturnReasonServiceImpl</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%90%A5%E9%94%80%E6%A8%A1%E5%9D%97%E7%9B%B8%E5%85%B3%E8%A1%A8%E5%88%86%E6%9E%90%EF%BC%8Csms"><span class="toc-number">1.7.4.11.</span> <span class="toc-text">营销模块相关表分析，sms_*</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#sms-%E7%9B%B8%E5%85%B3%E8%A1%A8%E5%88%86%E6%9E%90"><span class="toc-number">1.7.4.11.1.</span> <span class="toc-text">sms_*相关表分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%90%A5%E9%94%80%E7%9B%B8%E5%85%B3%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.7.4.12.</span> <span class="toc-text">营销相关接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#SmsCouponController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.12.1.</span> <span class="toc-text">SmsCouponController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsCouponService"><span class="toc-number">1.7.4.12.1.1.</span> <span class="toc-text">SmsCouponService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsCouponServiceImpl"><span class="toc-number">1.7.4.12.1.2.</span> <span class="toc-text">SmsCouponServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SmsCouponHistoryController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.12.2.</span> <span class="toc-text">SmsCouponHistoryController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsCouponHistoryService"><span class="toc-number">1.7.4.12.2.1.</span> <span class="toc-text">SmsCouponHistoryService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsCouponHistoryServiceImpl"><span class="toc-number">1.7.4.12.2.2.</span> <span class="toc-text">SmsCouponHistoryServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SmsFlashPromotionController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.12.3.</span> <span class="toc-text">SmsFlashPromotionController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsFlashPromotionService"><span class="toc-number">1.7.4.12.3.1.</span> <span class="toc-text">SmsFlashPromotionService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsFlashPromotionServiceImpl"><span class="toc-number">1.7.4.12.3.2.</span> <span class="toc-text">SmsFlashPromotionServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SmsFlashPromotionProductRelationController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.12.4.</span> <span class="toc-text">SmsFlashPromotionProductRelationController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsFlashPromotionProductRelationService"><span class="toc-number">1.7.4.12.4.1.</span> <span class="toc-text">SmsFlashPromotionProductRelationService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsFlashPromotionProductRelationServiceImpl"><span class="toc-number">1.7.4.12.4.2.</span> <span class="toc-text">SmsFlashPromotionProductRelationServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SmsFlashPromotionSessionController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.12.5.</span> <span class="toc-text">SmsFlashPromotionSessionController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsFlashPromotionSessionService"><span class="toc-number">1.7.4.12.5.1.</span> <span class="toc-text">SmsFlashPromotionSessionService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsFlashPromotionSessionServiceImpl"><span class="toc-number">1.7.4.12.5.2.</span> <span class="toc-text">SmsFlashPromotionSessionServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SmsHomeAdvertiseController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.12.6.</span> <span class="toc-text">SmsHomeAdvertiseController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsHomeAdvertiseService"><span class="toc-number">1.7.4.12.6.1.</span> <span class="toc-text">SmsHomeAdvertiseService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsHomeAdvertiseServiceImpl"><span class="toc-number">1.7.4.12.6.2.</span> <span class="toc-text">SmsHomeAdvertiseServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SmsHomeBrandController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.12.7.</span> <span class="toc-text">SmsHomeBrandController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsHomeBrandService"><span class="toc-number">1.7.4.12.7.1.</span> <span class="toc-text">SmsHomeBrandService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsHomeBrandServiceImpl"><span class="toc-number">1.7.4.12.7.2.</span> <span class="toc-text">SmsHomeBrandServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SmsHomeNewProductController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.12.8.</span> <span class="toc-text">SmsHomeNewProductController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsHomeNewProductService"><span class="toc-number">1.7.4.12.8.1.</span> <span class="toc-text">SmsHomeNewProductService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsHomeNewProductServiceImpl"><span class="toc-number">1.7.4.12.8.2.</span> <span class="toc-text">SmsHomeNewProductServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SmsHomeRecommendProductController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.12.9.</span> <span class="toc-text">SmsHomeRecommendProductController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsHomeRecommendProductService"><span class="toc-number">1.7.4.12.9.1.</span> <span class="toc-text">SmsHomeRecommendProductService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsHomeRecommendProductServiceImpl"><span class="toc-number">1.7.4.12.9.2.</span> <span class="toc-text">SmsHomeRecommendProductServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SmsHomeRecommendSubjectController%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.12.10.</span> <span class="toc-text">SmsHomeRecommendSubjectController相关</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsHomeRecommendSubjectService"><span class="toc-number">1.7.4.12.10.1.</span> <span class="toc-text">SmsHomeRecommendSubjectService</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#SmsHomeRecommendSubjectServiceImpl"><span class="toc-number">1.7.4.12.10.2.</span> <span class="toc-text">SmsHomeRecommendSubjectServiceImpl</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mall-portal%E6%A8%A1%E5%9D%97"><span class="toc-number">1.8.</span> <span class="toc-text">mall-portal模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pom-xml-5"><span class="toc-number">1.8.1.</span> <span class="toc-text">pom.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%85%E7%BB%93%E6%9E%84-5"><span class="toc-number">1.8.2.</span> <span class="toc-text">包结构</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer"  class="Popup" style="display: none">
      <ul>
  <li> 开发中. </li>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&text=Mall商城"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&title=Mall商城"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&is_video=false&description=Mall商城"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Mall商城&body=Check out this article: https://www.t1kcode.top/posts/20230320134010-cc2903eb.html"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&title=Mall商城"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&title=Mall商城"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&title=Mall商城"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&title=Mall商城"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&name=Mall商城&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://www.t1kcode.top/posts/20230320134010-cc2903eb.html&t=Mall商城"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li> -->

</ul>

    </div>

    <div id="actions-footer">
        <span id="menu" Popup="#nav-footer" class="icon"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</span>
        <span id="toc" Popup="#toc-footer" class="icon"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</span>
        <span id="share" Popup="#share-footer" class="icon"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</span>
        <span id="top" Popup="" style="display:none" class="icon" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</span>
    </div>

  </div>
</div>

            <!-- 图片弹窗 -->
            <div class="img-pup" style="display: none;">
              <img>
            </div>
          

          <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2019-2023
    t1k
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/blog/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/">关于</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

          <!-- jquery -->
 
  
<script src="/lib/jquery/jquery.min.js"></script>



<script src="/lib/jquery/jquery.pjax.js"></script>



<!-- clipboard -->

   
    
<script src="/lib/clipboard/clipboard.min.js"></script>

  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
      setTimeout(()=>{
        e.trigger.setAttribute('aria-label', "复制到粘贴板!");
      },1500)
    })
  })
  </script>



<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

     
      </div>   
    </div>
      
    
<script src="/js/main.js"></script>

    </body>
    </html>
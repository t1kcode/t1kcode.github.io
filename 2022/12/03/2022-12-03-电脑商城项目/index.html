<!DOCTYPE html>
<html lang=zh-CN>
  <head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="项目实践">
<meta property="og:type" content="article">
<meta property="og:title" content="电脑商城">
<meta property="og:url" content="http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/index.html">
<meta property="og:site_name" content="t1kcode">
<meta property="og:description" content="项目实践">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-12-03T10:57:10.000Z">
<meta property="article:modified_time" content="2023-03-25T11:35:14.630Z">
<meta property="article:author" content="t1k">
<meta property="article:tag" content="项目">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/Rolan.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    
      <title>t1kcode·电脑商城</title>
    
    
    <!-- styles -->

    <!-- 默认CSS引入方法 -->
    
<link rel="stylesheet" href="/css/layout.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	


  
  <!-- L2Dwidget -->
  
<script src="/lib/live2d/L2Dwidget.min.js"></script>


  <script>
  // 猫
  L2Dwidget.init({
    model: {
      jsonPath: "/lib/live2d/tororo/assets/tororo.model.json",
    },
    display: {
      superSample: 2,
      width: 60,
      height: 80,
      position: 'right',
      hOffset: 0,
      vOffset: 20,
    },
    mobile: {
      show: true,
      scale: 1,
      motion: true,
    },
    react: {
      opacityDefault: 1,
      opacityOnHover: 1,
    }
  })
  //百度搜索爬虫



var _hmt = _hmt || [];
(function () {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7e9a19e5e700f1a2607b47c7bd6b35e8";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();

  </script>
  <meta name="baidu-site-verification" content="code-dIan6MAmy5" />
  

  <!-- styles -->


 
  <link
    rel="preload"
    href="/lib/font-awesome/css/all.min.css"
    as="style"
    onload="this.onload=null;this.rel='stylesheet'"
  />
  <noscript
    ><link
      rel="stylesheet"
      href="/lib/font-awesome/css/all.min.css"
  /></noscript>



<meta name="generator" content="Hexo 6.3.0"></head>


    <body class="max-width mx-auto">
     <div class="home">
        <!-- //actions_desktop 右上角导航栏 -->
      <aside id="#aside" class="hubzy_left">
        
          <div class="hubzy_logo">
	<a href="/">
		
		  
					<div id="logo" style="background-image: url(/images/logo.jpg);"></div>
					
					  
	  </a>
	  <div id="title">
		<a href="/">
		  <h1>
			t1kcode
		  </h1>
		</a>
		
			<!-- icon列表 -->
			  <p class="iconlist">
				<!-- # > index.find_me_on -->
				
				
				
				
				  
					<a class="icon" target="_blank" rel="noopener" href="https://github.com/t1kcode" aria-label="github">
					  <i class="fab fa-github"></i></a>
					  
			     
				  
				
				  
					<a class="icon" target="_blank" rel="noopener" href="https://gitee.com/t1kcode">
					  <i><svg class='diyIcon'  viewBox="0 0 1024 1024" ><path d="M512 1024C229.248 1024 0 794.752 0 512S229.248 0 512 0s512 229.248 512 512-229.248 512-512 512z m259.168-568.896h-290.752a25.28 25.28 0 0 0-25.28 25.28l-0.032 63.232c0 13.952 11.296 25.28 25.28 25.28h177.024a25.28 25.28 0 0 1 25.28 25.28v12.64a75.84 75.84 0 0 1-75.84 75.84h-240.224a25.28 25.28 0 0 1-25.28-25.28v-240.192a75.84 75.84 0 0 1 75.84-75.84h353.92a25.28 25.28 0 0 0 25.28-25.28l0.064-63.2a25.312 25.312 0 0 0-25.28-25.312H417.184a189.632 189.632 0 0 0-189.632 189.6v353.952c0 13.952 11.328 25.28 25.28 25.28h372.928a170.656 170.656 0 0 0 170.656-170.656v-145.376a25.28 25.28 0 0 0-25.28-25.28z"></path></svg></i>
					</a>
				  
			  
				  
				
			  </p>
			
	  </div>
</div>
<!-- 搜索栏 -->
<div id="search">
	<input class="search-input" type="text" placeholder="search">
	<span id="search-icon" class="fa fa-bars" title="展开目录"></span>
</div>

<!-- 侧边目录栏 -->
<div id="tree">
	

	
					<ul>
						<li class="file">
							<a href="/2021/03/08/2021-03-12-单链表/">
								<i class="fa fa-file"></i>
								2021-03-12-单链表
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/2021/03/05/2021-03-13-顺序表/">
								<i class="fa fa-file"></i>
								2021-03-13-顺序表
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/2021/03/14/2021-03-14-C++那些事/">
								<i class="fa fa-file"></i>
								2021-03-14-C++那些事
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/2021/03/23/2021-03-23-循环链表/">
								<i class="fa fa-file"></i>
								2021-03-23-循环链表
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/2021/03/28/2021-03-28-双向循环链表/">
								<i class="fa fa-file"></i>
								2021-03-28-双向循环链表
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/2021/04/01/2021-04-01-栈/">
								<i class="fa fa-file"></i>
								2021-04-01-栈
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/2021/04/10/2021-04-010-基数排序/">
								<i class="fa fa-file"></i>
								2021-04-010-基数排序
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/2021/04/02/2021-04-02-栈的应用/">
								<i class="fa fa-file"></i>
								2021-04-02-栈的应用
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/2021/04/03/2021-04-03-队列/">
								<i class="fa fa-file"></i>
								2021-04-03-队列
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/2021/05/01/2021-05-01-树/">
								<i class="fa fa-file"></i>
								2021-05-01-树
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/2021/04/22/2021-4-22-查找/">
								<i class="fa fa-file"></i>
								2021-4-22-查找
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/2022/10/01/2022-10-01-JAVA基础/">
								<i class="fa fa-file"></i>
								2022-10-01-JAVA基础
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file active">
							<a href="/2022/12/03/2022-12-03-电脑商城项目/">
								<i class="fa fa-file"></i>
								2022-12-03-电脑商城项目
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/2023/02/16/2023-02-16-Mall商城/">
								<i class="fa fa-file"></i>
								2023-02-16-Mall商城
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/2019/12/07/关于我搭建个人博客的流程及一些问题/">
								<i class="fa fa-file"></i>
								关于我搭建个人博客的流程及一些问题
							</a>
						</li>
					</ul>
	
</div>

        
      </aside>
      <div id="header-post" class="hubzy_right">
        
          
  <!-- <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a> -->
  <!-- <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a> -->
  <!-- <a id="top-icon-tablet" href="#" "Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"
    style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a> -->
  <span id="menu">
    <span id="nav">
      <ul>
        
          <li><a href="/">
              首页
            </a></li>
          
          <li><a href="/categories/%E9%A1%B9%E7%9B%AE/">
              项目
            </a></li>
          
          <li><a href="/archives/">
              归档
            </a></li>
          
          <li><a href="/about/">
              关于
            </a></li>
          
      </ul>
    </span>
    <br />
    <div id="toc">
      
    </div>
    <br />
    <span id="actions">
      <ul>
        <!--// 
          <li><a class="icon" aria-label="上一篇 " href="/2023/02/16/2023-02-16-Mall%E5%95%86%E5%9F%8E/"><i
                class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();"
                onmouseout="$('#i-prev').toggle();"></i></a></li>
          
            
              <li><a class="icon" aria-label="下一篇 " href="/2022/10/01/2022-10-01-JAVA%E5%9F%BA%E7%A1%80/"><i
                    class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();"
                    onmouseout="$('#i-next').toggle();"></i></a></li>
              // -->
                <li><a class="icon" aria-label="返回顶部 " href="#"
                    onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up"
                      aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a>
                </li>
                <li><a class="icon" aria-label="分享文章 " href="#"><i class="fas fa-share-alt"
                      aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();"
                      onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">
        上一篇
      </span>
      <span id="i-next" class="info" style="display:none;">
        下一篇
      </span>
      <span id="i-top" class="info" style="display:none;">
        返回顶部
      </span>
      <span id="i-share" class="info" style="display:none;">
        分享文章
      </span>
    </span>
    <br />
    <div id="share" style="display: none">
      <ul>
  <li> 开发中. </li>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&text=电脑商城"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&title=电脑商城"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&is_video=false&description=电脑商城"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=电脑商城&body=Check out this article: http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&title=电脑商城"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&title=电脑商城"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&title=电脑商城"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&title=电脑商城"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&name=电脑商城&description=&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;项目实践&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&t=电脑商城"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li> -->

</ul>

    </div>

  </span>

        
      </div>
       
      <div class="content  hubzy_center">
        
          <!-- //body 引入首页和md编译后的页面 -->
          <!-- md 编译成 html 后的文件模板 -->

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="hubzy_center_title">
    
    <h1 class="posttitle" itemprop="name headline">
        电脑商城
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">t1k</span>
      </span>
      <!-- 文章时间和首页时间 -->

    <div class="postdate">
      
        <time datetime="2022-12-03T10:57:10.000Z" itemprop="datePublished">2022-12-03</time>
        
        <!-- (Updated: <time datetime="2023-03-25T11:35:14.630Z" itemprop="dateModified">2023-03-25</time>) -->
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/%E9%A1%B9%E7%9B%AE/" rel="tag">项目</a>
    </div>


    </div>
  </header>
  

  <div class="content conterDiy"  id="article" itemprop="articleBody">
    <em class="nubScript">
        ·本篇:27.1k字 大约需要: 142分钟
    </em>
    <blockquote>
<p><strong>项目实践</strong></p>
</blockquote>
<span id="more"></span>

<h1 id="电脑商城"><a href="#电脑商城" class="headerlink" title="电脑商城"></a>电脑商城</h1><h2 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h2><blockquote>
<p><strong>基于SpringBoot+MybatisPlus+JQuery的前后端分离项目</strong></p>
</blockquote>
<h2 id="项目功能"><a href="#项目功能" class="headerlink" title="项目功能"></a>项目功能</h2><blockquote>
<ul>
<li><strong>为用户提供登录、注册功能，继承kaptcha验证码防机器人以及用户管理，如：用户信息修改、修改密码、上传头像等</strong></li>
<li><strong>分页展示商品信息、支持通过模糊搜索查找相关商品</strong></li>
<li><strong>购物车相关功能管理，如：购物车商品的展示和结算、删除购物车中的商品等</strong></li>
<li><strong>订单管理页面可以查看不同状态的订单，如：未支付、已付款和已完成等，集成了支付宝沙箱模拟商品支付全过程</strong></li>
<li><strong>收藏界面分页展示用户收藏商品信息，以及取消收藏和加入购物车</strong></li>
</ul>
</blockquote>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><blockquote>
<ul>
<li><strong>JDK 1.8</strong></li>
<li><strong>Maven 3.6.3</strong></li>
<li><strong>SpringBoot 2.7.3</strong></li>
<li><strong>MySQL 5.5.37</strong></li>
<li><strong>集成开发环境 IDEA 2020.3.4</strong></li>
</ul>
</blockquote>
<h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><h3 id="创建数据表"><a href="#创建数据表" class="headerlink" title="创建数据表"></a>创建数据表</h3><blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>`  (</span><br><span class="line">      `uid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">      `username` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">      `password` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">      `phone` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;电话号码&#x27;</span>,</span><br><span class="line">      `email` <span class="type">varchar</span>(<span class="number">30</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line">      `gender` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">      `avatar` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;/upload/defalut/user.jpg&#x27;</span> COMMENT <span class="string">&#x27;头像&#x27;</span>,</span><br><span class="line">      `created_user` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">      `created_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">      `modified_user` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">      `modified_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">      <span class="keyword">PRIMARY</span> KEY (`uid`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">      <span class="keyword">UNIQUE</span> INDEX `username`(`username`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">3</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> Compact;</span><br></pre></td></tr></table></figure>

<p><strong>每个用户都有一张默认头像</strong></p>
</blockquote>
<h3 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h3><blockquote>
<p><strong>考虑到每张表中都有created_user、created_time、modified_user、modified_time这四个固定的字段，所以创建一个基类BaseEntity来对应这四个字段，并且之后的实体类都继承BaseEntity</strong></p>
<h4 id="BaseEntity"><a href="#BaseEntity" class="headerlink" title="BaseEntity"></a>BaseEntity</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span></span><br><span class="line">&#123;</span><br><span class="line">       <span class="keyword">private</span> String createdUser;</span><br><span class="line">       <span class="keyword">private</span> Date createdTime;</span><br><span class="line">       <span class="keyword">private</span> String modifiedUser;</span><br><span class="line">       <span class="keyword">private</span> Date modifiedTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="User"><a href="#User" class="headerlink" title="User"></a>User</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;用户实体类：User&quot;, description = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;对应数据库中的user表&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span></span><br><span class="line">&#123;</span><br><span class="line">       <span class="meta">@TableId(value = &quot;uid&quot;, type = IdType.AUTO)</span></span><br><span class="line">       <span class="meta">@ApiModelProperty(value = &quot;用户ID&quot;)</span></span><br><span class="line">       <span class="keyword">private</span> Integer uid;</span><br><span class="line">       <span class="meta">@ApiModelProperty(value = &quot;用户名&quot;)</span></span><br><span class="line">       <span class="keyword">private</span> String username;</span><br><span class="line">       <span class="meta">@ApiModelProperty(value = &quot;密码&quot;)</span></span><br><span class="line">       <span class="keyword">private</span> String password;</span><br><span class="line">       <span class="meta">@ApiModelProperty(value = &quot;电话&quot;)</span></span><br><span class="line">       <span class="keyword">private</span> String phone;</span><br><span class="line">       <span class="meta">@ApiModelProperty(value = &quot;电子邮箱&quot;)</span></span><br><span class="line">       <span class="keyword">private</span> String email;</span><br><span class="line">       <span class="meta">@ApiModelProperty(value = &quot;性别&quot;)</span></span><br><span class="line">       <span class="keyword">private</span> Integer gender;</span><br><span class="line">       <span class="meta">@ApiModelProperty(value = &quot;头像&quot;)</span></span><br><span class="line">       <span class="keyword">private</span> String avatar;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><h4 id="后端-持久层"><a href="#后端-持久层" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<p><strong>通过MyBatisPlus框架与数据库进行交互，所以这种简单的curd语句可以定义Mapper使其继承BaseMapper</strong></p>
<h5 id="UserMapper"><a href="#UserMapper" class="headerlink" title="UserMapper"></a>UserMapper</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理用户数据操作的持久层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt;&#123;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>单元测试：略</strong></p>
</blockquote>
<h4 id="后端-业务层"><a href="#后端-业务层" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<p><strong>在Service包下创建ex包，主要放置在业务层中会出现的各种异常类，所以在编写代码前先要规划异常</strong></p>
<ul>
<li><p><strong>规划异常处理机制</strong></p>
<blockquote>
<p><strong>考虑到在后端处理业务的过程中，会出现各种异常情况，如执行过程中数据库宕机、用户未登录等情况，虽然在代码中可以抛出RuntimeException异常，但是这样做对异常的定位不够明确</strong></p>
<p><strong>因此在业务层的制定中，需要考虑对异常的定义处理</strong></p>
<p><strong>所以在业务层制定一个继承RuntimeException异常的异常基类，再让其他具体的异常类继承该异常基类</strong></p>
</blockquote>
</li>
</ul>
<h5 id="ServiceException"><a href="#ServiceException" class="headerlink" title="ServiceException"></a>ServiceException</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 业务层异常基类 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServiceException</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServiceException</span><span class="params">(String message)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServiceException</span><span class="params">(String message, Throwable cause)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServiceException</span><span class="params">(Throwable cause)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">super</span>(cause);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">ServiceException</span><span class="params">(String message, Throwable cause, <span class="type">boolean</span> enableSuppression, <span class="type">boolean</span> writableStackTrace)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause, enableSuppression, writableStackTrace);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>根据业务不同详细定义具体异常类型，然后统一继承ServiceException</strong></p>
<h5 id="其他异常类型"><a href="#其他异常类型" class="headerlink" title="其他异常类型"></a>其他异常类型</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 用户名重复的异常 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UsernameDuplicateException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span></span><br><span class="line"><span class="comment">/** 用户数据不存在的异常 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserNotFoundException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span></span><br><span class="line"><span class="comment">/** 密码验证失败的异常 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PasswordNotMatchException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span>    </span><br><span class="line"><span class="comment">/** 插入数据的异常 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InsertException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span></span><br><span class="line"><span class="comment">/** 更新数据的异常 */</span>   </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpdateException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span></span><br><span class="line"><span class="comment">/** 删除数据失败的异常 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeleteException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span></span><br><span class="line"><span class="comment">/** 收货地址数量达到上限的异常 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressCountLimitException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span></span><br><span class="line"><span class="comment">/** 收货地址数据不存在的异常 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressNotFoundException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span>    </span><br><span class="line"><span class="comment">/** 购物车数据不存在的异常 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartNotFoundException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span></span><br><span class="line"><span class="comment">/** 商品数据不存在的异常 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductNotFoundException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span></span><br><span class="line"><span class="comment">/** 非法访问的异常 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccessDeniedException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span></span><br><span class="line"><span class="comment">/** 订单数据不存在的异常*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderNotFoundException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span>    </span><br></pre></td></tr></table></figure>

<h5 id="IUserService"><a href="#IUserService" class="headerlink" title="IUserService"></a>IUserService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理用户数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户注册</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户数据对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">reg</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="UserServiceImpl"><a href="#UserServiceImpl" class="headerlink" title="UserServiceImpl"></a>UserServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理用户数据的业务层实现类 */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IUserService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserMapper userMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    PasswordEncoder encoder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reg</span><span class="params">(User user)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 判断该用户名是否已被注册</span></span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(User::getUsername, user.getUsername())</span><br><span class="line">               .select(User::getUid);</span><br><span class="line">        <span class="keyword">if</span>(!Objects.isNull(userMapper.selectOne(wrapper))) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameDuplicateException</span>(<span class="string">&quot;该用户名已被注册&quot;</span>);</span><br><span class="line">        <span class="comment">// 日志</span></span><br><span class="line">        user.setCreatedUser(user.getUsername());</span><br><span class="line">        user.setModifiedUser(user.getUsername());</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        user.setCreatedTime(date);</span><br><span class="line">        user.setModifiedTime(date);</span><br><span class="line">        <span class="comment">// 加密密码</span></span><br><span class="line">        user.setPassword(encoder.encode(user.getPassword()));</span><br><span class="line">        <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> userMapper.insert(user);</span><br><span class="line">        <span class="keyword">if</span>(rows != <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;插入时产生未知异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>用户注册功能，前端将值返回后，需要先判断该用户名是否已被注册，如果被注册，则抛出对应异常，没有被注册，则补全日志四个字段，然后将该条数据插入数据库</strong></p>
<p><strong>单元测试：略</strong></p>
</blockquote>
<h4 id="后端-控制层"><a href="#后端-控制层" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<p><strong>前后端分离中，后端返回给前端的是包装好的响应类，里面包含状态码，响应信息和响应数据</strong></p>
<h5 id="JsonResult"><a href="#JsonResult" class="headerlink" title="JsonResult"></a>JsonResult</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 响应结果类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;E&gt; 响应数据的类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JsonResult</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/** 状态码 */</span></span><br><span class="line">    <span class="keyword">private</span> Integer state;</span><br><span class="line">    <span class="comment">/** 状态描述信息 */</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="comment">/** 数据 */</span></span><br><span class="line">    <span class="keyword">private</span> E data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JsonResult</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JsonResult</span><span class="params">(Integer state)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 出现异常时调用 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JsonResult</span><span class="params">(Throwable e)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取异常对象中的异常信息</span></span><br><span class="line">        <span class="built_in">this</span>.message = e.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JsonResult</span><span class="params">(Integer state, E data)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JsonResult</span><span class="params">(Integer state, String message)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>在控制层也会出现各种异常情况，所以需要进行异常规划，如业务层一样，在控制层也定义一些异常类</strong></p>
<h5 id="异常类型"><a href="#异常类型" class="headerlink" title="异常类型"></a>异常类型</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 表示session错误的异常 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionEmptyException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span></span><br><span class="line"><span class="comment">/** 表示验证码错误的异常 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeNotMatchException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> </span><br><span class="line"><span class="comment">/** 上传的文件为空的异常，例如没有选择上传的文件就提交了表单，或选择的文件是0字节的空文件 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileEmptyException</span> <span class="keyword">extends</span> <span class="title class_">FileUploadException</span>     </span><br><span class="line"><span class="comment">/** 上传的文件的大小超出了限制值 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileSizeException</span> <span class="keyword">extends</span> <span class="title class_">FileUploadException</span>    </span><br><span class="line"><span class="comment">/** 上传的文件状态异常 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileStateException</span> <span class="keyword">extends</span> <span class="title class_">FileUploadException</span>    </span><br><span class="line"><span class="comment">/** 上传的文件类型超出了限制 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileTypeException</span> <span class="keyword">extends</span> <span class="title class_">FileUploadException</span>  </span><br><span class="line"><span class="comment">/** 文件上传相关异常的基类 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileUploadException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>    </span><br><span class="line"><span class="comment">/** 上传文件时读写异常 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileUploadIOException</span> <span class="keyword">extends</span> <span class="title class_">FileUploadException</span>    </span><br></pre></td></tr></table></figure>

<p><strong>定义一个控制层基类，在这个基类中进行各种异常处理和定义一些公用的方法</strong></p>
<h5 id="BaseController"><a href="#BaseController" class="headerlink" title="BaseController"></a>BaseController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">OK</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从HttpSession对象中获取uid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session HttpSession对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 当前登录的用户的id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Integer <span class="title function_">getUidFromSession</span><span class="params">(HttpSession session)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Objects.isNull(session.getAttribute(<span class="string">&quot;uid&quot;</span>))) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SessionEmptyException</span>(<span class="string">&quot;用户未登录&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Integer.valueOf(session.getAttribute(<span class="string">&quot;uid&quot;</span>).toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从HttpSession对象中获取用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session HttpSession对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 当前登录的用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> String <span class="title function_">getUsernameFromSession</span><span class="params">(HttpSession session)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Objects.isNull(session.getAttribute(<span class="string">&quot;username&quot;</span>))) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SessionEmptyException</span>(<span class="string">&quot;用户未登录&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> session.getAttribute(<span class="string">&quot;username&quot;</span>).toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从HttpSession对象中获取用户头像</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session HttpSession对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 当前登录的用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> String <span class="title function_">getAvatarFromSession</span><span class="params">(HttpSession session)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Objects.isNull(session.getAttribute(<span class="string">&quot;avatar&quot;</span>))) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SessionEmptyException</span>(<span class="string">&quot;用户未登录&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> session.getAttribute(<span class="string">&quot;avatar&quot;</span>).toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(&#123;ServiceException.class, FileUploadException.class, SessionEmptyException.class, CodeNotMatchException.class&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">handleException</span><span class="params">(Throwable e)</span></span><br><span class="line">    &#123;</span><br><span class="line">        JsonResult&lt;Void&gt; result = <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(e <span class="keyword">instanceof</span> InsertException)&#123;</span><br><span class="line">            result.setState(<span class="number">4000</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;数据插入失败&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> UpdateException)&#123;</span><br><span class="line">            result.setState(<span class="number">4001</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;数据更新失败&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> DeleteException)&#123;</span><br><span class="line">            result.setState(<span class="number">4002</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;数据删除失败&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> UsernameDuplicateException)&#123;</span><br><span class="line">            result.setState(<span class="number">5000</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;用户名重复&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> UserNotFoundException)&#123;</span><br><span class="line">            result.setState(<span class="number">5001</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> PasswordNotMatchException)&#123;</span><br><span class="line">            result.setState(<span class="number">5002</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;密码不匹配&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> CodeNotMatchException)&#123;</span><br><span class="line">            result.setState(<span class="number">5003</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;验证码错误&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> AddressCountLimitException)&#123;</span><br><span class="line">            result.setState(<span class="number">6001</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;地址数量已超限制&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> AddressNotFoundException)&#123;</span><br><span class="line">            result.setState(<span class="number">6002</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;地址不存在&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> AccessDeniedException)&#123;</span><br><span class="line">            result.setState(<span class="number">6003</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;访问被拒绝&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> ProductNotFoundException)&#123;</span><br><span class="line">            result.setState(<span class="number">6004</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;商品不存在&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> CartNotFoundException)&#123;</span><br><span class="line">            result.setState(<span class="number">6005</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;购物车数据不存在&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> OrderNotFoundException)&#123;</span><br><span class="line">            result.setState(<span class="number">6006</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;订单数据不存在&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> FileEmptyException)&#123;</span><br><span class="line">            result.setState(<span class="number">7001</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;文件为空&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> FileSizeException)&#123;</span><br><span class="line">            result.setState(<span class="number">7002</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;文件大小超出限制&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> FileTypeException)&#123;</span><br><span class="line">            result.setState(<span class="number">7003</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;文件类型不正确&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> FileStateException)&#123;</span><br><span class="line">            result.setState(<span class="number">7004</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;文件状态异常&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> FileUploadIOException)&#123;</span><br><span class="line">            result.setState(<span class="number">7005</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;文件上传失败&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> SessionEmptyException)&#123;</span><br><span class="line">            result.setState(<span class="number">8000</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;用户未登录&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> ServiceException)&#123;</span><br><span class="line">            result.setState(<span class="number">9000</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;未知错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="设计请求"><a href="#设计请求" class="headerlink" title="设计请求"></a>设计请求</h5><blockquote>
<p><strong>请求路径：&#x2F;api&#x2F;auth&#x2F;reg</strong></p>
<p><strong>请求参数：User user</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应结果：JsonResult&lt; Void &gt;</strong></p>
</blockquote>
<h5 id="AuthController"><a href="#AuthController" class="headerlink" title="AuthController"></a>AuthController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/auth&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;用户验证相关接口描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;用户注册&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户注册&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 4000, message = &quot;数据插入失败&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5000, message = &quot;用户名重复&quot;),</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;reg&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">reg</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.reg(user);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;验证验证码&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于验证用户验证码是否填写正确&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5003, message = &quot;验证码错误&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;code&quot;, value = &quot;验证码&quot;, required = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;code&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">code</span><span class="params">(<span class="meta">@ApiParam(hidden = true)</span> HttpSession session, String code)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">iCode</span> <span class="operator">=</span> session.getAttribute(Constants.KAPTCHA_SESSION_KEY).toString();</span><br><span class="line">        <span class="keyword">if</span>(!iCode.equals(code)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CodeNotMatchException</span>(<span class="string">&quot;验证码错误&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>前端返回参数后，调用业务层的注册方法，并且返回响应实体类，如果在过程中抛出异常，则会在BaseController中进行处理，应该判断前端返回的参数是否为空</strong></p>
<p><strong>接口测试：使用postman进行接口测试</strong></p>
</blockquote>
<h4 id="前端界面"><a href="#前端界面" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<p><strong>编写js函数判断用户是否按规定输入，如：用户名长度是否为3以上，验证码是否正确等</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">        <span class="keyword">let</span> kaptcha = $(<span class="string">&quot;#kaptcha&quot;</span>) <span class="comment">// 绑定验证码控件</span></span><br><span class="line">        kaptcha.<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123; <span class="comment">// 验证码点击事件</span></span><br><span class="line">            <span class="title function_">reFlashImg</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">reFlashImg</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">// 向后端请求验证码时需要加上时间参数</span></span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;kaptcha&quot;</span>).<span class="property">src</span> = <span class="string">&quot;http://localhost:8080/kaptcha/kaptcha-image?time=&quot;</span>+ <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> ctr = $(<span class="string">&quot;#info&quot;</span>) <span class="comment">// 绑定信息控件</span></span><br><span class="line">        <span class="comment">// 判断各种数据格式是否正确</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">judgeData</span>(<span class="params"></span>)&#123; </span><br><span class="line">            <span class="keyword">let</span> flag = <span class="literal">true</span></span><br><span class="line">            <span class="comment">// 正则表达式</span></span><br><span class="line">            <span class="keyword">let</span> reg = <span class="regexp">/^[a-zA-Z]\w&#123;2,5&#125;$/i</span></span><br><span class="line">            <span class="keyword">let</span> reg1 = <span class="regexp">/^\w&#123;2,5&#125;$/i</span></span><br><span class="line">            <span class="keyword">let</span> username = $(<span class="string">&quot;#username&quot;</span>).<span class="title function_">val</span>()</span><br><span class="line">            <span class="keyword">let</span> p1 = $(<span class="string">&quot;#password1&quot;</span>).<span class="title function_">val</span>()</span><br><span class="line">            <span class="keyword">let</span> p2 = $(<span class="string">&quot;#password2&quot;</span>).<span class="title function_">val</span>()</span><br><span class="line">            <span class="keyword">let</span> code = $(<span class="string">&quot;#code&quot;</span>).<span class="title function_">val</span>()</span><br><span class="line">            <span class="keyword">if</span>(username.<span class="title function_">trim</span>().<span class="property">length</span> &lt; <span class="number">3</span>)&#123;</span><br><span class="line">                <span class="title function_">setInfo</span>(<span class="string">&quot;用户名长度必须为3及以上&quot;</span>, ctr)</span><br><span class="line">                flag = <span class="literal">false</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!reg.<span class="title function_">test</span>(username))&#123;</span><br><span class="line">                <span class="title function_">setInfo</span>(<span class="string">&quot;用户名必须为数字和字母且第一位不能为数字&quot;</span>, ctr)</span><br><span class="line">                flag = <span class="literal">false</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(p1.<span class="title function_">trim</span>().<span class="property">length</span> &lt; <span class="number">3</span>)&#123;</span><br><span class="line">                <span class="title function_">setInfo</span>(<span class="string">&quot;密码长度必须为3及以上&quot;</span>, ctr)</span><br><span class="line">                flag = <span class="literal">false</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!reg1.<span class="title function_">test</span>(p1))&#123;</span><br><span class="line">                <span class="title function_">setInfo</span>(<span class="string">&quot;密码必须为数字和字母&quot;</span>, ctr)</span><br><span class="line">                flag = <span class="literal">false</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(p1 !== p2)&#123;</span><br><span class="line">                <span class="title function_">setInfo</span>(<span class="string">&quot;两次密码不相同&quot;</span>, ctr)</span><br><span class="line">                flag = <span class="literal">false</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(code.<span class="title function_">trim</span>().<span class="property">length</span> === <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="title function_">setInfo</span>(<span class="string">&quot;请填写验证码&quot;</span>, ctr)</span><br><span class="line">                flag = <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> flag</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注册按钮点击事件</span></span><br><span class="line">        $(<span class="string">&quot;#btn-reg&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_">judgeData</span>())&#123;</span><br><span class="line">                <span class="comment">// 先判断验证码是否正确</span></span><br><span class="line">                $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">                    <span class="attr">url</span>: <span class="string">&quot;/api/auth/code&quot;</span>,</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">                    <span class="attr">data</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;code&quot;</span>: $(<span class="string">&quot;#code&quot;</span>).<span class="title function_">val</span>()</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">                    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(json.<span class="property">state</span> !== <span class="number">200</span>)&#123;</span><br><span class="line">                            <span class="title function_">setInfo</span>(<span class="string">&quot;验证码错误&quot;</span>, ctr)</span><br><span class="line">                        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                            <span class="comment">// $(&quot;#form-reg&quot;).serialize()，将表单中带有name字段的控件的值一起提交到后端</span></span><br><span class="line">                            $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">                                <span class="attr">url</span>: <span class="string">&quot;/api/auth/reg&quot;</span>,</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">                                <span class="attr">data</span>: &#123;</span><br><span class="line">                                    <span class="string">&quot;username&quot;</span>: $(<span class="string">&quot;#username&quot;</span>).<span class="title function_">val</span>(),</span><br><span class="line">                                    <span class="string">&quot;password&quot;</span>: $(<span class="string">&quot;#password1&quot;</span>).<span class="title function_">val</span>()</span><br><span class="line">                                &#125;,</span><br><span class="line">                                <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">                                <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">                                    <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                                        <span class="title function_">confirm</span>(<span class="string">&quot;注册成功&quot;</span>)</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    <span class="keyword">else</span>&#123;</span><br><span class="line">                                        <span class="title function_">confirm</span>(json.<span class="property">state</span> + <span class="string">&quot;: &quot;</span> + json.<span class="property">message</span>)</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;,</span><br><span class="line">                                <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                                    <span class="title function_">error</span>(xhr)</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                        <span class="title function_">error</span>(xhr)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><h4 id="后端-持久层-1"><a href="#后端-持久层-1" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<h5 id="UserMapper-1"><a href="#UserMapper-1" class="headerlink" title="UserMapper"></a>UserMapper</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理用户数据操作的持久层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="后端-业务层-1"><a href="#后端-业务层-1" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<p><strong>因为使用了Security安全框架，所以定义一个类实现UserDetailsService，并重写loadUserByUsername(String username)方法</strong></p>
<h5 id="AuthService"><a href="#AuthService" class="headerlink" title="AuthService"></a>AuthService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthService</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="meta">@Resource</span></span><br><span class="line">        UserMapper userMapper;</span><br><span class="line">    </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException</span><br><span class="line">        &#123;</span><br><span class="line">            LambdaQueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            wrapper.eq(User::getUsername, username);</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectOne(wrapper);</span><br><span class="line">            <span class="keyword">if</span>(ObjectUtils.isEmpty(user)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;该用户不存在&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> org.springframework.security.core.userdetails.User</span><br><span class="line">                    .withUsername(user.getUsername())</span><br><span class="line">                    .password(user.getPassword())</span><br><span class="line">                    .roles(<span class="string">&quot;user&quot;</span>) <span class="comment">// 用户权限</span></span><br><span class="line">                    .build();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="SecurityConfiguration"><a href="#SecurityConfiguration" class="headerlink" title="SecurityConfiguration"></a>SecurityConfiguration</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="meta">@Resource</span></span><br><span class="line">        AuthService service;</span><br><span class="line">        <span class="meta">@Resource</span></span><br><span class="line">        DataSource dataSource;</span><br><span class="line">        <span class="meta">@Resource</span></span><br><span class="line">        PersistentTokenRepository repository;</span><br><span class="line">	</span><br><span class="line">        <span class="comment">// 数据源无法被自动注入</span></span><br><span class="line">        <span class="comment">// remember-me底层依赖spring-JDBC</span></span><br><span class="line">        <span class="comment">// 是因为mybatis的依赖被我注释</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> PersistentTokenRepository <span class="title function_">jdbcRepository</span><span class="params">()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">JdbcTokenRepositoryImpl</span> <span class="variable">repository</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcTokenRepositoryImpl</span>();</span><br><span class="line">            repository.setDataSource(dataSource);</span><br><span class="line">    <span class="comment">//        repository.setCreateTableOnStartup(true); 第一次启动会创建一张表存储token</span></span><br><span class="line">            <span class="keyword">return</span> repository;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">        &#123;</span><br><span class="line">            http</span><br><span class="line">                    .authorizeRequests()</span><br><span class="line">                    .antMatchers( <span class="string">&quot;/api/auth/**&quot;</span>, <span class="string">&quot;/districts/**&quot;</span>).permitAll() <span class="comment">// 这些接口对所有人放行</span></span><br><span class="line">                    .antMatchers(<span class="string">&quot;/api/**&quot;</span>).authenticated() <span class="comment">// 这些接口需要登录验证</span></span><br><span class="line">                    .anyRequest().permitAll() <span class="comment">// 其余所有接口对所有人放行</span></span><br><span class="line">                    .and()</span><br><span class="line">                    .formLogin()</span><br><span class="line">                    .loginPage(<span class="string">&quot;/api/auth/login-deny&quot;</span>)</span><br><span class="line">                    .loginProcessingUrl(<span class="string">&quot;/api/auth/login&quot;</span>)</span><br><span class="line">                    .successForwardUrl(<span class="string">&quot;/api/auth/login-success&quot;</span>)</span><br><span class="line">                    .failureForwardUrl(<span class="string">&quot;/api/auth/login-failure&quot;</span>)</span><br><span class="line">                    .and()</span><br><span class="line">                    .logout()</span><br><span class="line">                    .logoutUrl(<span class="string">&quot;/api/auth/logout&quot;</span>)</span><br><span class="line">                    .logoutSuccessUrl(<span class="string">&quot;/api/auth/logout-success&quot;</span>)</span><br><span class="line">                    .and()</span><br><span class="line">                    .csrf().disable()</span><br><span class="line">                    .rememberMe()</span><br><span class="line">                    .rememberMeParameter(<span class="string">&quot;remember&quot;</span>)</span><br><span class="line">                    .tokenValiditySeconds(<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span>)</span><br><span class="line">                    .tokenRepository(repository)</span><br><span class="line">                    .userDetailsService(service);</span><br><span class="line">     &#125;</span><br><span class="line">   </span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">        &#123;</span><br><span class="line">            auth</span><br><span class="line">                    .userDetailsService(service)</span><br><span class="line">                    .passwordEncoder(<span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>());</span><br><span class="line">        &#125;</span><br><span class="line">   </span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><strong>在使用remember-me的过程中，因为想将token持久化存储到数据库中，然后自动注入数据源时报错，是因为禁用了mybatis的依赖，并且还要导入spring-boot-starter-jdbc依赖</strong></p>
</blockquote>
<h4 id="后端-控制层-1"><a href="#后端-控制层-1" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="设计请求-1"><a href="#设计请求-1" class="headerlink" title="设计请求"></a>设计请求</h5><blockquote>
<p><strong>请求路径：&#x2F;api&#x2F;auth&#x2F;login</strong></p>
<p><strong>请求参数：无</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：无</strong></p>
</blockquote>
<p><strong>实际上，登录请求没有走我定义的方法，是从Security中进行了验证</strong></p>
<h4 id="AuthController-1"><a href="#AuthController-1" class="headerlink" title="AuthController"></a>AuthController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/auth&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;用户验证相关接口描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;用户登录&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户登录&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;登录成功&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;表示登录成功，并将用户信息插入session中&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;login-success&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">loginSuccess</span><span class="params">(<span class="meta">@ApiParam(hidden = true)</span> HttpSession session)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SecurityContext</span> <span class="variable">context</span> <span class="operator">=</span> SecurityContextHolder.getContext();</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> context.getAuthentication().getName();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getByUsername(username);</span><br><span class="line">        session.setAttribute(<span class="string">&quot;username&quot;</span>, user.getUsername());</span><br><span class="line">        session.setAttribute(<span class="string">&quot;uid&quot;</span>, user.getUid());</span><br><span class="line">        session.setAttribute(<span class="string">&quot;avatar&quot;</span>, user.getAvatar());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;登录失败&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;表示登录失败&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 300, message = &quot;登录失败&quot;),</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;login-failure&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">loginFailure</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="number">300</span>, <span class="string">&quot;登陆失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;未登录&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;验证用户是否登录&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 301, message = &quot;未验证，请登录&quot;),</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;login-deny&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">loginDeny</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="number">301</span>, <span class="string">&quot;未验证，请登录&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;验证记住我&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于验证用户是否使用记住我&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 9000, message = &quot;没有使用记住我&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;remember&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">remember</span><span class="params">(<span class="meta">@ApiParam(hidden = true)</span> HttpSession session)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">        <span class="keyword">if</span>(Objects.isNull(authentication)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SessionEmptyException</span>(<span class="string">&quot;没有remember&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> authentication.getName();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getByUsername(username);</span><br><span class="line">        session.setAttribute(<span class="string">&quot;username&quot;</span>, user.getUsername());</span><br><span class="line">        session.setAttribute(<span class="string">&quot;uid&quot;</span>, user.getUid());</span><br><span class="line">        session.setAttribute(<span class="string">&quot;avatar&quot;</span>, user.getAvatar());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;验证验证码&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于验证用户验证码是否填写正确&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5003, message = &quot;验证码错误&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;code&quot;, value = &quot;验证码&quot;, required = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;code&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">code</span><span class="params">(<span class="meta">@ApiParam(hidden = true)</span> HttpSession session, String code)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">iCode</span> <span class="operator">=</span> session.getAttribute(Constants.KAPTCHA_SESSION_KEY).toString();</span><br><span class="line">        <span class="keyword">if</span>(!iCode.equals(code)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CodeNotMatchException</span>(<span class="string">&quot;验证码错误&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口测试：略</strong></p>
</blockquote>
<h4 id="前端界面-1"><a href="#前端界面-1" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<p><strong>与注册界面中的逻辑几乎相同，所有数据格式正确后，向登录接口发起POST请求即可，若请求成功则用location.herf&#x3D;”index.html”，跳转到index页面；未成功则输出相关信息</strong></p>
</blockquote>
<h3 id="退出登录"><a href="#退出登录" class="headerlink" title="退出登录"></a>退出登录</h3><h4 id="后端-持久层-2"><a href="#后端-持久层-2" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<p><strong>与前面一致</strong></p>
</blockquote>
<h4 id="后端-业务层-2"><a href="#后端-业务层-2" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<p><strong>无</strong></p>
</blockquote>
<h4 id="后端-控制层-2"><a href="#后端-控制层-2" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="设计请求-2"><a href="#设计请求-2" class="headerlink" title="设计请求"></a>设计请求</h5><blockquote>
<p><strong>请求路径：&#x2F;api&#x2F;auth&#x2F;logout</strong></p>
<p><strong>请求参数：HttpSession session</strong></p>
<p><strong>请求类型：GET</strong></p>
<p><strong>响应类型：JsonResult&lt; Void &gt;</strong></p>
</blockquote>
<h5 id="AuthController-2"><a href="#AuthController-2" class="headerlink" title="AuthController"></a>AuthController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/auth&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;用户验证相关接口描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IUserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;退出登录&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户退出登录，并清除session中存储的用户信息&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;logout&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">logout</span><span class="params">(<span class="meta">@ApiParam(hidden = true)</span> HttpSession session)</span></span><br><span class="line">    &#123;</span><br><span class="line">        session.setAttribute(<span class="string">&quot;username&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        session.setAttribute(<span class="string">&quot;uid&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        session.setAttribute(<span class="string">&quot;avatar&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;退出登录成功&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;表示用户退出登录成功&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;logout-success&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">logoutSuccess</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>退出登录时清空session中存储的用户信息即可</strong></p>
</blockquote>
<h3 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h3><h4 id="后端-持久层-3"><a href="#后端-持久层-3" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<p><strong>与前面一致</strong></p>
</blockquote>
<h4 id="后端-业务层-3"><a href="#后端-业务层-3" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="IUserService-1"><a href="#IUserService-1" class="headerlink" title="IUserService"></a>IUserService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理用户数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span></span><br><span class="line">&#123;</span><br><span class="line">    	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> oldPassword 原密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newPassword 新密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changePassword</span><span class="params">(Integer uid, String username, String oldPassword, String newPassword)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断密码是否相同</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password1 原密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password2 新密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">JudgePassword</span><span class="params">(Integer uid, String password1, String password2)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="UserServiceImpl-1"><a href="#UserServiceImpl-1" class="headerlink" title="UserServiceImpl"></a>UserServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理用户数据的业务层实现类 */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IUserService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserMapper userMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    PasswordEncoder encoder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changePassword</span><span class="params">(Integer uid, String username, String oldPassword, String newPassword)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(uid);</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(user)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UserNotFoundException</span>(<span class="string">&quot;该用户不存在&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 校验原密码是否一致</span></span><br><span class="line">            JudgePassword(uid, oldPassword, user.getPassword());</span><br><span class="line">            LambdaUpdateWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">            wrapper.eq(User::getUid, uid)</span><br><span class="line">                   .set(User::getPassword, encoder.encode(newPassword));</span><br><span class="line">            <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> userMapper.update(<span class="literal">null</span>, wrapper);</span><br><span class="line">            <span class="keyword">if</span>(row != <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;更新数据时发生异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">JudgePassword</span><span class="params">(Integer uid, String password1, String password2)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(password2))&#123;</span><br><span class="line">            LambdaQueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            wrapper.select(User::getPassword)</span><br><span class="line">                   .eq(User::getUid, uid);</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectOne(wrapper);</span><br><span class="line">            <span class="keyword">if</span>(!encoder.matches(password1, user.getPassword())) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">PasswordNotMatchException</span>(<span class="string">&quot;密码不匹配&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(!encoder.matches(password1, password2)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">PasswordNotMatchException</span>(<span class="string">&quot;密码不匹配&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>单元测试：略</strong></p>
</blockquote>
<h4 id="后端-控制层-3"><a href="#后端-控制层-3" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="设计请求-3"><a href="#设计请求-3" class="headerlink" title="设计请求"></a>设计请求</h5><blockquote>
<p><strong>请求路径：&#x2F;user&#x2F;change_password</strong></p>
<p><strong>请求参数：HttpSession session，String oldPassword，String newPassword</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt; Void &gt;</strong></p>
</blockquote>
<h5 id="UserController"><a href="#UserController" class="headerlink" title="UserController"></a>UserController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;用户相关接口描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IUserService service;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;修改密码&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户修改密码&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 4001, message = &quot;数据更新失败&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5002, message = &quot;原密码不匹配&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 8000, message = &quot;用户未登录&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;oldPassword&quot;, value = &quot;原密码&quot;, required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;newPassword&quot;, value = &quot;新密码&quot;, required = true),</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;change_password&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">changePassword</span><span class="params">(HttpSession session, String oldPassword, String newPassword)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">        service.changePassword(uid, username, oldPassword, newPassword);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口测试：略</strong></p>
</blockquote>
<h4 id="前端界面-2"><a href="#前端界面-2" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<p><strong>首先判断数据格式是否正确，如新密码不可与原密码相同等，当验证正确后发起请求修改密码，请求成功后，调用&#x2F;api&#x2F;auth&#x2F;logout接口退出登录，并跳转页面到index.html；未成功则输出相关信息</strong></p>
</blockquote>
<h3 id="修改个人资料"><a href="#修改个人资料" class="headerlink" title="修改个人资料"></a>修改个人资料</h3><h4 id="后端-持久层-4"><a href="#后端-持久层-4" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<p><strong>与前面一致</strong></p>
</blockquote>
<h4 id="后端-业务层-4"><a href="#后端-业务层-4" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="IUserService-2"><a href="#IUserService-2" class="headerlink" title="IUserService"></a>IUserService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理用户数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户资料</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户新的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">changeInfo</span><span class="params">(Integer uid, String username, User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="UserServiceImpl-2"><a href="#UserServiceImpl-2" class="headerlink" title="UserServiceImpl"></a>UserServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理用户数据的业务层实现类 */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IUserService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changeInfo</span><span class="params">(Integer uid, String username, User user)</span></span><br><span class="line">    &#123;</span><br><span class="line">        JudgeUser(uid, username);</span><br><span class="line">        user.setUid(uid);</span><br><span class="line">        user.setCreatedUser(user.getUsername());</span><br><span class="line">        user.setModifiedUser(user.getUsername());</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        user.setCreatedTime(date);</span><br><span class="line">        user.setModifiedTime(date);</span><br><span class="line">        <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> userMapper.updateById(user);</span><br><span class="line">        <span class="keyword">if</span>(row != <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;更新数据时发生异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>单元测试：略</strong></p>
</blockquote>
<h4 id="后端-控制层-4"><a href="#后端-控制层-4" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="设计请求-4"><a href="#设计请求-4" class="headerlink" title="设计请求"></a>设计请求</h5><blockquote>
<p><strong>请求路径：&#x2F;user&#x2F;change_info</strong></p>
<p><strong>请求参数：HttpSession session，User user</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt; Void &gt;</strong></p>
</blockquote>
<h5 id="UserController-1"><a href="#UserController-1" class="headerlink" title="UserController"></a>UserController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;用户相关接口描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IUserService service;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取用户信息&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于获取用户信息，返回User对象&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 8000, message = &quot;用户未登录&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;get_perInfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;User&gt; <span class="title function_">getPerInfo</span><span class="params">(HttpSession session)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">        <span class="type">User</span> <span class="variable">temp</span> <span class="operator">=</span> service.getByUid(uid);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUsername(temp.getUsername());</span><br><span class="line">        user.setPhone(temp.getPhone());</span><br><span class="line">        user.setEmail(temp.getEmail());</span><br><span class="line">        user.setGender(temp.getGender());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@ApiOperation(value = &quot;修改用户资料&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户修改个人资料&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 4001, message = &quot;数据更新失败&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 8000, message = &quot;用户未登录&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;change_info&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">changeInfo</span><span class="params">(HttpSession session, <span class="meta">@RequestBody</span> User user)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">        service.changeInfo(uid, username, user);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口测试：略</strong></p>
</blockquote>
<h4 id="前端界面-3"><a href="#前端界面-3" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<p><strong>页面开始先加载个人信息，然后校验用户输入的数据格式是否正确，最后发起请求，请求成功则跳转到修改个人资料页面；未成功则输出相关信息</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    $(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title function_">getUserData</span>()</span><br><span class="line">    &#125;)    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getUserData</span>(<span class="params"></span>)&#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            url : <span class="string">&quot;/user/get_perInfo&quot;</span> ,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                    $(<span class="string">&quot;#name&quot;</span>).<span class="title function_">val</span>(json.<span class="property">data</span>.<span class="property">username</span>) <span class="comment">//修改用户名</span></span><br><span class="line">                    $(<span class="string">&quot;#phone&quot;</span>).<span class="title function_">val</span>(json.<span class="property">data</span>.<span class="property">phone</span>) <span class="comment">//修改电话</span></span><br><span class="line">                    $(<span class="string">&quot;#email&quot;</span>).<span class="title function_">val</span>(json.<span class="property">data</span>.<span class="property">email</span>) <span class="comment">//修改邮箱</span></span><br><span class="line">                    <span class="comment">//修改性别</span></span><br><span class="line">                    <span class="keyword">let</span> gender = json.<span class="property">data</span>.<span class="property">gender</span> === <span class="number">0</span> ? $(<span class="string">&quot;#gender-female&quot;</span>) : $(<span class="string">&quot;#gender-male&quot;</span>);</span><br><span class="line">                    gender.<span class="title function_">prop</span>(<span class="string">&quot;checked&quot;</span>,<span class="string">&quot;checked&quot;</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="title function_">confirm</span>(json.<span class="property">state</span> + <span class="string">&quot;: &quot;</span> +json.<span class="property">message</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                <span class="title function_">error</span>(xhr)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> erms = $(<span class="string">&quot;#error-msg&quot;</span>)</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">judgePhone</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> ans = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">let</span> phone = $(<span class="string">&quot;#phone&quot;</span>).<span class="title function_">val</span>()</span><br><span class="line">        <span class="keyword">let</span> regex = <span class="regexp">/^1(?:3\d|4[4-9]|5[0-35-9]|6[67]|7[013-8]|8\d|9\d)\d&#123;8&#125;$/</span></span><br><span class="line">        <span class="keyword">if</span>(!regex.<span class="title function_">test</span>(phone))&#123;</span><br><span class="line">            <span class="title function_">setInfo</span>(<span class="string">&quot;请输入正确的号码格式&quot;</span>, erms)</span><br><span class="line">            ans = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">judgeEmail</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> regex = <span class="regexp">/[a-zA-Z0-9]+([-_.][A-Za-zd]+)*@([a-zA-Z0-9]+[-.])+[A-Za-zd]&#123;2,5&#125;$/</span></span><br><span class="line">        <span class="keyword">let</span> ans = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">let</span> email = $(<span class="string">&quot;#email&quot;</span>).<span class="title function_">val</span>()</span><br><span class="line">        <span class="keyword">if</span>(!regex.<span class="title function_">test</span>(email))&#123;</span><br><span class="line">            <span class="title function_">setInfo</span>(<span class="string">&quot;请输入正确的邮箱格式&quot;</span>, erms)</span><br><span class="line">            ans = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">changeInfo</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_">judgePhone</span>() === <span class="literal">true</span> &amp;&amp; <span class="title function_">judgeEmail</span>() === <span class="literal">true</span>)&#123;</span><br><span class="line">            $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">                <span class="attr">url</span>: <span class="string">&quot;/user/change_info&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">                <span class="attr">data</span>: $(<span class="string">&quot;#form-change-info&quot;</span>).<span class="title function_">serialize</span>(), <span class="comment">// 将表单中带有name属性的标签的值序列化</span></span><br><span class="line">                <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">                <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                        <span class="title function_">confirm</span>(<span class="string">&quot;个人资料修改成功&quot;</span>)</span><br><span class="line">                        location.<span class="property">href</span>= <span class="string">&quot;userdata.html&quot;</span></span><br><span class="line">                    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="title function_">confirm</span>(json.<span class="property">state</span> + <span class="string">&quot;: &quot;</span> + json.<span class="property">message</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                    <span class="title function_">error</span>(xhr)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;#btn-change-info&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title function_">changeInfo</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/scripy&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="上传头像"><a href="#上传头像" class="headerlink" title="上传头像"></a>上传头像</h3><h4 id="后端-持久层-5"><a href="#后端-持久层-5" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<p><strong>与前面一致</strong></p>
</blockquote>
<h4 id="后端-业务层-5"><a href="#后端-业务层-5" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="IUserService-3"><a href="#IUserService-3" class="headerlink" title="IUserService"></a>IUserService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理用户数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户头像</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> avatar 用户新头像的路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">changeAvatar</span><span class="params">(Integer uid, String username, String avatar)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="UserService"><a href="#UserService" class="headerlink" title="UserService"></a>UserService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理用户数据的业务层实现类 */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IUserService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserMapper userMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changeAvatar</span><span class="params">(Integer uid, String username, String avatar)</span></span><br><span class="line">    &#123;</span><br><span class="line">        JudgeUser(uid, username);</span><br><span class="line">        LambdaUpdateWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(User::getUid, uid)</span><br><span class="line">               .set(User::getAvatar, avatar);</span><br><span class="line">        <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> userMapper.update(<span class="literal">null</span>, wrapper);</span><br><span class="line">        <span class="keyword">if</span>(row != <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;更新数据时发生异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>单元测试：略</strong></p>
</blockquote>
<h4 id="后端-控制层-5"><a href="#后端-控制层-5" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="请求设计"><a href="#请求设计" class="headerlink" title="请求设计"></a>请求设计</h5><blockquote>
<p><strong>请求路径：&#x2F;user&#x2F;change_avatar</strong></p>
<p><strong>请求参数：HttpSession session，MultipartFile file</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt; String &gt;</strong></p>
</blockquote>
<h5 id="UserController-2"><a href="#UserController-2" class="headerlink" title="UserController"></a>UserController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;用户相关接口描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/** 头像文件大小的上限值(10MB) */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">AVATAR_MAX_SIZE</span> <span class="operator">=</span> <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line">    <span class="comment">/** 允许上传的头像的文件类型 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; AVATAR_TYPES = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;()&#123;&#123;</span><br><span class="line">        add(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line">        add(<span class="string">&quot;image/jpg&quot;</span>);</span><br><span class="line">        add(<span class="string">&quot;image/png&quot;</span>);</span><br><span class="line">        add(<span class="string">&quot;image/bmp&quot;</span>);</span><br><span class="line">        add(<span class="string">&quot;image/gif&quot;</span>);</span><br><span class="line">    &#125;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;web.upload-path&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String uploadPath;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;修改用户头像&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户上传个人头像，返回新头像的路径&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 4001, message = &quot;数据更新失败&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 7001, message = &quot;文件为空&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 7002, message = &quot;文件大小超出限制&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 7003, message = &quot;文件类型不正确&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 7004, message = &quot;文件状态异常&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 7005, message = &quot;文件上传失败&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 8000, message = &quot;用户未登录&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;file&quot;, value = &quot;头像文件&quot;, required = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;change_avatar&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;String&gt; <span class="title function_">changeAvatar</span><span class="params">(HttpSession session, MultipartFile file)</span> <span class="comment">// 后端接收文件类型用MultipartFile</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">        <span class="keyword">if</span>(Objects.isNull(file))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileEmptyException</span>(<span class="string">&quot;文件为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(file.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileEmptyException</span>(<span class="string">&quot;文件不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(file.getSize() &gt; AVATAR_MAX_SIZE)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileSizeException</span>(<span class="string">&quot;上传文件不能超过&quot;</span> + (AVATAR_MAX_SIZE / <span class="number">1024</span>) + <span class="string">&quot;KB&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!AVATAR_TYPES.contains(file.getContentType()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileTypeException</span>(<span class="string">&quot;不支持该文件类型&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        String parent = session.getServletContext().getRealPath(&quot;upload&quot;) + &#x27;\\&#x27; + username;</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">parent</span> <span class="operator">=</span> uploadPath + username;</span><br><span class="line"></span><br><span class="line">        <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(parent);</span><br><span class="line">        <span class="keyword">if</span>(!dir.exists())&#123;</span><br><span class="line">            dir.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 保存的头像文件的文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isBlank(originalFilename)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileTypeException</span>(<span class="string">&quot;文件类型异常&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> originalFilename.substring(index); <span class="comment">// 获取文件后缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> UUID.randomUUID().toString() + suffix;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建文件对象，表示保存的头像文件</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">dest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dir, filename);</span><br><span class="line">        <span class="comment">// 执行保存头像文件</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            file.transferTo(dest);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalStateException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileStateException</span>(<span class="string">&quot;文件状态异常，可能文件已被移动或删除&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileUploadIOException</span>(<span class="string">&quot;上传文件时读写错误，请稍后重新尝试&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 头像路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">avatar</span> <span class="operator">=</span> <span class="string">&quot;/upload/&quot;</span> + username + File.separator + filename;</span><br><span class="line">        <span class="comment">// 从Session中获取uid和username</span></span><br><span class="line">        <span class="comment">// 将头像写入到数据库中</span></span><br><span class="line">        service.changeAvatar(uid, username, avatar);</span><br><span class="line">        session.setAttribute(<span class="string">&quot;avatar&quot;</span>, avatar); <span class="comment">// 更新session中的头像文件</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, avatar);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="MvcConfig"><a href="#MvcConfig" class="headerlink" title="MvcConfig"></a>MvcConfig</h5><blockquote>
<p><strong>映射静态资源路径</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;web.upload-path&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String uploadPath;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 映射静态资源路径</span></span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/upload/**&quot;</span>) <span class="comment">// 映射用户头像路径</span></span><br><span class="line">                .addResourceLocations(<span class="string">&quot;file:&quot;</span> + uploadPath);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/web/**&quot;</span>)</span><br><span class="line">                .addResourceLocations(<span class="string">&quot;classpath:/static/web/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/static/**&quot;</span>)</span><br><span class="line">                .addResourceLocations(<span class="string">&quot;classpath:/static/static/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/swagger-ui.html&quot;</span>) <span class="comment">// swagger配置静态资源映射</span></span><br><span class="line">                .addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>)</span><br><span class="line">                .addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口测试：略</strong></p>
</blockquote>
<h4 id="前端界面-4"><a href="#前端界面-4" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">   	$(function ()&#123;</span><br><span class="line">           $.get(<span class="string">&#x27;/api/user/info&#x27;</span>, function (json)&#123;</span><br><span class="line">               <span class="keyword">if</span>(json.state === <span class="number">200</span>)&#123;</span><br><span class="line">                   $(<span class="string">&quot;#img-avatar&quot;</span>).prop(<span class="string">&quot;src&quot;</span>, json.data.avatar)</span><br><span class="line">               &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                   confirm(json.state + <span class="string">&quot;: &quot;</span> + json.message)</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">       &#125;);</span><br><span class="line">    </span><br><span class="line">       $(<span class="string">&quot;#btn-upload&quot;</span>).click(function ()&#123;</span><br><span class="line">           $.ajax(&#123;</span><br><span class="line">               url: <span class="string">&quot;/user/change_avatar&quot;</span>,</span><br><span class="line">               type: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">               data: <span class="keyword">new</span> <span class="title class_">FormData</span>($(<span class="string">&quot;#form-change-avatar&quot;</span>)[<span class="number">0</span>]), <span class="comment">// 选择表单的第一个元素，通常用来传文件</span></span><br><span class="line">               processData: <span class="literal">false</span>, <span class="comment">// 关闭默认以字符串处理数据</span></span><br><span class="line">               contentType: <span class="literal">false</span>, <span class="comment">// 关闭默认以字符串发送数据</span></span><br><span class="line">               dataType: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">               success: function (json) &#123;</span><br><span class="line">                   <span class="keyword">if</span>(json.state === <span class="number">200</span>)&#123;</span><br><span class="line">                       confirm(<span class="string">&quot;上传成功&quot;</span>)</span><br><span class="line">                           $(<span class="string">&quot;#img-avatar&quot;</span>).attr(<span class="string">&quot;src&quot;</span>, json.data)</span><br><span class="line">                   &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                       confirm(json.state + <span class="string">&quot;:&quot;</span> + json.message)</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;,</span><br><span class="line">               error: function (xhr)&#123;</span><br><span class="line">                   error(xhr)</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">       &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>如果将文件保存在tomcat中，那么项目每次重启都会创建一个新的临时目录，通过静态资源映射已解决</strong></p>
</blockquote>
</blockquote>
<h2 id="地址管理"><a href="#地址管理" class="headerlink" title="地址管理"></a>地址管理</h2><h3 id="创建数据表-1"><a href="#创建数据表-1" class="headerlink" title="创建数据表"></a>创建数据表</h3><blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `address`  (</span><br><span class="line">      `aid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;收货地址id&#x27;</span>,</span><br><span class="line">      `uid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;归属的用户id&#x27;</span>,</span><br><span class="line">      `name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收货人姓名&#x27;</span>,</span><br><span class="line">      `province_name` <span class="type">varchar</span>(<span class="number">15</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;省-名称&#x27;</span>,</span><br><span class="line">      `province_code` <span class="type">char</span>(<span class="number">6</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;省-行政代号&#x27;</span>,</span><br><span class="line">      `city_name` <span class="type">varchar</span>(<span class="number">15</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;市-名称&#x27;</span>,</span><br><span class="line">      `city_code` <span class="type">char</span>(<span class="number">6</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;市-行政代号&#x27;</span>,</span><br><span class="line">      `area_name` <span class="type">varchar</span>(<span class="number">15</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;区-名称&#x27;</span>,</span><br><span class="line">      `area_code` <span class="type">char</span>(<span class="number">6</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;区-行政代号&#x27;</span>,</span><br><span class="line">      `zip` <span class="type">char</span>(<span class="number">6</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;邮政编码&#x27;</span>,</span><br><span class="line">      `address` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;详细地址&#x27;</span>,</span><br><span class="line">      `phone` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;手机&#x27;</span>,</span><br><span class="line">      `tel` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;固话&#x27;</span>,</span><br><span class="line">      `tag` <span class="type">varchar</span>(<span class="number">6</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;标签&#x27;</span>,</span><br><span class="line">      `is_default` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;是否默认：0-不默认，1-默认&#x27;</span>,</span><br><span class="line">      `created_user` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">      `created_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">      `modified_user` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">      `modified_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">      <span class="keyword">PRIMARY</span> KEY (`aid`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">7</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> Compact;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="创建实体类-1"><a href="#创建实体类-1" class="headerlink" title="创建实体类"></a>创建实体类</h3><blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="comment">/* 收货地址数据的实体类 */</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;地址实体类：Address&quot;, description = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;对应数据库中的address表&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> </span><br><span class="line">&#123;</span><br><span class="line">        <span class="meta">@TableId(value = &quot;aid&quot;, type = IdType.AUTO)</span></span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;地址ID&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer aid;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;用户ID&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer uid;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;收货人姓名&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;省-名称&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String provinceName;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;省-行政代号&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String provinceCode;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;市-名称&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String cityName;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;市-行政代号&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String cityCode;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;区-名称&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String areaName;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;区-行政代号&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String areaCode;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;邮政编码&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String zip;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;详细地址&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String address;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;电话&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String phone;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;固话&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String tel;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;标签&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String tag;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;是否为默认地址，1-默认，0-非默认&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer isDefault;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="添加收货地址"><a href="#添加收货地址" class="headerlink" title="添加收货地址"></a>添加收货地址</h3><h4 id="后端-持久层-6"><a href="#后端-持久层-6" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<h5 id="AddressMapper"><a href="#AddressMapper" class="headerlink" title="AddressMapper"></a>AddressMapper</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理收货地址操作的持久层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AddressMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Address&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="DistrictMapper"><a href="#DistrictMapper" class="headerlink" title="DistrictMapper"></a>DistrictMapper</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理省市区操作的持久层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DistrictMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;District&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>在收货地址中需要用到省市区的信息</strong></p>
</blockquote>
</blockquote>
<h4 id="后端-业务层-6"><a href="#后端-业务层-6" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="IDistrictService"><a href="#IDistrictService" class="headerlink" title="IDistrictService"></a>IDistrictService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理省市区数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IDistrictService</span></span><br><span class="line">&#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据父代号获取省市区信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parent 父代号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 省市区信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;District&gt; <span class="title function_">getByParent</span><span class="params">(String parent)</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据自身代号获取省市区名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code 自身代号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 省市区名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getNameByCode</span><span class="params">(String code)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="DistrictService"><a href="#DistrictService" class="headerlink" title="DistrictService"></a>DistrictService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DistrictServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IDistrictService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    DistrictMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;District&gt; <span class="title function_">getByParent</span><span class="params">(String parent)</span></span><br><span class="line">    &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;District&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(District::getParent, parent);</span><br><span class="line">        List&lt;District&gt; list = mapper.selectList(wrapper);</span><br><span class="line">        list.forEach(district -&gt; &#123;</span><br><span class="line">            district.setParent(<span class="literal">null</span>);</span><br><span class="line">            district.setId(<span class="literal">null</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getNameByCode</span><span class="params">(String code)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">final</span> LambdaQueryWrapper&lt;District&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.select(District::getName)</span><br><span class="line">               .eq(District::getCode, code);</span><br><span class="line">        <span class="type">District</span> <span class="variable">district</span> <span class="operator">=</span> mapper.selectOne(wrapper);</span><br><span class="line">        <span class="keyword">if</span>(Objects.isNull(district.getName())) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceException</span>(<span class="string">&quot;无法获取省市区名称&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> district.getName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="IAddressService"><a href="#IAddressService" class="headerlink" title="IAddressService"></a>IAddressService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理收货地址数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IAddressService</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加收货地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> address 收货地址数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addAddress</span><span class="params">(Integer uid, String username, Address address)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="AddressService"><a href="#AddressService" class="headerlink" title="AddressService"></a>AddressService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IAddressService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IUserService userService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AddressMapper mapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IDistrictService districtService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;user.address.max-size&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> ADDRESS_MAX_SIZE; <span class="comment">// 最大收货地址条数</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addAddress</span><span class="params">(Integer uid, String username, Address address)</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        LambdaQueryWrapper&lt;Address&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(Address::getUid, uid)</span><br><span class="line">               .eq(Address::getUid, uid);</span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> Math.toIntExact(mapper.selectCount(wrapper));</span><br><span class="line">        <span class="keyword">if</span>(size &gt;= ADDRESS_MAX_SIZE) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AddressCountLimitException</span>(<span class="string">&quot;达到收货地址最大条数&quot;</span>);</span><br><span class="line">        address.setUid(uid);</span><br><span class="line">        address.setIsDefault((size == <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>)); <span class="comment">// 1表示默认，0表示不默认</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">provinceCode</span> <span class="operator">=</span> address.getProvinceCode();</span><br><span class="line">        <span class="type">String</span> <span class="variable">areaCode</span> <span class="operator">=</span> address.getAreaCode();</span><br><span class="line">        <span class="type">String</span> <span class="variable">cityCode</span> <span class="operator">=</span> address.getCityCode();</span><br><span class="line">        address.setProvinceName(districtService.getNameByCode(provinceCode));</span><br><span class="line">        address.setAreaName(districtService.getNameByCode(areaCode));</span><br><span class="line">        address.setCityName(districtService.getNameByCode(cityCode));</span><br><span class="line">        address.setCreatedUser(username);</span><br><span class="line">        address.setModifiedUser(username);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        address.setCreatedTime(date);</span><br><span class="line">        address.setModifiedTime(date);</span><br><span class="line">        <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> mapper.insert(address);</span><br><span class="line">        <span class="keyword">if</span>(rows != <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;插入时产生未知异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>如果插入的收货地址是该用户的第一条收货地址那么就将其设为默认地址</strong></p>
</blockquote>
</blockquote>
<h4 id="后端-控制层-6"><a href="#后端-控制层-6" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="请求设计-1"><a href="#请求设计-1" class="headerlink" title="请求设计"></a>请求设计</h5><blockquote>
<p><strong>请求路径：&#x2F;address&#x2F;add_address</strong></p>
<p><strong>请求参数：HttpSession session，Address address</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt; Void &gt;</strong></p>
</blockquote>
<h4 id="AddressController"><a href="#AddressController" class="headerlink" title="AddressController"></a>AddressController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/address&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;收货地址接口相关描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IAddressService addressService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;添加收货地址&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户添加收货地址&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 4000, message = &quot;数据插入失败&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 6001, message = &quot;地址数量已超限制&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 8000, message = &quot;用户未登录&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;address&quot;, value = &quot;Address对象&quot;, required = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;add_address&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">addAddress</span><span class="params">(HttpSession session, Address address)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">        addressService.addAddress(uid, username, address);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="请求设计-2"><a href="#请求设计-2" class="headerlink" title="请求设计"></a>请求设计</h5><blockquote>
<p><strong>请求路径：&#x2F;districts</strong></p>
<p><strong>请求参数：String parent</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：List&lt; District &gt;</strong></p>
</blockquote>
<h5 id="DistrictController"><a href="#DistrictController" class="headerlink" title="DistrictController"></a>DistrictController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/districts&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;城市名称相关接口描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DistrictController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IDistrictService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取城市名称&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于获取城市名称，返回List&lt;District&gt;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;parent&quot;, value = &quot;城市父代码&quot;, required = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&#123;&quot;/&quot;, &quot;&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;List&lt;District&gt;&gt; <span class="title function_">getDistricts</span><span class="params">(String parent)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;District&gt; list = service.getByParent(parent);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口测试：略</strong></p>
</blockquote>
<h4 id="前端界面-5"><a href="#前端界面-5" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"><span class="keyword">let</span> defaultOption = <span class="string">&#x27;&lt;option value=&quot;0&quot;&gt;----- 请选择 -----&lt;/option&gt;&#x27;</span></span><br><span class="line">       $(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">           <span class="title function_">showProvinceList</span>()</span><br><span class="line">           cityList.<span class="title function_">append</span>(defaultOption)</span><br><span class="line">           areaList.<span class="title function_">append</span>(defaultOption)</span><br><span class="line">       &#125;)</span><br><span class="line"></span><br><span class="line">       <span class="keyword">let</span> proList = $(<span class="string">&quot;#province-list&quot;</span>)</span><br><span class="line">       <span class="keyword">let</span> cityList = $(<span class="string">&quot;#city-list&quot;</span>)</span><br><span class="line">       <span class="keyword">let</span> areaList = $(<span class="string">&quot;#area-list&quot;</span>)</span><br><span class="line"></span><br><span class="line">       proList.<span class="title function_">change</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">           <span class="title function_">showCityList</span>()</span><br><span class="line">       &#125;)</span><br><span class="line"></span><br><span class="line">       cityList.<span class="title function_">change</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">           <span class="title function_">showAreaList</span>()</span><br><span class="line">       &#125;)</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">showProvinceList</span>(<span class="params"></span>)&#123;</span><br><span class="line">           proList.<span class="title function_">append</span>(defaultOption)</span><br><span class="line">           <span class="keyword">let</span> parent = <span class="number">86</span></span><br><span class="line">           $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">               <span class="attr">url</span>: <span class="string">&quot;/districts&quot;</span>,</span><br><span class="line">               <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">               <span class="attr">data</span>: &#123;</span><br><span class="line">                   <span class="string">&quot;parent&quot;</span>: parent</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">               <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>)&#123;</span><br><span class="line">                   <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                       <span class="keyword">let</span> list = json.<span class="property">data</span></span><br><span class="line">                       <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++)&#123;</span><br><span class="line">                           <span class="keyword">let</span> opt = <span class="string">&#x27;&lt;option value=&quot;&#x27;</span>+list[i].<span class="property">code</span>+<span class="string">&#x27;&quot;&gt;&#x27;</span>+list[i].<span class="property">name</span>+<span class="string">&#x27;&lt;/option&gt;&#x27;</span></span><br><span class="line">                           proList.<span class="title function_">append</span>(opt)</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">showCityList</span>(<span class="params"></span>)&#123;</span><br><span class="line">           <span class="keyword">let</span> parent = proList.<span class="title function_">val</span>()</span><br><span class="line">           cityList.<span class="title function_">empty</span>()</span><br><span class="line">           areaList.<span class="title function_">empty</span>()</span><br><span class="line">           cityList.<span class="title function_">append</span>(defaultOption)</span><br><span class="line">           areaList.<span class="title function_">append</span>(defaultOption)</span><br><span class="line">           <span class="keyword">if</span>(parent === <span class="number">0</span>)&#123;</span><br><span class="line">               <span class="keyword">return</span> ;</span><br><span class="line">           &#125;</span><br><span class="line">           $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">               <span class="attr">url</span>: <span class="string">&quot;/districts&quot;</span>,</span><br><span class="line">               <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">               <span class="attr">data</span>: &#123;</span><br><span class="line">                   <span class="string">&quot;parent&quot;</span>: parent</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">               <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>)&#123;</span><br><span class="line">                   <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                       <span class="keyword">let</span> list = json.<span class="property">data</span></span><br><span class="line">                       <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++)&#123;</span><br><span class="line">                           <span class="keyword">let</span> opt = <span class="string">&#x27;&lt;option value=&quot;&#x27;</span>+list[i].<span class="property">code</span>+<span class="string">&#x27;&quot;&gt;&#x27;</span>+list[i].<span class="property">name</span>+<span class="string">&#x27;&lt;/option&gt;&#x27;</span></span><br><span class="line">                           cityList.<span class="title function_">append</span>(opt)</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">showAreaList</span>(<span class="params"></span>)&#123;</span><br><span class="line">           <span class="keyword">let</span> parent = cityList.<span class="title function_">val</span>()</span><br><span class="line">           areaList.<span class="title function_">empty</span>()</span><br><span class="line">           areaList.<span class="title function_">append</span>(defaultOption)</span><br><span class="line">           <span class="keyword">if</span>(parent === <span class="number">0</span>)&#123;</span><br><span class="line">               <span class="keyword">return</span> ;</span><br><span class="line">           &#125;</span><br><span class="line">           $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">               <span class="attr">url</span>: <span class="string">&quot;/districts&quot;</span>,</span><br><span class="line">               <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">               <span class="attr">data</span>: &#123;</span><br><span class="line">                   <span class="string">&quot;parent&quot;</span>: parent</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">               <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>)&#123;</span><br><span class="line">                   <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                       <span class="keyword">let</span> list = json.<span class="property">data</span></span><br><span class="line">                       <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++)&#123;</span><br><span class="line">                           <span class="keyword">let</span> opt = <span class="string">&#x27;&lt;option value=&quot;&#x27;</span>+list[i].<span class="property">code</span>+<span class="string">&#x27;&quot;&gt;&#x27;</span>+list[i].<span class="property">name</span>+<span class="string">&#x27;&lt;/option&gt;&#x27;</span></span><br><span class="line">                           areaList.<span class="title function_">append</span>(opt)</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       $(<span class="string">&quot;#btn-add-new-address&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">           $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">               <span class="attr">url</span>: <span class="string">&quot;/address/add_address&quot;</span>,</span><br><span class="line">               <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">               <span class="attr">data</span>: $(<span class="string">&quot;#form-add-new-address&quot;</span>).<span class="title function_">serialize</span>(),</span><br><span class="line">               <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">               <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">                   <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                       <span class="title function_">alert</span>(<span class="string">&quot;新增收货地址成功&quot;</span>)</span><br><span class="line">                       location.<span class="property">href</span>=<span class="string">&quot;addAddress.html&quot;</span></span><br><span class="line">                   &#125;</span><br><span class="line">                   <span class="keyword">else</span>&#123;</span><br><span class="line">                       <span class="title function_">alert</span>(<span class="string">&quot;新增收货地址失败: &quot;</span> + json.<span class="property">message</span>)</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">       &#125;)</span><br><span class="line">&lt;/script&gt;    </span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>在增加收货地址页，主要是省市区信息显示</strong></p>
</blockquote>
</blockquote>
<h3 id="设置默认收货地址"><a href="#设置默认收货地址" class="headerlink" title="设置默认收货地址"></a>设置默认收货地址</h3><h4 id="后端-持久层-7"><a href="#后端-持久层-7" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<h5 id="AddressMapper-1"><a href="#AddressMapper-1" class="headerlink" title="AddressMapper"></a>AddressMapper</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理收货地址操作的持久层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AddressMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Address&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="后端-业务层-7"><a href="#后端-业务层-7" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="IAddressService-1"><a href="#IAddressService-1" class="headerlink" title="IAddressService"></a>IAddressService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理收货地址数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IAddressService</span></span><br><span class="line">&#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取收货地址列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回收货地址列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Address&gt; <span class="title function_">getAddressList</span><span class="params">(Integer uid, String username)</span>;</span><br><span class="line">    </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置默认收货地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> aid 收货地址id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setDefault</span><span class="params">(Integer aid, Integer uid, String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="AddressServiceImpl"><a href="#AddressServiceImpl" class="headerlink" title="AddressServiceImpl"></a>AddressServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IAddressService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IUserService userService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AddressMapper mapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Address&gt; <span class="title function_">getAddressList</span><span class="params">(Integer uid, String username)</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        LambdaQueryWrapper&lt;Address&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//noinspection unchecked</span></span><br><span class="line">        wrapper.select(Address::getName, Address::getAddress,</span><br><span class="line">                       Address::getTag, Address::getPhone,</span><br><span class="line">                       Address::getCityName, Address::getAreaName, Address::getAid, Address::getProvinceName)</span><br><span class="line">               .eq(Address::getUid, uid)</span><br><span class="line">               .orderByDesc(Address::getIsDefault, Address::getCreatedTime); <span class="comment">// is_default为1表示默认，降序排序，没有默认就按创建时间排序</span></span><br><span class="line">        <span class="keyword">return</span> mapper.selectList(wrapper);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span> <span class="comment">// 开启事务</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDefault</span><span class="params">(Integer aid, Integer uid, String username)</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> mapper.selectById(aid);</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(address)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AddressNotFoundException</span>(<span class="string">&quot;收获地址不存在&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!address.getUid().equals(uid)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AccessDeniedException</span>(<span class="string">&quot;非法数据访问&quot;</span>);</span><br><span class="line">        LambdaUpdateWrapper&lt;Address&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 将该用户所有收货地址设为非默认</span></span><br><span class="line">        wrapper.set(Address::getIsDefault, <span class="number">0</span>)</span><br><span class="line">               .eq(Address::getUid, uid);</span><br><span class="line">        <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> mapper.update(<span class="literal">null</span>, wrapper);</span><br><span class="line">        <span class="keyword">if</span>(rows &lt; <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;更新数据时产生未知异常&quot;</span>);</span><br><span class="line">        address.setIsDefault(<span class="number">1</span>); <span class="comment">// 将选中的收获地址设为默认</span></span><br><span class="line">        address.setModifiedUser(username);</span><br><span class="line">        address.setModifiedTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> mapper.updateById(address);</span><br><span class="line">        <span class="keyword">if</span>(row &lt; <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;更新数据时产生未知异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="后端-控制层-7"><a href="#后端-控制层-7" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="请求设计-3"><a href="#请求设计-3" class="headerlink" title="请求设计"></a>请求设计</h5><blockquote>
<p><strong>请求路径：&#x2F;address&#x2F;set_default</strong></p>
<p><strong>请求参数：HttpSession session，Integer aid</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt; Void &gt;</strong></p>
</blockquote>
<h5 id="AddressController-1"><a href="#AddressController-1" class="headerlink" title="AddressController"></a>AddressController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/address&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;收货地址接口相关描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;设置默认收货地址&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户设置默认收货地址&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 4001, message = &quot;数据更新失败&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 6002, message = &quot;地址不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 6003, message = &quot;非法数据访问&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 8000, message = &quot;用户未登录&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;aid&quot;, value = &quot;地址ID&quot;, required = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;set_default&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">setDefault</span><span class="params">(HttpSession session, Integer aid)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">        addressService.setDefault(aid, uid, username);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口测试：略</strong></p>
</blockquote>
<h4 id="前端界面-6"><a href="#前端界面-6" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<p><strong>设置默认收货地址后，重新显示收货地址列表</strong></p>
</blockquote>
<h3 id="删除收货地址"><a href="#删除收货地址" class="headerlink" title="删除收货地址"></a>删除收货地址</h3><h4 id="后端-持久层-8"><a href="#后端-持久层-8" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<p><strong>与前面一致</strong></p>
</blockquote>
<h4 id="后端-业务层-8"><a href="#后端-业务层-8" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="IAddressService-2"><a href="#IAddressService-2" class="headerlink" title="IAddressService"></a>IAddressService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理收货地址数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IAddressService</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除收货地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> aid 收货地址id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delAddress</span><span class="params">(Integer aid, Integer uid, String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="AddressServiceImpl-1"><a href="#AddressServiceImpl-1" class="headerlink" title="AddressServiceImpl"></a>AddressServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IAddressService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IUserService userService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AddressMapper mapper;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delAddress</span><span class="params">(Integer aid, Integer uid, String username)</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> mapper.selectById(aid);</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(address)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AddressNotFoundException</span>(<span class="string">&quot;收获地址不存在&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!address.getUid().equals(uid)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AccessDeniedException</span>(<span class="string">&quot;非法数据访问&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">status</span> <span class="operator">=</span> address.getIsDefault();</span><br><span class="line">        <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> mapper.deleteById(aid);</span><br><span class="line">        <span class="keyword">if</span>(row &lt; <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeleteException</span>(<span class="string">&quot;删除数据时产生未知异常&quot;</span>);</span><br><span class="line">        LambdaQueryWrapper&lt;Address&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(Address::getUid, uid);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> mapper.selectCount(wrapper);</span><br><span class="line">        <span class="keyword">if</span>(count == <span class="number">0</span>) <span class="keyword">return</span> ; <span class="comment">// 如果已经没有收货地址，返回空</span></span><br><span class="line">        <span class="keyword">if</span>(status == <span class="number">1</span>)&#123; <span class="comment">// 如果删除的这条收货地址为默认收货地址</span></span><br><span class="line">            wrapper.clear();</span><br><span class="line">            <span class="comment">//noinspection unchecked</span></span><br><span class="line">            wrapper.eq(Address::getUid, uid)</span><br><span class="line">                   .orderByDesc(Address::getModifiedTime)</span><br><span class="line">                   .last(<span class="string">&quot;limit 1&quot;</span>); <span class="comment">// 将最新修改的第一条收货地址设为默认地址</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">aid1</span> <span class="operator">=</span> mapper.selectOne(wrapper).getAid();</span><br><span class="line">            setDefault(aid1, uid, username);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="后端-控制层-8"><a href="#后端-控制层-8" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="请求设计-4"><a href="#请求设计-4" class="headerlink" title="请求设计"></a>请求设计</h5><blockquote>
<p><strong>请求路径：&#x2F;address&#x2F;del_address</strong></p>
<p><strong>请求参数：HttpSession session，Integer aid</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt; Void &gt;</strong></p>
</blockquote>
<h5 id="AddressController-2"><a href="#AddressController-2" class="headerlink" title="AddressController"></a>AddressController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/address&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;收货地址接口相关描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IAddressService addressService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除收货地址&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户删除收货地址&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 4002, message = &quot;数据删除失败&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 6002, message = &quot;地址不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 6003, message = &quot;非法数据访问&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 8000, message = &quot;用户未登录&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;aid&quot;, value = &quot;地址ID&quot;, required = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;del_address&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">delAddress</span><span class="params">(HttpSession session, Integer aid)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">        addressService.delAddress(aid, uid, username);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口测试：略</strong></p>
</blockquote>
<h4 id="前端界面-7"><a href="#前端界面-7" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<p><strong>删除收货地址后，重新显示收货地址列表</strong></p>
</blockquote>
<h3 id="修改收货地址"><a href="#修改收货地址" class="headerlink" title="修改收货地址"></a>修改收货地址</h3><h4 id="后端-持久层-9"><a href="#后端-持久层-9" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<p><strong>与前面一致</strong></p>
</blockquote>
<h4 id="后端-业务层-9"><a href="#后端-业务层-9" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="IAddressService-3"><a href="#IAddressService-3" class="headerlink" title="IAddressService"></a>IAddressService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理收货地址数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IAddressService</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取收货地址信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> aid 收货地址id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回收货地址信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Address <span class="title function_">getAddress</span><span class="params">(Integer aid, Integer uid, String username)</span>;</span><br><span class="line">    </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改收货地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> address 收货地址信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">modAddress</span><span class="params">(Integer uid, String username, Address address)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="AddressServiceImpl-2"><a href="#AddressServiceImpl-2" class="headerlink" title="AddressServiceImpl"></a>AddressServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IAddressService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IUserService userService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AddressMapper mapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Address <span class="title function_">getAddress</span><span class="params">(Integer aid, Integer uid, String username)</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> mapper.selectById(aid);</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(address)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AddressNotFoundException</span>(<span class="string">&quot;收获地址不存在&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!address.getUid().equals(uid)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AccessDeniedException</span>(<span class="string">&quot;非法数据访问&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">modAddress</span><span class="params">(Integer uid, String username, Address address)</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        address.setModifiedUser(username);</span><br><span class="line">        address.setModifiedTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> mapper.updateById(address);</span><br><span class="line">        <span class="keyword">if</span>(row &lt; <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;更新数据时产生未知异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>修改收货地址信息前，先要将该收货地址信息显示出来</strong></p>
</blockquote>
</blockquote>
<h4 id="后端-控制层-9"><a href="#后端-控制层-9" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="请求设计-5"><a href="#请求设计-5" class="headerlink" title="请求设计"></a>请求设计</h5><blockquote>
<p><strong>请求路径：&#x2F;address&#x2F;get_address</strong></p>
<p><strong>请求参数：HttpSession session，Integer aid</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt; Address &gt;</strong></p>
</blockquote>
<h5 id="AddressController-3"><a href="#AddressController-3" class="headerlink" title="AddressController"></a>AddressController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/address&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;收货地址接口相关描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="meta">@ApiOperation(value = &quot;获取收货地址&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户获取收货地址&quot;)</span></span><br><span class="line"> <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 6002, message = &quot;地址不存在&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 6003, message = &quot;非法数据访问&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 8000, message = &quot;用户未登录&quot;)</span></span><br><span class="line"><span class="meta"> &#125;)</span></span><br><span class="line"> <span class="meta">@ApiImplicitParam(name = &quot;aid&quot;, value = &quot;地址ID&quot;, required = true)</span></span><br><span class="line"> <span class="meta">@PostMapping(&quot;get_address&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> JsonResult&lt;Address&gt; <span class="title function_">getAddress</span><span class="params">(HttpSession session, Integer aid)</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">     <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">     <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> addressService.getAddress(aid, uid, username);</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, address);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@ApiOperation(value = &quot;修改收货地址&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户修改收货地址&quot;)</span></span><br><span class="line"> <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 4001, message = &quot;数据更新失败&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 8000, message = &quot;用户未登录&quot;)</span></span><br><span class="line"><span class="meta"> &#125;)</span></span><br><span class="line"> <span class="meta">@ApiImplicitParam(name = &quot;address&quot;, value = &quot;Address对象&quot;, required = true)</span></span><br><span class="line"> <span class="meta">@PostMapping(&quot;mod_address&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">modAddress</span><span class="params">(HttpSession session, Address address)</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">     <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">     addressService.modAddress(uid, username, address);</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="前端界面-8"><a href="#前端界面-8" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<p><strong>修改收货地址请求成功后跳转到收货地址显示页面</strong></p>
</blockquote>
<h2 id="商品管理"><a href="#商品管理" class="headerlink" title="商品管理"></a>商品管理</h2><h3 id="创建数据表-2"><a href="#创建数据表-2" class="headerlink" title="创建数据表"></a>创建数据表</h3><blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `product`  (</span><br><span class="line">      `id` <span class="type">int</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品id&#x27;</span>,</span><br><span class="line">      `category_id` <span class="type">int</span>(<span class="number">20</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;分类id&#x27;</span>,</span><br><span class="line">      `item_type` <span class="type">varchar</span>(<span class="number">100</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品系列&#x27;</span>,</span><br><span class="line">      `title` <span class="type">varchar</span>(<span class="number">100</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品标题&#x27;</span>,</span><br><span class="line">      `sell_point` <span class="type">varchar</span>(<span class="number">150</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品卖点&#x27;</span>,</span><br><span class="line">      `price` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品单价&#x27;</span>,</span><br><span class="line">      `num` <span class="type">int</span>(<span class="number">10</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;库存数量&#x27;</span>,</span><br><span class="line">      `image` <span class="type">varchar</span>(<span class="number">500</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;图片路径&#x27;</span>,</span><br><span class="line">      `status` <span class="type">int</span>(<span class="number">1</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;商品状态  1：上架   2：下架   3：删除&#x27;</span>,</span><br><span class="line">      `priority` <span class="type">int</span>(<span class="number">10</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;显示优先级，数字越大优先级越高&#x27;</span>,</span><br><span class="line">      `created_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">      `modified_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;最后修改时间&#x27;</span>,</span><br><span class="line">      `created_user` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">      `modified_user` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;最后修改人&#x27;</span>,</span><br><span class="line">      <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> Compact;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="创建实体类-2"><a href="#创建实体类-2" class="headerlink" title="创建实体类"></a>创建实体类</h3><blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 商品数据的实体类 */</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;商品实体类：Product&quot;, description = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;对应数据库中的product表&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">        <span class="meta">@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span></span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品ID&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer id;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;分类ID&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer categoryId;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品系列&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String itemType;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品标题&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String title;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品卖点&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String sellPoint;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品单价&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Long price;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品数量&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer num;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品图片路径&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String image;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品状态：1-上架，2-下架，3-删除&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer status;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;显示优先级，数字越大优先级越高&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer priority;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="热销商品列表"><a href="#热销商品列表" class="headerlink" title="热销商品列表"></a>热销商品列表</h3><h4 id="后端-持久层-10"><a href="#后端-持久层-10" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<h5 id="ProductMapper"><a href="#ProductMapper" class="headerlink" title="ProductMapper"></a>ProductMapper</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理商品数据操作的持久层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Product&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="后端-业务层-10"><a href="#后端-业务层-10" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="IProductService"><a href="#IProductService" class="headerlink" title="IProductService"></a>IProductService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理商品数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IProductService</span></span><br><span class="line">&#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取热销商品列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page 当前分页的信息，包含页码和每页数据条数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 热销商品列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Product&gt; <span class="title function_">getHotProducts</span><span class="params">(IPage&lt;Product&gt; page)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ProductServiceImpl"><a href="#ProductServiceImpl" class="headerlink" title="ProductServiceImpl"></a>ProductServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IProductService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    ProductMapper mapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    ICollectService collectService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">getHotProducts</span><span class="params">(IPage&lt;Product&gt; page)</span></span><br><span class="line">    &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Product&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 必须是上架的商品</span></span><br><span class="line">        <span class="comment">//noinspection unchecked</span></span><br><span class="line">        wrapper.select(Product::getId, Product::getPrice, Product::getImage, Product::getTitle)</span><br><span class="line">               .eq(Product::getStatus, <span class="number">1</span>)</span><br><span class="line">               .orderByDesc(Product::getPriority); <span class="comment">// 根据优先级进行降序排序</span></span><br><span class="line">        List&lt;Product&gt; list = mapper.selectPage(page, wrapper).getRecords();</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(list)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ProductNotFoundException</span>(<span class="string">&quot;没有商品列表&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="后端-控制层-10"><a href="#后端-控制层-10" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="请求设计-6"><a href="#请求设计-6" class="headerlink" title="请求设计"></a>请求设计</h5><blockquote>
<p><strong>请求路径：&#x2F;product&#x2F;get_hotProducts</strong></p>
<p><strong>请求参数：Long page，Long limit</strong></p>
<p><strong>请求类型：POST</strong></p>
<p>**响应类型：JsonResult&lt;List&lt; Product &gt;&gt; **</p>
</blockquote>
<h4 id="ProductController"><a href="#ProductController" class="headerlink" title="ProductController"></a>ProductController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/product&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;商品相关接口描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IProductService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取热销商品&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于获取热销商品，返回List&lt;Product&gt;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 6004, message = &quot;商品不存在&quot;),</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;page&quot;, value = &quot;页码&quot;, required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;limit&quot;, value = &quot;每页数据条数&quot;, required = true),</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;get_hotProducts&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;List&lt;Product&gt;&gt; <span class="title function_">getHotProducts</span><span class="params">(<span class="meta">@RequestParam(&quot;page&quot;)</span> Long page, <span class="meta">@RequestParam(&quot;limit&quot;)</span> Long limit)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Page&lt;Product&gt; iPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, limit);</span><br><span class="line">        List&lt;Product&gt; list = service.getHotProducts(iPage);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口测试：略</strong></p>
</blockquote>
<h4 id="前端界面-9"><a href="#前端界面-9" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">       <span class="keyword">let</span> page = <span class="number">1</span> <span class="comment">// 设置首页页码</span></span><br><span class="line">       <span class="keyword">let</span> limit = <span class="number">6</span> <span class="comment">// 每页的数据条数</span></span><br><span class="line">       <span class="keyword">let</span> total = <span class="number">48</span> <span class="comment">// 总条数</span></span><br><span class="line"></span><br><span class="line">       $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">           <span class="title function_">showHotProducts</span>()</span><br><span class="line">           <span class="title function_">showNewProducts</span>()</span><br><span class="line">           <span class="title function_">hotPaging</span>()</span><br><span class="line">           <span class="title function_">newPaging</span>()</span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">showList</span>(<span class="params">json, ct</span>)&#123;</span><br><span class="line">           <span class="keyword">let</span> list = json.<span class="property">data</span></span><br><span class="line">           <span class="keyword">if</span>(total &gt; list.<span class="property">length</span>)&#123;</span><br><span class="line">               total = list.<span class="property">length</span></span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++) &#123;</span><br><span class="line">               <span class="keyword">let</span> html = <span class="string">&#x27;&lt;div class=&quot;col-md-12&quot;&gt;&#x27;</span> +</span><br><span class="line">                   <span class="string">&#x27;&lt;div class=&quot;col-md-7 text-row-2&quot;&gt;&lt;a href=&quot;product.html?id=#&#123;id&#125;&quot;&gt;#&#123;title&#125;&lt;/a&gt;&lt;/div&gt;&#x27;</span> +</span><br><span class="line">                   <span class="string">&#x27;&lt;div class=&quot;col-md-2&quot;&gt;￥#&#123;price&#125;&lt;/div&gt;&#x27;</span> +</span><br><span class="line">                   <span class="string">&#x27;&lt;div class=&quot;col-md-3&quot;&gt;&lt;img src=&quot;..#&#123;image&#125;collect.png&quot; class=&quot;img-responsive&quot; /&gt;&lt;/div&gt;&#x27;</span> +</span><br><span class="line">                   <span class="string">&#x27;&lt;/div&gt;&#x27;</span></span><br><span class="line">               html = html.<span class="title function_">replace</span>(<span class="regexp">/#&#123;title&#125;/g</span>, list[i].<span class="property">title</span>)</span><br><span class="line">               html = html.<span class="title function_">replace</span>(<span class="regexp">/#&#123;price&#125;/g</span>, list[i].<span class="property">price</span>)</span><br><span class="line">               html = html.<span class="title function_">replace</span>(<span class="regexp">/#&#123;image&#125;/g</span>, list[i].<span class="property">image</span>)</span><br><span class="line">               html = html.<span class="title function_">replace</span>(<span class="regexp">/#&#123;id&#125;/g</span>, list[i].<span class="property">id</span>)</span><br><span class="line">               ct.<span class="title function_">append</span>(html)</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">showHotProducts</span>(<span class="params"></span>)&#123;</span><br><span class="line">           $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">               <span class="attr">url</span>: <span class="string">&quot;/product/get_hotProducts&quot;</span>,</span><br><span class="line">               <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">               <span class="attr">data</span>: &#123;</span><br><span class="line">                   <span class="string">&quot;page&quot;</span>: page,</span><br><span class="line">                   <span class="string">&quot;limit&quot;</span>: limit</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">               <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">json</span>)&#123;</span><br><span class="line">                   <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                       <span class="keyword">let</span> ct = $(<span class="string">&quot;#hot-list&quot;</span>)</span><br><span class="line">                       <span class="title function_">showList</span>(json, ct)</span><br><span class="line">                   &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                       <span class="title function_">confirm</span>(json.<span class="property">state</span> + <span class="string">&quot;: &quot;</span> + json.<span class="property">message</span>)</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                   <span class="title function_">error</span>(xhr)</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">showNewProducts</span>(<span class="params"></span>)&#123;</span><br><span class="line">           $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">               <span class="attr">url</span>: <span class="string">&quot;/product/get_newProducts&quot;</span>,</span><br><span class="line">               <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">               <span class="attr">data</span>: &#123;</span><br><span class="line">                   <span class="string">&quot;page&quot;</span>: page,</span><br><span class="line">                   <span class="string">&quot;limit&quot;</span>: limit</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">               <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">                   <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                       <span class="keyword">let</span> ct = $(<span class="string">&quot;#new-list&quot;</span>)</span><br><span class="line">                       <span class="title function_">showList</span>(json, ct)</span><br><span class="line">                   &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                       <span class="title function_">confirm</span>(json.<span class="property">state</span> + <span class="string">&quot;: &quot;</span> + json.<span class="property">message</span>)</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                   <span class="title function_">error</span>(xhr)</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">hotPaging</span>(<span class="params"></span>)&#123;</span><br><span class="line">           layui.<span class="title function_">use</span>(<span class="string">&#x27;laypage&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">               <span class="keyword">let</span> laypage = layui.<span class="property">laypage</span></span><br><span class="line">               laypage.<span class="title function_">render</span>(&#123;</span><br><span class="line">                   <span class="attr">elem</span>: <span class="string">&#x27;bar-pages-hot&#x27;</span>,</span><br><span class="line">                   <span class="attr">count</span>: total,</span><br><span class="line">                   <span class="attr">limit</span>: limit,</span><br><span class="line">                   <span class="attr">jump</span>: <span class="keyword">function</span> (<span class="params">obj, first</span>) &#123;</span><br><span class="line">                       <span class="comment">// obj包含了当前分页的所有参数, 比如</span></span><br><span class="line">                       page = obj.<span class="property">curr</span> <span class="comment">// 改变当前页码</span></span><br><span class="line">                       limit = obj.<span class="property">limit</span></span><br><span class="line">                       <span class="keyword">if</span>(!first)&#123;</span><br><span class="line">                           $(<span class="string">&quot;#hot-list&quot;</span>).<span class="title function_">empty</span>()</span><br><span class="line">                           <span class="title function_">showHotProducts</span>() <span class="comment">// 首次不执行</span></span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;)</span><br><span class="line">           &#125;)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">newPaging</span>(<span class="params"></span>)&#123;</span><br><span class="line">           layui.<span class="title function_">use</span>(<span class="string">&#x27;laypage&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">               <span class="keyword">let</span> laypage = layui.<span class="property">laypage</span></span><br><span class="line">               laypage.<span class="title function_">render</span>(&#123;</span><br><span class="line">                   <span class="attr">elem</span>: <span class="string">&#x27;bar-pages-new&#x27;</span>,</span><br><span class="line">                   <span class="attr">count</span>: total,</span><br><span class="line">                   <span class="attr">limit</span>: limit,</span><br><span class="line">                   <span class="attr">jump</span>: <span class="keyword">function</span> (<span class="params">obj, first</span>) &#123;</span><br><span class="line">                       <span class="comment">// obj包含了当前分页的所有参数, 比如</span></span><br><span class="line">                       page = obj.<span class="property">curr</span> <span class="comment">// 改变当前页码</span></span><br><span class="line">                       limit = obj.<span class="property">limit</span></span><br><span class="line">                       <span class="keyword">if</span>(!first)&#123;</span><br><span class="line">                           $(<span class="string">&quot;#new-list&quot;</span>).<span class="title function_">empty</span>()</span><br><span class="line">                           <span class="title function_">showNewProducts</span>() <span class="comment">// 首次不执行</span></span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;)</span><br><span class="line">           &#125;)</span><br><span class="line">       &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>使用laypage.js进行分页</strong></p>
</blockquote>
</blockquote>
<h3 id="新到商品列表"><a href="#新到商品列表" class="headerlink" title="新到商品列表"></a>新到商品列表</h3><blockquote>
<p><strong>与热销商品列表基本一致</strong></p>
</blockquote>
<h3 id="显示商品信息"><a href="#显示商品信息" class="headerlink" title="显示商品信息"></a>显示商品信息</h3><h4 id="后端-持久层-11"><a href="#后端-持久层-11" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<h5 id="ProductMapper-1"><a href="#ProductMapper-1" class="headerlink" title="ProductMapper"></a>ProductMapper</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理商品数据操作的持久层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Product&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="后端-业务层-11"><a href="#后端-业务层-11" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="IProductService-1"><a href="#IProductService-1" class="headerlink" title="IProductService"></a>IProductService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理商品数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IProductService</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据商品id获取商品信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 商品id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 商品信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Product <span class="title function_">getProductById</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ProductServiceImpl-1"><a href="#ProductServiceImpl-1" class="headerlink" title="ProductServiceImpl"></a>ProductServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IProductService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    ProductMapper mapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">getProductById</span><span class="params">(Integer id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Product&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.select(Product::getTitle, Product::getSellPoint, Product::getPrice, Product::getImage)</span><br><span class="line">               .eq(Product::getId, id);</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> mapper.selectOne(wrapper);</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(product)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ProductNotFoundException</span>(<span class="string">&quot;没有该商品&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="后端-控制层-11"><a href="#后端-控制层-11" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="请求设计-7"><a href="#请求设计-7" class="headerlink" title="请求设计"></a>请求设计</h5><blockquote>
<p><strong>请求路径：&#x2F;product&#x2F;get_product</strong></p>
<p><strong>请求参数：Integer id</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt; Product &gt;</strong></p>
</blockquote>
<h5 id="ProductController-1"><a href="#ProductController-1" class="headerlink" title="ProductController"></a>ProductController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/product&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;商品相关接口描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IProductService service;</span><br><span class="line">    </span><br><span class="line">        <span class="meta">@ApiOperation(value = &quot;获取商品信息&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于获取商品信息，返回Product对象&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 6004, message = &quot;商品不存在&quot;),</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;id&quot;, value = &quot;商品ID&quot;, required = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;get_product&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Product&gt; <span class="title function_">getProduct</span><span class="params">(Integer id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, service.getProductById(id));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="前端界面-10"><a href="#前端界面-10" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">       $(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">            <span class="title function_">getProduct</span>()</span><br><span class="line">            <span class="title function_">getCollectS</span>()</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">   	<span class="keyword">let</span> pid = $.<span class="title function_">getUrlParam</span>(<span class="string">&quot;id&quot;</span>)</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">getProduct</span>(<span class="params"></span>)&#123;</span><br><span class="line">           $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">               <span class="attr">url</span>: <span class="string">&quot;/product/get_product&quot;</span>,</span><br><span class="line">               <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">               <span class="attr">data</span>: &#123;</span><br><span class="line">                   <span class="string">&quot;id&quot;</span>: pid,</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">               <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>)&#123;</span><br><span class="line">                   <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                       <span class="keyword">let</span> product = json.<span class="property">data</span></span><br><span class="line">                       $(<span class="string">&quot;#product-title&quot;</span>).<span class="title function_">html</span>(product.<span class="property">title</span>)</span><br><span class="line">                       $(<span class="string">&quot;#product-sell-point&quot;</span>).<span class="title function_">html</span>(product.<span class="property">sellPoint</span>)</span><br><span class="line">                       $(<span class="string">&quot;#product-price&quot;</span>).<span class="title function_">html</span>(product.<span class="property">price</span>)</span><br><span class="line">                       <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++)&#123;</span><br><span class="line">                           $(<span class="string">&quot;#product-image-&quot;</span> + i +<span class="string">&quot;-big&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;src&quot;</span>, <span class="string">&quot;..&quot;</span> + product.<span class="property">image</span> + i +<span class="string">&quot;_big.png&quot;</span>)</span><br><span class="line">                           $(<span class="string">&quot;#product-image-&quot;</span> + i).<span class="title function_">attr</span>(<span class="string">&quot;src&quot;</span>, <span class="string">&quot;..&quot;</span> + product.<span class="property">image</span> + i +<span class="string">&quot;.jpg&quot;</span>)</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;<span class="keyword">else</span> <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">6004</span>)&#123;</span><br><span class="line">                       location.<span class="property">href</span>=<span class="string">&quot;index.html&quot;</span></span><br><span class="line">                   &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                       <span class="title function_">confirm</span>(json.<span class="property">state</span> + <span class="string">&quot;: &quot;</span> +json.<span class="property">message</span>)</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                   <span class="title function_">error</span>(xhr)</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">let</span> heart = $(<span class="string">&quot;#heart&quot;</span>)</span><br><span class="line">       <span class="keyword">let</span> collect = $(<span class="string">&quot;#collect&quot;</span>)</span><br><span class="line">       <span class="keyword">let</span> btn = $(<span class="string">&quot;#btn-add-to-collect&quot;</span>)</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">setCollect</span>(<span class="params">str, cls</span>)&#123;</span><br><span class="line">           collect.<span class="title function_">empty</span>().<span class="title function_">html</span>(str)</span><br><span class="line">           heart.<span class="title function_">prop</span>(<span class="string">&quot;class&quot;</span>, cls)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">getCollectS</span>(<span class="params"></span>)&#123;</span><br><span class="line">           $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">               <span class="attr">url</span>: <span class="string">&quot;/product/get_status&quot;</span>,</span><br><span class="line">               <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">               <span class="attr">data</span>: &#123;</span><br><span class="line">                   <span class="string">&quot;pid&quot;</span>: pid</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">               <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>)</span><br><span class="line">               &#123;</span><br><span class="line">                   <span class="keyword">let</span> status = json.<span class="property">data</span></span><br><span class="line">                   <span class="keyword">if</span> (status === <span class="number">1</span>)&#123;</span><br><span class="line">                       <span class="title function_">setCollect</span>(<span class="string">&quot; 已收藏&quot;</span>, <span class="string">&quot;fa fa-heart&quot;</span>)</span><br><span class="line">                   &#125;</span><br><span class="line">                   <span class="keyword">else</span> <span class="keyword">if</span> (status === <span class="literal">null</span> || status === <span class="number">0</span>)&#123;</span><br><span class="line">                       <span class="title function_">setCollect</span>(<span class="string">&quot; 加入收藏&quot;</span>, <span class="string">&quot;fa fa-heart-o&quot;</span>)</span><br><span class="line">                   &#125;</span><br><span class="line">                   <span class="keyword">else</span>&#123;</span><br><span class="line">                       <span class="title function_">confirm</span>(json.<span class="property">state</span> + <span class="string">&quot;: &quot;</span> + json.<span class="property">message</span>)</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                   <span class="title function_">error</span>(xhr)</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       $(<span class="string">&quot;#btn-add-to-cart&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">           <span class="keyword">let</span> num = $(<span class="string">&quot;#num&quot;</span>).<span class="title function_">val</span>()</span><br><span class="line">           $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">               <span class="attr">url</span>: <span class="string">&quot;/cart/add_to_cart&quot;</span>,</span><br><span class="line">               <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">               <span class="attr">data</span>: &#123;</span><br><span class="line">                   <span class="string">&quot;id&quot;</span>: pid,</span><br><span class="line">                   <span class="string">&quot;num&quot;</span>: num</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">               <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>)&#123;</span><br><span class="line">                   <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                       location.<span class="property">href</span>=<span class="string">&quot;cart.html&quot;</span></span><br><span class="line">                   &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                       <span class="title function_">confirm</span>(json.<span class="property">state</span> + <span class="string">&quot;: &quot;</span> + json.<span class="property">message</span>)</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                   <span class="title function_">error</span>(xhr)</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">       &#125;)</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">judgeCls</span>(<span class="params"></span>)&#123;</span><br><span class="line">           <span class="keyword">let</span> cls = heart.<span class="title function_">prop</span>(<span class="string">&quot;class&quot;</span>)</span><br><span class="line">           <span class="keyword">if</span>(cls === <span class="string">&quot;fa fa-heart&quot;</span>)&#123;</span><br><span class="line">               <span class="title function_">cancelCollect</span>()</span><br><span class="line">           &#125; <span class="keyword">else</span> <span class="keyword">if</span>(cls === <span class="string">&quot;fa fa-heart-o&quot;</span>)&#123;</span><br><span class="line">               <span class="title function_">addCollect</span>()</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">cancelCollect</span>(<span class="params"></span>)&#123;</span><br><span class="line">           $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">               <span class="attr">url</span>: <span class="string">&quot;/product/cancel_collect&quot;</span>,</span><br><span class="line">               <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">               <span class="attr">data</span>: &#123;</span><br><span class="line">                   <span class="string">&quot;pid&quot;</span>: pid,</span><br><span class="line">                   <span class="string">&quot;status&quot;</span>: <span class="number">0</span></span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">               <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>)&#123;</span><br><span class="line">                   <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                       <span class="title function_">setCollect</span>(<span class="string">&quot; 加入收藏&quot;</span>, <span class="string">&quot;fa fa-heart-o&quot;</span>)</span><br><span class="line">                   &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                       <span class="title function_">setCollect</span>(<span class="string">&quot; 已收藏&quot;</span>, <span class="string">&quot;fa fa-heart&quot;</span>)</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                   <span class="title function_">error</span>(xhr)</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">addCollect</span>(<span class="params"></span>)&#123;</span><br><span class="line">           $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">               <span class="attr">url</span>: <span class="string">&quot;/product/add_collect&quot;</span>,</span><br><span class="line">               <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">               <span class="attr">data</span>: &#123;</span><br><span class="line">                   <span class="string">&quot;pid&quot;</span>: pid</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">               <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>)&#123;</span><br><span class="line">                   <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                       <span class="title function_">setCollect</span>(<span class="string">&quot; 已收藏&quot;</span>, <span class="string">&quot;fa fa-heart&quot;</span>)</span><br><span class="line">                   &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                       <span class="title function_">setCollect</span>(<span class="string">&quot; 加入收藏&quot;</span>, <span class="string">&quot;fa fa-heart-o&quot;</span>)</span><br><span class="line">                       <span class="title function_">confirm</span>(json.<span class="property">state</span> + <span class="string">&quot;: &quot;</span> + json.<span class="property">message</span>)</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                   <span class="title function_">error</span>(xhr)</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       btn.<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">           <span class="title function_">judgeCls</span>()</span><br><span class="line">       &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>因为商品页面可以加入收藏，所以这里还需要调用加入收藏和取消收藏商品的接口，商品信息显示的时候需要判断其是不是处于收藏状态</strong></p>
</blockquote>
</blockquote>
<h3 id="立即购买"><a href="#立即购买" class="headerlink" title="立即购买"></a>立即购买</h3><h4 id="后端-持久层-12"><a href="#后端-持久层-12" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<h5 id="ProductMapper-2"><a href="#ProductMapper-2" class="headerlink" title="ProductMapper"></a>ProductMapper</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理商品数据操作的持久层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Product&gt;&#123;&#125;</span><br></pre></td></tr></table></figure>

<h5 id="OrderMapper"><a href="#OrderMapper" class="headerlink" title="OrderMapper"></a>OrderMapper</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理订单用户数据操作的持久层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> <span class="keyword">extends</span> <span class="title class_">MPJBaseMapper</span>&lt;Order&gt;</span><br><span class="line">&#123;</span><br><span class="line">       <span class="meta">@Select(&quot;select a.oid, a.aid, a.recv_name as recvName, a.total_price as totalPrice, a.status, a.order_time as orderTime, a.pay_time as payTime, &quot; +</span></span><br><span class="line"><span class="meta">               &quot;b.image, b.title, b.price, b.num, &quot; +</span></span><br><span class="line"><span class="meta">               &quot;c.zip, c.address, c.province_name as provinceName, c.phone, c.city_name as cityName, c.area_name as areaName &quot; +</span></span><br><span class="line"><span class="meta">               &quot;from (order_user a &quot; +</span></span><br><span class="line"><span class="meta">               &quot;left join order_item b on a.oid = b.oid) &quot; +</span></span><br><span class="line"><span class="meta">               &quot;left join address c on a.aid = c.aid &quot; +</span></span><br><span class="line"><span class="meta">               &quot;where a.uid=#&#123;uid&#125; &quot; +</span></span><br><span class="line"><span class="meta">               &quot;order by a.status ASC, a.created_time DESC&quot;)</span></span><br><span class="line">       List&lt;OrderVO&gt; <span class="title function_">getOrderVOs</span><span class="params">(Integer uid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>这里最后没有使用自己定义的getOrderVOs方法，而是使用了MPJ进行左连接查询</strong></p>
</blockquote>
</blockquote>
<h4 id="后端-业务层-12"><a href="#后端-业务层-12" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="IOrderService"><a href="#IOrderService" class="headerlink" title="IOrderService"></a>IOrderService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理订单数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IOrderService</span></span><br><span class="line">&#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建订单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> aid 收货地址id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pid 商品id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> num 商品数量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 订单id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">createOrderByP</span><span class="params">(Integer uid, String username, Integer aid, Integer pid, Integer num)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="OrderServiceImpl"><a href="#OrderServiceImpl" class="headerlink" title="OrderServiceImpl"></a>OrderServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IOrderService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IUserService userService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AddressServiceImpl addressService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    OrderMapper orderMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    OrderItemMapper orderItemMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    ProductMapper productMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">createOrderByP</span><span class="params">(Integer uid, String username, Integer aid, Integer pid, Integer num)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> addressService.getAddress(aid, uid, username);</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productMapper.selectById(pid);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">totalPrice</span> <span class="operator">=</span> product.getPrice() * num;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setUid(uid);</span><br><span class="line">        order.setAid(aid);</span><br><span class="line">        order.setRecvName(address.getName());</span><br><span class="line">        order.setRecvPhone(address.getPhone());</span><br><span class="line">        order.setRecvProvince(address.getProvinceName());</span><br><span class="line">        order.setRecvCity(address.getCityName());</span><br><span class="line">        order.setRecvArea(address.getAreaName());</span><br><span class="line">        order.setRecvAddress(address.getAddress());</span><br><span class="line">        order.setTotalPrice(totalPrice);</span><br><span class="line">        order.setStatus(<span class="number">0</span>);</span><br><span class="line">        order.setOrderTime(date);</span><br><span class="line">        <span class="comment">// 补全数据：日志</span></span><br><span class="line">        order.setCreatedUser(username);</span><br><span class="line">        order.setCreatedTime(date);</span><br><span class="line">        order.setModifiedUser(username);</span><br><span class="line">        order.setModifiedTime(date);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> orderMapper.insert(order);</span><br><span class="line">        <span class="keyword">if</span>(row != <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;插入数据时发生异常&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建订单商品数据</span></span><br><span class="line">        <span class="type">OrderItem</span> <span class="variable">item</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderItem</span>();</span><br><span class="line">        <span class="comment">// 补全数据：</span></span><br><span class="line">        item.setOid(order.getOid());</span><br><span class="line">        <span class="comment">// 补全数据：pid, title, image, price, num</span></span><br><span class="line">        item.setPid(pid);</span><br><span class="line">        item.setTitle(product.getTitle());</span><br><span class="line">        item.setImage(product.getImage());</span><br><span class="line">        item.setPrice(product.getPrice());</span><br><span class="line">        item.setNum(num);</span><br><span class="line">        <span class="comment">// 补全数据：4项日志</span></span><br><span class="line">        item.setCreatedUser(username);</span><br><span class="line">        item.setCreatedTime(date);</span><br><span class="line">        item.setModifiedUser(username);</span><br><span class="line">        item.setModifiedTime(date);</span><br><span class="line">        <span class="comment">// 插入订单商品数据</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">rows2</span> <span class="operator">=</span> orderItemMapper.insert(item);</span><br><span class="line">        <span class="keyword">if</span> (rows2 != <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;插入数据时发生异常&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> order.getOid();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="IProductService-2"><a href="#IProductService-2" class="headerlink" title="IProductService"></a>IProductService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理商品数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IProductService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据商品id获取商品信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 商品id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 商品信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Product <span class="title function_">getProductById</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ProductServiceImpl-2"><a href="#ProductServiceImpl-2" class="headerlink" title="ProductServiceImpl"></a>ProductServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IProductService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    ProductMapper mapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">getProductById</span><span class="params">(Integer id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;id = &quot;</span> + id);</span><br><span class="line">        LambdaQueryWrapper&lt;Product&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.select(Product::getTitle, Product::getSellPoint, Product::getPrice, Product::getImage)</span><br><span class="line">               .eq(Product::getId, id);</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> mapper.selectOne(wrapper);</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(product)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ProductNotFoundException</span>(<span class="string">&quot;没有该商品&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>根据商品id查出商品信息，然后创建订单</strong></p>
</blockquote>
</blockquote>
<h4 id="后端-控制层-12"><a href="#后端-控制层-12" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="设计请求-5"><a href="#设计请求-5" class="headerlink" title="设计请求"></a>设计请求</h5><blockquote>
<p><strong>请求路径：&#x2F;order&#x2F;create_orderByP</strong></p>
<p><strong>请求参数：HttpSession session, Integer aid, Integer pid, Integer num</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt; Integer &gt;</strong></p>
</blockquote>
<h5 id="OrderController"><a href="#OrderController" class="headerlink" title="OrderController"></a>OrderController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/order&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;订单相关接口描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据商品数据创建订单&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户创建订单，返回Oid&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 4000, message = &quot;数据插入失败&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 6004, message = &quot;商品不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 8000, message = &quot;用户未登录&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 9000, message = &quot;参数错误&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;aid&quot;, value = &quot;收货地址ID&quot;, required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;pid&quot;, value = &quot;商品ID&quot;, required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;num&quot;, value = &quot;商品数量&quot;, required = true)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;create_orderByP&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Integer&gt; <span class="title function_">createOrderByP</span><span class="params">(HttpSession session, Integer aid, Integer pid, Integer num)</span>&#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">oid</span> <span class="operator">=</span> service.createOrderByP(uid, username, aid, pid, num);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, oid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口测试：略</strong></p>
</blockquote>
<h4 id="前端界面-11"><a href="#前端界面-11" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<p><strong>点击立即购买后，用sessionStorage将pid和num存储到session中，然后跳转到订单页面</strong></p>
</blockquote>
<h2 id="购物车管理"><a href="#购物车管理" class="headerlink" title="购物车管理"></a>购物车管理</h2><h3 id="创建数据表-3"><a href="#创建数据表-3" class="headerlink" title="创建数据表"></a>创建数据表</h3><blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `cart`  (</span><br><span class="line">      `cid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;购物车数据id&#x27;</span>,</span><br><span class="line">      `uid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">      `pid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品id&#x27;</span>,</span><br><span class="line">      `price` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;加入时商品单价&#x27;</span>,</span><br><span class="line">      `num` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品数量&#x27;</span>,</span><br><span class="line">      `created_user` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">      `created_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">      `modified_user` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">      `modified_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">      <span class="keyword">PRIMARY</span> KEY (`cid`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">27</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> Compact;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="创建实体类-3"><a href="#创建实体类-3" class="headerlink" title="创建实体类"></a>创建实体类</h3><blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 购物车数据的实体类 */</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;购物车数据实体类：Cart&quot;, description = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;对应数据库中的cart表&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cart</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">        <span class="meta">@TableId(value = &quot;cid&quot;, type = IdType.AUTO)</span></span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;购物车数据ID&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer cid;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;用户ID&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer uid;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品ID&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer pid;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品单价&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Long price;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品数量&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="创建VO类"><a href="#创建VO类" class="headerlink" title="创建VO类"></a>创建VO类</h3><blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 购物车数据的Value Object类 */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;购物车数据VO类：CartVO&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;购物车数据ID&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer cid;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;用户ID&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer uid;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品ID&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer pid;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品单价&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Long price;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品数量&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer num;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品标题&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String title;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品真实价格&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Long realPrice;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品图片&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="加入购物车"><a href="#加入购物车" class="headerlink" title="加入购物车"></a>加入购物车</h3><h4 id="后端-持久层-13"><a href="#后端-持久层-13" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<h5 id="CartMapper"><a href="#CartMapper" class="headerlink" title="CartMapper"></a>CartMapper</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理购物车数据操作的持久层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CartMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Cart&gt;</span><br><span class="line">&#123;</span><br><span class="line">       <span class="meta">@Select(&quot;select cid, uid, pid, cart.price, cart.num, product.title, product.image, product.price AS realprice &quot; +</span></span><br><span class="line"><span class="meta">               &quot;from cart left join product on cart.pid = product.id &quot; +</span></span><br><span class="line"><span class="meta">               &quot;where uid=#&#123;uid&#125; &quot; +</span></span><br><span class="line"><span class="meta">               &quot;order by cart.created_time desc&quot;)</span></span><br><span class="line">       List&lt;CartVO&gt; <span class="title function_">getCartVOs</span><span class="params">(Integer uid)</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 注解在使用诸如foreach标签之类时，需要使用&lt;script&gt;&lt;/script&gt;包裹，</span></span><br><span class="line">       <span class="comment">// 在foreach标签中，</span></span><br><span class="line">       <span class="comment">// 如果参数是数组类型那么keyName为array</span></span><br><span class="line">       <span class="comment">// 如果参数是集合类型那么keyName为list</span></span><br><span class="line"></span><br><span class="line">       <span class="meta">@Select(&quot;&lt;script&gt; &quot; +</span></span><br><span class="line"><span class="meta">               &quot;select cid, uid, pid, cart.price, cart.num, product.title, product.image, product.price AS realprice &quot; +</span></span><br><span class="line"><span class="meta">               &quot;from cart left join product on cart.pid = product.id &quot; +</span></span><br><span class="line"><span class="meta">               &quot;where cid IN &quot; +</span></span><br><span class="line"><span class="meta">               &quot;&lt;foreach collection=&#x27;list&#x27; open=&#x27;(&#x27; item=&#x27;cid&#x27; separator=&#x27;,&#x27; close=&#x27;)&#x27;&gt; #&#123;cid&#125; &lt;/foreach&gt; &quot; +</span></span><br><span class="line"><span class="meta">               &quot;order by cart.created_time desc &quot; +</span></span><br><span class="line"><span class="meta">               &quot;&lt;/script&gt;&quot;)</span></span><br><span class="line">       List&lt;CartVO&gt; <span class="title function_">getCartVOsByCid</span><span class="params">(<span class="meta">@Param(&quot;list&quot;)</span> List&lt;Integer&gt; cids)</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 这里类型为List，却需要指定</span></span><br><span class="line">       <span class="meta">@Delete(&quot;&lt;script&gt;&quot; +</span></span><br><span class="line"><span class="meta">               &quot;delete from cart &quot; +</span></span><br><span class="line"><span class="meta">               &quot;where uid=#&#123;uid&#125; &quot; +</span></span><br><span class="line"><span class="meta">               &quot;and cid in &quot; +</span></span><br><span class="line"><span class="meta">               &quot;&lt;foreach collection=&#x27;list&#x27; open=&#x27;(&#x27; item=&#x27;cid&#x27; separator=&#x27;,&#x27; close=&#x27;)&#x27;&gt; #&#123;cid&#125; &lt;/foreach&gt; &quot; +</span></span><br><span class="line"><span class="meta">               &quot;&lt;/script&gt;&quot;)</span></span><br><span class="line">       <span class="type">int</span> <span class="title function_">selDelCart</span><span class="params">(Integer uid, <span class="meta">@Param(&quot;list&quot;)</span> List&lt;Integer&gt; cids)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="后端-业务层-13"><a href="#后端-业务层-13" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="ICartService"><a href="#ICartService" class="headerlink" title="ICartService"></a>ICartService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理购物车数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICartService</span></span><br><span class="line">&#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将商品添加到购物车中</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pid 商品id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> amount 商品数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">addToCart</span><span class="params">(Integer uid, String username, Integer pid, Integer amount)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="CartServiceImpl"><a href="#CartServiceImpl" class="headerlink" title="CartServiceImpl"></a>CartServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ICartService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    CartMapper mapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    ProductMapper productMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserServiceImpl userService;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">addToCart</span><span class="params">(Integer uid, String username, Integer pid, Integer amount)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Integer cid;</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        LambdaQueryWrapper&lt;Cart&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(Cart::getUid, uid)</span><br><span class="line">               .eq(Cart::getPid, pid);</span><br><span class="line">        <span class="type">Cart</span> <span class="variable">cart</span> <span class="operator">=</span> mapper.selectOne(wrapper);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(cart)) <span class="comment">// 购物车中没有该商品，将该商品添加到购物车</span></span><br><span class="line">        &#123;</span><br><span class="line">            cart = <span class="keyword">new</span> <span class="title class_">Cart</span>();</span><br><span class="line">            cart.setUid(uid);</span><br><span class="line">            cart.setPid(pid);</span><br><span class="line">            cart.setNum(amount);</span><br><span class="line">            LambdaQueryWrapper&lt;Product&gt; wrapper1 = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            wrapper1.eq(Product::getId, pid)</span><br><span class="line">                    .select(Product::getPrice);</span><br><span class="line">            cart.setPrice(productMapper.selectOne(wrapper1).getPrice());</span><br><span class="line">            cart.setCreatedTime(date);</span><br><span class="line">            cart.setModifiedTime(date);</span><br><span class="line">            cart.setCreatedUser(username);</span><br><span class="line">            cart.setModifiedUser(username);</span><br><span class="line">            <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> mapper.insert(cart);</span><br><span class="line">            cid = cart.getCid();</span><br><span class="line">            <span class="keyword">if</span>(row != <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;插入数据时发生未知异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">// 购物车中有该商品，更新该商品的数量</span></span><br><span class="line">        &#123;</span><br><span class="line">            LambdaUpdateWrapper&lt;Cart&gt; wrapper1 = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">            wrapper1.set(Cart::getNum, amount + cart.getNum())</span><br><span class="line">                    .set(Cart::getModifiedTime, date)</span><br><span class="line">                    .set(Cart::getModifiedUser, username)</span><br><span class="line">                    .eq(Cart::getUid, uid) <span class="comment">// 忘记加限定条件，后端数据库cart被污染</span></span><br><span class="line">                    .eq(Cart::getPid, pid);</span><br><span class="line">            <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> mapper.update(cart, wrapper1);</span><br><span class="line">            cid = cart.getCid();</span><br><span class="line">            <span class="keyword">if</span>(row != <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;更新数据时发生未知异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>**单元测试：略 **</p>
</blockquote>
<h4 id="后端-控制层-13"><a href="#后端-控制层-13" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="设计请求-6"><a href="#设计请求-6" class="headerlink" title="设计请求"></a>设计请求</h5><blockquote>
<p><strong>请求路径：&#x2F;cart&#x2F;add_to_cart</strong></p>
<p><strong>请求参数：HttpSession session，Integer pid, Integer amount</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt; Integer &gt;</strong></p>
</blockquote>
<h5 id="CartController"><a href="#CartController" class="headerlink" title="CartController"></a>CartController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/cart&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;购物车接口相关描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    ICartService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;加入购物车&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户将商品加入购物车&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 4000, message = &quot;数据插入失败&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 6004, message = &quot;商品不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 6005, message = &quot;购物车数据不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 8000, message = &quot;用户未登录&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 9000, message = &quot;参数错误&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;pid&quot;, value = &quot;商品ID&quot;, required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;amount&quot;, value = &quot;商品数量&quot;, required = true)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;add_to_cart&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Integer&gt; <span class="title function_">addToCart</span><span class="params">(HttpSession session,</span></span><br><span class="line"><span class="params">                                      <span class="meta">@RequestParam(&quot;id&quot;)</span> Integer pid,</span></span><br><span class="line"><span class="params">                                      <span class="meta">@RequestParam(&quot;num&quot;)</span> Integer amount)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">        service.addToCart(uid, username, pid, amount);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, service.addToCart(uid, username, pid, amount));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>**接口测试：略 **</p>
</blockquote>
<h4 id="前端界面-12"><a href="#前端界面-12" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">       $(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">       	<span class="title function_">showCarts</span>()</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">       <span class="keyword">let</span> totalNum = <span class="number">0</span></span><br><span class="line">       <span class="keyword">let</span> totalPrice = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">showCarts</span>(<span class="params"></span>)&#123;</span><br><span class="line">           $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">               <span class="attr">url</span>: <span class="string">&quot;/cart/get_cartVOs&quot;</span>,</span><br><span class="line">               <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">               <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">               <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>)&#123;</span><br><span class="line">                   <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                       <span class="keyword">let</span> list = json.<span class="property">data</span></span><br><span class="line">                       <span class="keyword">if</span>(list.<span class="property">length</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                           <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++)&#123;</span><br><span class="line">                               <span class="keyword">let</span> ckId = <span class="string">&quot;ckid&quot;</span> + i.<span class="title function_">toString</span>()</span><br><span class="line">                               <span class="keyword">let</span> priceId = <span class="string">&quot;goodsPrice&quot;</span> + i.<span class="title function_">toString</span>()</span><br><span class="line">                               <span class="keyword">let</span> countId = <span class="string">&quot;goodsCount&quot;</span> + i.<span class="title function_">toString</span>()</span><br><span class="line">                               <span class="keyword">let</span> castId = <span class="string">&quot;goodsCast&quot;</span> + i.<span class="title function_">toString</span>()</span><br><span class="line">                               <span class="keyword">let</span> tr = <span class="string">&#x27;&lt;tr&gt;&#x27;</span> +</span><br><span class="line">                                   <span class="string">&#x27;&lt;td&gt;&#x27;</span> +</span><br><span class="line">                                   <span class="string">&#x27;&lt;input id=&quot;#&#123;ckId&#125;&quot; onclick=&quot;checkOne(#&#123;i&#125;)&quot; name=&quot;cids&quot; value=&quot;#&#123;cid&#125;&quot; type=&quot;checkbox&quot; class=&quot;ckitem&quot; /&gt;&#x27;</span> +</span><br><span class="line">                                   <span class="string">&#x27;&lt;/td&gt;&#x27;</span> +</span><br><span class="line">                                   <span class="string">&#x27;&lt;td&gt;&lt;img src=&quot;..#&#123;image&#125;collect.png&quot; class=&quot;img-responsive&quot; /&gt;&lt;/td&gt;&#x27;</span> +</span><br><span class="line">                                   <span class="string">&#x27;&lt;td&gt;#&#123;title&#125;&lt;/td&gt;&#x27;</span> +</span><br><span class="line">                                   <span class="string">&#x27;&lt;td&gt;¥&lt;span id=&quot;#&#123;priceId&#125;&quot;&gt;#&#123;price&#125;&lt;/span&gt;&lt;/td&gt;&#x27;</span> +</span><br><span class="line">                                   <span class="string">&#x27;&lt;td&gt;&#x27;</span> +</span><br><span class="line">                                   <span class="string">&#x27;&lt;input type=&quot;button&quot; value=&quot;-&quot; class=&quot;num-btn&quot; onclick=&quot;reduceNum(#&#123;cid&#125;, #&#123;i&#125;)&quot; /&gt;&#x27;</span> +</span><br><span class="line">                                   <span class="string">&#x27;&lt;input id= &quot;#&#123;countId&#125;&quot; type=&quot;text&quot; size=&quot;2&quot; readonly=&quot;readonly&quot; class=&quot;num-text&quot; value=#&#123;num&#125;&gt;&#x27;</span> +</span><br><span class="line">                                   <span class="string">&#x27;&lt;input class=&quot;num-btn&quot; type=&quot;button&quot; value=&quot;+&quot; onclick=&quot;addNum(#&#123;cid&#125;, #&#123;i&#125;)&quot; /&gt;&#x27;</span> +</span><br><span class="line">                                   <span class="string">&#x27;&lt;/td&gt;&#x27;</span> +</span><br><span class="line">                                   <span class="string">&#x27;&lt;td&gt;¥&lt;span id=&quot;#&#123;castId&#125;&quot;&gt;#&#123;money&#125;&lt;/span&gt;&lt;/td&gt;&#x27;</span> +</span><br><span class="line">                                   <span class="string">&#x27;&lt;td&gt;&#x27;</span> +</span><br><span class="line">                                   <span class="string">&#x27;&lt;input type=&quot;button&quot; onclick=&quot;delCart(#&#123;cid&#125;)&quot; class=&quot;cart-del btn btn-default btn-xs&quot; value=&quot;删除&quot; /&gt;&#x27;</span> +</span><br><span class="line">                                   <span class="string">&#x27;&lt;/td&gt;&#x27;</span> +</span><br><span class="line">                                   <span class="string">&#x27;&lt;/tr&gt;&#x27;</span></span><br><span class="line">                               tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;ckId&#125;/g</span>, ckId)</span><br><span class="line">                               tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;priceId&#125;/g</span>, priceId)</span><br><span class="line">                               tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;countId&#125;/g</span>, countId)</span><br><span class="line">                               tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;castId&#125;/g</span>, castId)</span><br><span class="line">                               tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;i&#125;/g</span>, i.<span class="title function_">toString</span>())</span><br><span class="line">                               tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;image&#125;/g</span>, list[i].<span class="property">image</span>)</span><br><span class="line">                               tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;title&#125;/g</span>, list[i].<span class="property">title</span>)</span><br><span class="line">                               tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;price&#125;/g</span>, list[i].<span class="property">realPrice</span>)</span><br><span class="line">                               <span class="keyword">let</span> money = list[i].<span class="property">realPrice</span> * list[i].<span class="property">num</span></span><br><span class="line">                               tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;money&#125;/g</span>, money.<span class="title function_">toString</span>())</span><br><span class="line">                               tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;num&#125;/g</span>, list[i].<span class="property">num</span>)</span><br><span class="line">                               tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;cid&#125;/g</span>, list[i].<span class="property">cid</span>)</span><br><span class="line">                               $(<span class="string">&quot;#cart-list&quot;</span>).<span class="title function_">append</span>(tr)</span><br><span class="line">                               totalNum += list[i].<span class="property">num</span></span><br><span class="line">                               totalPrice += money</span><br><span class="line">                           &#125;</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                       <span class="title function_">confirm</span>(json.<span class="property">state</span> + <span class="string">&quot;: &quot;</span> + json.<span class="property">message</span>)</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                   <span class="title function_">error</span>(xhr)</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">let</span> price <span class="comment">// 商品价格控件</span></span><br><span class="line">       <span class="keyword">let</span> count <span class="comment">// 商品数量控件</span></span><br><span class="line">       <span class="keyword">let</span> cast <span class="comment">// 该商品总金额控件</span></span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">getCtrl</span>(<span class="params">rid</span>)&#123;</span><br><span class="line">           price = $(<span class="string">&quot;#goodsPrice&quot;</span>+rid)</span><br><span class="line">           count = $(<span class="string">&quot;#goodsCount&quot;</span>+rid)</span><br><span class="line">           cast = $(<span class="string">&quot;#goodsCast&quot;</span>+rid)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//计算单行小计价格的方法</span></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">calcRow</span>(<span class="params"></span>)&#123;</span><br><span class="line">           <span class="comment">//取单价</span></span><br><span class="line">           <span class="keyword">let</span> vprice = <span class="built_in">parseFloat</span>(price.<span class="title function_">html</span>());</span><br><span class="line">           <span class="comment">//取数量</span></span><br><span class="line">           <span class="keyword">let</span> vnum = <span class="built_in">parseFloat</span>(count.<span class="title function_">val</span>());</span><br><span class="line">           <span class="comment">//小计金额</span></span><br><span class="line">           <span class="keyword">let</span> vtotal = vprice * vnum;</span><br><span class="line">           <span class="comment">//赋值</span></span><br><span class="line">           cast.<span class="title function_">html</span>(vtotal);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">reduceNum</span>(<span class="params">cid, rid</span>)&#123;</span><br><span class="line">           <span class="title function_">getCtrl</span>(rid)</span><br><span class="line">           <span class="keyword">let</span> num = <span class="built_in">parseInt</span>(count.<span class="title function_">val</span>()) - <span class="number">1</span>;</span><br><span class="line">           <span class="keyword">if</span> (num === <span class="number">0</span>)</span><br><span class="line">               <span class="keyword">return</span>;</span><br><span class="line">           count.<span class="title function_">val</span>(num);</span><br><span class="line">           <span class="title function_">calcRow</span>();</span><br><span class="line">           <span class="title function_">changeNum</span>(cid, num)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">addNum</span>(<span class="params">cid, rid</span>)&#123;</span><br><span class="line">           <span class="title function_">getCtrl</span>(rid)</span><br><span class="line">           <span class="keyword">let</span> num = <span class="built_in">parseInt</span>(count.<span class="title function_">val</span>()) + <span class="number">1</span>;</span><br><span class="line">           <span class="keyword">if</span> (num === <span class="number">20</span>)&#123;</span><br><span class="line">               <span class="title function_">confirm</span>(<span class="string">&quot;修改失败，超出库存或购买限制&quot;</span>)</span><br><span class="line">               <span class="keyword">return</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           count.<span class="title function_">val</span>(num);</span><br><span class="line">           <span class="title function_">calcRow</span>();</span><br><span class="line">           <span class="title function_">changeNum</span>(cid, num)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">changeNum</span>(<span class="params">cid, num</span>)&#123;</span><br><span class="line">           $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">               <span class="attr">url</span>: <span class="string">&quot;/cart/change_cartNum&quot;</span>,</span><br><span class="line">               <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">               <span class="attr">data</span>: &#123;</span><br><span class="line">                   <span class="string">&quot;cid&quot;</span>: cid,</span><br><span class="line">                   <span class="string">&quot;num&quot;</span>: num</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">               <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>)&#123;</span><br><span class="line">                   <span class="keyword">if</span>(json.<span class="property">state</span> !== <span class="number">200</span>)&#123;</span><br><span class="line">                       <span class="title function_">confirm</span>(json.<span class="property">state</span> + <span class="string">&quot;: &quot;</span> + json.<span class="property">message</span>)</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                   <span class="title function_">error</span>(xhr)</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">let</span> countCtrl = $(<span class="string">&quot;#selectCount&quot;</span>)</span><br><span class="line">       <span class="keyword">let</span> totalCtrl = $(<span class="string">&quot;#selectTotal&quot;</span>)</span><br><span class="line">       <span class="keyword">let</span> cids = <span class="title class_">Array</span>.<span class="title function_">of</span>()</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">setCids</span>(<span class="params"></span>)&#123;</span><br><span class="line">           <span class="comment">// 获取当前购物车中有多少商品</span></span><br><span class="line">           <span class="keyword">let</span> cartLength = $(<span class="string">&quot;#cart-list&quot;</span>).<span class="title function_">children</span>(<span class="string">&quot;tr&quot;</span>).<span class="property">length</span></span><br><span class="line">           <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; cartLength; i++)&#123;</span><br><span class="line">               <span class="keyword">let</span> ck = $(<span class="string">&quot;#ckid&quot;</span> + i.<span class="title function_">toString</span>())</span><br><span class="line">               cids.<span class="title function_">push</span>(<span class="built_in">parseInt</span>(ck.<span class="title function_">val</span>()))</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">clearCids</span>(<span class="params"></span>)&#123;</span><br><span class="line">           cids.<span class="property">length</span> = <span class="number">0</span></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 全选全不选</span></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">checkAll</span>(<span class="params">ckbtn</span>) &#123;</span><br><span class="line">           <span class="comment">//根据全选按钮的状态设置所有class为ckitem的选中状态</span></span><br><span class="line">           $(<span class="string">&quot;.ckitem&quot;</span>).<span class="title function_">prop</span>(<span class="string">&quot;checked&quot;</span>, $(ckbtn).<span class="title function_">prop</span>(<span class="string">&quot;checked&quot;</span>));</span><br><span class="line">           <span class="comment">// 表示全选状态为取消</span></span><br><span class="line">           <span class="keyword">if</span>($(ckbtn).<span class="title function_">prop</span>(<span class="string">&quot;checked&quot;</span>) === <span class="literal">false</span>)&#123;</span><br><span class="line">               countCtrl.<span class="title function_">empty</span>().<span class="title function_">html</span>(<span class="number">0</span>)</span><br><span class="line">               totalCtrl.<span class="title function_">empty</span>().<span class="title function_">html</span>(<span class="number">0</span>)</span><br><span class="line">               <span class="title function_">clearCids</span>()</span><br><span class="line">           &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">               <span class="comment">// 设置选择的商品数量和总价</span></span><br><span class="line">               countCtrl.<span class="title function_">empty</span>().<span class="title function_">html</span>(totalNum)</span><br><span class="line">               totalCtrl.<span class="title function_">empty</span>().<span class="title function_">html</span>(totalPrice)</span><br><span class="line">               <span class="title function_">setCids</span>()</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">let</span> theNum = <span class="number">0</span></span><br><span class="line">       <span class="keyword">let</span> thePrice = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">checkOne</span>(<span class="params">rid</span>)&#123;</span><br><span class="line">           <span class="keyword">let</span> ck = $(<span class="string">&quot;#ckid&quot;</span> + rid)</span><br><span class="line">           <span class="comment">// 获取当前购物车中有多少商品</span></span><br><span class="line">           <span class="keyword">let</span> cartLength = $(<span class="string">&quot;#cart-list&quot;</span>).<span class="title function_">children</span>(<span class="string">&quot;tr&quot;</span>).<span class="property">length</span></span><br><span class="line">           <span class="comment">// 获取已被选中的单选框的数量</span></span><br><span class="line">           <span class="keyword">let</span> ckNum = $(<span class="string">&quot;.ckitem:checked&quot;</span>).<span class="property">length</span></span><br><span class="line">           <span class="comment">// 判断是否全被选中</span></span><br><span class="line">           <span class="keyword">if</span>(cartLength === ckNum)&#123;</span><br><span class="line">               <span class="keyword">let</span> ckall = $(<span class="string">&quot;.ckall&quot;</span>)</span><br><span class="line">               ckall.<span class="title function_">prop</span>(<span class="string">&quot;checked&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">               <span class="title function_">checkAll</span>(ckall)</span><br><span class="line">           &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">               <span class="title function_">getCtrl</span>(rid)</span><br><span class="line">               <span class="keyword">if</span>(ck.<span class="title function_">prop</span>(<span class="string">&quot;checked&quot;</span>) === <span class="literal">true</span>)&#123;</span><br><span class="line">                   cids.<span class="title function_">push</span>(<span class="built_in">parseInt</span>(ck.<span class="title function_">val</span>()))</span><br><span class="line">                   theNum += <span class="built_in">parseInt</span>(count.<span class="title function_">val</span>())</span><br><span class="line">                   thePrice += <span class="built_in">parseFloat</span>(cast.<span class="title function_">html</span>())</span><br><span class="line"></span><br><span class="line">               &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                   cids.<span class="title function_">splice</span>(<span class="built_in">parseInt</span>(ck.<span class="title function_">val</span>()), <span class="number">1</span>)</span><br><span class="line">                   theNum -= <span class="built_in">parseInt</span>(count.<span class="title function_">val</span>())</span><br><span class="line">                   thePrice -= <span class="built_in">parseFloat</span>(cast.<span class="title function_">html</span>())</span><br><span class="line">               &#125;</span><br><span class="line">               countCtrl.<span class="title function_">empty</span>().<span class="title function_">html</span>(theNum)</span><br><span class="line">               totalCtrl.<span class="title function_">empty</span>().<span class="title function_">html</span>(thePrice)</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">delCart</span>(<span class="params">cid</span>)&#123;</span><br><span class="line">           <span class="keyword">if</span>(<span class="title function_">confirm</span>(<span class="string">&quot;确定要删除该商品吗？&quot;</span>))&#123;</span><br><span class="line">               $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">                   <span class="attr">url</span>: <span class="string">&quot;/cart/del_cart&quot;</span>,</span><br><span class="line">                   <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">                   <span class="attr">data</span>: &#123;</span><br><span class="line">                       <span class="string">&quot;cid&quot;</span>: cid,</span><br><span class="line">                   &#125;,</span><br><span class="line">                   <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">                   <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>)&#123;</span><br><span class="line">                       <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">200</span>) &#123;</span><br><span class="line">                           location.<span class="property">href</span>=<span class="string">&quot;cart.html&quot;</span></span><br><span class="line">                       &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                           <span class="title function_">confirm</span>(json.<span class="property">state</span> + <span class="string">&quot;: &quot;</span> + json.<span class="property">message</span>)</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;,</span><br><span class="line">                   <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                       <span class="title function_">error</span>(xhr)</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;)</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">selDelCart</span>(<span class="params"></span>)&#123;</span><br><span class="line">           <span class="keyword">if</span> (cids.<span class="property">length</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">               cids = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(cids) <span class="comment">// 将数组转换为字符串返回</span></span><br><span class="line">               <span class="keyword">if</span> (<span class="title function_">confirm</span>(<span class="string">&quot;确定要删除所选商品吗？&quot;</span>))&#123;</span><br><span class="line">                   $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">                       <span class="attr">url</span>: <span class="string">&quot;/cart/sel_del_cart&quot;</span>,</span><br><span class="line">                       <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">                       <span class="attr">data</span>: &#123;</span><br><span class="line">                           <span class="string">&quot;cids&quot;</span>: cids</span><br><span class="line">                       &#125;, <span class="comment">// 不能采用&quot;cids=&quot;+cids这样加在url的方式返回，因为tomcat中特殊字符(例如&quot; &lt; &gt; [ \ ] ^ ` &#123; | &#125; .)报错</span></span><br><span class="line">                       <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">                       <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>)&#123;</span><br><span class="line">                           <span class="keyword">if</span> (json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                               location.<span class="property">href</span> = <span class="string">&quot;cart.html&quot;</span></span><br><span class="line">                           &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                               <span class="title function_">confirm</span>(json.<span class="property">state</span> + <span class="string">&quot;: &quot;</span> + json.<span class="property">message</span>)</span><br><span class="line">                           &#125;</span><br><span class="line">                       &#125;,</span><br><span class="line">                       <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                           <span class="title function_">error</span>(xhr)</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;)</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="title function_">clearCids</span>()</span><br><span class="line">           &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">               <span class="title function_">confirm</span>(<span class="string">&quot;您没有选择任何商品&quot;</span>)</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">judgeCheck</span>(<span class="params"></span>)&#123;</span><br><span class="line">           <span class="keyword">let</span> flag = <span class="literal">true</span></span><br><span class="line">           <span class="keyword">if</span>(cids.<span class="property">length</span> === <span class="number">0</span>)&#123;</span><br><span class="line">               <span class="title function_">confirm</span>(<span class="string">&quot;请先选择任意商品再进行结算&quot;</span>)</span><br><span class="line">               flag = <span class="literal">false</span></span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> flag</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">function</span> <span class="title function_">settlement</span>(<span class="params"></span>)&#123;</span><br><span class="line">           <span class="keyword">if</span>(<span class="title function_">judgeCheck</span>())&#123;</span><br><span class="line">               sessionStorage.<span class="title function_">setItem</span>(<span class="string">&quot;cids&quot;</span>, $(<span class="string">&quot;#form-cart&quot;</span>).<span class="title function_">serialize</span>())</span><br><span class="line">               location.<span class="property">href</span>=<span class="string">&quot;orderConfirm.html&quot;</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="显示商品"><a href="#显示商品" class="headerlink" title="显示商品"></a>显示商品</h3><h4 id="后端-持久层-14"><a href="#后端-持久层-14" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<p><strong>与前面一致</strong></p>
</blockquote>
<h4 id="后端-业务层-14"><a href="#后端-业务层-14" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="ICartService-1"><a href="#ICartService-1" class="headerlink" title="ICartService"></a>ICartService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理购物车数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICartService</span></span><br><span class="line">&#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取购物车数据信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 购物车数据信息列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;CartVO&gt; <span class="title function_">getCartVOs</span><span class="params">(Integer uid, String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="CartServiceImpl-1"><a href="#CartServiceImpl-1" class="headerlink" title="CartServiceImpl"></a>CartServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ICartService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    CartMapper mapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    ProductMapper productMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserServiceImpl userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CartVO&gt; <span class="title function_">getCartVOs</span><span class="params">(Integer uid, String username)</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        List&lt;CartVO&gt; cartVOs = mapper.getCartVOs(uid);</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(cartVOs)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CartNotFoundException</span>(<span class="string">&quot;没有购物车数据&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> cartVOs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>单元测试：略</strong></p>
</blockquote>
<h4 id="后端-控制层-14"><a href="#后端-控制层-14" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="设计请求-7"><a href="#设计请求-7" class="headerlink" title="设计请求"></a>设计请求</h5><blockquote>
<p><strong>请求路径：&#x2F;cart&#x2F;get_cartVOs</strong></p>
<p><strong>请求参数：HttpSession session</strong></p>
<p><strong>请求类型：GET</strong></p>
<p><strong>响应类型：JsonResult&lt;List&lt; CartVO &gt;&gt;</strong></p>
</blockquote>
<h5 id="CartController-1"><a href="#CartController-1" class="headerlink" title="CartController"></a>CartController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/cart&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;购物车接口相关描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="meta">@ApiOperation(value = &quot;获取购物车中商品信息&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户获取购物车中商品信息&quot;)</span></span><br><span class="line"> <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 6005, message = &quot;购物车数据不存在&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 8000, message = &quot;用户未登录&quot;)</span></span><br><span class="line"><span class="meta"> &#125;)</span></span><br><span class="line"> <span class="meta">@GetMapping(&quot;get_cartVOs&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> JsonResult&lt;List&lt;CartVO&gt;&gt; <span class="title function_">getCartVOs</span><span class="params">(HttpSession session)</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, service.getCartVOs(uid, username));</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口测试：略</strong></p>
</blockquote>
<h4 id="前端界面-13"><a href="#前端界面-13" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<p><strong>略</strong></p>
</blockquote>
<h3 id="移除商品"><a href="#移除商品" class="headerlink" title="移除商品"></a>移除商品</h3><h4 id="后端-持久层-15"><a href="#后端-持久层-15" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<p><strong>与前面一致</strong></p>
</blockquote>
<h4 id="后端-业务层-15"><a href="#后端-业务层-15" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="ICartService-2"><a href="#ICartService-2" class="headerlink" title="ICartService"></a>ICartService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理购物车数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICartService</span></span><br><span class="line">&#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除购物车数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cid 购物车数据id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delCart</span><span class="params">(Integer uid, String username, Integer cid)</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除选择的购物车数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cids 购物车数据id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">selDelCart</span><span class="params">(Integer uid, String username, List&lt;Integer&gt; cids)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="CartServiceImpl-2"><a href="#CartServiceImpl-2" class="headerlink" title="CartServiceImpl"></a>CartServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ICartService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    CartMapper mapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    ProductMapper productMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserServiceImpl userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delCart</span><span class="params">(Integer uid, String username, Integer cid)</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        LambdaQueryWrapper&lt;Cart&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(Cart::getCid, cid);</span><br><span class="line">        <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> mapper.delete(wrapper);</span><br><span class="line">        <span class="keyword">if</span>(row != <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeleteException</span>(<span class="string">&quot;删除数据时发生未知异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selDelCart</span><span class="params">(Integer uid, String username, List&lt;Integer&gt; cids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(cids)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceException</span>(<span class="string">&quot;参数错误&quot;</span>);</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> mapper.selDelCart(uid, cids);</span><br><span class="line">        <span class="keyword">if</span>(row &lt; <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CartNotFoundException</span>(<span class="string">&quot;没有购物车数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>单元测试：略</strong></p>
</blockquote>
<h4 id="后端-控制层-15"><a href="#后端-控制层-15" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="设计请求-8"><a href="#设计请求-8" class="headerlink" title="设计请求"></a>设计请求</h5><blockquote>
<p><strong>请求路径：&#x2F;cart&#x2F;del_cart</strong></p>
<p><strong>请求参数：HttpSession session，Integer cid</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt; Void &gt;</strong></p>
<p><strong>请求路径：&#x2F;cart&#x2F;sel_del_cart</strong></p>
<p><strong>请求参数：HttpSession session，String cids</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt; Void &gt;</strong></p>
</blockquote>
<h5 id="CartController-2"><a href="#CartController-2" class="headerlink" title="CartController"></a>CartController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/cart&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;购物车接口相关描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="meta">@Resource</span></span><br><span class="line"> ICartService service;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@ApiOperation(value = &quot;删除购物车商品&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户删除购物车商品&quot;)</span></span><br><span class="line"> <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 4002, message = &quot;数据删除失败&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 8000, message = &quot;用户未登录&quot;)</span></span><br><span class="line"><span class="meta"> &#125;)</span></span><br><span class="line"> <span class="meta">@ApiImplicitParam(name = &quot;cid&quot;, value = &quot;购物车ID&quot;, required = true)</span></span><br><span class="line"> <span class="meta">@PostMapping(&quot;del_cart&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">delCart</span><span class="params">(HttpSession session, Integer cid)</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">     service.delCart(uid, username, cid);</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@ApiOperation(value = &quot;选择购物车商品删除&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户选择购物车商品删除&quot;)</span></span><br><span class="line"> <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 6005, message = &quot;购物车数据不存在&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 8000, message = &quot;用户未登录&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 9000, message = &quot;参数错误&quot;)</span></span><br><span class="line"><span class="meta"> &#125;)</span></span><br><span class="line"> <span class="meta">@ApiImplicitParam(name = &quot;cids&quot;, value = &quot;购物车ID&quot;, required = true)</span></span><br><span class="line"> <span class="meta">@PostMapping(&quot;sel_del_cart&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">selDelCart</span><span class="params">(HttpSession session, String cids)</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="comment">// 前端用json传送数据，后端需要加上@RequestBody</span></span><br><span class="line">     <span class="comment">// 使用fastjson将前端传回的JsonString转换为List</span></span><br><span class="line">     List&lt;Integer&gt; params = JSON.parseArray(cids, Integer.class);</span><br><span class="line">     <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">     service.selDelCart(uid, username, params);</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口测试：略</strong></p>
</blockquote>
<h4 id="前端界面-14"><a href="#前端界面-14" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<p><strong>略</strong></p>
</blockquote>
<h2 id="订单管理"><a href="#订单管理" class="headerlink" title="订单管理"></a>订单管理</h2><h4 id="创建数据表-4"><a href="#创建数据表-4" class="headerlink" title="创建数据表"></a>创建数据表</h4><blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `order_user`  (</span><br><span class="line">    `oid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;订单id&#x27;</span>,</span><br><span class="line">    `uid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">    `aid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;地址id&#x27;</span>,</span><br><span class="line">    `recv_name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收货人姓名&#x27;</span>,</span><br><span class="line">    `recv_phone` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收货人电话&#x27;</span>,</span><br><span class="line">    `recv_province` <span class="type">varchar</span>(<span class="number">15</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收货人所在省&#x27;</span>,</span><br><span class="line">    `recv_city` <span class="type">varchar</span>(<span class="number">15</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收货人所在市&#x27;</span>,</span><br><span class="line">    `recv_area` <span class="type">varchar</span>(<span class="number">15</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收货人所在区&#x27;</span>,</span><br><span class="line">    `recv_address` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收货详细地址&#x27;</span>,</span><br><span class="line">    `total_price` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;总价&#x27;</span>,</span><br><span class="line">    `status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;状态：0-未支付，1-已支付，2-已取消，3-已关闭，4-已完成&#x27;</span>,</span><br><span class="line">    `order_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;下单时间&#x27;</span>,</span><br><span class="line">    `pay_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;支付时间&#x27;</span>,</span><br><span class="line">    `created_user` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">    `created_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    `modified_user` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">    `modified_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`oid`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">67</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> Compact;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `order_item`  (</span><br><span class="line">    `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    `oid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;所归属的订单的id&#x27;</span>,</span><br><span class="line">    `pid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品的id&#x27;</span>,</span><br><span class="line">    `title` <span class="type">varchar</span>(<span class="number">100</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品标题&#x27;</span>,</span><br><span class="line">    `image` <span class="type">varchar</span>(<span class="number">500</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品图片&#x27;</span>,</span><br><span class="line">    `price` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品价格&#x27;</span>,</span><br><span class="line">    `num` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;购买数量&#x27;</span>,</span><br><span class="line">    `created_user` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">    `created_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    `modified_user` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">    `modified_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">166</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> Compact;</span><br></pre></td></tr></table></figure>

<p><strong>订单包括两部分，一部分是用户信息，一部分是商品信息</strong></p>
</blockquote>
<h4 id="创建实体类-4"><a href="#创建实体类-4" class="headerlink" title="创建实体类"></a>创建实体类</h4><blockquote>
<h5 id="Order"><a href="#Order" class="headerlink" title="Order"></a>Order</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 订单数据的实体类 */</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@TableName(&quot;order_user&quot;)</span> <span class="comment">// 不能使用order为表名</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;订单实体类：Order&quot;, description = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;对应数据库中的order_user表&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@TableId(value = &quot;oid&quot;, type = IdType.AUTO)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;订单ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer oid;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;用户ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;收货地址ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer aid;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;收货人姓名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String recvName;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;收货人电话&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String recvPhone;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;收货人所在省&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String recvProvince;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;收货人所在市&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String recvCity;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;收货人所在区&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String recvArea;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;收货人详细地址&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String recvAddress;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;订单总价&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long totalPrice;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;订单状态：0-未支付，1-已支付，2-已取消，3-已关闭，4-已完成&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;下单时间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date orderTime;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;支付时间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date payTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="OrderItem"><a href="#OrderItem" class="headerlink" title="OrderItem"></a>OrderItem</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 订单中的商品数据 */</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;订单实体类：OrderItem&quot;, description = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;对应数据库中的order_item表&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderItem</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;主键ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;订单ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer oid;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;商品ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer pid;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;商品标题&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;商品图片&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;商品单价&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long price;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;商品数量&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="创建VO类-1"><a href="#创建VO类-1" class="headerlink" title="创建VO类"></a>创建VO类</h4><blockquote>
<h5 id="OrderVO"><a href="#OrderVO" class="headerlink" title="OrderVO"></a>OrderVO</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;订单数据VO类：OrderVO&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;订单ID&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer oid;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;收货地址ID&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer aid;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;收货人姓名&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String recvName;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;电话&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String phone;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;收货人所在省&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String provinceName;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;收货人所在市&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String cityName;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;收货人所在区&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String areaName;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;详细地址&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String address;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;订单状态：0-未支付，1-已支付，2-已取消，3-已关闭，4-已完成&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Integer status;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;下单时间&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Date orderTime;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;支付时间&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Date payTime;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;订单总价&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> Long totalPrice;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;邮政编码&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String zip;</span><br><span class="line">        <span class="meta">@ApiModelProperty(value = &quot;商品详细信息&quot;)</span></span><br><span class="line">        List&lt;OrderItem&gt; orderItems;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="显示订单"><a href="#显示订单" class="headerlink" title="显示订单"></a>显示订单</h3><h4 id="后端-持久层-16"><a href="#后端-持久层-16" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<h5 id="OrderMapper-1"><a href="#OrderMapper-1" class="headerlink" title="OrderMapper"></a>OrderMapper</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理订单用户数据操作的持久层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> <span class="keyword">extends</span> <span class="title class_">MPJBaseMapper</span>&lt;Order&gt;</span><br><span class="line">&#123;</span><br><span class="line">        <span class="meta">@Select(&quot;select a.oid, a.aid, a.recv_name as recvName, a.total_price as totalPrice, a.status, a.order_time as orderTime, a.pay_time as payTime, &quot; +</span></span><br><span class="line"><span class="meta">                &quot;b.image, b.title, b.price, b.num, &quot; +</span></span><br><span class="line"><span class="meta">                &quot;c.zip, c.address, c.province_name as provinceName, c.phone, c.city_name as cityName, c.area_name as areaName &quot; +</span></span><br><span class="line"><span class="meta">                &quot;from (order_user a &quot; +</span></span><br><span class="line"><span class="meta">                &quot;left join order_item b on a.oid = b.oid) &quot; +</span></span><br><span class="line"><span class="meta">                &quot;left join address c on a.aid = c.aid &quot; +</span></span><br><span class="line"><span class="meta">                &quot;where a.uid=#&#123;uid&#125; &quot; +</span></span><br><span class="line"><span class="meta">                &quot;order by a.status ASC, a.created_time DESC&quot;)</span></span><br><span class="line">        List&lt;OrderVO&gt; <span class="title function_">getOrderVOs</span><span class="params">(Integer uid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="OrderItemMapper"><a href="#OrderItemMapper" class="headerlink" title="OrderItemMapper"></a>OrderItemMapper</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理订单商品数据操作的持久层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderItemMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;OrderItem&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>

<h5 id="OrderVOMapper"><a href="#OrderVOMapper" class="headerlink" title="OrderVOMapper"></a>OrderVOMapper</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理订单VO数据操作的持久层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderVOMapper</span> <span class="keyword">extends</span> <span class="title class_">MPJBaseMapper</span>&lt;OrderVO&gt;</span><br><span class="line">&#123;</span><br><span class="line">        List&lt;OrderVO&gt; <span class="title function_">getOrderVOs</span><span class="params">(Integer uid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    List&lt;OrderVO&gt; getOrderVOsByS(Integer uid, Integer status);</span></span><br><span class="line"></span><br><span class="line">        OrderVO <span class="title function_">getOrderVO</span><span class="params">(Integer uid, Integer oid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="OrderVOMapper-xml"><a href="#OrderVOMapper-xml" class="headerlink" title="OrderVOMapper.xml"></a>OrderVOMapper.xml</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span> = <span class="string">&quot;com.t1k.store.mapper.OrderVOMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;getOrderVOs&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.t1k.store.vo.OrderVO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;oid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;oid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;aid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;aid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;recvName&quot;</span> <span class="attr">property</span>=<span class="string">&quot;recvName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;totalPrice&quot;</span> <span class="attr">property</span>=<span class="string">&quot;totalPrice&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;status&quot;</span> <span class="attr">property</span>=<span class="string">&quot;status&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;orderTime&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;payTime&quot;</span> <span class="attr">property</span>=<span class="string">&quot;payTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> <span class="attr">property</span>=<span class="string">&quot;zip&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;provinceName&quot;</span> <span class="attr">property</span>=<span class="string">&quot;provinceName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cityName&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cityName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;areaName&quot;</span> <span class="attr">property</span>=<span class="string">&quot;areaName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;orderItems&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.t1k.store.entity.OrderItem&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;java.util.List&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;image&quot;</span> <span class="attr">property</span>=<span class="string">&quot;image&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;title&quot;</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;num&quot;</span> <span class="attr">property</span>=<span class="string">&quot;num&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getOrderVOs&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;getOrderVOs&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.t1k.store.vo.OrderVO&quot;</span>&gt;</span></span><br><span class="line">        SELECT a.oid, a.aid, a.recv_name AS recvName, a.total_price AS totalPrice,</span><br><span class="line">               a.status, a.order_time AS orderTime, a.pay_time AS payTime,</span><br><span class="line">               b.image, b.title, b.price, b.num,</span><br><span class="line">               c.zip, c.address, c.province_name AS provinceName, c.phone, c.city_name AS cityName, c.area_name AS areaName</span><br><span class="line">        FROM</span><br><span class="line">            order_user a</span><br><span class="line">        LEFT JOIN</span><br><span class="line">            address c ON a.aid = c.aid</span><br><span class="line">        LEFT JOIN</span><br><span class="line">            order_item b ON a.oid = b.oid</span><br><span class="line">        WHERE</span><br><span class="line">            a.uid=#&#123;uid&#125;</span><br><span class="line">        ORDER BY a.status ASC, a.created_time DESC</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;getOrderVOsByS&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.t1k.store.vo.OrderVO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;oid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;oid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;aid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;aid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;recvName&quot;</span> <span class="attr">property</span>=<span class="string">&quot;recvName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;totalPrice&quot;</span> <span class="attr">property</span>=<span class="string">&quot;totalPrice&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;status&quot;</span> <span class="attr">property</span>=<span class="string">&quot;status&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;orderTime&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;payTime&quot;</span> <span class="attr">property</span>=<span class="string">&quot;payTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> <span class="attr">property</span>=<span class="string">&quot;zip&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;provinceName&quot;</span> <span class="attr">property</span>=<span class="string">&quot;provinceName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cityName&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cityName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;areaName&quot;</span> <span class="attr">property</span>=<span class="string">&quot;areaName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;orderItems&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.t1k.store.entity.OrderItem&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;java.util.List&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;image&quot;</span> <span class="attr">property</span>=<span class="string">&quot;image&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;title&quot;</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;num&quot;</span> <span class="attr">property</span>=<span class="string">&quot;num&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getOrderVOsByS&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;getOrderVOsByS&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.t1k.store.vo.OrderVO&quot;</span>&gt;</span></span><br><span class="line">        SELECT a.oid, a.aid, a.recv_name AS recvName, a.total_price AS totalPrice,</span><br><span class="line">               a.status, a.order_time AS orderTime, a.pay_time AS payTime,</span><br><span class="line">               b.image, b.title, b.price, b.num,</span><br><span class="line">               c.zip, c.address, c.province_name AS provinceName, c.phone, c.city_name AS cityName, c.area_name AS areaName</span><br><span class="line">        FROM</span><br><span class="line">            order_user a</span><br><span class="line">                LEFT JOIN</span><br><span class="line">            address c ON a.aid = c.aid</span><br><span class="line">                LEFT JOIN</span><br><span class="line">            order_item b ON a.oid = b.oid</span><br><span class="line">        WHERE</span><br><span class="line">            a.uid=#&#123;uid&#125; AND a.status=#&#123;status&#125;</span><br><span class="line">        ORDER BY a.status ASC, a.created_time DESC</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;getOrderVO&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.t1k.store.vo.OrderVO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;oid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;oid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;aid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;aid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;recvName&quot;</span> <span class="attr">property</span>=<span class="string">&quot;recvName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;totalPrice&quot;</span> <span class="attr">property</span>=<span class="string">&quot;totalPrice&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;status&quot;</span> <span class="attr">property</span>=<span class="string">&quot;status&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;orderTime&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;payTime&quot;</span> <span class="attr">property</span>=<span class="string">&quot;payTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> <span class="attr">property</span>=<span class="string">&quot;zip&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;provinceName&quot;</span> <span class="attr">property</span>=<span class="string">&quot;provinceName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cityName&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cityName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;areaName&quot;</span> <span class="attr">property</span>=<span class="string">&quot;areaName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;orderItems&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.t1k.store.entity.OrderItem&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;java.util.List&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;image&quot;</span> <span class="attr">property</span>=<span class="string">&quot;image&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;title&quot;</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;num&quot;</span> <span class="attr">property</span>=<span class="string">&quot;num&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getOrderVO&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;getOrderVO&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.t1k.store.vo.OrderVO&quot;</span>&gt;</span></span><br><span class="line">        SELECT a.oid, a.aid, a.recv_name AS recvName, a.total_price AS totalPrice,</span><br><span class="line">               a.status, a.order_time AS orderTime, a.pay_time AS payTime,</span><br><span class="line">               b.image, b.title, b.price, b.num,</span><br><span class="line">               c.zip, c.address, c.province_name AS provinceName, c.phone, c.city_name AS cityName, c.area_name AS areaName</span><br><span class="line">        FROM</span><br><span class="line">            order_user a</span><br><span class="line">                LEFT JOIN</span><br><span class="line">            address c ON a.aid = c.aid</span><br><span class="line">                LEFT JOIN</span><br><span class="line">            order_item b ON a.oid = b.oid</span><br><span class="line">        WHERE</span><br><span class="line">            a.uid=#&#123;uid&#125; and a.oid=#&#123;oid&#125;</span><br><span class="line">        ORDER BY a.status ASC, a.created_time DESC</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="后端-业务层-16"><a href="#后端-业务层-16" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="IOrderService-1"><a href="#IOrderService-1" class="headerlink" title="IOrderService"></a>IOrderService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理订单数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IOrderService</span></span><br><span class="line">&#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取订单数据列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 订单数据列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;OrderVO&gt; <span class="title function_">getOrderVOs</span><span class="params">(Integer uid, String username)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据订单状态获取订单信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status 订单的状态：0-未支付，1-已支付，2-已取消，3-已关闭，4-已完成</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 订单信息列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;OrderVO&gt; <span class="title function_">getOrderVOsByS</span><span class="params">(Integer uid, String username, List&lt;Integer&gt; status)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据订单id获取订单信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> oid 订单id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 订单信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    OrderVO <span class="title function_">getOrderVO</span><span class="params">(Integer uid, String username, Integer oid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在支付界面获取订单信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> oid 订单id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 订单信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    OrderVO <span class="title function_">getOrderInfo</span><span class="params">(Integer uid, String username, Integer oid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="OrderServiceImpl-1"><a href="#OrderServiceImpl-1" class="headerlink" title="OrderServiceImpl"></a>OrderServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IOrderService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IUserService userService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AddressServiceImpl addressService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    CartServiceImpl cartService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    OrderMapper orderMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    OrderItemMapper orderItemMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    OrderVOMapper orderVOMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    ProductMapper productMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;OrderVO&gt; <span class="title function_">getOrderVOs</span><span class="params">(Integer uid, String username)</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        List&lt;OrderVO&gt; orderVOS = orderVOMapper.getOrderVOs(uid);</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(orderVOS)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceException</span>(<span class="string">&quot;订单数据不存在&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> orderVOS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;OrderVO&gt; <span class="title function_">getOrderVOsByS</span><span class="params">(Integer uid, String username, List&lt;Integer&gt; status)</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        MPJLambdaWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> <span class="title class_">MPJLambdaWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.select(Order::getOid, Order::getAid, Order::getStatus, Order::getRecvName,</span><br><span class="line">                       Order::getTotalPrice, Order::getOrderTime, Order::getPayTime)</span><br><span class="line">               .select(Address::getZip, Address::getAddress, Address::getPhone,</span><br><span class="line">                       Address::getProvinceName, Address::getCityName, Address::getAreaName)</span><br><span class="line">               .leftJoin(Address.class, Address::getAid, Order::getAid)</span><br><span class="line">               .eq(Order::getUid, uid)</span><br><span class="line">               .in(Order::getStatus, status)</span><br><span class="line">               .selectCollection(OrderItem.class, OrderVO::getOrderItems)</span><br><span class="line">               .leftJoin(OrderItem.class, OrderItem::getOid, Order::getOid);</span><br><span class="line">        List&lt;OrderVO&gt; orderVOS = orderMapper.selectJoinList(OrderVO.class, wrapper);</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(orderVOS)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceException</span>(<span class="string">&quot;订单数据不存在&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> orderVOS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> OrderVO <span class="title function_">getOrderVO</span><span class="params">(Integer uid, String username, Integer oid)</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        <span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> orderVOMapper.getOrderVO(uid, oid);</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(orderVO)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceException</span>(<span class="string">&quot;订单数据不存在&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> orderVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> OrderVO <span class="title function_">getOrderInfo</span><span class="params">(Integer uid, String username, Integer oid)</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.selectOne(<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;Order&gt;().eq(Order::getUid, uid).eq(Order::getOid, oid));</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(order)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderNotFoundException</span>(<span class="string">&quot;没有该订单&quot;</span>);</span><br><span class="line">        <span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> getOrderVO(uid, username, oid);</span><br><span class="line">        orderVO.setAid(<span class="literal">null</span>);</span><br><span class="line">        orderVO.setRecvName(<span class="literal">null</span>);</span><br><span class="line">        orderVO.setPhone(<span class="literal">null</span>);</span><br><span class="line">        orderVO.setProvinceName(<span class="literal">null</span>);</span><br><span class="line">        orderVO.setCityName(<span class="literal">null</span>);</span><br><span class="line">        orderVO.setAreaName(<span class="literal">null</span>);</span><br><span class="line">        orderVO.setAddress(<span class="literal">null</span>);</span><br><span class="line">        orderVO.setStatus(<span class="literal">null</span>);</span><br><span class="line">        orderVO.setOrderTime(<span class="literal">null</span>);</span><br><span class="line">        orderVO.setPayTime(<span class="literal">null</span>);</span><br><span class="line">        orderVO.setZip(<span class="literal">null</span>);</span><br><span class="line">        orderVO.setOrderItems(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> orderVO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="后端-控制层-16"><a href="#后端-控制层-16" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="设计请求-9"><a href="#设计请求-9" class="headerlink" title="设计请求"></a>设计请求</h5><blockquote>
<p><strong>请求路径：&#x2F;order&#x2F;get_orderVOs</strong></p>
<p><strong>请求参数：HttpSession session</strong></p>
<p><strong>请求类型：GET</strong></p>
<p><strong>响应类型：JsonResult&lt;List&lt; OrderVO &gt;&gt;</strong></p>
<p><strong>请求路径：&#x2F;order&#x2F;get_orderVOsByS</strong></p>
<p><strong>请求参数：HttpSession session</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt;List&lt; OrderVO &gt;&gt;</strong></p>
<p><strong>请求路径：&#x2F;order&#x2F;get_orderInfo</strong></p>
<p><strong>请求参数：HttpSession session，Integer oid</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt;List&lt; OrderVO &gt;&gt;</strong></p>
</blockquote>
<h5 id="OrderController-1"><a href="#OrderController-1" class="headerlink" title="OrderController"></a>OrderController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/order&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;订单相关接口描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IOrderService service;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取订单列表&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户获取订单列表，返回List&lt;OrderVO&gt;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 8000, message = &quot;用户未登录&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 9000, message = &quot;订单数据不存在&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;get_orderVOs&quot;, method = &#123;RequestMethod.GET, RequestMethod.POST&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;List&lt;OrderVO&gt;&gt; <span class="title function_">getOrderVOs</span><span class="params">(HttpSession session)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, service.getOrderVOs(uid, username));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取订单&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户获取订单，返回OrderVO对象&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 8000, message = &quot;用户未登录&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 9000, message = &quot;参数错误&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;oid&quot;, value = &quot;订单ID&quot;, required = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;get_orderVO&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;OrderVO&gt; <span class="title function_">getOrderVO</span><span class="params">(HttpSession session, Integer oid)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, service.getOrderVO(uid, username, oid));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;通过订单状态获取订单列表&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户通过订单状态获取订单列表，返回List&lt;OrderVO&gt;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 8000, message = &quot;用户未登录&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 9000, message = &quot;订单数据不存在&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;oid&quot;, value = &quot;订单ID&quot;, required = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;get_orderVOsByS&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;List&lt;OrderVO&gt;&gt; <span class="title function_">geOrderVOsByS</span><span class="params">(HttpSession session, String status)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;Integer&gt; params = JSON.parseArray(status, Integer.class);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, service.getOrderVOsByS(uid, username, params));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获得订单信息&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于获得订单信息，返回OrderVO对象&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 6006, message = &quot;订单数据不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 8000, message = &quot;用户未登录&quot;),</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;oid&quot;, value = &quot;订单ID&quot;, required = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;get_orderInfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;OrderVO&gt; <span class="title function_">getOrderInfo</span><span class="params">(HttpSession session, Integer oid)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, service.getOrderInfo(uid, username, oid));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口测试：略</strong></p>
</blockquote>
<h4 id="前端界面-15"><a href="#前端界面-15" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    $(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> url = <span class="string">&quot;/order/get_orderVOs&quot;</span></span><br><span class="line">        <span class="keyword">let</span> status = $.<span class="title function_">getUrlParam</span>(<span class="string">&quot;status&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(status !== <span class="literal">null</span> &amp;&amp; status !== <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(status === <span class="string">&quot;0&quot;</span> || status === <span class="string">&quot;1&quot;</span>)&#123;</span><br><span class="line">                url = <span class="string">&quot;/order/get_orderVOsByS&quot;</span></span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">let</span> res = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">                status = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res)</span><br><span class="line">                url = <span class="string">&quot;/order/get_orderVOsByS&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">showList</span>(url, status)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">function</span> <span class="title function_">showList</span>(<span class="params">url, status</span>)&#123;</span><br><span class="line">    	$(<span class="string">&quot;#orderDetail&quot;</span>).<span class="title function_">empty</span>()</span><br><span class="line">        <span class="title function_">showOrderVOs</span>(url, status)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">setStatus</span>(<span class="params">status</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> str = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">switch</span> (status)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>: str = <span class="string">&quot;未付款&quot;</span>; <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: str = <span class="string">&quot;已付款&quot;</span>; <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>: str = <span class="string">&quot;已取消&quot;</span>; <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>: str = <span class="string">&quot;已关闭&quot;</span>; <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>: str = <span class="string">&quot;已完成&quot;</span>; <span class="keyword">break</span></span><br><span class="line">            <span class="attr">default</span>: <span class="title function_">confirm</span>(<span class="string">&quot;订单状态错误&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> str</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">setOption</span>(<span class="params">status</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> str = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span>(status === <span class="string">&quot;未付款&quot;</span>)&#123;</span><br><span class="line">            str = <span class="string">&quot;去付款&quot;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(status === <span class="string">&quot;已付款&quot;</span>)&#123;</span><br><span class="line">            str = <span class="string">&quot;确定收货&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> str</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">delOrder</span>(<span class="params">oid</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_">confirm</span>(<span class="string">&quot;确定要删除该订单吗？&quot;</span>))&#123;</span><br><span class="line">            $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">                <span class="attr">url</span>: <span class="string">&quot;/order/del_order&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">                <span class="attr">data</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;oid&quot;</span>: oid</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">                <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                        <span class="keyword">let</span> url = <span class="string">&quot;/order/get_orderVOs&quot;</span></span><br><span class="line">                        <span class="title function_">showList</span>(url)</span><br><span class="line">                    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="title function_">confirm</span>(json.<span class="property">state</span> + <span class="string">&quot;: &quot;</span> + json.<span class="property">message</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                    <span class="title function_">error</span>(xhr)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">operation</span>(<span class="params">oid</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> opId = <span class="string">&quot;op&quot;</span> + oid.<span class="title function_">toString</span>()</span><br><span class="line">        <span class="keyword">let</span> str = $(<span class="string">&quot;#&quot;</span>+opId).<span class="title function_">html</span>()</span><br><span class="line">        <span class="keyword">if</span>(str === <span class="string">&quot;去付款&quot;</span>)&#123;</span><br><span class="line">            sessionStorage.<span class="title function_">setItem</span>(<span class="string">&quot;oid&quot;</span>, oid)</span><br><span class="line">            location.<span class="property">href</span>=<span class="string">&quot;payment.html&quot;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(str === <span class="string">&quot;确定收货&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_">confirm</span>(<span class="string">&quot;确认收到货了吗？&quot;</span>))&#123;</span><br><span class="line">                <span class="title function_">receipt</span>(oid)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 确认收货</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">receipt</span>(<span class="params">oid</span>)&#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/order/receipt&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;</span><br><span class="line">                <span class="string">&quot;oid&quot;</span>: oid,</span><br><span class="line">                <span class="string">&quot;status&quot;</span>: <span class="number">4</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                    <span class="keyword">let</span> url =  <span class="string">&quot;/order/get_orderVOs&quot;</span></span><br><span class="line">                    <span class="title function_">showList</span>(url)</span><br><span class="line">                &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="title function_">confirm</span>(json.<span class="property">state</span> + <span class="string">&quot;: &quot;</span> + json.<span class="property">message</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                <span class="title function_">error</span>(xhr)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">elementHandle</span>(<span class="params">orderVO, tbId, apId, opId</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> oid = orderVO.<span class="property">oid</span></span><br><span class="line">        <span class="keyword">let</span> element =</span><br><span class="line">            <span class="string">&#x27;&lt;div class=&quot;panel panel-default&quot;&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;div class=&quot;panel-heading&quot;&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;p class=&quot;panel-title&quot;&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;订单号：&lt;label id=&quot;#&#123;oid&#125;&quot; style=&quot;color: red&quot;&gt;11010003#&#123;oid&#125;&lt;/label&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;，下单时间&lt;label style=&quot;color: #4288c3&quot;&gt;#&#123;orderTime&#125;&lt;/label&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;，收货人&lt;label style=&quot;color: #4288c3&quot;&gt;#&#123;name&#125;&lt;/label&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;a class=&quot;pull-right&quot; style=&quot;cursor: pointer; padding: 0 15px; color: #72ACE3&quot; onclick=&quot;delOrder(#&#123;oid&#125;)&quot;&gt;删除订单&lt;/a&gt;&#x27;</span>+</span><br><span class="line">            <span class="string">&#x27;&lt;/p&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;/div&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;div class=&quot;panel-body&quot;&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;table class=&quot;orders-table&quot; width=&quot;100%&quot;&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;thead&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;tr&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;th width=&quot;15%&quot;&gt;&lt;/th&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;th width=&quot;30%&quot;&gt;商品&lt;/th&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;th width=&quot;8%&quot;&gt;单价&lt;/th&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;th width=&quot;8%&quot;&gt;数量&lt;/th&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;th width=&quot;9%&quot;&gt;小计&lt;/th&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;th width=&quot;10%&quot;&gt;状态&lt;/th&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;/tr&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;/thead&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;tbody class=&quot;orders-body&quot; id=#&#123;tbId&#125;&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;/tbody&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;/table&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;div&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;a class=&quot;pull-right&quot; style=&quot;cursor: pointer; color: #72ACE3&quot; id=#&#123;opId&#125; onclick=&quot;operation(#&#123;oid&#125;)&quot;&gt;&lt;/a&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;a class=&quot;pull-right&quot; style=&quot;cursor: pointer; color: #72ACE3; padding: 0 15px;&quot; href=&quot;orderInfo.html?oid=#&#123;oid&#125;&quot;&gt;订单详情&lt;/a&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;span class=&quot;pull-right&quot; style=&quot;padding: 0 15px;&quot;&gt;订单总金额：¥&lt;label style=&quot;color: red&quot;&gt;#&#123;totalPrice&#125;&lt;/label&gt;元&lt;/span&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;/div&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;/div&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;/div&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">        element = element.<span class="title function_">replace</span>(<span class="regexp">/#&#123;oid&#125;/g</span>, oid)</span><br><span class="line">        <span class="keyword">let</span> orderTime = <span class="title function_">getDate</span>(orderVO.<span class="property">orderTime</span>)</span><br><span class="line">        element = element.<span class="title function_">replace</span>(<span class="regexp">/#&#123;orderTime&#125;/g</span>, orderTime)</span><br><span class="line">        element = element.<span class="title function_">replace</span>(<span class="regexp">/#&#123;name&#125;/g</span>, orderVO.<span class="property">recvName</span>)</span><br><span class="line">        element = element.<span class="title function_">replace</span>(<span class="regexp">/#&#123;tbId&#125;/g</span>, tbId)</span><br><span class="line">        element = element.<span class="title function_">replace</span>(<span class="regexp">/#&#123;allPriceId&#125;/g</span>, apId)</span><br><span class="line">        element = element.<span class="title function_">replace</span>(<span class="regexp">/#&#123;opId&#125;/g</span>, opId)</span><br><span class="line">        element = element.<span class="title function_">replace</span>(<span class="regexp">/#&#123;totalPrice&#125;/g</span>, orderVO.<span class="property">totalPrice</span>)</span><br><span class="line">        $(<span class="string">&quot;#orderDetail&quot;</span>).<span class="title function_">append</span>(element)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">showOrderVOs</span>(<span class="params">url, status</span>)&#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: url,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;</span><br><span class="line">                <span class="string">&quot;status&quot;</span>: status</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(json.<span class="property">state</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                    <span class="keyword">let</span> list = json.<span class="property">data</span></span><br><span class="line">                    <span class="keyword">if</span>(list.<span class="property">length</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++)&#123;</span><br><span class="line">                            <span class="comment">// 先处理该用户第一条订单的地址等信息</span></span><br><span class="line">                            <span class="keyword">let</span> orderVO = list[i]</span><br><span class="line">                            <span class="keyword">let</span> oid = orderVO.<span class="property">oid</span></span><br><span class="line">                            <span class="keyword">let</span> tbId = <span class="string">&quot;tb&quot;</span> + oid.<span class="title function_">toString</span>()</span><br><span class="line">                            <span class="keyword">let</span> apId = <span class="string">&quot;ap&quot;</span> + oid.<span class="title function_">toString</span>()</span><br><span class="line">                            <span class="keyword">let</span> opId = <span class="string">&quot;op&quot;</span> + oid.<span class="title function_">toString</span>()</span><br><span class="line">                            <span class="title function_">elementHandle</span>(orderVO, tbId, apId, opId)</span><br><span class="line">                            <span class="keyword">let</span> odItList = list[i].<span class="property">orderItems</span></span><br><span class="line">                            <span class="keyword">if</span>(odItList.<span class="property">length</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                                <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; odItList.<span class="property">length</span>; j++)&#123;</span><br><span class="line">                                    <span class="keyword">let</span> tr = <span class="string">&#x27;&lt;tr&gt;&#x27;</span> +</span><br><span class="line">                                        <span class="string">&#x27;&lt;td&gt;&lt;img src=&quot;..#&#123;image&#125;collect.png&quot; class=&quot;img-responsive&quot; /&gt;&lt;/td&gt;&#x27;</span> +</span><br><span class="line">                                        <span class="string">&#x27;&lt;td&gt;#&#123;title&#125;&lt;/td&gt;&#x27;</span> +</span><br><span class="line">                                        <span class="string">&#x27;&lt;td&gt;¥&lt;span&gt;#&#123;price&#125;&lt;/span&gt;&lt;/td&gt;&#x27;</span> +</span><br><span class="line">                                        <span class="string">&#x27;&lt;td&gt;#&#123;num&#125;件&lt;/td&gt;&#x27;</span> +</span><br><span class="line">                                        <span class="string">&#x27;&lt;td&gt;¥&lt;span&gt;#&#123;subPrice&#125;&lt;/span&gt;&lt;/td&gt;&#x27;</span> +</span><br><span class="line">                                        <span class="string">&#x27;&lt;td&gt;&#x27;</span> +</span><br><span class="line">                                        <span class="string">&#x27;&lt;div&gt;#&#123;status&#125;&lt;/div&gt;&#x27;</span> +</span><br><span class="line">                                        <span class="string">&#x27;&lt;/td&gt;&#x27;</span> +</span><br><span class="line">                                        <span class="string">&#x27;&lt;/tr&gt;&#x27;</span></span><br><span class="line">                                    tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;image&#125;/g</span>, odItList[j].<span class="property">image</span>)</span><br><span class="line">                                    tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;title&#125;/g</span>, odItList[j].<span class="property">title</span>)</span><br><span class="line">                                    tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;price&#125;/g</span>, odItList[j].<span class="property">price</span>)</span><br><span class="line">                                    tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;num&#125;/g</span>, odItList[j].<span class="property">num</span>)</span><br><span class="line">                                    <span class="keyword">let</span> subPrice = <span class="built_in">parseFloat</span>((odItList[j].<span class="property">price</span> * odItList[j].<span class="property">num</span>).<span class="title function_">toString</span>())</span><br><span class="line">                                    tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;subPrice&#125;/g</span>, subPrice)</span><br><span class="line">                                    <span class="keyword">let</span> status = <span class="title function_">setStatus</span>(orderVO.<span class="property">status</span>)</span><br><span class="line">                                    <span class="keyword">let</span> option = <span class="title function_">setOption</span>(status)</span><br><span class="line">                                    tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;status&#125;/g</span>, status)</span><br><span class="line">                                    $(<span class="string">&quot;#&quot;</span>+tbId).<span class="title function_">append</span>(tr)</span><br><span class="line">                                    $(<span class="string">&quot;#&quot;</span>+opId).<span class="title function_">html</span>(option)</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="title function_">confirm</span>(json.<span class="property">state</span> + <span class="string">&quot;: &quot;</span> + json.<span class="property">message</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>)&#123;</span><br><span class="line">                <span class="title function_">error</span>(xhr)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="创建订单"><a href="#创建订单" class="headerlink" title="创建订单"></a>创建订单</h3><h4 id="后端-持久层-17"><a href="#后端-持久层-17" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<p><strong>与前面一致</strong></p>
</blockquote>
<h4 id="后端-业务层-17"><a href="#后端-业务层-17" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="IOrderService-2"><a href="#IOrderService-2" class="headerlink" title="IOrderService"></a>IOrderService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理订单数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IOrderService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建订单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> aid 收货地址id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cids 购物车数据id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 订单id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">createOrderByC</span><span class="params">(Integer uid, String username, Integer aid, List&lt;Integer&gt; cids)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建订单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> aid 收货地址id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pid 商品id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> num 商品数量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 订单id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">createOrderByP</span><span class="params">(Integer uid, String username, Integer aid, Integer pid, Integer num)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="OrderServiceImpl-2"><a href="#OrderServiceImpl-2" class="headerlink" title="OrderServiceImpl"></a>OrderServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IOrderService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IUserService userService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AddressServiceImpl addressService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    CartServiceImpl cartService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    OrderMapper orderMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    OrderItemMapper orderItemMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    OrderVOMapper orderVOMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    ProductMapper productMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">createOrderByC</span><span class="params">(Integer uid, String username, Integer aid, List&lt;Integer&gt; cids)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 根据uid和aid查地址创建order，根据uid和cids查购物车数据</span></span><br><span class="line">        <span class="comment">// 先插入order，再插入orderItem</span></span><br><span class="line">        <span class="comment">// 先查出VO</span></span><br><span class="line">        List&lt;CartVO&gt; carts = cartService.getCartVOsByCids(uid, username, cids);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="comment">// 计算商品总价</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">totalPrice</span> <span class="operator">=</span> carts.stream().mapToLong(cart -&gt; (cart.getPrice() * cart.getNum())).sum();</span><br><span class="line"></span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> addressService.getAddress(aid, uid, username);</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setUid(uid);</span><br><span class="line">        order.setAid(aid);</span><br><span class="line">        order.setRecvName(address.getName());</span><br><span class="line">        order.setRecvPhone(address.getPhone());</span><br><span class="line">        order.setRecvProvince(address.getProvinceName());</span><br><span class="line">        order.setRecvCity(address.getCityName());</span><br><span class="line">        order.setRecvArea(address.getAreaName());</span><br><span class="line">        order.setRecvAddress(address.getAddress());</span><br><span class="line">        order.setTotalPrice(totalPrice);</span><br><span class="line">        order.setStatus(<span class="number">0</span>);</span><br><span class="line">        order.setOrderTime(date);</span><br><span class="line">        <span class="comment">// 补全数据：日志</span></span><br><span class="line">        order.setCreatedUser(username);</span><br><span class="line">        order.setCreatedTime(date);</span><br><span class="line">        order.setModifiedUser(username);</span><br><span class="line">        order.setModifiedTime(date);</span><br><span class="line">        <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> orderMapper.insert(order);</span><br><span class="line">        <span class="keyword">if</span>(row != <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;插入数据时发生异常&quot;</span>);</span><br><span class="line"></span><br><span class="line">        carts.forEach(cart -&gt; &#123;</span><br><span class="line">            <span class="comment">// 创建订单商品数据</span></span><br><span class="line">            <span class="type">OrderItem</span> <span class="variable">item</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderItem</span>();</span><br><span class="line">            <span class="comment">// 补全数据：setOid(order.getOid())</span></span><br><span class="line">            item.setOid(order.getOid());</span><br><span class="line">            <span class="comment">// 补全数据：pid, title, image, price, num</span></span><br><span class="line">            item.setPid(cart.getPid());</span><br><span class="line">            item.setTitle(cart.getTitle());</span><br><span class="line">            item.setImage(cart.getImage());</span><br><span class="line">            item.setPrice(cart.getRealPrice());</span><br><span class="line">            item.setNum(cart.getNum());</span><br><span class="line">            <span class="comment">// 补全数据：4项日志</span></span><br><span class="line">            item.setCreatedUser(username);</span><br><span class="line">            item.setCreatedTime(date);</span><br><span class="line">            item.setModifiedUser(username);</span><br><span class="line">            item.setModifiedTime(date);</span><br><span class="line">            <span class="comment">// 插入订单商品数据</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">rows2</span> <span class="operator">=</span> orderItemMapper.insert(item);</span><br><span class="line">            <span class="keyword">if</span> (rows2 != <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;插入数据时发生异常&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> order.getOid();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">createOrderByP</span><span class="params">(Integer uid, String username, Integer aid, Integer pid, Integer num)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> addressService.getAddress(aid, uid, username);</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productMapper.selectById(pid);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">totalPrice</span> <span class="operator">=</span> product.getPrice() * num;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setUid(uid);</span><br><span class="line">        order.setAid(aid);</span><br><span class="line">        order.setRecvName(address.getName());</span><br><span class="line">        order.setRecvPhone(address.getPhone());</span><br><span class="line">        order.setRecvProvince(address.getProvinceName());</span><br><span class="line">        order.setRecvCity(address.getCityName());</span><br><span class="line">        order.setRecvArea(address.getAreaName());</span><br><span class="line">        order.setRecvAddress(address.getAddress());</span><br><span class="line">        order.setTotalPrice(totalPrice);</span><br><span class="line">        order.setStatus(<span class="number">0</span>);</span><br><span class="line">        order.setOrderTime(date);</span><br><span class="line">        <span class="comment">// 补全数据：日志</span></span><br><span class="line">        order.setCreatedUser(username);</span><br><span class="line">        order.setCreatedTime(date);</span><br><span class="line">        order.setModifiedUser(username);</span><br><span class="line">        order.setModifiedTime(date);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> orderMapper.insert(order);</span><br><span class="line">        <span class="keyword">if</span>(row != <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;插入数据时发生异常&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建订单商品数据</span></span><br><span class="line">        <span class="type">OrderItem</span> <span class="variable">item</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderItem</span>();</span><br><span class="line">        <span class="comment">// 补全数据：</span></span><br><span class="line">        item.setOid(order.getOid());</span><br><span class="line">        <span class="comment">// 补全数据：pid, title, image, price, num</span></span><br><span class="line">        item.setPid(pid);</span><br><span class="line">        item.setTitle(product.getTitle());</span><br><span class="line">        item.setImage(product.getImage());</span><br><span class="line">        item.setPrice(product.getPrice());</span><br><span class="line">        item.setNum(num);</span><br><span class="line">        <span class="comment">// 补全数据：4项日志</span></span><br><span class="line">        item.setCreatedUser(username);</span><br><span class="line">        item.setCreatedTime(date);</span><br><span class="line">        item.setModifiedUser(username);</span><br><span class="line">        item.setModifiedTime(date);</span><br><span class="line">        <span class="comment">// 插入订单商品数据</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">rows2</span> <span class="operator">=</span> orderItemMapper.insert(item);</span><br><span class="line">        <span class="keyword">if</span> (rows2 != <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;插入数据时发生异常&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> order.getOid();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>单元测试：略</strong></p>
</blockquote>
<h4 id="后端-控制层-17"><a href="#后端-控制层-17" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="设计请求-10"><a href="#设计请求-10" class="headerlink" title="设计请求"></a>设计请求</h5><blockquote>
<p><strong>请求路径：&#x2F;order&#x2F;create_orderByC</strong></p>
<p><strong>请求参数：HttpSession session，Integer aid，String cids HttpSession session，Integer aid，Integer pid，Integer num</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt; Integer &gt;</strong></p>
<p><strong>请求路径：&#x2F;order&#x2F;create_orderByP</strong></p>
<p><strong>请求参数：HttpSession session，Integer aid，Integer pid，Integer num</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt; Integer &gt;</strong></p>
</blockquote>
<h5 id="OrderController-2"><a href="#OrderController-2" class="headerlink" title="OrderController"></a>OrderController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/order&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;订单相关接口描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="meta">@Resource</span></span><br><span class="line"> IOrderService service;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@ApiOperation(value = &quot;根据购物车数据创建订单&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户创建订单，返回Oid&quot;)</span></span><br><span class="line"> <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 4000, message = &quot;数据插入失败&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 6004, message = &quot;商品不存在&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 6005, message = &quot;购物车数据不存在&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 8000, message = &quot;用户未登录&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 9000, message = &quot;参数错误&quot;)</span></span><br><span class="line"><span class="meta"> &#125;)</span></span><br><span class="line"> <span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">         @ApiImplicitParam(name = &quot;aid&quot;, value = &quot;收货地址ID&quot;, required = true),</span></span><br><span class="line"><span class="meta">         @ApiImplicitParam(name = &quot;cids&quot;, value = &quot;购物车ID&quot;, required = true)</span></span><br><span class="line"><span class="meta"> &#125;)</span></span><br><span class="line"> <span class="meta">@PostMapping(&quot;create_orderByC&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> JsonResult&lt;Integer&gt; <span class="title function_">createOrderByC</span><span class="params">(HttpSession session, Integer aid, String cids)</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">     <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">oid</span> <span class="operator">=</span> service.createOrderByC(uid, username, aid, JSON.parseArray(cids, Integer.class));</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, oid);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@ApiOperation(value = &quot;根据商品数据创建订单&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户创建订单，返回Oid&quot;)</span></span><br><span class="line"> <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 4000, message = &quot;数据插入失败&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 6004, message = &quot;商品不存在&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 8000, message = &quot;用户未登录&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 9000, message = &quot;参数错误&quot;)</span></span><br><span class="line"><span class="meta"> &#125;)</span></span><br><span class="line"> <span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">         @ApiImplicitParam(name = &quot;aid&quot;, value = &quot;收货地址ID&quot;, required = true),</span></span><br><span class="line"><span class="meta">         @ApiImplicitParam(name = &quot;pid&quot;, value = &quot;商品ID&quot;, required = true),</span></span><br><span class="line"><span class="meta">         @ApiImplicitParam(name = &quot;num&quot;, value = &quot;商品数量&quot;, required = true)</span></span><br><span class="line"><span class="meta"> &#125;)</span></span><br><span class="line"> <span class="meta">@PostMapping(&quot;create_orderByP&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> JsonResult&lt;Integer&gt; <span class="title function_">createOrderByP</span><span class="params">(HttpSession session, Integer aid, Integer pid, Integer num)</span>&#123;</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">     <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">oid</span> <span class="operator">=</span> service.createOrderByP(uid, username, aid, pid, num);</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, oid);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口测试：略</strong></p>
</blockquote>
<h4 id="前端界面-16"><a href="#前端界面-16" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<p><strong>略</strong></p>
</blockquote>
<h3 id="去付款"><a href="#去付款" class="headerlink" title="去付款"></a>去付款</h3><blockquote>
<p><strong>与商品管理中立即购买基本一致</strong></p>
</blockquote>
<h3 id="删除订单"><a href="#删除订单" class="headerlink" title="删除订单"></a>删除订单</h3><h4 id="后端-持久层-18"><a href="#后端-持久层-18" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<p><strong>与前面一致</strong></p>
</blockquote>
<h4 id="后端-业务层-18"><a href="#后端-业务层-18" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="IOrderService-3"><a href="#IOrderService-3" class="headerlink" title="IOrderService"></a>IOrderService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理订单数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IOrderService</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除订单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> oid 订单id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteOrder</span><span class="params">(Integer uid, String username, Integer oid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="OrderServiceImpl-3"><a href="#OrderServiceImpl-3" class="headerlink" title="OrderServiceImpl"></a>OrderServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IOrderService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IUserService userService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    OrderMapper orderMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    OrderItemMapper orderItemMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteOrder</span><span class="params">(Integer uid, String username, Integer oid)</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        LambdaQueryWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(Order::getOid, oid);</span><br><span class="line">        orderMapper.delete(wrapper);</span><br><span class="line">        LambdaQueryWrapper&lt;OrderItem&gt; wrapper1 = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper1.eq(OrderItem::getOid, oid);</span><br><span class="line">        orderItemMapper.delete(wrapper1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>单元测试：略</strong></p>
</blockquote>
<h4 id="后端-控制层-18"><a href="#后端-控制层-18" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="设计请求-11"><a href="#设计请求-11" class="headerlink" title="设计请求"></a>设计请求</h5><blockquote>
<p><strong>请求路径：&#x2F;order&#x2F;del_order</strong></p>
<p><strong>请求参数：HttpSession session，Integer oid</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt; Void &gt;</strong></p>
</blockquote>
<h5 id="OrderController-3"><a href="#OrderController-3" class="headerlink" title="OrderController"></a>OrderController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/order&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;订单相关接口描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="meta">@ApiOperation(value = &quot;删除订单&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户删除订单&quot;)</span></span><br><span class="line"> <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 5001, message = &quot;用户不存在&quot;),</span></span><br><span class="line"><span class="meta">         @ApiResponse(code = 8000, message = &quot;用户未登录&quot;)</span></span><br><span class="line"><span class="meta"> &#125;)</span></span><br><span class="line"> <span class="meta">@ApiImplicitParam(name = &quot;oid&quot;, value = &quot;订单ID&quot;, required = true)</span></span><br><span class="line"> <span class="meta">@PostMapping(&quot;del_order&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">delOrder</span><span class="params">(HttpSession session, Integer oid)</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">     <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">     service.deleteOrder(uid, username, oid);</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口测试：略</strong></p>
</blockquote>
<h4 id="前端界面-17"><a href="#前端界面-17" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<p><strong>略</strong></p>
</blockquote>
<h2 id="收藏管理"><a href="#收藏管理" class="headerlink" title="收藏管理"></a>收藏管理</h2><h3 id="创建数据表-5"><a href="#创建数据表-5" class="headerlink" title="创建数据表"></a>创建数据表</h3><blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">collect</span>`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">  `uid` <span class="type">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">  `pid` <span class="type">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品id&#x27;</span>,</span><br><span class="line">  `image` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品图片&#x27;</span>,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品标题&#x27;</span>,</span><br><span class="line">  `price` <span class="type">bigint</span>(<span class="number">10</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品单价&#x27;</span>,</span><br><span class="line">  `status` <span class="type">int</span>(<span class="number">1</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品状态：1收藏中，0取消收藏&#x27;</span>,</span><br><span class="line">  `created_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `modified_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;最后修改时间&#x27;</span>,</span><br><span class="line">  `created_user` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">  `modified_user` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;最后修改人&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">28</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> Compact;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="创建实体类-5"><a href="#创建实体类-5" class="headerlink" title="创建实体类"></a>创建实体类</h3><blockquote>
<h5 id="Collect"><a href="#Collect" class="headerlink" title="Collect"></a>Collect</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;收藏商品实体类：Collect&quot;, description = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;对应数据库中的collect表&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Collect</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;主键ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;用户ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;商品ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer pid;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;商品图片&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;商品标题&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;商品单价&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long price;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;商品状态：1-收藏中，0-未收藏&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="显示收藏"><a href="#显示收藏" class="headerlink" title="显示收藏"></a>显示收藏</h3><h4 id="后端-持久层-19"><a href="#后端-持久层-19" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<h5 id="CollectMapper"><a href="#CollectMapper" class="headerlink" title="CollectMapper"></a>CollectMapper</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理收藏商品数据操作的持久层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CollectMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Collect&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="后端-业务层-19"><a href="#后端-业务层-19" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="ICollectService"><a href="#ICollectService" class="headerlink" title="ICollectService"></a>ICollectService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理收藏商品数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICollectService</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取收藏商品列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page 当前分页的信息，包含页码和每页数据条数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 收藏商品列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Collect&gt; <span class="title function_">getCollects</span><span class="params">(IPage&lt;Collect&gt; page, Integer uid, String username)</span>;</span><br><span class="line">    </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取在收藏中的收藏商品数量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 在收藏中的收藏商品数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">getCount</span><span class="params">(Integer uid, String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="CollectServiceImpl"><a href="#CollectServiceImpl" class="headerlink" title="CollectServiceImpl"></a>CollectServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CollectServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ICollectService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IUserService userService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    CollectMapper mapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IProductService productService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Collect&gt;getCollects(IPage&lt;Collect&gt; iPage, Integer uid, String username)</span><br><span class="line">    &#123;</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        LambdaQueryWrapper&lt;Collect&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.select(Collect::getImage, Collect::getTitle, Collect::getPid, Collect::getPrice)</span><br><span class="line">               .eq(Collect::getUid, uid)</span><br><span class="line">               .ne(Collect::getStatus, <span class="number">0</span>);</span><br><span class="line">        List&lt;Collect&gt; records = mapper.selectPage(iPage, wrapper).getRecords();</span><br><span class="line">        <span class="keyword">if</span>(Objects.isNull(records)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ProductNotFoundException</span>(<span class="string">&quot;没有商品信息&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> records;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getCount</span><span class="params">(Integer uid, String username)</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        LambdaQueryWrapper&lt;Collect&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(Collect::getUid, uid)</span><br><span class="line">               .eq(Collect::getStatus, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> mapper.selectCount(wrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>单元测试：略</strong></p>
</blockquote>
<h4 id="后端-控制层-19"><a href="#后端-控制层-19" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="设计请求-12"><a href="#设计请求-12" class="headerlink" title="设计请求"></a>设计请求</h5><blockquote>
<p><strong>请求路径：&#x2F;product&#x2F;get_collects</strong></p>
<p><strong>请求参数：HttpSession session，Long page，Long limit</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt;List&lt; Collect &gt;&gt;</strong></p>
</blockquote>
<h5 id="ProductController-2"><a href="#ProductController-2" class="headerlink" title="ProductController"></a>ProductController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/product&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;商品相关接口描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取收藏商品&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户获取收藏商品，返回List&lt;Collect&gt;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 6004, message = &quot;商品不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 8000, message = &quot;用户未登录&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;page&quot;, value = &quot;页码&quot;, required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;limit&quot;, value = &quot;每页数据条数&quot;, required = true),</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;get_collects&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;List&lt;Collect&gt;&gt; <span class="title function_">getCollects</span><span class="params">(HttpSession session, Long page, Long limit)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">        Page&lt;Collect&gt; iPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, limit);</span><br><span class="line">        List&lt;Collect&gt; collects = collectService.getCollects(iPage, uid, username);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, collects);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口测试：略</strong></p>
</blockquote>
<h4 id="前端界面-18"><a href="#前端界面-18" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<p><strong>略</strong></p>
</blockquote>
<h3 id="加入-x2F-取消收藏"><a href="#加入-x2F-取消收藏" class="headerlink" title="加入&#x2F;取消收藏"></a>加入&#x2F;取消收藏</h3><h4 id="后端-持久层-20"><a href="#后端-持久层-20" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<p><strong>与前面一致</strong></p>
</blockquote>
<h4 id="后端-业务层-20"><a href="#后端-业务层-20" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="ICollectService-1"><a href="#ICollectService-1" class="headerlink" title="ICollectService"></a>ICollectService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理收藏商品数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICollectService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加收藏商品</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pid 商品id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addCollect</span><span class="params">(Integer uid, String username, Integer pid)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置收藏商品状态</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pid 商品id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status 收藏商品状态：1-收藏中，0-未收藏</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setStatus</span><span class="params">(Integer uid, String username, Integer pid, Integer status)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="CollectServiceImpl-1"><a href="#CollectServiceImpl-1" class="headerlink" title="CollectServiceImpl"></a>CollectServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CollectServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ICollectService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IUserService userService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    CollectMapper mapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IProductService productService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCollect</span><span class="params">(Integer uid, String username, Integer pid)</span></span><br><span class="line">    &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Collect&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.select(Collect::getId)</span><br><span class="line">               .eq(Collect::getPid, pid);</span><br><span class="line">        <span class="type">Collect</span> <span class="variable">data</span> <span class="operator">=</span> mapper.selectOne(wrapper);</span><br><span class="line">        <span class="keyword">if</span>(!Objects.isNull(data)) &#123;</span><br><span class="line">            data.setStatus(<span class="number">1</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> mapper.updateById(data);</span><br><span class="line">            <span class="keyword">if</span>(row != <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;更新数据时发生异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">Product</span> <span class="variable">produce</span> <span class="operator">=</span> productService.getProductById(pid);</span><br><span class="line">            <span class="type">Collect</span> <span class="variable">collect</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Collect</span>();</span><br><span class="line">            collect.setUid(uid);</span><br><span class="line">            collect.setPid(pid);</span><br><span class="line">            collect.setImage(produce.getImage());</span><br><span class="line">            collect.setTitle(produce.getTitle());</span><br><span class="line">            collect.setPrice(produce.getPrice());</span><br><span class="line">            collect.setStatus(<span class="number">1</span>);</span><br><span class="line">            <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">            collect.setCreatedUser(username);</span><br><span class="line">            collect.setModifiedUser(username);</span><br><span class="line">            collect.setModifiedTime(date);</span><br><span class="line">            collect.setCreatedTime(date);</span><br><span class="line">            <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> mapper.insert(collect);</span><br><span class="line">            <span class="keyword">if</span>(row != <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;插入数据时发生异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStatus</span><span class="params">(Integer uid, String username, Integer pid, Integer status)</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.JudgeUser(uid, username);</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productService.getProductById(pid);</span><br><span class="line">        <span class="keyword">if</span>(Objects.isNull(product)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ProductNotFoundException</span>(<span class="string">&quot;没有商品信息&quot;</span>);</span><br><span class="line">        LambdaUpdateWrapper&lt;Collect&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.set(Collect::getStatus, status)</span><br><span class="line">               .eq(Collect::getPid, pid)</span><br><span class="line">               .eq(Collect::getUid, uid);</span><br><span class="line">        <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> mapper.update(<span class="literal">null</span>, wrapper);</span><br><span class="line">        <span class="keyword">if</span>(row != <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;更新数据时发生异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>单元测试：略</strong></p>
</blockquote>
<h4 id="后端-控制层-20"><a href="#后端-控制层-20" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="设计请求-13"><a href="#设计请求-13" class="headerlink" title="设计请求"></a>设计请求</h5><blockquote>
<p><strong>请求路径：&#x2F;product&#x2F;add_collect</strong></p>
<p><strong>请求参数：HttpSession session，Integer pid</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt; Void &gt;</strong></p>
<p><strong>请求路径：&#x2F;product&#x2F;cancel_collect</strong></p>
<p><strong>请求参数：HttpSession session，Integer pid，Integer status</strong></p>
<p><strong>请求类型：POST</strong></p>
<p>**响应类型：JsonResult&lt; Void &gt; **</p>
</blockquote>
<h5 id="ProductController-3"><a href="#ProductController-3" class="headerlink" title="ProductController"></a>ProductController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/product&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;商品相关接口描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IProductService service;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    ICollectService collectService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;添加收藏&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户收藏商品&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 4000, message = &quot;数据插入失败&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 4001, message = &quot;数据更新失败&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 6004, message = &quot;商品不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 8000, message = &quot;用户未登录&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;pid&quot;, value = &quot;商品ID&quot;, required = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;add_collect&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">addCollect</span><span class="params">(HttpSession session, Integer pid)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">        collectService.addCollect(uid, username, pid);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;取消收藏&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户取消收藏&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 4001, message = &quot;数据更新失败&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 6004, message = &quot;商品不存在&quot;),</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 8000, message = &quot;用户未登录&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;pid&quot;, value = &quot;商品ID&quot;, required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;status&quot;, value = &quot;商品状态&quot;, required = true),</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;cancel_collect&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt;  <span class="title function_">cancelCollect</span><span class="params">(HttpSession session, Integer pid, Integer status)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">        collectService.setStatus(uid, username, pid, status);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口测试：略</strong></p>
</blockquote>
<h4 id="前端界面-19"><a href="#前端界面-19" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<p><strong>略</strong></p>
</blockquote>
<h2 id="商品搜索"><a href="#商品搜索" class="headerlink" title="商品搜索"></a>商品搜索</h2><h4 id="后端-持久层-21"><a href="#后端-持久层-21" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><blockquote>
<p><strong>与商品管理和收藏管理一致</strong></p>
</blockquote>
<h4 id="后端-业务层-21"><a href="#后端-业务层-21" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><blockquote>
<h5 id="IProductService-3"><a href="#IProductService-3" class="headerlink" title="IProductService"></a>IProductService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 处理商品数据的业务层接口 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IProductService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 搜索商品</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录的用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> keyWord 关键字</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 符合关键字的商品列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Collect&gt; <span class="title function_">searchProducts</span><span class="params">(Integer uid, String username, String keyWord)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ProductServiceImpl-3"><a href="#ProductServiceImpl-3" class="headerlink" title="ProductServiceImpl"></a>ProductServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IProductService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    ProductMapper mapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    ICollectService collectService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Collect&gt; <span class="title function_">searchProducts</span><span class="params">(Integer uid, String username, String keyWord)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;Collect&gt; collects = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        LambdaQueryWrapper&lt;Product&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.like(Product::getTitle, keyWord);</span><br><span class="line">        List&lt;Product&gt; products = mapper.selectList(wrapper);</span><br><span class="line">        <span class="keyword">if</span>(uid == -<span class="number">1</span> &amp;&amp; username.equals(<span class="string">&quot;-1&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            products.forEach(product -&gt; &#123;</span><br><span class="line">                <span class="type">Collect</span> <span class="variable">collect</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Collect</span>()&#123;&#123;</span><br><span class="line">                    setPid(product.getId());</span><br><span class="line">                    setPrice(product.getPrice());</span><br><span class="line">                    setImage(product.getImage());</span><br><span class="line">                    setTitle(product.getTitle());</span><br><span class="line">                &#125;&#125;;</span><br><span class="line">                collects.add(collect);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            products.forEach(product -&gt; &#123;</span><br><span class="line">                <span class="type">Integer</span> <span class="variable">status</span> <span class="operator">=</span> collectService.getStatus(uid, username, product.getId());</span><br><span class="line">                <span class="type">Collect</span> <span class="variable">collect</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Collect</span>()&#123;&#123;</span><br><span class="line">                    setPid(product.getId());</span><br><span class="line">                    setPrice(product.getPrice());</span><br><span class="line">                    setImage(product.getImage());</span><br><span class="line">                    setTitle(product.getTitle());</span><br><span class="line">                    setStatus(status);</span><br><span class="line">                &#125;&#125;;</span><br><span class="line">                collects.add(collect);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> collects;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>单元测试：略</strong></p>
</blockquote>
<h4 id="后端-控制层-21"><a href="#后端-控制层-21" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><blockquote>
<h5 id="设计请求-14"><a href="#设计请求-14" class="headerlink" title="设计请求"></a>设计请求</h5><blockquote>
<p><strong>请求路径：&#x2F;product&#x2F;search_product</strong></p>
<p><strong>请求参数：HttpSession session，String keyWord</strong></p>
<p><strong>请求类型：POST</strong></p>
<p><strong>响应类型：JsonResult&lt;List&lt; Collect &gt;&gt;</strong></p>
</blockquote>
<h5 id="ProductController-4"><a href="#ProductController-4" class="headerlink" title="ProductController"></a>ProductController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/product&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;商品相关接口描述&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    IProductService service;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    ICollectService collectService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取搜索商品&quot;, notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;描述:&lt;/span&gt;&amp;nbsp;&amp;nbsp;用于用户获取搜索商品，返回List&lt;Collect&gt;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">            @ApiResponse(code = 200, message = &quot;请求成功&quot;),</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;keyWord&quot;, value = &quot;关键词&quot;, required = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;search_product&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;List&lt;Collect&gt;&gt; <span class="title function_">searchProduce</span><span class="params">(HttpSession session, String keyWord)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;-1&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(!ObjectUtils.isEmpty(session))&#123;</span><br><span class="line">            uid = getUidFromSession(session);</span><br><span class="line">            username = getUsernameFromSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Collect&gt; collects = service.searchProducts(uid, username, keyWord);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, collects);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口测试：略</strong></p>
</blockquote>
<h4 id="前端界面-20"><a href="#前端界面-20" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<p><strong>略</strong></p>
</blockquote>
<h2 id="抽离公共页面"><a href="#抽离公共页面" class="headerlink" title="抽离公共页面"></a>抽离公共页面</h2><h4 id="前端界面-21"><a href="#前端界面-21" class="headerlink" title="前端界面"></a>前端界面</h4><blockquote>
<p><strong>将每个页面共有的部分抽取出来用js加载，如：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">    $(<span class="string">&quot;.header&quot;</span>).<span class="title function_">load</span>(<span class="string">&quot;template/head.html&quot;</span>)</span><br><span class="line">    $(<span class="string">&quot;.footer&quot;</span>).<span class="title function_">load</span>(<span class="string">&quot;template/footer.html&quot;</span>)</span><br><span class="line">    $(<span class="string">&quot;.middleBar&quot;</span>).<span class="title function_">load</span>(<span class="string">&quot;template/middleBar.html&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&lt;!--头部--&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line">&lt;!--导航 --&gt;</span><br><span class="line">&lt;!--分割导航和顶部--&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;middleBar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</blockquote>

  </div>
</article>




          
          <!-- //actions_mobile 移动端导航栏 -->
            <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" class="Popup" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/about/">关于</a></li>
        
      </ul>
    </div>

    <div id="toc-footer"  class="Popup" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E"><span class="toc-number">1.</span> <span class="toc-text">电脑商城</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">项目介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%8A%9F%E8%83%BD"><span class="toc-number">1.2.</span> <span class="toc-text">项目功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.3.</span> <span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">1.4.</span> <span class="toc-text">用户管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="toc-number">1.4.1.</span> <span class="toc-text">创建数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">1.4.2.</span> <span class="toc-text">创建实体类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#BaseEntity"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">BaseEntity</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#User"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">User</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C"><span class="toc-number">1.4.3.</span> <span class="toc-text">注册</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">后端-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#UserMapper"><span class="toc-number">1.4.3.1.1.</span> <span class="toc-text">UserMapper</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ServiceException"><span class="toc-number">1.4.3.2.1.</span> <span class="toc-text">ServiceException</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%BC%82%E5%B8%B8%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.3.2.2.</span> <span class="toc-text">其他异常类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#IUserService"><span class="toc-number">1.4.3.2.3.</span> <span class="toc-text">IUserService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UserServiceImpl"><span class="toc-number">1.4.3.2.4.</span> <span class="toc-text">UserServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#JsonResult"><span class="toc-number">1.4.3.3.1.</span> <span class="toc-text">JsonResult</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.3.3.2.</span> <span class="toc-text">异常类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#BaseController"><span class="toc-number">1.4.3.3.3.</span> <span class="toc-text">BaseController</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82"><span class="toc-number">1.4.3.3.4.</span> <span class="toc-text">设计请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AuthController"><span class="toc-number">1.4.3.3.5.</span> <span class="toc-text">AuthController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2"><span class="toc-number">1.4.3.4.</span> <span class="toc-text">前端界面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95"><span class="toc-number">1.4.4.</span> <span class="toc-text">登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-1"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">后端-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#UserMapper-1"><span class="toc-number">1.4.4.1.1.</span> <span class="toc-text">UserMapper</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-1"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#AuthService"><span class="toc-number">1.4.4.2.1.</span> <span class="toc-text">AuthService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SecurityConfiguration"><span class="toc-number">1.4.4.2.2.</span> <span class="toc-text">SecurityConfiguration</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-1"><span class="toc-number">1.4.4.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-1"><span class="toc-number">1.4.4.3.1.</span> <span class="toc-text">设计请求</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AuthController-1"><span class="toc-number">1.4.4.4.</span> <span class="toc-text">AuthController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-1"><span class="toc-number">1.4.4.5.</span> <span class="toc-text">前端界面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95"><span class="toc-number">1.4.5.</span> <span class="toc-text">退出登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-2"><span class="toc-number">1.4.5.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-2"><span class="toc-number">1.4.5.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-2"><span class="toc-number">1.4.5.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-2"><span class="toc-number">1.4.5.3.1.</span> <span class="toc-text">设计请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AuthController-2"><span class="toc-number">1.4.5.3.2.</span> <span class="toc-text">AuthController</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81"><span class="toc-number">1.4.6.</span> <span class="toc-text">修改密码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-3"><span class="toc-number">1.4.6.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-3"><span class="toc-number">1.4.6.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IUserService-1"><span class="toc-number">1.4.6.2.1.</span> <span class="toc-text">IUserService</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UserServiceImpl-1"><span class="toc-number">1.4.6.3.</span> <span class="toc-text">UserServiceImpl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-3"><span class="toc-number">1.4.6.4.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-3"><span class="toc-number">1.4.6.4.1.</span> <span class="toc-text">设计请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UserController"><span class="toc-number">1.4.6.4.2.</span> <span class="toc-text">UserController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-2"><span class="toc-number">1.4.6.5.</span> <span class="toc-text">前端界面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99"><span class="toc-number">1.4.7.</span> <span class="toc-text">修改个人资料</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-4"><span class="toc-number">1.4.7.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-4"><span class="toc-number">1.4.7.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IUserService-2"><span class="toc-number">1.4.7.2.1.</span> <span class="toc-text">IUserService</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UserServiceImpl-2"><span class="toc-number">1.4.7.3.</span> <span class="toc-text">UserServiceImpl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-4"><span class="toc-number">1.4.7.4.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-4"><span class="toc-number">1.4.7.4.1.</span> <span class="toc-text">设计请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UserController-1"><span class="toc-number">1.4.7.4.2.</span> <span class="toc-text">UserController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-3"><span class="toc-number">1.4.7.5.</span> <span class="toc-text">前端界面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E5%A4%B4%E5%83%8F"><span class="toc-number">1.4.8.</span> <span class="toc-text">上传头像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-5"><span class="toc-number">1.4.8.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-5"><span class="toc-number">1.4.8.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IUserService-3"><span class="toc-number">1.4.8.2.1.</span> <span class="toc-text">IUserService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UserService"><span class="toc-number">1.4.8.2.2.</span> <span class="toc-text">UserService</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-5"><span class="toc-number">1.4.8.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.4.8.3.1.</span> <span class="toc-text">请求设计</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UserController-2"><span class="toc-number">1.4.8.3.2.</span> <span class="toc-text">UserController</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#MvcConfig"><span class="toc-number">1.4.8.3.3.</span> <span class="toc-text">MvcConfig</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-4"><span class="toc-number">1.4.8.4.</span> <span class="toc-text">前端界面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E7%AE%A1%E7%90%86"><span class="toc-number">1.5.</span> <span class="toc-text">地址管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8-1"><span class="toc-number">1.5.1.</span> <span class="toc-text">创建数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB-1"><span class="toc-number">1.5.2.</span> <span class="toc-text">创建实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80"><span class="toc-number">1.5.3.</span> <span class="toc-text">添加收货地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-6"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">后端-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#AddressMapper"><span class="toc-number">1.5.3.1.1.</span> <span class="toc-text">AddressMapper</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DistrictMapper"><span class="toc-number">1.5.3.1.2.</span> <span class="toc-text">DistrictMapper</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-6"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IDistrictService"><span class="toc-number">1.5.3.2.1.</span> <span class="toc-text">IDistrictService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DistrictService"><span class="toc-number">1.5.3.2.2.</span> <span class="toc-text">DistrictService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#IAddressService"><span class="toc-number">1.5.3.2.3.</span> <span class="toc-text">IAddressService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AddressService"><span class="toc-number">1.5.3.2.4.</span> <span class="toc-text">AddressService</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-6"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E8%AE%BE%E8%AE%A1-1"><span class="toc-number">1.5.3.3.1.</span> <span class="toc-text">请求设计</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AddressController"><span class="toc-number">1.5.3.4.</span> <span class="toc-text">AddressController</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E8%AE%BE%E8%AE%A1-2"><span class="toc-number">1.5.3.4.1.</span> <span class="toc-text">请求设计</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DistrictController"><span class="toc-number">1.5.3.4.2.</span> <span class="toc-text">DistrictController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-5"><span class="toc-number">1.5.3.5.</span> <span class="toc-text">前端界面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80"><span class="toc-number">1.5.4.</span> <span class="toc-text">设置默认收货地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-7"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">后端-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#AddressMapper-1"><span class="toc-number">1.5.4.1.1.</span> <span class="toc-text">AddressMapper</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-7"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IAddressService-1"><span class="toc-number">1.5.4.2.1.</span> <span class="toc-text">IAddressService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AddressServiceImpl"><span class="toc-number">1.5.4.2.2.</span> <span class="toc-text">AddressServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-7"><span class="toc-number">1.5.4.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E8%AE%BE%E8%AE%A1-3"><span class="toc-number">1.5.4.3.1.</span> <span class="toc-text">请求设计</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AddressController-1"><span class="toc-number">1.5.4.3.2.</span> <span class="toc-text">AddressController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-6"><span class="toc-number">1.5.4.4.</span> <span class="toc-text">前端界面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80"><span class="toc-number">1.5.5.</span> <span class="toc-text">删除收货地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-8"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-8"><span class="toc-number">1.5.5.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IAddressService-2"><span class="toc-number">1.5.5.2.1.</span> <span class="toc-text">IAddressService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AddressServiceImpl-1"><span class="toc-number">1.5.5.2.2.</span> <span class="toc-text">AddressServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-8"><span class="toc-number">1.5.5.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E8%AE%BE%E8%AE%A1-4"><span class="toc-number">1.5.5.3.1.</span> <span class="toc-text">请求设计</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AddressController-2"><span class="toc-number">1.5.5.3.2.</span> <span class="toc-text">AddressController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-7"><span class="toc-number">1.5.5.4.</span> <span class="toc-text">前端界面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80"><span class="toc-number">1.5.6.</span> <span class="toc-text">修改收货地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-9"><span class="toc-number">1.5.6.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-9"><span class="toc-number">1.5.6.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IAddressService-3"><span class="toc-number">1.5.6.2.1.</span> <span class="toc-text">IAddressService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AddressServiceImpl-2"><span class="toc-number">1.5.6.2.2.</span> <span class="toc-text">AddressServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-9"><span class="toc-number">1.5.6.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E8%AE%BE%E8%AE%A1-5"><span class="toc-number">1.5.6.3.1.</span> <span class="toc-text">请求设计</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AddressController-3"><span class="toc-number">1.5.6.3.2.</span> <span class="toc-text">AddressController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-8"><span class="toc-number">1.5.6.4.</span> <span class="toc-text">前端界面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86"><span class="toc-number">1.6.</span> <span class="toc-text">商品管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8-2"><span class="toc-number">1.6.1.</span> <span class="toc-text">创建数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB-2"><span class="toc-number">1.6.2.</span> <span class="toc-text">创建实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%83%AD%E9%94%80%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8"><span class="toc-number">1.6.3.</span> <span class="toc-text">热销商品列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-10"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">后端-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ProductMapper"><span class="toc-number">1.6.3.1.1.</span> <span class="toc-text">ProductMapper</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-10"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IProductService"><span class="toc-number">1.6.3.2.1.</span> <span class="toc-text">IProductService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ProductServiceImpl"><span class="toc-number">1.6.3.2.2.</span> <span class="toc-text">ProductServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-10"><span class="toc-number">1.6.3.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E8%AE%BE%E8%AE%A1-6"><span class="toc-number">1.6.3.3.1.</span> <span class="toc-text">请求设计</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ProductController"><span class="toc-number">1.6.3.4.</span> <span class="toc-text">ProductController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-9"><span class="toc-number">1.6.3.5.</span> <span class="toc-text">前端界面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%88%B0%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8"><span class="toc-number">1.6.4.</span> <span class="toc-text">新到商品列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%95%86%E5%93%81%E4%BF%A1%E6%81%AF"><span class="toc-number">1.6.5.</span> <span class="toc-text">显示商品信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-11"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">后端-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ProductMapper-1"><span class="toc-number">1.6.5.1.1.</span> <span class="toc-text">ProductMapper</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-11"><span class="toc-number">1.6.5.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IProductService-1"><span class="toc-number">1.6.5.2.1.</span> <span class="toc-text">IProductService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ProductServiceImpl-1"><span class="toc-number">1.6.5.2.2.</span> <span class="toc-text">ProductServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-11"><span class="toc-number">1.6.5.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E8%AE%BE%E8%AE%A1-7"><span class="toc-number">1.6.5.3.1.</span> <span class="toc-text">请求设计</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ProductController-1"><span class="toc-number">1.6.5.3.2.</span> <span class="toc-text">ProductController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-10"><span class="toc-number">1.6.5.4.</span> <span class="toc-text">前端界面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%8B%E5%8D%B3%E8%B4%AD%E4%B9%B0"><span class="toc-number">1.6.6.</span> <span class="toc-text">立即购买</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-12"><span class="toc-number">1.6.6.1.</span> <span class="toc-text">后端-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ProductMapper-2"><span class="toc-number">1.6.6.1.1.</span> <span class="toc-text">ProductMapper</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OrderMapper"><span class="toc-number">1.6.6.1.2.</span> <span class="toc-text">OrderMapper</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-12"><span class="toc-number">1.6.6.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IOrderService"><span class="toc-number">1.6.6.2.1.</span> <span class="toc-text">IOrderService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OrderServiceImpl"><span class="toc-number">1.6.6.2.2.</span> <span class="toc-text">OrderServiceImpl</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#IProductService-2"><span class="toc-number">1.6.6.2.3.</span> <span class="toc-text">IProductService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ProductServiceImpl-2"><span class="toc-number">1.6.6.2.4.</span> <span class="toc-text">ProductServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-12"><span class="toc-number">1.6.6.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-5"><span class="toc-number">1.6.6.3.1.</span> <span class="toc-text">设计请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OrderController"><span class="toc-number">1.6.6.3.2.</span> <span class="toc-text">OrderController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-11"><span class="toc-number">1.6.6.4.</span> <span class="toc-text">前端界面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B4%AD%E7%89%A9%E8%BD%A6%E7%AE%A1%E7%90%86"><span class="toc-number">1.7.</span> <span class="toc-text">购物车管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8-3"><span class="toc-number">1.7.1.</span> <span class="toc-text">创建数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB-3"><span class="toc-number">1.7.2.</span> <span class="toc-text">创建实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAVO%E7%B1%BB"><span class="toc-number">1.7.3.</span> <span class="toc-text">创建VO类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">1.7.4.</span> <span class="toc-text">加入购物车</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-13"><span class="toc-number">1.7.4.1.</span> <span class="toc-text">后端-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#CartMapper"><span class="toc-number">1.7.4.1.1.</span> <span class="toc-text">CartMapper</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-13"><span class="toc-number">1.7.4.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ICartService"><span class="toc-number">1.7.4.2.1.</span> <span class="toc-text">ICartService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CartServiceImpl"><span class="toc-number">1.7.4.2.2.</span> <span class="toc-text">CartServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-13"><span class="toc-number">1.7.4.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-6"><span class="toc-number">1.7.4.3.1.</span> <span class="toc-text">设计请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CartController"><span class="toc-number">1.7.4.3.2.</span> <span class="toc-text">CartController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-12"><span class="toc-number">1.7.4.4.</span> <span class="toc-text">前端界面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%95%86%E5%93%81"><span class="toc-number">1.7.5.</span> <span class="toc-text">显示商品</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-14"><span class="toc-number">1.7.5.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-14"><span class="toc-number">1.7.5.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ICartService-1"><span class="toc-number">1.7.5.2.1.</span> <span class="toc-text">ICartService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CartServiceImpl-1"><span class="toc-number">1.7.5.2.2.</span> <span class="toc-text">CartServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-14"><span class="toc-number">1.7.5.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-7"><span class="toc-number">1.7.5.3.1.</span> <span class="toc-text">设计请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CartController-1"><span class="toc-number">1.7.5.3.2.</span> <span class="toc-text">CartController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-13"><span class="toc-number">1.7.5.4.</span> <span class="toc-text">前端界面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E9%99%A4%E5%95%86%E5%93%81"><span class="toc-number">1.7.6.</span> <span class="toc-text">移除商品</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-15"><span class="toc-number">1.7.6.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-15"><span class="toc-number">1.7.6.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ICartService-2"><span class="toc-number">1.7.6.2.1.</span> <span class="toc-text">ICartService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CartServiceImpl-2"><span class="toc-number">1.7.6.2.2.</span> <span class="toc-text">CartServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-15"><span class="toc-number">1.7.6.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-8"><span class="toc-number">1.7.6.3.1.</span> <span class="toc-text">设计请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CartController-2"><span class="toc-number">1.7.6.3.2.</span> <span class="toc-text">CartController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-14"><span class="toc-number">1.7.6.4.</span> <span class="toc-text">前端界面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E7%AE%A1%E7%90%86"><span class="toc-number">1.8.</span> <span class="toc-text">订单管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8-4"><span class="toc-number">1.8.0.1.</span> <span class="toc-text">创建数据表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB-4"><span class="toc-number">1.8.0.2.</span> <span class="toc-text">创建实体类</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Order"><span class="toc-number">1.8.0.2.1.</span> <span class="toc-text">Order</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OrderItem"><span class="toc-number">1.8.0.2.2.</span> <span class="toc-text">OrderItem</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAVO%E7%B1%BB-1"><span class="toc-number">1.8.0.3.</span> <span class="toc-text">创建VO类</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#OrderVO"><span class="toc-number">1.8.0.3.1.</span> <span class="toc-text">OrderVO</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E8%AE%A2%E5%8D%95"><span class="toc-number">1.8.1.</span> <span class="toc-text">显示订单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-16"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">后端-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#OrderMapper-1"><span class="toc-number">1.8.1.1.1.</span> <span class="toc-text">OrderMapper</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OrderItemMapper"><span class="toc-number">1.8.1.1.2.</span> <span class="toc-text">OrderItemMapper</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OrderVOMapper"><span class="toc-number">1.8.1.1.3.</span> <span class="toc-text">OrderVOMapper</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OrderVOMapper-xml"><span class="toc-number">1.8.1.1.4.</span> <span class="toc-text">OrderVOMapper.xml</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-16"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IOrderService-1"><span class="toc-number">1.8.1.2.1.</span> <span class="toc-text">IOrderService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OrderServiceImpl-1"><span class="toc-number">1.8.1.2.2.</span> <span class="toc-text">OrderServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-16"><span class="toc-number">1.8.1.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-9"><span class="toc-number">1.8.1.3.1.</span> <span class="toc-text">设计请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OrderController-1"><span class="toc-number">1.8.1.3.2.</span> <span class="toc-text">OrderController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-15"><span class="toc-number">1.8.1.4.</span> <span class="toc-text">前端界面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%AE%A2%E5%8D%95"><span class="toc-number">1.8.2.</span> <span class="toc-text">创建订单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-17"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-17"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IOrderService-2"><span class="toc-number">1.8.2.2.1.</span> <span class="toc-text">IOrderService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OrderServiceImpl-2"><span class="toc-number">1.8.2.2.2.</span> <span class="toc-text">OrderServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-17"><span class="toc-number">1.8.2.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-10"><span class="toc-number">1.8.2.3.1.</span> <span class="toc-text">设计请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OrderController-2"><span class="toc-number">1.8.2.3.2.</span> <span class="toc-text">OrderController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-16"><span class="toc-number">1.8.2.4.</span> <span class="toc-text">前端界面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%BB%E4%BB%98%E6%AC%BE"><span class="toc-number">1.8.3.</span> <span class="toc-text">去付款</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%AE%A2%E5%8D%95"><span class="toc-number">1.8.4.</span> <span class="toc-text">删除订单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-18"><span class="toc-number">1.8.4.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-18"><span class="toc-number">1.8.4.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IOrderService-3"><span class="toc-number">1.8.4.2.1.</span> <span class="toc-text">IOrderService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OrderServiceImpl-3"><span class="toc-number">1.8.4.2.2.</span> <span class="toc-text">OrderServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-18"><span class="toc-number">1.8.4.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-11"><span class="toc-number">1.8.4.3.1.</span> <span class="toc-text">设计请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OrderController-3"><span class="toc-number">1.8.4.3.2.</span> <span class="toc-text">OrderController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-17"><span class="toc-number">1.8.4.4.</span> <span class="toc-text">前端界面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%B6%E8%97%8F%E7%AE%A1%E7%90%86"><span class="toc-number">1.9.</span> <span class="toc-text">收藏管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8-5"><span class="toc-number">1.9.1.</span> <span class="toc-text">创建数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB-5"><span class="toc-number">1.9.2.</span> <span class="toc-text">创建实体类</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Collect"><span class="toc-number">1.9.2.0.1.</span> <span class="toc-text">Collect</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E6%94%B6%E8%97%8F"><span class="toc-number">1.9.3.</span> <span class="toc-text">显示收藏</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-19"><span class="toc-number">1.9.3.1.</span> <span class="toc-text">后端-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#CollectMapper"><span class="toc-number">1.9.3.1.1.</span> <span class="toc-text">CollectMapper</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-19"><span class="toc-number">1.9.3.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ICollectService"><span class="toc-number">1.9.3.2.1.</span> <span class="toc-text">ICollectService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CollectServiceImpl"><span class="toc-number">1.9.3.2.2.</span> <span class="toc-text">CollectServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-19"><span class="toc-number">1.9.3.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-12"><span class="toc-number">1.9.3.3.1.</span> <span class="toc-text">设计请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ProductController-2"><span class="toc-number">1.9.3.3.2.</span> <span class="toc-text">ProductController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-18"><span class="toc-number">1.9.3.4.</span> <span class="toc-text">前端界面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5-x2F-%E5%8F%96%E6%B6%88%E6%94%B6%E8%97%8F"><span class="toc-number">1.9.4.</span> <span class="toc-text">加入&#x2F;取消收藏</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-20"><span class="toc-number">1.9.4.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-20"><span class="toc-number">1.9.4.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ICollectService-1"><span class="toc-number">1.9.4.2.1.</span> <span class="toc-text">ICollectService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CollectServiceImpl-1"><span class="toc-number">1.9.4.2.2.</span> <span class="toc-text">CollectServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-20"><span class="toc-number">1.9.4.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-13"><span class="toc-number">1.9.4.3.1.</span> <span class="toc-text">设计请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ProductController-3"><span class="toc-number">1.9.4.3.2.</span> <span class="toc-text">ProductController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-19"><span class="toc-number">1.9.4.4.</span> <span class="toc-text">前端界面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2"><span class="toc-number">1.10.</span> <span class="toc-text">商品搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-21"><span class="toc-number">1.10.0.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-21"><span class="toc-number">1.10.0.2.</span> <span class="toc-text">后端-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IProductService-3"><span class="toc-number">1.10.0.2.1.</span> <span class="toc-text">IProductService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ProductServiceImpl-3"><span class="toc-number">1.10.0.2.2.</span> <span class="toc-text">ProductServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-21"><span class="toc-number">1.10.0.3.</span> <span class="toc-text">后端-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-14"><span class="toc-number">1.10.0.3.1.</span> <span class="toc-text">设计请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ProductController-4"><span class="toc-number">1.10.0.3.2.</span> <span class="toc-text">ProductController</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-20"><span class="toc-number">1.10.0.4.</span> <span class="toc-text">前端界面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%BD%E7%A6%BB%E5%85%AC%E5%85%B1%E9%A1%B5%E9%9D%A2"><span class="toc-number">1.11.</span> <span class="toc-text">抽离公共页面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2-21"><span class="toc-number">1.11.0.1.</span> <span class="toc-text">前端界面</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer"  class="Popup" style="display: none">
      <ul>
  <li> 开发中. </li>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&text=电脑商城"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&title=电脑商城"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&is_video=false&description=电脑商城"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=电脑商城&body=Check out this article: http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&title=电脑商城"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&title=电脑商城"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&title=电脑商城"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&title=电脑商城"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&name=电脑商城&description=&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;项目实践&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/12/03/2022-12-03-%E7%94%B5%E8%84%91%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/&t=电脑商城"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li> -->

</ul>

    </div>

    <div id="actions-footer">
        <span id="menu" Popup="#nav-footer" class="icon"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</span>
        <span id="toc" Popup="#toc-footer" class="icon"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</span>
        <span id="share" Popup="#share-footer" class="icon"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</span>
        <span id="top" Popup="" style="display:none" class="icon" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</span>
    </div>

  </div>
</div>

            <!-- 图片弹窗 -->
            <div class="img-pup" style="display: none;">
              <img>
            </div>
          

          <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2019-2023
    t1k
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/about/">关于</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

          <!-- jquery -->
 
  
<script src="/lib/jquery/jquery.min.js"></script>



<script src="/lib/jquery/jquery.pjax.js"></script>



<!-- clipboard -->

   
    
<script src="/lib/clipboard/clipboard.min.js"></script>

  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
      setTimeout(()=>{
        e.trigger.setAttribute('aria-label', "复制到粘贴板!");
      },1500)
    })
  })
  </script>



<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

     
      </div>   
    </div>
      
    
<script src="/js/main.js"></script>

    </body>
    </html>